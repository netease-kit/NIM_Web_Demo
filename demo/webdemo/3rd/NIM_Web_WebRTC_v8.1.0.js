!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebRTC=t():e.WebRTC=t()}(window,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=694)}([function(e,t,r){"use strict";var i,a=r(9),n=(i=a)&&i.__esModule?i:{default:i};var o=r(92),s=r(86);r(122);var d,c,u=r(17),l=u.getGlobal(),p=/\s+/;u.deduplicate=function(e){var t=[];return e.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),t},u.capFirstLetter=function(e){return e?(e=""+e).slice(0,1).toUpperCase()+e.slice(1):""},u.guid=(d=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return d()+d()+d()+d()+d()+d()+d()+d()}),u.extend=function(e,t,r){for(var i in t)void 0!==e[i]&&!0!==r||(e[i]=t[i])},u.filterObj=function(e,t){var r={};return u.isString(t)&&(t=t.split(p)),t.forEach(function(t){e.hasOwnProperty(t)&&(r[t]=e[t])}),r},u.copy=function(e,t){return t=t||{},e?(Object.keys(e).forEach(function(r){u.exist(e[r])&&(t[r]=e[r])}),t):t},u.copyWithNull=function(e,t){return t=t||{},e?(Object.keys(e).forEach(function(r){(u.exist(e[r])||u.isnull(e[r]))&&(t[r]=e[r])}),t):t},u.findObjIndexInArray=function(e,t){e=e||[];var r=t.keyPath||"id",i=-1;return e.some(function(e,a){if(s(e,r)===t.value)return i=a,!0}),i},u.findObjInArray=function(e,t){var r=u.findObjIndexInArray(e,t);return-1===r?null:e[r]},u.mergeObjArray=function(){var e=[],t=[].slice.call(arguments,0,-1),r=arguments[arguments.length-1];u.isArray(r)&&(t.push(r),r={});var i,a=r.keyPath=r.keyPath||"id";for(r.sortPath=r.sortPath||a;!e.length&&t.length;)e=(e=t.shift()||[]).slice(0);return t.forEach(function(t){t&&t.forEach(function(t){-1!==(i=u.findObjIndexInArray(e,{keyPath:a,value:s(t,a)}))?e[i]=u.merge({},e[i],t):e.push(t)})}),r.notSort||(e=u.sortObjArray(e,r)),e},u.cutObjArray=function(e){var t=e.slice(0),r=arguments.length,i=[].slice.call(arguments,1,r-1),a=arguments[r-1];u.isObject(a)||(i.push(a),a={});var n,o=a.keyPath=a.keyPath||"id";return i.forEach(function(e){u.isArray(e)||(e=[e]),e.forEach(function(e){e&&(a.value=s(e,o),-1!==(n=u.findObjIndexInArray(t,a))&&t.splice(n,1))})}),t},u.sortObjArray=function(e,t){var r=(t=t||{}).sortPath||"id";o.insensitive=!!t.insensitive;var i,a,n,d=!!t.desc;return n=u.isFunction(t.compare)?t.compare:function(e,t){return i=s(e,r),a=s(t,r),d?o(a,i):o(i,a)},e.sort(n)},u.emptyFunc=function(){},u.isEmptyFunc=function(e){return e===u.emptyFunc},u.notEmptyFunc=function(e){return e!==u.emptyFunc},u.splice=function(e,t,r){return[].splice.call(e,t,r)},u.reshape2d=function(e,t){if(Array.isArray(e)){u.verifyParamType("type",t,"number","util::reshape2d");var r=e.length;if(r<=t)return[e];for(var i=Math.ceil(r/t),a=[],n=0;n<i;n++)a.push(e.slice(n*t,(n+1)*t));return a}return e},u.flatten2d=function(e){if(Array.isArray(e)){var t=[];return e.forEach(function(e){t=t.concat(e)}),t}return e},u.dropArrayDuplicates=function(e){if(Array.isArray(e)){for(var t={},r=[];e.length>0;){t[e.shift()]=!0}for(var i in t)!0===t[i]&&r.push(i);return r}return e},u.onError=function(e){throw new function(e){"object"===(void 0===e?"undefined":(0,n.default)(e))?(this.callFunc=e.callFunc||null,this.message=e.message||"UNKNOW ERROR"):this.message=e,this.time=new Date,this.timetag=+this.time}(e)},u.verifyParamPresent=function(e,t,r,i){r=r||"";var a=!1;switch(u.typeOf(t)){case"undefined":case"null":a=!0;break;case"string":""===t&&(a=!0);break;case"StrStrMap":case"object":Object.keys(t).length||(a=!0);break;case"array":t.length?t.some(function(e){if(u.notexist(e))return a=!0,!0}):a=!0}a&&u.onParamAbsent(r+e,i)},u.onParamAbsent=function(e,t){u.onParamError("缺少参数 "+e+", 请确保参数不是 空字符串、空对象、空数组、null或undefined, 或数组的内容不是 null/undefined",t)},u.verifyParamAbsent=function(e,t,r,i){r=r||"",void 0!==t&&u.onParamPresent(r+e,i)},u.onParamPresent=function(e,t){u.onParamError("多余的参数 "+e,t)},u.verifyParamType=function(e,t,r,i){var a=u.typeOf(t).toLowerCase();u.isArray(r)||(r=[r]);var n=!0;switch(-1===(r=r.map(function(e){return e.toLowerCase()})).indexOf(a)&&(n=!1),a){case"number":isNaN(t)&&(n=!1);break;case"string":"numeric or numeric string"===r.join("")&&(n=!!/^[0-9]+$/.test(t))}n||u.onParamInvalidType(e,r,"",i)},u.onParamInvalidType=function(e,t,r,i){r=r||"",t=u.isArray(t)?(t=t.map(function(e){return'"'+e+'"'})).join(", "):'"'+t+'"',u.onParamError('参数"'+r+e+'"类型错误, 合法的类型包括: ['+t+"]",i)},u.verifyParamValid=function(e,t,r,i){u.isArray(r)||(r=[r]),-1===r.indexOf(t)&&u.onParamInvalidValue(e,r,i)},u.onParamInvalidValue=function(e,t,r){u.isArray(t)||(t=[t]),t=t.map(function(e){return'"'+e+'"'}),u.isArray(t)&&(t=t.join(", ")),u.onParamError("参数 "+e+"值错误, 合法的值包括: ["+JSON.stringify(t)+"]",r)},u.verifyParamMin=function(e,t,r,i){t<r&&u.onParamError("参数"+e+"的值不能小于"+r,i)},u.verifyParamMax=function(e,t,r,i){t>r&&u.onParamError("参数"+e+"的值不能大于"+r,i)},u.verifyArrayMax=function(e,t,r,i){t.length>r&&u.onParamError("参数"+e+"的长度不能大于"+r,i)},u.verifyEmail=(c=/^\S+@\S+$/,function(e,t,r){c.test(t)||u.onParamError("参数"+e+"邮箱格式错误, 合法格式必须包含@符号, @符号前后至少要各有一个字符",r)}),u.verifyTel=function(){var e=/^[+\-()\d]+$/;return function(t,r,i){e.test(r)||u.onParamError("参数"+t+"电话号码格式错误, 合法字符包括+、-、英文括号和数字",i)}}(),u.verifyBirth=function(){var e=/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/;return function(t,r,i){e.test(r)||u.onParamError("参数"+t+'生日格式错误, 合法为"yyyy-MM-dd"',i)}}(),u.onParamError=function(e,t){u.onError({message:e,callFunc:t})},u.verifyOptions=function(e,t,r,i,a){if(e=e||{},t&&(u.isString(t)&&(t=t.split(p)),u.isArray(t))){"boolean"!=typeof r&&(a=r||null,r=!0,i="");var n=r?u.verifyParamPresent:u.verifyParamAbsent;t.forEach(function(t){n.call(u,t,e[t],i,a)})}return e},u.verifyParamAtLeastPresentOne=function(e,t,r){t&&(u.isString(t)&&(t=t.split(p)),u.isArray(t)&&(t.some(function(t){return u.exist(e[t])})||u.onParamError("以下参数["+t.join(", ")+"]至少需要传入一个",r)))},u.verifyParamPresentJustOne=function(e,t,r){t&&(u.isString(t)&&(t=t.split(p)),u.isArray(t)&&1!==t.reduce(function(t,r){return u.exist(e[r])&&t++,t},0)&&u.onParamError("以下参数["+t.join(", ")+"]必须且只能传入一个",r))},u.verifyBooleanWithDefault=function(e,t,r,i,a){u.undef(r)&&(r=!0),p.test(t)&&(t=t.split(p)),u.isArray(t)?t.forEach(function(t){u.verifyBooleanWithDefault(e,t,r,i,a)}):void 0===e[t]?e[t]=r:u.isBoolean(e[t])||u.onParamInvalidType(t,"boolean",i,a)},u.verifyFileInput=function(e,t){return u.verifyParamPresent("fileInput",e,"",t),u.isString(e)&&((e="undefined"==typeof document?void 0:document.getElementById(e))||u.onParamError("找不到要上传的文件对应的input, 请检查fileInput id "+e,t)),e.tagName&&"input"===e.tagName.toLowerCase()&&"file"===e.type.toLowerCase()||u.onParamError("请提供正确的 fileInput, 必须为 file 类型的 input 节点 tagname:"+e.tagName+", filetype:"+e.type,t),e},u.verifyFileType=function(e,t){u.verifyParamValid("type",e,u.validFileTypes,t)},u.verifyCallback=function(e,t,r){p.test(t)&&(t=t.split(p)),u.isArray(t)?t.forEach(function(t){u.verifyCallback(e,t,r)}):e[t]?u.isFunction(e[t])||u.onParamInvalidType(t,"function","",r):e[t]=u.emptyFunc},u.verifyFileUploadCallback=function(e,t){u.verifyCallback(e,"uploadprogress uploaddone uploaderror uploadcancel",t)},u.validFileTypes=["image","audio","video","file"],u.validFileExts={image:["bmp","gif","jpg","jpeg","jng","png","webp"],audio:["mp3","wav","aac","wma","wmv","amr","mp2","flac","vorbis","ac3"],video:["mp4","rm","rmvb","wmv","avi","mpg","mpeg","mov"]},u.filterFiles=function(e,t){var r,i,a="file"===(t=t.toLowerCase()),n=[];return[].forEach.call(e,function(e){if(a)n.push(e);else if(r=e.name.slice(e.name.lastIndexOf(".")+1),(i=e.type.split("/"))[0]&&i[1]){(i[0].toLowerCase()===t||-1!==u.validFileExts[t].indexOf(r))&&n.push(e)}}),n};var f,h,m=u.supportFormData=u.notundef(l.FormData);u.getFileName=function(e){return e=u.verifyFileInput(e),m?e.files[0].name:e.value.slice(e.value.lastIndexOf("\\")+1)},u.getFileInfo=(f={ppt:1,pptx:2,pdf:3},function(e){var t={};if(!(e=u.verifyFileInput(e)).files)return t;var r=e.files[0];return m&&(t.name=r.name,t.size=r.size,t.type=r.name.match(/\.(\w+)$/),t.type=t.type&&t.type[1].toLowerCase(),t.transcodeType=f[t.type]||0),t}),u.sizeText=(h=["B","KB","MB","GB","TB","PB","EB","ZB","BB"],function(e){var t,r=0;do{t=(e=Math.floor(100*e)/100)+h[r],e/=1024,r++}while(e>1);return t}),u.promises2cmds=function(e){return e.map(function(e){return e.cmd})},u.objs2accounts=function(e){return e.map(function(e){return e.account})},u.teams2ids=function(e){return e.map(function(e){return e.teamId})},u.objs2ids=function(e){return e.map(function(e){return e.id})},u.getMaxUpdateTime=function(e){var t=e.map(function(e){return+e.updateTime});return Math.max.apply(Math,t)},u.genCheckUniqueFunc=function(e,t){return e=e||"id",t=t||1e3,function(t){this.uniqueSet=this.uniqueSet||{},this.uniqueSet[e]=this.uniqueSet[e]||{};var r=this.uniqueSet[e],i=t[e];return!r[i]&&(r[i]=!0,!0)}},u.fillPropertyWithDefault=function(e,t,r){return!!u.undef(e[t])&&(e[t]=r,!0)},e.exports=u},function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,r){"use strict";t.__esModule=!0;var i,a=r(156),n=(i=a)&&i.__esModule?i:{default:i};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}()},function(e,t,r){"use strict";t.__esModule=!0;var i=o(r(229)),a=o(r(225)),n=o(r(9));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,n.default)(t)));e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i.default?(0,i.default)(e,t):e.__proto__=t)}},function(e,t,r){"use strict";t.__esModule=!0;var i,a=r(9),n=(i=a)&&i.__esModule?i:{default:i};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,n.default)(t))&&"function"!=typeof t?e:t}},function(e,t,r){"use strict";var i,a=r(9),n=(i=a)&&i.__esModule?i:{default:i};r(0);var o="object"===("undefined"==typeof localStorage?"undefined":(0,n.default)(localStorage))&&"function"==typeof localStorage.setItem&&"function"==typeof localStorage.getItem,s={nodeEnv:"production",msgStatEnv:"online",info:{hash:"22910da3c3384f2589f2b5f182e36c7c4febc98d",shortHash:"22910da3c",version:"8.1.0",sdkVersion:"150",nrtcVersion:"5.1.0",nrtcSdkVersion:"1",protocolVersion:1},agentVersion:"3.0.1",lbsUrl:"https://lbs.netease.im/lbs/webconf.jsp",roomserver:"roomserver.netease.im",connectTimeout:8e3,xhrTimeout:8e3,socketTimeout:8e3,reconnectionDelay:1600,reconnectionDelayMax:8e3,reconnectionJitter:.01,reconnectiontimer:null,heartbeatInterval:6e4,cmdTimeout:8e3,defaultReportUrl:"https://dr.netease.im/1.gif",isWeixinApp:!1,isNodejs:!1,isRN:!1,ipVersion:0,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,PushPermissionAsked:!1,iosPushConfig:null,androidPushConfig:null,netDetectAddr:"https://roomserver-dev.netease.im/v1/sdk/detect/local",optionDefaultLinkUrl:"",defaultLinkUrl:"weblink.netease.im",ipv6DefaultLinkUrl:"weblink.netease.im",optionIpv6DefaultLinkUrl:"",wxDefaultLinkUrl:"wlnimsc0.netease.im",serverNosConfig:o?{cdnDomain:localStorage.getItem("nim_cdn_domain")||"",objectPrefix:localStorage.getItem("nim_object_prefix")||""}:{},hasLocalStorage:o,getDefaultLinkUrl:function(e){var t,r;1===s.ipVersion?(t=s.optionIpv6DefaultLinkUrl,r=s.ipv6DefaultLinkUrl):(t=s.optionDefaultLinkUrl,r=s.defaultLinkUrl);var i=t||(s.isWeixinApp?s.wxDefaultLinkUrl:r);if(!i)return!1;var a=e?"https":"http",n=e?"443":"80",o=i;return-1===i.indexOf("http")&&(o=a+"://"+o),-1===i.indexOf(":")&&(o=o+":"+n),o}};s.weixinNetcall=s.nrtcNetcall={checkSumUrl:"https://nrtc.netease.im/demo/getChecksum.action",getChannelInfoUrl:"https://nrtc.netease.im/nrtc/getChannelInfos.action"},s.ipProbeAddr={ipv4:"https://detect4.netease.im/test/",ipv6:"https://detect6.netease.im/test/"},s.nrtcWebRTC2={checkSumUrl:"",getChannelInfoUrl:""},s.formatSocketUrl=function(e){var t=e.url,r=e.secure?"https":"http";return-1===t.indexOf("http")?r+"://"+t:t},s.uploadUrl="https://nos.netease.com",s.chunkUploadUrl="https://wanproxy-web.127.net",s.commonMaxSize=104857600,s.chunkSize=4194304,s.chunkMaxSize=4194304e4,s.replaceUrl="https://{bucket}-nosdn.netease.im/{object}",s.downloadHost="nos.netease.com",s.downloadHostList=["nos.netease.com"],s.nosCdnEnable=!0,s.downloadUrl="https://{bucket}-nosdn.netease.im/{object}",s.httpsEnabled=!1,s.threshold=0,s.lbsUrls=["http://wanproxy.127.net/lbs","http://wanproxy-bj.127.net/lbs","http://wanproxy-hz.127.net/lbs","http://wanproxy-oversea.127.net/lbs"],s.genUploadUrl=function(e){return s.uploadUrl+"/"+e},s.genChunkUploadUrl=function(e){return s.chunkUploadUrl?s.chunkUploadUrl+"/"+e.bucket+"/"+e.objectName:""},s.genDownloadUrl=function(e,t,r){var i=e.bucket,a=(e.tag,e.expireSec),n=+new Date,o=a?"&survivalTime="+a:"";if(r)return"https://"+r+"/"+t+"?createTime="+n+o;var d=s.replaceUrl+"?createTime="+n+o;return(d=s.genNosProtocolUrl(d)).replace("{bucket}",i).replace("{object}",t)},s.genFileUrl=function(e){var t=e.bucket,r=e.objectName;return s.genNosProtocolUrl(s.replaceUrl).replace("{bucket}",t).replace("{object}",r)},s.genNosProtocolUrl=function(e){return/^http/.test(e)?s.httpsEnabled&&0!==e.indexOf("https://")&&(e=e.replace("http","https")):e=s.httpsEnabled?"https://"+e:"http://"+e,e},e.exports=s},function(e,t){var r=e.exports={version:"2.5.5"};"number"==typeof __e&&(__e=r)},function(e,t,r){var i=r(57)("wks"),a=r(40),n=r(8).Symbol,o="function"==typeof n;(e.exports=function(e){return i[e]||(i[e]=o&&n[e]||(o?n:a)("Symbol."+e))}).store=i},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){"use strict";t.__esModule=!0;var i=o(r(141)),a=o(r(131)),n="function"==typeof a.default&&"symbol"==typeof i.default?function(e){return typeof e}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof a.default&&"symbol"===n(i.default)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":void 0===e?"undefined":n(e)}},,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(318);Object.defineProperty(t,"EVENT_OBJ",{enumerable:!0,get:function(){return i.EVENT_OBJ}}),Object.defineProperty(t,"EVENT_CODE",{enumerable:!0,get:function(){return i.EVENT_CODE}});var a=r(315);Object.defineProperty(t,"PushConfig",{enumerable:!0,get:function(){return a.PushConfig}}),Object.defineProperty(t,"SessionConfig",{enumerable:!0,get:function(){return a.SessionConfig}}),Object.defineProperty(t,"NetcallOption",{enumerable:!0,get:function(){return a.NetcallOption}}),Object.defineProperty(t,"WebRTCOption",{enumerable:!0,get:function(){return a.WebRTCOption}}),Object.defineProperty(t,"NRTCOption",{enumerable:!0,get:function(){return a.NRTCOption}}),Object.defineProperty(t,"ApiParams",{enumerable:!0,get:function(){return a.ApiParams}}),Object.defineProperty(t,"VIDEO_QUALITY",{enumerable:!0,get:function(){return a.VIDEO_QUALITY}}),Object.defineProperty(t,"VIDEO_QUALITY_REV",{enumerable:!0,get:function(){return a.VIDEO_QUALITY_REV}}),Object.defineProperty(t,"validateVideoQuality",{enumerable:!0,get:function(){return a.validateVideoQuality}}),Object.defineProperty(t,"VIDEO_FRAME_RATE",{enumerable:!0,get:function(){return a.VIDEO_FRAME_RATE}}),Object.defineProperty(t,"VIDEO_FRAME_RATE_REV",{enumerable:!0,get:function(){return a.VIDEO_FRAME_RATE_REV}}),Object.defineProperty(t,"validateVideoFrameRate",{enumerable:!0,get:function(){return a.validateVideoFrameRate}}),Object.defineProperty(t,"ENCRYPTION_ALGORITHM_MODE",{enumerable:!0,get:function(){return a.ENCRYPTION_ALGORITHM_MODE}}),Object.defineProperty(t,"CONTROL_TYPE",{enumerable:!0,get:function(){return a.CONTROL_TYPE}}),Object.defineProperty(t,"CONFIG_MAP",{enumerable:!0,get:function(){return a.CONFIG_MAP}}),Object.defineProperty(t,"DECTECT_RESULT_TYPE",{enumerable:!0,get:function(){return a.DECTECT_RESULT_TYPE}}),Object.defineProperty(t,"DECTECT_TYPE",{enumerable:!0,get:function(){return a.DECTECT_TYPE}}),Object.defineProperty(t,"DEVICE_TYPE",{enumerable:!0,get:function(){return a.DEVICE_TYPE}}),Object.defineProperty(t,"DEVICE_TYPE_REV",{enumerable:!0,get:function(){return a.DEVICE_TYPE_REV}}),Object.defineProperty(t,"NETCALL_TYPE",{enumerable:!0,get:function(){return a.NETCALL_TYPE}}),Object.defineProperty(t,"SCALE_TYPE",{enumerable:!0,get:function(){return a.SCALE_TYPE}}),Object.defineProperty(t,"SPLIT_MODE",{enumerable:!0,get:function(){return a.SPLIT_MODE}}),Object.defineProperty(t,"MIX_VIDEO_MODE",{enumerable:!0,get:function(){return a.MIX_VIDEO_MODE}}),Object.defineProperty(t,"VIDEO_ENCODE_MODE",{enumerable:!0,get:function(){return a.VIDEO_ENCODE_MODE}}),Object.defineProperty(t,"ROLE_FOR_MEETING",{enumerable:!0,get:function(){return a.ROLE_FOR_MEETING}}),Object.defineProperty(t,"SESSION_MODE",{enumerable:!0,get:function(){return a.SESSION_MODE}}),Object.defineProperty(t,"DEFAULT_PUSH_CONFIG",{enumerable:!0,get:function(){return a.DEFAULT_PUSH_CONFIG}}),Object.defineProperty(t,"DEFAULT_SESSION_CONFIG",{enumerable:!0,get:function(){return a.DEFAULT_SESSION_CONFIG}}),Object.defineProperty(t,"DEFAULT_NETCALL_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_NETCALL_OPTION}}),Object.defineProperty(t,"DEFAULT_WEBRTC_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_WEBRTC_OPTION}}),Object.defineProperty(t,"DEFAULT_NRTC_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_NRTC_OPTION}}),Object.defineProperty(t,"GATE_WAY_RESPONSE_CODE",{enumerable:!0,get:function(){return a.GATE_WAY_RESPONSE_CODE}});var n=r(280);Object.defineProperty(t,"CLIENT_JOIN_OF_WEBRTC",{enumerable:!0,get:function(){return n.CLIENT_JOIN_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_LOGIN_OF_WEBRTC",{enumerable:!0,get:function(){return n.CLIENT_LOGIN_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_LOGOUT_OF_WEBRTC",{enumerable:!0,get:function(){return n.CLIENT_LOGOUT_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_ERROR_OF_WEBRTC",{enumerable:!0,get:function(){return n.CLIENT_ERROR_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_DETECT_NETWORK_RESULT_WEBRTC",{enumerable:!0,get:function(){return n.CLIENT_DETECT_NETWORK_RESULT_WEBRTC}}),Object.defineProperty(t,"CLIENT_UPDATE_OF_WEBRTC",{enumerable:!0,get:function(){return n.CLIENT_UPDATE_OF_WEBRTC}}),Object.defineProperty(t,"ICE_ANSWER_OF_WEBRTC",{enumerable:!0,get:function(){return n.ICE_ANSWER_OF_WEBRTC}}),Object.defineProperty(t,"ICE_OFFER_OF_WEBRTC",{enumerable:!0,get:function(){return n.ICE_OFFER_OF_WEBRTC}}),Object.defineProperty(t,"KEEP_ALIVE_ACK_OF_WEBRTC",{enumerable:!0,get:function(){return n.KEEP_ALIVE_ACK_OF_WEBRTC}}),Object.defineProperty(t,"KEEP_ALIVE_OF_WEBRTC",{enumerable:!0,get:function(){return n.KEEP_ALIVE_OF_WEBRTC}}),Object.defineProperty(t,"LOGIN_ACK_OF_WEBRTC",{enumerable:!0,get:function(){return n.LOGIN_ACK_OF_WEBRTC}}),Object.defineProperty(t,"LOGOUT_OF_WEBRTC",{enumerable:!0,get:function(){return n.LOGOUT_OF_WEBRTC}}),Object.defineProperty(t,"SDP_ANSWER_OF_WEBRTC",{enumerable:!0,get:function(){return n.SDP_ANSWER_OF_WEBRTC}}),Object.defineProperty(t,"SDP_OFFER_OF_WEBRTC",{enumerable:!0,get:function(){return n.SDP_OFFER_OF_WEBRTC}}),Object.defineProperty(t,"SDP_UPDATE_OF_WEBRTC",{enumerable:!0,get:function(){return n.SDP_UPDATE_OF_WEBRTC}}),Object.defineProperty(t,"WEBRTC_GATE_WAY_API",{enumerable:!0,get:function(){return n.WEBRTC_GATE_WAY_API}}),Object.defineProperty(t,"WEBRTC2_GATE_WAY_API",{enumerable:!0,get:function(){return n.WEBRTC2_GATE_WAY_API}}),Object.defineProperty(t,"CLIENT_LOGIN_OF_WEBRTC2",{enumerable:!0,get:function(){return n.CLIENT_LOGIN_OF_WEBRTC2}}),Object.defineProperty(t,"LOGIN_ACK_OF_WEBRTC2",{enumerable:!0,get:function(){return n.LOGIN_ACK_OF_WEBRTC2}}),Object.defineProperty(t,"KEEP_ALIVE_OF_WEBRTC2",{enumerable:!0,get:function(){return n.KEEP_ALIVE_OF_WEBRTC2}}),Object.defineProperty(t,"KEEP_ALIVE_ACK_OF_WEBRTC2",{enumerable:!0,get:function(){return n.KEEP_ALIVE_ACK_OF_WEBRTC2}}),Object.defineProperty(t,"LOGOUT_OF_WEBRTC2",{enumerable:!0,get:function(){return n.LOGOUT_OF_WEBRTC2}}),Object.defineProperty(t,"USER_UPDATE_WEBRTC2",{enumerable:!0,get:function(){return n.USER_UPDATE_WEBRTC2}}),Object.defineProperty(t,"MEDIA_UPDATE_WEBRTC2",{enumerable:!0,get:function(){return n.MEDIA_UPDATE_WEBRTC2}}),Object.defineProperty(t,"SUB_SOURCE_WEBRTC2",{enumerable:!0,get:function(){return n.SUB_SOURCE_WEBRTC2}}),Object.defineProperty(t,"SSRC_UPDATE_WEBRTC2",{enumerable:!0,get:function(){return n.SSRC_UPDATE_WEBRTC2}}),Object.defineProperty(t,"MUTE_UPDATE_WEBRTC2",{enumerable:!0,get:function(){return n.MUTE_UPDATE_WEBRTC2}}),Object.defineProperty(t,"USER_PUB_WEBRTC2",{enumerable:!0,get:function(){return n.USER_PUB_WEBRTC2}}),Object.defineProperty(t,"PUB_ACK_WEBRTC2",{enumerable:!0,get:function(){return n.PUB_ACK_WEBRTC2}}),Object.defineProperty(t,"USER_SUB_WEBRTC2",{enumerable:!0,get:function(){return n.USER_SUB_WEBRTC2}}),Object.defineProperty(t,"SUB_ACK_WEBRTC2",{enumerable:!0,get:function(){return n.SUB_ACK_WEBRTC2}}),Object.defineProperty(t,"USER_ASL_SUB_WEBRTC2",{enumerable:!0,get:function(){return n.USER_ASL_SUB_WEBRTC2}}),Object.defineProperty(t,"USER_ASL_SUB_ACK_WEBRTC2",{enumerable:!0,get:function(){return n.USER_ASL_SUB_ACK_WEBRTC2}}),Object.defineProperty(t,"CHANNEL_STATE_WEBRTC2",{enumerable:!0,get:function(){return n.CHANNEL_STATE_WEBRTC2}});var o=r(271);Object.defineProperty(t,"CommonErrorCode",{enumerable:!0,get:function(){return o.CommonErrorCode}}),Object.defineProperty(t,"RoomServerErrorCode",{enumerable:!0,get:function(){return o.RoomServerErrorCode}}),Object.defineProperty(t,"VideoErrorCode",{enumerable:!0,get:function(){return o.VideoErrorCode}}),Object.defineProperty(t,"AudioErrorCode",{enumerable:!0,get:function(){return o.AudioErrorCode}}),Object.defineProperty(t,"VideoRecordErrorCode",{enumerable:!0,get:function(){return o.VideoRecordErrorCode}}),Object.defineProperty(t,"AudioRecordErrorCode",{enumerable:!0,get:function(){return o.AudioRecordErrorCode}}),Object.defineProperty(t,"LiveStatusErrorCode",{enumerable:!0,get:function(){return o.LiveStatusErrorCode}}),Object.defineProperty(t,"GateWayErrorCode",{enumerable:!0,get:function(){return o.GateWayErrorCode}}),Object.defineProperty(t,"DeviceErrorCode",{enumerable:!0,get:function(){return o.DeviceErrorCode}}),Object.defineProperty(t,"Webrtc2ErrorCode",{enumerable:!0,get:function(){return o.Webrtc2ErrorCode}});var s=r(269);Object.defineProperty(t,"AuidoMixingState",{enumerable:!0,get:function(){return s.AuidoMixingState}})},function(e,t,r){"use strict";var i=Object.prototype.hasOwnProperty,a="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(a=!1)),s.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e,t){var r=a?a+e:e,i=this._events[r];if(t)return!!i;if(!i)return[];if(i.fn)return[i.fn];for(var n=0,o=i.length,s=new Array(o);n<o;n++)s[n]=i[n].fn;return s},s.prototype.emit=function(e,t,r,i,n,o){var s=a?a+e:e;if(!this._events[s])return!1;var d,c,u=this._events[s],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,n),!0;case 6:return u.fn.call(u.context,t,r,i,n,o),!0}for(c=1,d=new Array(l-1);c<l;c++)d[c-1]=arguments[c];u.fn.apply(u.context,d)}else{var p,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),l){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!d)for(p=1,d=new Array(l-1);p<l;p++)d[p-1]=arguments[p];u[c].fn.apply(u[c].context,d)}}return!0},s.prototype.on=function(e,t,r){var i=new o(t,r||this),n=a?a+e:e;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],i]:this._events[n].push(i):(this._events[n]=i,this._eventsCount++),this},s.prototype.once=function(e,t,r){var i=new o(t,r||this,!0),n=a?a+e:e;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],i]:this._events[n].push(i):(this._events[n]=i,this._eventsCount++),this},s.prototype.removeListener=function(e,t,r,i){var o=a?a+e:e;if(!this._events[o])return this;if(!t)return 0==--this._eventsCount?this._events=new n:delete this._events[o],this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||(0==--this._eventsCount?this._events=new n:delete this._events[o]);else{for(var d=0,c=[],u=s.length;d<u;d++)(s[d].fn!==t||i&&!s[d].once||r&&s[d].context!==r)&&c.push(s[d]);c.length?this._events[o]=1===c.length?c[0]:c:0==--this._eventsCount?this._events=new n:delete this._events[o]}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=a?a+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new n:delete this._events[t])):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=a,s.EventEmitter=s,e.exports=s},,function(e,t,r){var i=r(23);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var i=r(14),a=r(77),n=r(59),o=Object.defineProperty;t.f=r(18)?Object.defineProperty:function(e,t,r){if(i(e),t=n(t,!0),i(r),a)try{return o(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var i=r(8),a=r(6),n=r(36),o=r(25),s=r(22),d=function(e,t,r){var c,u,l,p=e&d.F,f=e&d.G,h=e&d.S,m=e&d.P,g=e&d.B,v=e&d.W,R=f?a:a[t]||(a[t]={}),_=R.prototype,y=f?i:h?i[t]:(i[t]||{}).prototype;for(c in f&&(r=t),r)(u=!p&&y&&void 0!==y[c])&&s(R,c)||(l=u?y[c]:r[c],R[c]=f&&"function"!=typeof y[c]?r[c]:g&&u?n(l,i):v&&y[c]==l?function(e){var t=function(t,r,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,i)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):m&&"function"==typeof l?n(Function.call,l):l,m&&((R.virtual||(R.virtual={}))[c]=l,e&d.R&&_&&!_[c]&&o(_,c,l)))};d.F=1,d.G=2,d.S=4,d.P=8,d.B=16,d.W=32,d.U=64,d.R=128,e.exports=d},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.url2origin=t.uniqueID=t.off=t.removeEventListener=t.on=t.addEventListener=t.format=t.regWhiteSpace=t.regBlank=t.emptyFunc=t.f=t.emptyObj=t.o=void 0;var i,a=r(9),n=(i=a)&&i.__esModule?i:{default:i};t.getGlobal=o,t.detectCSSFeature=function(e){var t=!1,r="Webkit Moz ms O".split(" ");if("undefined"==typeof document)return void console.log("error:fn:detectCSSFeature document is undefined");var i=document.createElement("div"),a=null;e=e.toLowerCase(),void 0!==i.style[e]&&(t=!0);if(!1===t){a=e.charAt(0).toUpperCase()+e.substr(1);for(var n=0;n<r.length;n++)if(void 0!==i.style[r[n]+a]){t=!0;break}}return t},t.fix=s,t.getYearStr=d,t.getMonthStr=c,t.getDayStr=u,t.getHourStr=l,t.getMinuteStr=p,t.getSecondStr=f,t.getMillisecondStr=h,t.dateFromDateTimeLocal=function(e){return e=""+e,new Date(e.replace(/-/g,"/").replace("T"," "))},t.getClass=v,t.typeOf=R,t.isString=_,t.isNumber=y,t.isInt=function(e){return y(e)&&e%1==0},t.isBoolean=function(e){return"boolean"===R(e)},t.isArray=C,t.isFunction=b,t.isDate=E,t.isRegExp=function(e){return"regexp"===R(e)},t.isError=function(e){return"error"===R(e)},t.isnull=S,t.notnull=T,t.undef=A,t.notundef=O,t.exist=k,t.notexist=P,t.isObject=I,t.isEmpty=function(e){return P(e)||(_(e)||C(e))&&0===e.length},t.containsNode=function(e,t){if(e===t)return!0;for(;t.parentNode;){if(t.parentNode===e)return!0;t=t.parentNode}return!1},t.calcHeight=function(e){var t=e.parentNode||("undefined"==typeof document?null:document.body);if(!t)return 0;(e=e.cloneNode(!0)).style.display="block",e.style.opacity=0,e.style.height="auto",t.appendChild(e);var r=e.offsetHeight;return t.removeChild(e),r},t.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},t.dataset=function(e,t,r){if(!k(r))return e.getAttribute("data-"+t);e.setAttribute("data-"+t,r)},t.target=function(e){return e.target||e.srcElement},t.createIframe=function(e){if("undefined"==typeof document)return;var t;if((e=e||{}).name)try{(t=document.createElement('<iframe name="'+e.name+'"></iframe>')).frameBorder=0}catch(r){(t=document.createElement("iframe")).name=e.name}else t=document.createElement("iframe");e.visible||(t.style.display="none");b(e.onload)&&w(t,"load",function r(i){if(!t.src)return;e.multi||W(t,"load",r);e.onload(i)});(e.parent||document.body).appendChild(t);var r=e.src||"about:blank";return setTimeout(function(){t.src=r},0),t},t.html2node=function(e){if("undefined"==typeof document)return;var t=document.createElement("div");t.innerHTML=e;var r=[],i=void 0,a=void 0;if(t.children)for(i=0,a=t.children.length;i<a;i++)r.push(t.children[i]);else for(i=0,a=t.childNodes.length;i<a;i++){var n=t.childNodes[i];1===n.nodeType&&r.push(n)}return r.length>1?t:r[0]},t.scrollTop=function(e){"undefined"!=typeof document&&k(e)&&(document.documentElement.scrollTop=document.body.scrollTop=e);return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},t.forOwn=x,t.mixin=N,t.isJSON=V,t.parseJSON=function e(t){try{V(t)&&(t=JSON.parse(t)),I(t)&&x(t,function(r,i){switch(R(i)){case"string":case"object":t[r]=e(i)}})}catch(e){console.log("error:",e)}return t},t.simpleClone=function(e){var t=[],r=JSON.stringify(e,function(e,r){if("object"===(void 0===r?"undefined":(0,n.default)(r))&&null!==r){if(-1!==t.indexOf(r))return;t.push(r)}return r});return JSON.parse(r)},t.merge=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return r.forEach(function(t){N(e,t)}),e},t.fillUndef=function(e,t){return x(t,function(t,r){A(e[t])&&(e[t]=r)}),e},t.checkWithDefault=function(e,t,r){var i=e[t]||e[t.toLowerCase()];P(i)&&(i=r,e[t]=i);return i},t.fetch=function(e,t){return x(e,function(r,i){k(t[r])&&(e[r]=t[r])}),e},t.string2object=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r={};return e.split(t).forEach(function(e){var t=e.split("="),i=t.shift();i&&(r[decodeURIComponent(i)]=decodeURIComponent(t.join("=")))}),r},t.object2string=B,t.genUrlSep=function(e){return e.indexOf("?")<0?"?":"&"},t.object2query=function(e){return B(e,"&",!0)},t.isFileInput=U,t.getKeys=function(e,t){var r=Object.keys(e);t&&r.sort(function(t,r){var i=U(e[t]),a=U(e[r]);return i===a?0:i?1:-1});return r};t.o={},t.emptyObj={},t.f=function(){},t.emptyFunc=function(){},t.regBlank=/\s+/gi,t.regWhiteSpace=/\s+/gi;function o(){return"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{}}function s(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r}function d(e){return""+e.getFullYear()}function c(e){return s(e.getMonth()+1)}function u(e){return s(e.getDate())}function l(e){return s(e.getHours())}function p(e){return s(e.getMinutes())}function f(e){return s(e.getSeconds())}function h(e){return s(e.getMilliseconds(),3)}var m,g;t.format=(m=/yyyy|MM|dd|hh|mm|ss|SSS/g,g={yyyy:d,MM:c,dd:u,hh:l,mm:p,ss:f,SSS:h},function(e,t){return e=new Date(e),isNaN(+e)?"invalid date":(t=t||"yyyy-MM-dd").replace(m,function(t){return g[t](e)})});function v(e){return Object.prototype.toString.call(e).slice(8,-1)}function R(e){return v(e).toLowerCase()}function _(e){return"string"===R(e)}function y(e){return"number"===R(e)}function C(e){return"array"===R(e)}function b(e){return"function"===R(e)}function E(e){return"date"===R(e)}function S(e){return null===e}function T(e){return null!==e}function A(e){return void 0===e}function O(e){return void 0!==e}function k(e){return O(e)&&T(e)}function P(e){return A(e)||S(e)}function I(e){return k(e)&&"object"===R(e)}var D=t.addEventListener=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},w=t.on=D,M=t.removeEventListener=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)},W=t.off=M;function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments[2];for(var i in e)e.hasOwnProperty(i)&&t.call(r,i,e[i])}function N(e,t){x(t,function(t,r){e[t]=r})}var L;t.uniqueID=(L=0,function(){return""+L++});function V(e){return _(e)&&0===e.indexOf("{")&&e.lastIndexOf("}")===e.length-1}function B(e,t,r){if(!e)return"";var i=[];return x(e,function(e,t){b(t)||(E(t)?t=t.getTime():C(t)?t=t.join(","):I(t)&&(t=JSON.stringify(t)),r&&(t=encodeURIComponent(t)),i.push(encodeURIComponent(e)+"="+t))}),i.join(t||",")}t.url2origin=function(){var e=/^([\w]+?:\/\/.*?(?=\/|$))/i;return function(t){return e.test(t||"")?RegExp.$1.toLowerCase():""}}();function U(e){var t=o();return e.tagName&&"INPUT"===e.tagName.toUpperCase()||t.Blob&&e instanceof t.Blob}}).call(this,r(24))},function(e,t,r){e.exports=!r(29)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){"use strict";(function(t){var i,a=r(9),n=(i=a)&&i.__esModule?i:{default:i};var o=function(){var e="object"===(void 0===t?"undefined":(0,n.default)(t))?t:window,r=Math.pow(2,53)-1,i=/\bOpera/,a=Object.prototype,o=a.hasOwnProperty,s=a.toString;function d(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function c(e){return e=h(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:d(e)}function u(e,t){for(var r in e)o.call(e,r)&&t(e[r],r,e)}function l(e){return null==e?d(e):s.call(e).slice(8,-1)}function p(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function f(e,t){var i=null;return function(e,t){var i=-1,a=e?e.length:0;if("number"==typeof a&&a>-1&&a<=r)for(;++i<a;)t(e[i],i,e);else u(e,t)}(e,function(r,a){i=t(i,r,a,e)}),i}function h(e){return String(e).replace(/^ +| +$/g,"")}return function t(r){var a=e,o=r&&"object"===(void 0===r?"undefined":(0,n.default)(r))&&"String"!=l(r);o&&(a=r,r=null);var d=a.navigator||{},m=d.userAgent||"";r||(r=m);var g,v,R,_,y,C=o?!!d.likeChrome:/\bChrome\b/.test(r)&&!/internal|\n/i.test(s.toString()),b=o?"Object":"ScriptBridgingProxyObject",E=o?"Object":"Environment",S=o&&a.java?"JavaPackage":l(a.java),T=o?"Object":"RuntimeObject",A=/\bJava/.test(S)&&a.java,O=A&&l(a.environment)==E,k=A?"a":"α",P=A?"b":"β",I=a.document||{},D=a.operamini||a.opera,w=i.test(w=o&&D?D["[[Class]]"]:l(D))?w:D=null,M=r,W=[],x=null,N=r==m,L=N&&D&&"function"==typeof D.version&&D.version(),V=f([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,t){return e||RegExp("\\b"+(t.pattern||p(t))+"\\b","i").exec(r)&&(t.label||t)}),B=function(e){return f(e,function(e,t){return e||RegExp("\\b"+(t.pattern||p(t))+"\\b","i").exec(r)&&(t.label||t)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=H([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),j=function(e){return f(e,function(e,t,i){return e||(t[U]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+p(i)+"(?:\\b|\\w*\\d)","i").exec(r))&&i})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),F=function(e){return f(e,function(e,t){var i=t.pattern||p(t);return!e&&(e=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(r))&&(e=function(e,t,r){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),e=c(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,i,t.label||t)),e})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function H(e){return f(e,function(e,t){var i=t.pattern||p(t);return!e&&(e=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(r)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(r)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(r))&&((e=String(t.label&&!RegExp(i,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=c(e[0].replace(RegExp(i,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e})}if(V&&(V=[V]),j&&!U&&(U=H([j])),(g=/\bGoogle TV\b/.exec(U))&&(U=g[0]),/\bSimulator\b/i.test(r)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==B&&/\bOPiOS\b/.test(r)&&W.push("running in Turbo/Uncompressed mode"),"IE"==B&&/\blike iPhone OS\b/.test(r)?(j=(g=t(r.replace(/like iPhone OS/,""))).manufacturer,U=g.product):/^iP/.test(U)?(B||(B="Safari"),F="iOS"+((g=/ OS ([\d_]+)/i.exec(r))?" "+g[1].replace(/_/g,"."):"")):"Konqueror"!=B||/buntu/i.test(F)?j&&"Google"!=j&&(/Chrome/.test(B)&&!/\bMobile Safari\b/i.test(r)||/\bVita\b/.test(U))||/\bAndroid\b/.test(F)&&/^Chrome/.test(B)&&/\bVersion\//i.test(r)?(B="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==B?(/\bMobi/i.test(r)||(F="Android",W.unshift("desktop mode")),/Accelerated *= *true/i.test(r)&&W.unshift("accelerated")):"PaleMoon"==B&&(g=/\bFirefox\/([\d.]+)\b/.exec(r))?W.push("identifying as Firefox "+g[1]):"Firefox"==B&&(g=/\b(Mobile|Tablet|TV)\b/i.exec(r))?(F||(F="Firefox OS"),U||(U=g[1])):!B||(g=!/\bMinefield\b/i.test(r)&&/\b(?:Firefox|Safari)\b/.exec(B))?(B&&!U&&/[\/,]|^[^(]+?\)/.test(r.slice(r.indexOf(g+"/")+8))&&(B=null),(g=U||j||F)&&(U||j||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(B=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:g)+" Browser")):"Electron"==B&&(g=(/\bChrome\/([\d.]+)\b/.exec(r)||0)[1])&&W.push("Chromium "+g):F="Kubuntu",L||(L=f(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version","HeadlessChrome",p(B),"(?:Firefox|Minefield|NetFront)"],function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(r)||0)[1]||null})),(g=("iCab"==V&&parseFloat(L)>3?"WebKit":/\bOpera\b/.test(B)&&(/\bOPR\b/.test(r)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(r)&&!/^(?:Trident|EdgeHTML)$/.test(V)&&"WebKit"||!V&&/\bMSIE\b/i.test(r)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==V&&/\bPlayStation\b(?! Vita\b)/i.test(B)&&"NetFront")&&(V=[g]),"IE"==B&&(g=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(r)||0)[1])?(B+=" Mobile",F="Windows Phone "+(/\+$/.test(g)?g:g+".x"),W.unshift("desktop mode")):/\bWPDesktop\b/i.test(r)?(B="IE Mobile",F="Windows Phone 8.x",W.unshift("desktop mode"),L||(L=(/\brv:([\d.]+)/.exec(r)||0)[1])):"IE"!=B&&"Trident"==V&&(g=/\brv:([\d.]+)/.exec(r))&&(B&&W.push("identifying as "+B+(L?" "+L:"")),B="IE",L=g[1]),N){if(_="global",y=null!=(R=a)?(0,n.default)(R[_]):"number",/^(?:boolean|number|string|undefined)$/.test(y)||"object"==y&&!R[_])l(g=a.runtime)==b?(B="Adobe AIR",F=g.flash.system.Capabilities.os):l(g=a.phantom)==T?(B="PhantomJS",L=(g=g.version||null)&&g.major+"."+g.minor+"."+g.patch):"number"==typeof I.documentMode&&(g=/\bTrident\/(\d+)/i.exec(r))?(L=[L,I.documentMode],(g=+g[1]+4)!=L[1]&&(W.push("IE "+L[1]+" mode"),V&&(V[1]=""),L[1]=g),L="IE"==B?String(L[1].toFixed(1)):L[0]):"number"==typeof I.documentMode&&/^(?:Chrome|Firefox)\b/.test(B)&&(W.push("masking as "+B+" "+L),B="IE",L="11.0",V=["Trident"],F="Windows");else if(A&&(M=(g=A.lang.System).getProperty("os.arch"),F=F||g.getProperty("os.name")+" "+g.getProperty("os.version")),O){try{L=a.require("ringo/engine").version.join("."),B="RingoJS"}catch(e){(g=a.system)&&g.global.system==a.system&&(B="Narwhal",F||(F=g[0].os||null))}B||(B="Rhino")}else"object"===(0,n.default)(a.process)&&!a.process.browser&&(g=a.process)&&("object"===(0,n.default)(g.versions)&&("string"==typeof g.versions.electron?(W.push("Node "+g.versions.node),B="Electron",L=g.versions.electron):"string"==typeof g.versions.nw&&(W.push("Chromium "+L,"Node "+g.versions.node),B="NW.js",L=g.versions.nw)),B||(B="Node.js",M=g.arch,F=g.platform,L=(L=/[\d.]+/.exec(g.version))?L[0]:null));F=F&&c(F)}if(L&&(g=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(L)||/(?:alpha|beta)(?: ?\d)?/i.exec(r+";"+(N&&d.appMinorVersion))||/\bMinefield\b/i.test(r)&&"a")&&(x=/b/i.test(g)?"beta":"alpha",L=L.replace(RegExp(g+"\\+?$"),"")+("beta"==x?P:k)+(/\d+\+?/.exec(g)||"")),"Fennec"==B||"Firefox"==B&&/\b(?:Android|Firefox OS)\b/.test(F))B="Firefox Mobile";else if("Maxthon"==B&&L)L=L.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(F=null),"Xbox 360"==U&&/\bIEMobile\b/.test(r)&&W.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(B)&&(!B||U||/Browser|Mobi/.test(B))||"Windows CE"!=F&&!/Mobi/i.test(r))if("IE"==B&&N)try{null===a.external&&W.unshift("platform preview")}catch(e){W.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(r))&&(g=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(r)||0)[1]||L)?(F=((g=[g,/BB10/.test(r)])[1]?(U=null,j="BlackBerry"):"Device Software")+" "+g[0],L=null):this!=u&&"Wii"!=U&&(N&&D||/Opera/.test(B)&&/\b(?:MSIE|Firefox)\b/i.test(r)||"Firefox"==B&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==B&&(F&&!/^Win/.test(F)&&L>5.5||/\bWindows XP\b/.test(F)&&L>8||8==L&&!/\bTrident\b/.test(r)))&&!i.test(g=t.call(u,r.replace(i,"")+";"))&&g.name&&(g="ing as "+g.name+((g=g.version)?" "+g:""),i.test(B)?(/\bIE\b/.test(g)&&"Mac OS"==F&&(F=null),g="identify"+g):(g="mask"+g,B=w?c(w.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(g)&&(F=null),N||(L=null)),V=["Presto"],W.push(g));else B+=" Mobile";(g=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(r)||0)[1])&&(g=[parseFloat(g.replace(/\.(\d)$/,".0$1")),g],"Safari"==B&&"+"==g[1].slice(-1)?(B="WebKit Nightly",x="alpha",L=g[1].slice(0,-1)):L!=g[1]&&L!=(g[2]=(/\bSafari\/([\d.]+\+?)/i.exec(r)||0)[1])||(L=null),g[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(r)||0)[1],537.36==g[0]&&537.36==g[2]&&parseFloat(g[1])>=28&&"WebKit"==V&&(V=["Blink"]),N&&(C||g[1])?(V&&(V[1]="like Chrome"),g=g[1]||((g=g[0])<530?1:g<532?2:g<532.05?3:g<533?4:g<534.03?5:g<534.07?6:g<534.1?7:g<534.13?8:g<534.16?9:g<534.24?10:g<534.3?11:g<535.01?12:g<535.02?"13+":g<535.07?15:g<535.11?16:g<535.19?17:g<536.05?18:g<536.1?19:g<537.01?20:g<537.11?"21+":g<537.13?23:g<537.18?24:g<537.24?25:g<537.36?26:"Blink"!=V?"27":"28")):(V&&(V[1]="like Safari"),g=(g=g[0])<400?1:g<500?2:g<526?3:g<533?4:g<534?"4+":g<535?5:g<537?6:g<538?7:g<601?8:"8"),V&&(V[1]+=" "+(g+="number"==typeof g?".x":/[.+]/.test(g)?"":"+")),"Safari"==B&&(!L||parseInt(L)>45)&&(L=g)),"Opera"==B&&(g=/\bzbov|zvav$/.exec(F))?(B+=" ",W.unshift("desktop mode"),"zvav"==g?(B+="Mini",L=null):B+="Mobile",F=F.replace(RegExp(" *"+g+"$"),"")):"Safari"==B&&/\bChrome\b/.exec(V&&V[1])&&(W.unshift("desktop mode"),B="Chrome Mobile",L=null,/\bOS X\b/.test(F)?(j="Apple",F="iOS 4.3+"):F=null),L&&0==L.indexOf(g=/[\d.]+$/.exec(F))&&r.indexOf("/"+g+"-")>-1&&(F=h(F.replace(g,""))),V&&!/\b(?:Avant|Nook)\b/.test(B)&&(/Browser|Lunascape|Maxthon/.test(B)||"Safari"!=B&&/^iOS/.test(F)&&/\bSafari\b/.test(V[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(B)&&V[1])&&(g=V[V.length-1])&&W.push(g),W.length&&(W=["("+W.join("; ")+")"]),j&&U&&U.indexOf(j)<0&&W.push("on "+j),U&&W.push((/^on /.test(W[W.length-1])?"":"on ")+U),F&&(g=/ ([\d.+]+)$/.exec(F),v=g&&"/"==F.charAt(F.length-g[0].length-1),F={architecture:32,family:g&&!v?F.replace(g[0],""):F,version:g?g[1]:null,toString:function(){var e=this.version;return this.family+(e&&!v?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(g=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(M))&&!/\bi686\b/i.test(M)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+g),"")),B&&(/\bWOW64\b/i.test(r)||N&&/\w(?:86|32)$/.test(d.cpuClass||d.platform)&&!/\bWin64; x64\b/i.test(r))&&W.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==B&&parseFloat(L)>=39&&(F.architecture=64),r||(r=null);var G={};return G.description=r,G.layout=V&&V[0],G.manufacturer=j,G.name=B,G.prerelease=x,G.product=U,G.ua=r,G.version=B&&L,G.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}},G.parse=t,G.toString=function(){return this.description||""},G.version&&W.unshift(L),G.name&&W.unshift(B),F&&B&&(F!=String(F).split(" ")[0]||F!=B.split(" ")[0]&&!U)&&W.push(U?"("+F+")":"on "+F),W.length&&(G.description=W.join(" ")),G}()}();e.exports=o}).call(this,r(24))},,,function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var i=r(15),a=r(34);e.exports=r(18)?function(e,t,r){return i.f(e,t,a(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var i=r(74),a=r(60);e.exports=function(e){return i(a(e))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(335);Object.defineProperty(t,"element",{enumerable:!0,get:function(){return i.element}});var a=r(334);Object.defineProperty(t,"ajax",{enumerable:!0,get:function(){return a.ajax}});var n=r(333);Object.defineProperty(t,"tool",{enumerable:!0,get:function(){return n.tool}});var o=r(143);Object.defineProperty(t,"ApiInvokeData",{enumerable:!0,get:function(){return o.ApiInvokeData}}),Object.defineProperty(t,"DataRtc",{enumerable:!0,get:function(){return o.DataRtc}}),Object.defineProperty(t,"DataStats",{enumerable:!0,get:function(){return o.DataStats}});var s=r(28);Object.defineProperty(t,"RtcUtil",{enumerable:!0,get:function(){return s.RtcUtil}}),Object.defineProperty(t,"SdpUtil",{enumerable:!0,get:function(){return s.SdpUtil}}),Object.defineProperty(t,"RtcStats",{enumerable:!0,get:function(){return s.RtcStats}}),Object.defineProperty(t,"RtcStatsNew",{enumerable:!0,get:function(){return s.RtcStatsNew}}),Object.defineProperty(t,"RtcSupport",{enumerable:!0,get:function(){return s.RtcSupport}}),Object.defineProperty(t,"RtcSystem",{enumerable:!0,get:function(){return s.RtcSystem}}),Object.defineProperty(t,"WebrtcUtil",{enumerable:!0,get:function(){return s.WebrtcUtil}});var d=r(159);Object.defineProperty(t,"WebAudio",{enumerable:!0,get:function(){return d.WebAudio}});var c=r(268);Object.defineProperty(t,"deviceId",{enumerable:!0,get:function(){return(e=c,e&&e.__esModule?e:{default:e}).default;var e}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(326);Object.defineProperty(t,"RtcUtil",{enumerable:!0,get:function(){return c(i).default}});var a=r(322);Object.defineProperty(t,"SdpUtil",{enumerable:!0,get:function(){return c(a).default}});var n=r(321);Object.defineProperty(t,"RtcStatsNew",{enumerable:!0,get:function(){return c(n).default}});var o=r(208);Object.defineProperty(t,"RtcSupport",{enumerable:!0,get:function(){return c(o).default}});var s=r(100);Object.defineProperty(t,"RtcSystem",{enumerable:!0,get:function(){return c(s).default}});var d=r(319);function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"WebrtcUtil",{enumerable:!0,get:function(){return c(d).default}})},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},,function(e,t){e.exports={}},,,function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},,function(e,t,r){var i=r(50);e.exports=function(e,t,r){if(i(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,a){return e.call(t,r,i,a)}}return function(){return e.apply(t,arguments)}}},,function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){var r=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},function(e,t,r){var i=r(75),a=r(56);e.exports=Object.keys||function(e){return i(e,a)}},function(e,t,r){"use strict";var i=r(139)(!0);r(78)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=i(t,r),this._i+=e.length,{value:e,done:!1})})},function(e,t,r){var i=r(15).f,a=r(22),n=r(7)("toStringTag");e.exports=function(e,t,r){e&&!a(e=r?e:e.prototype,n)&&i(e,n,{configurable:!0,value:t})}},function(e,t){e.exports=!0},,function(e,t,r){"use strict";var i=r(66),a=r(198),n=r(197),o=r(196);i.json=a,i.upload=n,i.chunkUpload=o,e.exports=i},,function(e,t,r){r(134);for(var i=r(8),a=r(25),n=r(31),o=r(7)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),d=0;d<s.length;d++){var c=s[d],u=i[c],l=u&&u.prototype;l&&!l[o]&&a(l,o,c),n[c]=n.Array}},function(e,t,r){var i=r(60);e.exports=function(e){return Object(i(e))}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(221);Object.defineProperty(t,"WebRTCGateWay",{enumerable:!0,get:function(){return i.WebRTCGateWay}}),Object.defineProperty(t,"WebRTCGateWayContext",{enumerable:!0,get:function(){return i.WebRTCGateWayContext}}),Object.defineProperty(t,"WebRTCGateWayManager",{enumerable:!0,get:function(){return i.WebRTCGateWayManager}}),Object.defineProperty(t,"WebRTCGateWayProtocolHandler",{enumerable:!0,get:function(){return i.WebRTCGateWayProtocolHandler}});var a=r(220);Object.defineProperty(t,"WebRTC2GateWay",{enumerable:!0,get:function(){return a.WebRTC2GateWay}}),Object.defineProperty(t,"WebRTC2GateWayContext",{enumerable:!0,get:function(){return a.WebRTC2GateWayContext}}),Object.defineProperty(t,"WebRTC2GateWayManager",{enumerable:!0,get:function(){return a.WebRTC2GateWayManager}}),Object.defineProperty(t,"WebRTC2GateWayProtocolHandler",{enumerable:!0,get:function(){return a.WebRTC2GateWayProtocolHandler}});var n=r(466);Object.defineProperty(t,"MediaDeviceHelper",{enumerable:!0,get:function(){return n.MediaDeviceHelper}});var o=r(465);Object.defineProperty(t,"MediaRecordHelper",{enumerable:!0,get:function(){return o.MediaRecordHelper}});var s=r(464);Object.defineProperty(t,"AudioHelper",{enumerable:!0,get:function(){return s.AudioHelper}});var d=r(462);Object.defineProperty(t,"VideoHelper",{enumerable:!0,get:function(){return d.VideoHelper}});var c=r(459);Object.defineProperty(t,"ApiReportHelper",{enumerable:!0,get:function(){return c.ApiReportHelper}}),Object.defineProperty(t,"LogReportHelper",{enumerable:!0,get:function(){return c.LogReportHelper}}),Object.defineProperty(t,"StatsReportHelper",{enumerable:!0,get:function(){return c.StatsReportHelper}}),Object.defineProperty(t,"CommonDataReport",{enumerable:!0,get:function(){return c.CommonDataReport}}),Object.defineProperty(t,"IntervalCommonDataReport",{enumerable:!0,get:function(){return c.IntervalCommonDataReport}})},,function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var i=r(8),a=r(6),n=r(44),o=r(55),s=r(15).f;e.exports=function(e){var t=a.Symbol||(a.Symbol=n?{}:i.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,r){t.f=r(7)},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var i=r(8),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});e.exports=function(e){return a[e]||(a[e]={})}},function(e,t,r){var i=r(57)("keys"),a=r(40);e.exports=function(e){return i[e]||(i[e]=a(e))}},function(e,t,r){var i=r(23);e.exports=function(e,t){if(!i(e))return e;var r,a;if(t&&"function"==typeof(r=e.toString)&&!i(a=r.call(e)))return a;if("function"==typeof(r=e.valueOf)&&!i(a=r.call(e)))return a;if(!t&&"function"==typeof(r=e.toString)&&!i(a=r.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var r=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},,,function(e,t,r){var i=r(23),a=r(8).document,n=i(a)&&i(a.createElement);e.exports=function(e){return n?a.createElement(e):{}}},function(e,t,r){"use strict";t.__esModule=!0;var i,a=r(120),n=(i=a)&&i.__esModule?i:{default:i};t.default=n.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}},function(e,t,r){"use strict";var i=r(17),a=r(202),n=r(200),o=r(199),s={},d=i.f;function c(e){var t=e.upload="multipart/form-data"===(e.headers||i.o)["Content-Type"],r=!1;try{r=(location.protocol+"//"+location.host).toLowerCase()!==i.url2origin(e.url)}catch(e){}return e.cors=r,t||r||e.mode?function(e){var t=e.mode,r=a,s=i.getGlobal();return!s.FormData&&s.document&&(t="iframe"),"iframe"===t&&(r=e.upload?n:o),new r(e)}(e):new a(e)}function u(e,t,r){var i=s[e];if(i){"onload"===t&&i.result&&(r=function(e,t){t={data:t};var r=e.result.headers;return r&&(t.headers=e.req.header(r)),t}(i,r)),function(e){var t=s[e];t&&(t.req.destroy(),delete s[e])}(e);var a={type:t,result:r};d(a),a.stopped||i[t](a.result)}}function l(e,t){var r=i.genUrlSep(e);return t=t||"",i.isObject(t)&&(t=i.object2query(t)),t&&(e+=r+t),e}function p(e,t){t=t||{};var r=i.uniqueID(),a={result:t.result,onload:t.onload||i.f,onerror:t.onerror||i.f};s[r]=a,t.onload=function(e,t){u(e,"onload",t)}.bind(null,r),t.onerror=function(e,t){u(e,"onerror",t)}.bind(null,r),t.query&&(e=l(e,t.query));var n=t.method||"";return n&&!/get/i.test(n)||!t.data||(e=l(e,t.data),t.data=null),t.url=e,a.req=c(t),r}p.filter=function(e){i.isFunction(e)&&(d=e)},p.abort=function(e){var t=s[e];t&&t.req&&t.req.abort()},e.exports=p},function(e,t,r){var i=r(14),a=r(137),n=r(56),o=r(58)("IE_PROTO"),s=function(){},d=function(){var e,t=r(64)("iframe"),i=n.length;for(t.style.display="none",r(88).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),d=e.F;i--;)delete d.prototype[n[i]];return d()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=i(e),r=new s,s.prototype=null,r[o]=e):r=d(),void 0===t?r:a(r,t)}},function(e,t,r){var i=r(61),a=Math.min;e.exports=function(e){return e>0?a(i(e),9007199254740991):0}},,,,function(e,t,r){var i=r(39),a=r(34),n=r(26),o=r(59),s=r(22),d=r(77),c=Object.getOwnPropertyDescriptor;t.f=r(18)?c:function(e,t){if(e=n(e),t=o(t,!0),d)try{return c(e,t)}catch(e){}if(s(e,t))return a(!i.f.call(e,t),e[t])}},function(e,t,r){var i=r(75),a=r(56).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,a)}},function(e,t,r){var i=r(38);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t,r){var i=r(22),a=r(26),n=r(136)(!1),o=r(58)("IE_PROTO");e.exports=function(e,t){var r,s=a(e),d=0,c=[];for(r in s)r!=o&&i(s,r)&&c.push(r);for(;t.length>d;)i(s,r=t[d++])&&(~n(c,r)||c.push(r));return c}},function(e,t,r){e.exports=r(25)},function(e,t,r){e.exports=!r(18)&&!r(29)(function(){return 7!=Object.defineProperty(r(64)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){"use strict";var i=r(44),a=r(16),n=r(76),o=r(25),s=r(31),d=r(138),c=r(43),u=r(93),l=r(7)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,r,h,m,g,v){d(r,t,h);var R,_,y,C=function(e){if(!p&&e in T)return T[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},b=t+" Iterator",E="values"==m,S=!1,T=e.prototype,A=T[l]||T["@@iterator"]||m&&T[m],O=A||C(m),k=m?E?C("entries"):O:void 0,P="Array"==t&&T.entries||A;if(P&&(y=u(P.call(new e)))!==Object.prototype&&y.next&&(c(y,b,!0),i||"function"==typeof y[l]||o(y,l,f)),E&&A&&"values"!==A.name&&(S=!0,O=function(){return A.call(this)}),i&&!v||!p&&!S&&T[l]||o(T,l,O),s[t]=O,s[b]=f,m)if(R={values:E?O:C("values"),keys:g?O:C("keys"),entries:k},v)for(_ in R)_ in T||n(T,_,R[_]);else a(a.P+a.F*(p||S),t,R);return R}},function(e,t,r){"use strict";var i=r(50);e.exports.f=function(e){return new function(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i}),this.resolve=i(t),this.reject=i(r)}(e)}},,function(e,t,r){var i=r(38),a=r(7)("toStringTag"),n="Arguments"==i(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?r:n?i(t):"Object"==(o=i(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,r){var i=r(81),a=r(7)("iterator"),n=r(31);e.exports=r(6).getIteratorMethod=function(e){if(null!=e)return e[a]||e["@@iterator"]||n[i(e)]}},function(e,t,r){"use strict";var i=r(17),a=i.f,n=r(201);function o(e){e.onload&&this.once("load",e.onload),e.onerror&&this.once("error",e.onerror),e.onbeforesend&&this.once("beforesend",e.onbeforesend),e.onaftersend&&this.once("aftersend",e.onaftersend);var t=(e=this.options=i.fetch({method:"GET",url:"",sync:!1,data:null,headers:{},cookie:!1,timeout:6e4,type:"text",form:null,input:null,putFileAtEnd:!1,proxyUrl:""},e)).headers;i.notexist(t["Content-Type"])&&(t["Content-Type"]="application/x-www-form-urlencoded"),this.send()}var s=o.prototype=Object.create(n.prototype);s.send=function(){var e=this,t=e.options;setTimeout(function(){try{try{e.emit("beforesend",t)}catch(e){console.log("error:","ignore error ajax beforesend,",e)}e.doSend()}catch(t){console.log("error:","ignore error server error,",t),e.onError("serverError","请求失败:"+t.message)}},0)},s.doSend=a,s.afterSend=function(){var e=this;setTimeout(function(){e.emit("aftersend",e.options)},0)},s.onLoad=function(e){var t=this.options,r=e.status,i=e.result;if(0===(""+r).indexOf("2")){if("json"===t.type)try{i=JSON.parse(i)}catch(e){return console.log("error:","ignore error parse json,",e),void this.onError("parseError",i)}this.emit("load",i)}else this.onError("serverError","服务器返回异常状态",{status:r,result:i,date:e.date})},s.onError=function(e,t,r){var a=i.isObject(r)?r:{};a.code=e||"error",a.message=t||"发生错误",this.emit("error",a)},s.onTimeout=function(){this.onError("timeout","请求超时")},s.abort=function(){this.onError("abort","客户端中止")},s.header=function(e){var t=this;if(!i.isArray(e))return t.getResponseHeader(e||"");var r={};return e.forEach(function(e){r[e]=t.header(e)}),r},s.getResponseHeader=a,s.destroy=a,e.exports=o},function(e,t,r){"use strict";t.__esModule=!0;var i=n(r(343)),a=n(r(340));function n(e){return e&&e.__esModule?e:{default:e}}t.default=function e(t,r,n){null===t&&(t=Function.prototype);var o=(0,a.default)(t,r);if(void 0===o){var s=(0,i.default)(t);return null===s?void 0:e(s,r,n)}if("value"in o)return o.value;var d=o.get;return void 0!==d?d.call(n):void 0}},,function(e,t){e.exports=function(e,t){var r=t.split(".");for(;r.length;){var i=r.shift(),a=!1;if("?"==i[i.length-1]&&(i=i.slice(0,-1),a=!0),!(e=e[i])&&a)return e}return e}},function(e,t){},function(e,t,r){var i=r(8).document;e.exports=i&&i.documentElement},function(e,t,r){"use strict";var i=!0,a=!0,n={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){a&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,r){var i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)r.browser="chrome",r.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return r.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",r;r.browser="safari",r.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}};e.exports={log:n.log,deprecated:n.deprecated,disableLog:n.disableLog,disableWarnings:n.disableWarnings,extractVersion:n.extractVersion,shimCreateObjectURL:n.shimCreateObjectURL,detectBrowser:n.detectBrowser.bind(n)}},,,function(e,t){e.exports=function e(t,r){"use strict";var i,a,n=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,o=/(^[ ]*|[ ]*$)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=/^0x[0-9a-f]+$/i,c=/^0/,u=function(t){return e.insensitive&&(""+t).toLowerCase()||""+t},l=u(t).replace(o,"")||"",p=u(r).replace(o,"")||"",f=l.replace(n,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=p.replace(n,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=parseInt(l.match(d),16)||1!==f.length&&l.match(s)&&Date.parse(l),g=parseInt(p.match(d),16)||m&&p.match(s)&&Date.parse(p)||null;if(g){if(m<g)return-1;if(m>g)return 1}for(var v=0,R=Math.max(f.length,h.length);v<R;v++){if(i=!(f[v]||"").match(c)&&parseFloat(f[v])||f[v]||0,a=!(h[v]||"").match(c)&&parseFloat(h[v])||h[v]||0,isNaN(i)!==isNaN(a))return isNaN(i)?1:-1;if(typeof i!=typeof a&&(i+="",a+=""),i<a)return-1;if(i>a)return 1}return 0}},function(e,t,r){var i=r(22),a=r(49),n=r(58)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),i(e,n)?e[n]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,r){"use strict";t.__esModule=!0;var i,a=r(156),n=(i=a)&&i.__esModule?i:{default:i};t.default=function(e,t,r){return t in e?(0,n.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},,,function(e,t,r){"use strict";t.__esModule=!0;var i,a=r(179),n=(i=a)&&i.__esModule?i:{default:i};t.default=function(e){return function(){var t=e.apply(this,arguments);return new n.default(function(e,r){return function i(a,o){try{var s=t[a](o),d=s.value}catch(e){return void r(e)}if(!s.done)return n.default.resolve(d).then(function(e){i("next",e)},function(e){i("throw",e)});e(d)}("next")})}}},function(e,t,r){e.exports=r(181)},function(e,t,r){"use strict";var i={link:{id:1,heartbeat:2,negotiateTransport:5,initTransport:6},sync:{id:5,sync:1,syncTeamMembers:2},misc:{id:6,getSimpleNosToken:1,getNosToken:2,notifyUploadLog:3,uploadSdkLogUrl:4,audioToText:5,processImage:6,getNosTokenTrans:7,notifyTransLog:8,fetchFile:9,fetchFileList:10,removeFile:11,getClientAntispam:17,fileQuickTransfer:18,getNosOriginUrl:22,getServerTime:23,getNosAccessToken:24,deleteNosAccessToken:25,getNosCdnHost:26},avSignal:{id:15,signalingCreate:1,signalingDelay:2,signalingClose:3,signalingJoin:4,signalingLeave:5,signalingInvite:6,signalingCancel:7,signalingReject:8,signalingAccept:9,signalingControl:10,signalingNotify:11,signalingMutilClientSyncNotify:12,signalingUnreadMessageSyncNotify:13,signalingChannelsSyncNotify:14,signalingGetChannelInfo:15}},a={heartbeat:{sid:i.link.id,cid:i.link.heartbeat},negotiateTransport:{sid:i.link.id,cid:i.link.negotiateTransport,params:[{type:"int",name:"sdkVersion"},{type:"Property",name:"negotiateTransportTag"}]},initTransport:{sid:i.link.id,cid:i.link.initTransport,params:[{type:"Property",name:"initTransportTag"}]},getSimpleNosToken:{sid:i.misc.id,cid:i.misc.getSimpleNosToken,params:[{type:"int",name:"num"}]},getNosToken:{sid:i.misc.id,cid:i.misc.getNosToken,params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken"}]},uploadSdkLogUrl:{sid:i.misc.id,cid:i.misc.uploadSdkLogUrl,params:[{type:"string",name:"url"}]},audioToText:{sid:i.misc.id,cid:i.misc.audioToText,params:[{type:"Property",name:"audioToText"}]},processImage:{sid:i.misc.id,cid:i.misc.processImage,params:[{type:"String",name:"url"},{type:"PropertyArray",name:"imageOps",entity:"imageOp"}]},getClientAntispam:{sid:i.misc.id,cid:i.misc.getClientAntispam,params:[{type:"Property",name:"clientAntispam"}]},fileQuickTransfer:{sid:i.misc.id,cid:i.misc.fileQuickTransfer,params:[{type:"Property",name:"fileQuickTransfer"}]},getNosOriginUrl:{sid:i.misc.id,cid:i.misc.getNosOriginUrl,params:[{type:"Property",name:"nosFileUrlTag"}]},getServerTime:{sid:i.misc.id,cid:i.misc.getServerTime,params:[]},getNosAccessToken:{sid:i.misc.id,cid:i.misc.getNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},deleteNosAccessToken:{sid:i.misc.id,cid:i.misc.deleteNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},getNosTokenTrans:{sid:i.misc.id,cid:i.misc.getNosTokenTrans,params:[{type:"Property",name:"transToken"}]},fetchFile:{sid:i.misc.id,cid:i.misc.fetchFile,params:[{type:"String",name:"docId"}]},fetchFileList:{sid:i.misc.id,cid:i.misc.fetchFileList,params:[{type:"Property",name:"fileListParam"}]},removeFile:{sid:i.misc.id,cid:i.misc.removeFile,params:[{type:"String",name:"docId"}]},getNosCdnHost:{sid:i.misc.id,cid:i.misc.getNosCdnHost,params:[]},signalingCreate:{sid:i.avSignal.id,cid:i.avSignal.signalingCreate,params:[{type:"Property",name:"avSignalTag"}]},signalingDelay:{sid:i.avSignal.id,cid:i.avSignal.signalingDelay,params:[{type:"Property",name:"avSignalTag"}]},signalingClose:{sid:i.avSignal.id,cid:i.avSignal.signalingClose,params:[{type:"Property",name:"avSignalTag"}]},signalingJoin:{sid:i.avSignal.id,cid:i.avSignal.signalingJoin,params:[{type:"Property",name:"avSignalTag"}]},signalingLeave:{sid:i.avSignal.id,cid:i.avSignal.signalingLeave,params:[{type:"Property",name:"avSignalTag"}]},signalingInvite:{sid:i.avSignal.id,cid:i.avSignal.signalingInvite,params:[{type:"Property",name:"avSignalTag"}]},signalingCancel:{sid:i.avSignal.id,cid:i.avSignal.signalingCancel,params:[{type:"Property",name:"avSignalTag"}]},signalingReject:{sid:i.avSignal.id,cid:i.avSignal.signalingReject,params:[{type:"Property",name:"avSignalTag"}]},signalingAccept:{sid:i.avSignal.id,cid:i.avSignal.signalingAccept,params:[{type:"Property",name:"avSignalTag"}]},signalingControl:{sid:i.avSignal.id,cid:i.avSignal.signalingControl,params:[{type:"Property",name:"avSignalTag"}]},signalingGetChannelInfo:{sid:i.avSignal.id,cid:i.avSignal.signalingGetChannelInfo,params:[{type:"Property",name:"avSignalTag"}]}};e.exports={idMap:i,cmdConfig:a,packetConfig:{"1_2":{service:"link",cmd:"heartbeat"},"1_5":{service:"link",cmd:"negotiateTransport",response:[{type:"Property",name:"negotiateTransportTag"}]},"1_6":{service:"link",cmd:"initTransport",response:[{type:"Property",name:"initTransportTag"}]},"6_1":{service:"misc",cmd:"getSimpleNosToken",response:[{type:"PropertyArray",name:"nosTokens",entity:"nosToken"}]},"6_2":{service:"misc",cmd:"getNosToken",response:[{type:"Property",name:"nosToken"}]},"6_3":{service:"misc",cmd:"notifyUploadLog"},"6_4":{service:"misc",cmd:"uploadSdkLogUrl"},"6_5":{service:"misc",cmd:"audioToText",response:[{type:"String",name:"text"}]},"6_6":{service:"misc",cmd:"processImage",response:[{type:"String",name:"url"}]},"6_7":{service:"misc",cmd:"getNosTokenTrans",response:[{type:"Property",name:"nosToken"},{type:"String",name:"docId"}]},"6_8":{service:"misc",cmd:"notifyTransLog",response:[{type:"Property",name:"transInfo"}]},"6_9":{service:"misc",cmd:"fetchFile",response:[{type:"Property",name:"info",entity:"transInfo"}]},"6_10":{service:"misc",cmd:"fetchFileList",response:[{type:"PropertyArray",name:"list",entity:"transInfo"},{type:"Number",name:"totalCount"}]},"6_11":{service:"misc",cmd:"removeFile",response:[{type:"String",name:"res"}]},"6_17":{service:"misc",cmd:"getClientAntispam",response:[{type:"Property",name:"clientAntispam"}]},"6_18":{service:"misc",cmd:"fileQuickTransfer",response:[{type:"Property",name:"fileQuickTransfer"}]},"6_22":{service:"misc",cmd:"getNosOriginUrl",response:[{type:"Property",name:"nosFileUrlTag"}]},"6_23":{service:"misc",cmd:"getServerTime",response:[{type:"Number",name:"time"}]},"6_24":{service:"misc",cmd:"getNosAccessToken",response:[{type:"Property",name:"nosAccessTokenTag"}]},"6_25":{service:"misc",cmd:"deleteNosAccessToken"},"6_26":{service:"misc",cmd:"getNosCdnHost",response:[{type:"Property",name:"nosConfigTag"}]},"15_1":{service:"avSignal",cmd:"signalingCreate",response:[{type:"Property",name:"avSignalTag"}]},"15_2":{service:"avSignal",cmd:"signalingDelay",response:[{type:"Property",name:"avSignalTag"}]},"15_3":{service:"avSignal",cmd:"signalingClose",response:[{type:"Property",name:"avSignalTag"}]},"15_4":{service:"avSignal",cmd:"signalingJoin",response:[{type:"Property",name:"avSignalTag"}]},"15_5":{service:"avSignal",cmd:"signalingLeave",response:[]},"15_6":{service:"avSignal",cmd:"signalingInvite",response:[]},"15_7":{service:"avSignal",cmd:"signalingCancel",response:[]},"15_8":{service:"avSignal",cmd:"signalingReject",response:[]},"15_9":{service:"avSignal",cmd:"signalingAccept",response:[]},"15_10":{service:"avSignal",cmd:"signalingControl",response:[]},"15_11":{service:"avSignal",cmd:"signalingNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_12":{service:"avSignal",cmd:"signalingMutilClientSyncNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_13":{service:"avSignal",cmd:"signalingUnreadMessageSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_14":{service:"avSignal",cmd:"signalingChannelsSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_15":{service:"avSignal",cmd:"signalingGetChannelInfo",response:[{type:"Property",name:"avSignalTag"}]}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=r(9),n=(i=a)&&i.__esModule?i:{default:i};var o={},s=(window.document.documentElement,window.navigator.userAgent.toLowerCase()),d=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","pov_tv","hbbtv","ce-html"];function c(e,t){return-1!==e.indexOf(t)}function u(e){return c(s,e)}function l(e){for(var t=0;t<e.length;t++)if(o[e[t]]())return e[t];return"unknown"}function p(e,t,r){var i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}o.macos=function(){return u("mac")},o.ios=function(){return o.iphone()||o.ipod()||o.ipad()},o.iphone=function(){return!o.windows()&&u("iphone")},o.ipod=function(){return u("ipod")},o.ipad=function(){return u("ipad")},o.android=function(){return!o.windows()&&u("android")},o.androidPhone=function(){return o.android()&&u("mobile")},o.androidTablet=function(){return o.android()&&!u("mobile")},o.blackberry=function(){return u("blackberry")||u("bb10")||u("rim")},o.blackberryPhone=function(){return o.blackberry()&&!u("tablet")},o.blackberryTablet=function(){return o.blackberry()&&u("tablet")},o.windows=function(){return u("windows")},o.windowsPhone=function(){return o.windows()&&u("phone")},o.windowsTablet=function(){return o.windows()&&u("touch")&&!o.windowsPhone()},o.fxos=function(){return(u("(mobile")||u("(tablet"))&&u(" rv:")},o.fxosPhone=function(){return o.fxos()&&u("mobile")},o.fxosTablet=function(){return o.fxos()&&u("tablet")},o.meego=function(){return u("meego")},o.cordova=function(){return window.cordova&&"file:"===location.protocol},o.nodeWebkit=function(){return"object"===(0,n.default)(window.process)},o.mobile=function(){return o.androidPhone()||o.iphone()||o.ipod()||o.windowsPhone()||o.blackberryPhone()||o.fxosPhone()||o.meego()},o.tablet=function(){return o.ipad()||o.androidTablet()||o.blackberryTablet()||o.windowsTablet()||o.fxosTablet()},o.h5=function(){return o.tablet()||o.mobile()},o.desktop=function(){return!o.tablet()&&!o.mobile()},o.television=function(){for(var e=0;e<d.length;){if(u(d[e]))return!0;e++}return!1},o.portrait=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?c(screen.orientation.type,"portrait"):window.innerHeight/window.innerWidth>1},o.landscape=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?c(screen.orientation.type,"landscape"):window.innerHeight/window.innerWidth<1},o.type=l(["mobile","tablet","desktop"]),o.os=l(["ios","iphone","ipad","ipod","android","blackberry","macos","windows","fxos","meego","television"]),o.browser=function(){var e=window&&window.navigator,t={ua:null,version:null,UIVersion:null};if("undefined"==typeof window||!window.navigator)return t.ua="Not a browser.",t;if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.ua="edge",t.version=p(e.userAgent,/Edge\/(\d+).(\d+)$/,2),t.UIVersion=e.userAgent.match(/Edge\/([\d.]+)/)[1];else if(e.mozGetUserMedia)t.ua="firefox",t.version=p(e.userAgent,/Firefox\/(\d+)\./,1),t.UIVersion=e.userAgent.match(/Firefox\/([\d.]+)/)[1];else if(e.webkitGetUserMedia&&window.webkitRTCPeerConnection)if(/micromessenger/.test(s))t.ua="weixin",t.version=p(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2),t.UIVersion=e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)&&e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/).length>1&&e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)[2];else if(e.userAgent.match(/(OPR|Opera).([\d.]+)/))t.ua="opera",t.version=p(e.userAgent,/O(PR|pera)\/(\d+)\./,2),t.UIVersion=e.userAgent.match(/O(PR|pera)\/([\d.]+)/)[2];else{if(!/Chrome/gi.test(e.userAgent))return t.ua="unknown",t;t.ua="chrome",t.version=p(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2),t.UIVersion=e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)&&e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/).length>1&&e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)[2]}else{if(!(!e.webkitGetUserMedia&&e.userAgent.match(/AppleWebKit\/([0-9]+)\./)||e.webkitGetUserMedia&&!e.webkitRTCPeerConnection))return t.ua="unknown",t;if(/micromessenger/.test(s))t.ua="weixin",t.version=p(s,/micromessenger\/(\d+)\./,2),t.UIVersion=7;else{if(!e.userAgent.match(/Version\/(\d+).(\d+)/))return t.ua="unknown",t;t.ua="safari",t.version=e.userAgent.match(/Version\/([\d]+)/)[1],t.UIVersion=e.userAgent.match(/Version\/([\d.]+)/)[1]}}return t}(),o.browser.greaterThanOrEqualToSafari_12_1_1=function(){if("safari"!==o.browser.ua||!o.browser.UIVersion)return!1;var e=o.browser.UIVersion.split(".");return 1===e.length?!(e[0]<12):2===e.length?e[0]>12||!(e[0]<12)&&!(e[1]<1):e[0]>12||(e[0]<12||!(e[1]<1)&&!(e[2]<1))},o.browser.lessThanSafari_12_1_1=function(){return!("safari"!==o.browser.ua||!o.browser.UIVersion)&&!o.browser.greaterThanOrEqualToSafari_12_1_1()},o.browser.safari_12_1=function(){if("safari"!==o.browser.ua||!o.browser.UIVersion)return!1;var e=o.browser.UIVersion.split(".");return 2==e.length&&(12==e[0]&&1==e[1])},o.browser.safari_12_0_1=function(){if("safari"!==o.browser.ua||!o.browser.UIVersion)return!1;var e=o.browser.UIVersion.split(".");return!(e.length<3)&&(12===e[0]&&(0===e[1]&&1===e[2]))},o.orientation=l(["portrait","landscape"]),t.default=o,e.exports=t.default},function(e,t,r){var i=r(14),a=r(23),n=r(79);e.exports=function(e,t){if(i(e),a(t)&&t.constructor===e)return t;var r=n.f(e);return(0,r.resolve)(t),r.promise}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var i,a,n,o=r(36),s=r(174),d=r(88),c=r(64),u=r(8),l=u.process,p=u.setImmediate,f=u.clearImmediate,h=u.MessageChannel,m=u.Dispatch,g=0,v={},R=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},_=function(e){R.call(e.data)};p&&f||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return v[++g]=function(){s("function"==typeof e?e:Function(e),t)},i(g),g},f=function(e){delete v[e]},"process"==r(38)(l)?i=function(e){l.nextTick(o(R,e,1))}:m&&m.now?i=function(e){m.now(o(R,e,1))}:h?(n=(a=new h).port2,a.port1.onmessage=_,i=o(n.postMessage,n,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(i=function(e){u.postMessage(e+"","*")},u.addEventListener("message",_,!1)):i="onreadystatechange"in c("script")?function(e){d.appendChild(c("script")).onreadystatechange=function(){d.removeChild(this),R.call(e)}}:function(e){setTimeout(o(R,e,1),0)}),e.exports={set:p,clear:f}},function(e,t,r){var i=r(14),a=r(50),n=r(7)("species");e.exports=function(e,t){var r,o=i(e).constructor;return void 0===o||null==(r=i(o)[n])?t:a(r)}},function(e,t,r){var i=r(7)("iterator"),a=!1;try{var n=[7][i]();n.return=function(){a=!0},Array.from(n,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var r=!1;try{var n=[7],o=n[i]();o.next=function(){return{done:r=!0}},n[i]=function(){return o},e(n)}catch(e){}return r}},function(e,t,r){var i=r(31),a=r(7)("iterator"),n=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||n[a]===e)}},function(e,t,r){var i=r(14);e.exports=function(e,t,r,a){try{return a?t(i(r)[0],r[1]):t(r)}catch(t){var n=e.return;throw void 0!==n&&i(n.call(e)),t}}},,function(e,t,r){"use strict";var i=r(17),a=i.getGlobal(),n={},o=a.name||"_parent",s=[],d=[];n.addMsgListener=function(e){s.push(e)};var c,u,l,p,f=(c=/^([\w]+?:\/\/.*?(?=\/|$))/i,function(e){return e=e||"",c.test(e)?RegExp.$1:"*"}),h=function(){var e=unescape(a.name||"").trim();if(e&&0===e.indexOf("MSG|")){a.name="";var t=i.string2object(e.replace("MSG|",""),"|"),r=(t.origin||"").toLowerCase();r&&"*"!==r&&0!==location.href.toLowerCase().indexOf(r)||function(e){for(var t=0,r=s.length;t<r;t++)try{s[t].call(null,e)}catch(e){}}({data:JSON.parse(t.data||"null"),source:a.frames[t.self]||t.self,origin:f(t.ref||("undefined"==typeof document?"":document.referrer))})}},m=(l=function(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return!0;return!1},function(){if(d.length){u=[];for(var e,t=d.length-1;t>=0;t--)e=d[t],l(u,e.w)||(u.push(e.w),d.splice(t,1),e.w.name=e.d);u=null}}),g=n.startTimer=(p=!1,function(){p||(p=!0,a.postMessage||(setInterval(m,100),setInterval(h,20)))});n.postMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i.fillUndef(t,{origin:"*",source:o}),a.postMessage){var r=t.data;a.FormData||(r=JSON.stringify(r)),e.postMessage(r,t.origin)}else{if(g(),i.isObject(t)){var n={};n.origin=t.origin||"",n.ref=location.href,n.self=t.source,n.data=JSON.stringify(t.data),t="MSG|"+i.object2string(n,"|",!0)}d.unshift({w:e,d:escape(t)})}},e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractBusiness=void 0;var i=o(r(1)),a=o(r(4)),n=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return(0,n.default)(t,e),t}(r(12).EventEmitter);t.AbstractBusiness=s},function(e,t,r){var i=r(324),a=r(323);t.write=a,t.parse=i.parse,t.parseFmtpConfig=i.parseFmtpConfig,t.parseParams=i.parseParams,t.parsePayloads=i.parsePayloads,t.parseRemoteCandidates=i.parseRemoteCandidates,t.parseImageAttributes=i.parseImageAttributes,t.parseSimulcastStreamList=i.parseSimulcastStreamList},,,,,,function(e,t,r){"use strict";var i=r(41),a=r(53),n=r(39),o=r(49),s=r(74),d=Object.assign;e.exports=!d||r(29)(function(){var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(e){t[e]=e}),7!=d({},e)[r]||Object.keys(d({},t)).join("")!=i})?function(e,t){for(var r=o(e),d=arguments.length,c=1,u=a.f,l=n.f;d>c;)for(var p,f=s(arguments[c++]),h=u?i(f).concat(u(f)):i(f),m=h.length,g=0;m>g;)l.call(f,p=h[g++])&&(r[p]=f[p]);return r}:d},function(e,t,r){var i=r(16);i(i.S+i.F,"Object",{assign:r(117)})},function(e,t,r){r(118),e.exports=r(6).Object.assign},function(e,t,r){e.exports={default:r(119),__esModule:!0}},,function(e,t,r){"use strict";var i=r(5);"undefined"!=typeof window&&(window.console||i.isWeixinApp||(window.console={log:function(){},info:function(){},warn:function(){},error:function(){}}))},function(e,t,r){r(54)("observable")},function(e,t,r){r(54)("asyncIterator")},function(e,t,r){var i=r(26),a=r(73).f,n={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==n.call(e)?function(e){try{return a(e)}catch(e){return o.slice()}}(e):a(i(e))}},function(e,t,r){var i=r(38);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t,r){var i=r(41),a=r(53),n=r(39);e.exports=function(e){var t=i(e),r=a.f;if(r)for(var o,s=r(e),d=n.f,c=0;s.length>c;)d.call(e,o=s[c++])&&t.push(o);return t}},function(e,t,r){var i=r(40)("meta"),a=r(23),n=r(22),o=r(15).f,s=0,d=Object.isExtensible||function(){return!0},c=!r(29)(function(){return d(Object.preventExtensions({}))}),u=function(e){o(e,i,{value:{i:"O"+ ++s,w:{}}})},l=e.exports={KEY:i,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!n(e,i)){if(!d(e))return"F";if(!t)return"E";u(e)}return e[i].i},getWeak:function(e,t){if(!n(e,i)){if(!d(e))return!0;if(!t)return!1;u(e)}return e[i].w},onFreeze:function(e){return c&&l.NEED&&d(e)&&!n(e,i)&&u(e),e}}},function(e,t,r){"use strict";var i=r(8),a=r(22),n=r(18),o=r(16),s=r(76),d=r(128).KEY,c=r(29),u=r(57),l=r(43),p=r(40),f=r(7),h=r(55),m=r(54),g=r(127),v=r(126),R=r(14),_=r(23),y=r(26),C=r(59),b=r(34),E=r(67),S=r(125),T=r(72),A=r(15),O=r(41),k=T.f,P=A.f,I=S.f,D=i.Symbol,w=i.JSON,M=w&&w.stringify,W=f("_hidden"),x=f("toPrimitive"),N={}.propertyIsEnumerable,L=u("symbol-registry"),V=u("symbols"),B=u("op-symbols"),U=Object.prototype,j="function"==typeof D,F=i.QObject,H=!F||!F.prototype||!F.prototype.findChild,G=n&&c(function(){return 7!=E(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(e,t,r){var i=k(U,t);i&&delete U[t],P(e,t,r),i&&e!==U&&P(U,t,i)}:P,Y=function(e){var t=V[e]=E(D.prototype);return t._k=e,t},J=j&&"symbol"==typeof D.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof D},K=function(e,t,r){return e===U&&K(B,t,r),R(e),t=C(t,!0),R(r),a(V,t)?(r.enumerable?(a(e,W)&&e[W][t]&&(e[W][t]=!1),r=E(r,{enumerable:b(0,!1)})):(a(e,W)||P(e,W,b(1,{})),e[W][t]=!0),G(e,t,r)):P(e,t,r)},z=function(e,t){R(e);for(var r,i=g(t=y(t)),a=0,n=i.length;n>a;)K(e,r=i[a++],t[r]);return e},q=function(e){var t=N.call(this,e=C(e,!0));return!(this===U&&a(V,e)&&!a(B,e))&&(!(t||!a(this,e)||!a(V,e)||a(this,W)&&this[W][e])||t)},Q=function(e,t){if(e=y(e),t=C(t,!0),e!==U||!a(V,t)||a(B,t)){var r=k(e,t);return!r||!a(V,t)||a(e,W)&&e[W][t]||(r.enumerable=!0),r}},$=function(e){for(var t,r=I(y(e)),i=[],n=0;r.length>n;)a(V,t=r[n++])||t==W||t==d||i.push(t);return i},X=function(e){for(var t,r=e===U,i=I(r?B:y(e)),n=[],o=0;i.length>o;)!a(V,t=i[o++])||r&&!a(U,t)||n.push(V[t]);return n};j||(s((D=function(){if(this instanceof D)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===U&&t.call(B,r),a(this,W)&&a(this[W],e)&&(this[W][e]=!1),G(this,e,b(1,r))};return n&&H&&G(U,e,{configurable:!0,set:t}),Y(e)}).prototype,"toString",function(){return this._k}),T.f=Q,A.f=K,r(73).f=S.f=$,r(39).f=q,r(53).f=X,n&&!r(44)&&s(U,"propertyIsEnumerable",q,!0),h.f=function(e){return Y(f(e))}),o(o.G+o.W+o.F*!j,{Symbol:D});for(var Z="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;Z.length>ee;)f(Z[ee++]);for(var te=O(f.store),re=0;te.length>re;)m(te[re++]);o(o.S+o.F*!j,"Symbol",{for:function(e){return a(L,e+="")?L[e]:L[e]=D(e)},keyFor:function(e){if(!J(e))throw TypeError(e+" is not a symbol!");for(var t in L)if(L[t]===e)return t},useSetter:function(){H=!0},useSimple:function(){H=!1}}),o(o.S+o.F*!j,"Object",{create:function(e,t){return void 0===t?E(e):z(E(e),t)},defineProperty:K,defineProperties:z,getOwnPropertyDescriptor:Q,getOwnPropertyNames:$,getOwnPropertySymbols:X}),w&&o(o.S+o.F*(!j||c(function(){var e=D();return"[null]"!=M([e])||"{}"!=M({a:e})||"{}"!=M(Object(e))})),"JSON",{stringify:function(e){for(var t,r,i=[e],a=1;arguments.length>a;)i.push(arguments[a++]);if(r=t=i[1],(_(t)||void 0!==e)&&!J(e))return v(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!J(t))return t}),i[1]=t,M.apply(w,i)}}),D.prototype[x]||r(25)(D.prototype,x,D.prototype.valueOf),l(D,"Symbol"),l(Math,"Math",!0),l(i.JSON,"JSON",!0)},function(e,t,r){r(129),r(87),r(124),r(123),e.exports=r(6).Symbol},function(e,t,r){e.exports={default:r(130),__esModule:!0}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t){e.exports=function(){}},function(e,t,r){"use strict";var i=r(133),a=r(132),n=r(31),o=r(26);e.exports=r(78)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),n.Arguments=n.Array,i("keys"),i("values"),i("entries")},function(e,t,r){var i=r(61),a=Math.max,n=Math.min;e.exports=function(e,t){return(e=i(e))<0?a(e+t,0):n(e,t)}},function(e,t,r){var i=r(26),a=r(68),n=r(135);e.exports=function(e){return function(t,r,o){var s,d=i(t),c=a(d.length),u=n(o,c);if(e&&r!=r){for(;c>u;)if((s=d[u++])!=s)return!0}else for(;c>u;u++)if((e||u in d)&&d[u]===r)return e||u||0;return!e&&-1}}},function(e,t,r){var i=r(15),a=r(14),n=r(41);e.exports=r(18)?Object.defineProperties:function(e,t){a(e);for(var r,o=n(t),s=o.length,d=0;s>d;)i.f(e,r=o[d++],t[r]);return e}},function(e,t,r){"use strict";var i=r(67),a=r(34),n=r(43),o={};r(25)(o,r(7)("iterator"),function(){return this}),e.exports=function(e,t,r){e.prototype=i(o,{next:a(1,r)}),n(e,t+" Iterator")}},function(e,t,r){var i=r(61),a=r(60);e.exports=function(e){return function(t,r){var n,o,s=String(a(t)),d=i(r),c=s.length;return d<0||d>=c?e?"":void 0:(n=s.charCodeAt(d))<55296||n>56319||d+1===c||(o=s.charCodeAt(d+1))<56320||o>57343?e?s.charAt(d):n:e?s.slice(d,d+2):o-56320+(n-55296<<10)+65536}}},function(e,t,r){r(42),r(48),e.exports=r(55).f("iterator")},function(e,t,r){e.exports={default:r(140),__esModule:!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(312);Object.defineProperty(t,"VIDEO_QUALITY",{enumerable:!0,get:function(){return i.VIDEO_QUALITY}}),Object.defineProperty(t,"VIDEO_QUALITY_REV",{enumerable:!0,get:function(){return i.VIDEO_QUALITY_REV}}),Object.defineProperty(t,"validateVideoQuality",{enumerable:!0,get:function(){return i.validateVideoQuality}});var a=r(311);Object.defineProperty(t,"VIDEO_FRAME_RATE",{enumerable:!0,get:function(){return a.VIDEO_FRAME_RATE}}),Object.defineProperty(t,"VIDEO_FRAME_RATE_REV",{enumerable:!0,get:function(){return a.VIDEO_FRAME_RATE_REV}}),Object.defineProperty(t,"validateVideoFrameRate",{enumerable:!0,get:function(){return a.validateVideoFrameRate}});var n=r(310);Object.defineProperty(t,"ENCRYPTION_ALGORITHM_MODE",{enumerable:!0,get:function(){return n.ENCRYPTION_ALGORITHM_MODE}});var o=r(309);Object.defineProperty(t,"CONTROL_TYPE",{enumerable:!0,get:function(){return o.CONTROL_TYPE}});var s=r(308);Object.defineProperty(t,"CONFIG_MAP",{enumerable:!0,get:function(){return s.CONFIG_MAP}});var d=r(307);Object.defineProperty(t,"DEVICE_TYPE",{enumerable:!0,get:function(){return d.DEVICE_TYPE}}),Object.defineProperty(t,"DEVICE_TYPE_REV",{enumerable:!0,get:function(){return d.DEVICE_TYPE_REV}});var c=r(306);Object.defineProperty(t,"NETCALL_TYPE",{enumerable:!0,get:function(){return c.NETCALL_TYPE}});var u=r(305);Object.defineProperty(t,"SPLIT_MODE",{enumerable:!0,get:function(){return u.SPLIT_MODE}});var l=r(304);Object.defineProperty(t,"MIX_VIDEO_MODE",{enumerable:!0,get:function(){return l.MIX_VIDEO_MODE}});var p=r(303);Object.defineProperty(t,"ROLE_FOR_MEETING",{enumerable:!0,get:function(){return p.ROLE_FOR_MEETING}});var f=r(302);Object.defineProperty(t,"SESSION_MODE",{enumerable:!0,get:function(){return f.SESSION_MODE}});var h=r(301);Object.defineProperty(t,"DECTECT_RESULT_TYPE",{enumerable:!0,get:function(){return h.DECTECT_RESULT_TYPE}});var m=r(300);Object.defineProperty(t,"DECTECT_TYPE",{enumerable:!0,get:function(){return m.DECTECT_TYPE}}),Object.defineProperty(t,"DECTECT_TYPE_REV",{enumerable:!0,get:function(){return m.DECTECT_TYPE_REV}});var g=r(299);Object.defineProperty(t,"VIDEO_ENCODE_MODE",{enumerable:!0,get:function(){return g.VIDEO_ENCODE_MODE}});var v=r(298);Object.defineProperty(t,"SCALE_TYPE",{enumerable:!0,get:function(){return v.SCALE_TYPE}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(r(332)),a=s(r(331)),n=s(r(330)),o=s(r(327));function s(e){return e&&e.__esModule?e:{default:e}}t.default={ApiInvokeData:function(e){return new i.default(e)},LogData:function(e){return new a.default(e)},FormatDataFromStats:function(e){return new n.default(e)},RawDataFromStats:function(e){return new o.default(e)}},e.exports=t.default},,,,,,,,function(e,t,r){"use strict";t.__esModule=!0;var i=n(r(188)),a=n(r(185));function n(e){return e&&e.__esModule?e:{default:e}}t.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,i.default)(Object(e)))return function(e,t){var r=[],i=!0,n=!1,o=void 0;try{for(var s,d=(0,a.default)(e);!(i=(s=d.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(e){n=!0,o=e}finally{try{!i&&d.return&&d.return()}finally{if(n)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},,,,function(e,t,r){var i,a,n,o,s;i=r(329),a=r(209).utf8,n=r(328),o=r(209).bin,(s=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?o.stringToBytes(e):a.stringToBytes(e):n(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var r=i.bytesToWords(e),d=8*e.length,c=1732584193,u=-271733879,l=-1732584194,p=271733878,f=0;f<r.length;f++)r[f]=16711935&(r[f]<<8|r[f]>>>24)|4278255360&(r[f]<<24|r[f]>>>8);r[d>>>5]|=128<<d%32,r[14+(d+64>>>9<<4)]=d;var h=s._ff,m=s._gg,g=s._hh,v=s._ii;for(f=0;f<r.length;f+=16){var R=c,_=u,y=l,C=p;u=v(u=v(u=v(u=v(u=g(u=g(u=g(u=g(u=m(u=m(u=m(u=m(u=h(u=h(u=h(u=h(u,l=h(l,p=h(p,c=h(c,u,l,p,r[f+0],7,-680876936),u,l,r[f+1],12,-389564586),c,u,r[f+2],17,606105819),p,c,r[f+3],22,-1044525330),l=h(l,p=h(p,c=h(c,u,l,p,r[f+4],7,-176418897),u,l,r[f+5],12,1200080426),c,u,r[f+6],17,-1473231341),p,c,r[f+7],22,-45705983),l=h(l,p=h(p,c=h(c,u,l,p,r[f+8],7,1770035416),u,l,r[f+9],12,-1958414417),c,u,r[f+10],17,-42063),p,c,r[f+11],22,-1990404162),l=h(l,p=h(p,c=h(c,u,l,p,r[f+12],7,1804603682),u,l,r[f+13],12,-40341101),c,u,r[f+14],17,-1502002290),p,c,r[f+15],22,1236535329),l=m(l,p=m(p,c=m(c,u,l,p,r[f+1],5,-165796510),u,l,r[f+6],9,-1069501632),c,u,r[f+11],14,643717713),p,c,r[f+0],20,-373897302),l=m(l,p=m(p,c=m(c,u,l,p,r[f+5],5,-701558691),u,l,r[f+10],9,38016083),c,u,r[f+15],14,-660478335),p,c,r[f+4],20,-405537848),l=m(l,p=m(p,c=m(c,u,l,p,r[f+9],5,568446438),u,l,r[f+14],9,-1019803690),c,u,r[f+3],14,-187363961),p,c,r[f+8],20,1163531501),l=m(l,p=m(p,c=m(c,u,l,p,r[f+13],5,-1444681467),u,l,r[f+2],9,-51403784),c,u,r[f+7],14,1735328473),p,c,r[f+12],20,-1926607734),l=g(l,p=g(p,c=g(c,u,l,p,r[f+5],4,-378558),u,l,r[f+8],11,-2022574463),c,u,r[f+11],16,1839030562),p,c,r[f+14],23,-35309556),l=g(l,p=g(p,c=g(c,u,l,p,r[f+1],4,-1530992060),u,l,r[f+4],11,1272893353),c,u,r[f+7],16,-155497632),p,c,r[f+10],23,-1094730640),l=g(l,p=g(p,c=g(c,u,l,p,r[f+13],4,681279174),u,l,r[f+0],11,-358537222),c,u,r[f+3],16,-722521979),p,c,r[f+6],23,76029189),l=g(l,p=g(p,c=g(c,u,l,p,r[f+9],4,-640364487),u,l,r[f+12],11,-421815835),c,u,r[f+15],16,530742520),p,c,r[f+2],23,-995338651),l=v(l,p=v(p,c=v(c,u,l,p,r[f+0],6,-198630844),u,l,r[f+7],10,1126891415),c,u,r[f+14],15,-1416354905),p,c,r[f+5],21,-57434055),l=v(l,p=v(p,c=v(c,u,l,p,r[f+12],6,1700485571),u,l,r[f+3],10,-1894986606),c,u,r[f+10],15,-1051523),p,c,r[f+1],21,-2054922799),l=v(l,p=v(p,c=v(c,u,l,p,r[f+8],6,1873313359),u,l,r[f+15],10,-30611744),c,u,r[f+6],15,-1560198380),p,c,r[f+13],21,1309151649),l=v(l,p=v(p,c=v(c,u,l,p,r[f+4],6,-145523070),u,l,r[f+11],10,-1120210379),c,u,r[f+2],15,718787259),p,c,r[f+9],21,-343485551),c=c+R>>>0,u=u+_>>>0,l=l+y>>>0,p=p+C>>>0}return i.endian([c,u,l,p])})._ff=function(e,t,r,i,a,n,o){var s=e+(t&r|~t&i)+(a>>>0)+o;return(s<<n|s>>>32-n)+t},s._gg=function(e,t,r,i,a,n,o){var s=e+(t&i|r&~i)+(a>>>0)+o;return(s<<n|s>>>32-n)+t},s._hh=function(e,t,r,i,a,n,o){var s=e+(t^r^i)+(a>>>0)+o;return(s<<n|s>>>32-n)+t},s._ii=function(e,t,r,i,a,n,o){var s=e+(r^(t|~i))+(a>>>0)+o;return(s<<n|s>>>32-n)+t},s._blocksize=16,s._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=i.wordsToBytes(s(e,t));return t&&t.asBytes?r:t&&t.asString?o.bytesToString(r):i.bytesToHex(r)}},function(e,t,r){e.exports={default:r(231),__esModule:!0}},,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractWebRTC=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3));r(219);var s=r(12),d=r(27),c=r(11);r(51);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.imInfo=e.imInfo,r.targetUid=e.targetUid||r.imInfo.uid,r.adapterRef=e.adapterRef,d.RtcUtil.logger=d.SdpUtil.logger=r.adapterRef.logger,r._init(),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_resetOfferRelativeStatus",value:function(){this.sdpOffer=null,this.sdpAnswer=null,this.iceOffer=[],this.iceAnswer=[],this.offerCount=0}},{key:"_reset",value:function(){this._resetOfferRelativeStatus(),this.isProgress=!1,this.iceCompleted=!1,this.rtcConnection=null,this.currStream=null,this.isNeedUpdataSdp=!1,this.imInfo=null,this.targetUid=null,this.vp8Only=!1,this.disTimer&&clearTimeout(this.disTimer),this.disTimer=null}},{key:"_resetPeerTimeOut",value:function(){this._resetOfferRelativeStatus(),this.isProgress=!1,this.iceCompleted=!1,this.rtcConnection=null,this.isNeedUpdataSdp=!1}},{key:"_init",value:function(){var e=this;if(this.rtcConnection)this.adapterRef.logger.log("AbstractWebRTC:_init 已存在rtcConnection");else{var t={iceServers:[{urls:["stun:turn.ideasip.com"]}],rtcpMuxPolicy:"require"},r={relayaddrs:null,relaytoken:null,uid:this.imInfo.uid,cid:this.imInfo.cid};"WebRTC"===c.CONFIG_MAP.SDK_NAME[c.CONFIG_MAP.CURRENT.SDK_TYPE]&&this.imInfo.serverMap?(r.relayaddrs=this.imInfo.serverMap.relayaddrs,r.relaytoken=this.imInfo.serverMap.relaytoken):"NRTC"===c.CONFIG_MAP.SDK_NAME[c.CONFIG_MAP.CURRENT.SDK_TYPE]&&(r.relayaddrs=this.imInfo.relayaddrs,r.relaytoken=this.imInfo.relaytoken),this.adapterRef.isPrivateDeployment&&this.adapterRef.privateDeploymentConf&&this.adapterRef.privateDeploymentConf.turnServer?(t.iceServers=[],t.iceServers.push({urls:"turn:"+this.adapterRef.privateDeploymentConf.turnServer,credential:"netease",username:"netease"}),t.iceTransportPolicy="relay"):r.relayaddrs&&r.relayaddrs.length&&r.relaytoken?(r.relayaddrs=Array.from(new Set(r.relayaddrs)),t.iceServers=[],r.relayaddrs.forEach(function(e){t.iceServers.push({urls:"turn:"+e+"?transport=udp",credential:r.uid+"/"+r.cid,username:r.relaytoken}),t.iceServers.push({urls:"turn:"+e+"?transport=tcp",credential:r.uid+"/"+r.cid,username:r.relaytoken})}),t.iceTransportPolicy="relay",this.timer=setTimeout(function(){e.rtcConnection&&e.emit("iceCandidateTimeOut",{rtc:e,state:e.rtcConnection.iceConnectionState})},15e3)):this.timer&&(clearTimeout(this.timer),this.timer=null),this.createPeerConnection(t)}}},{key:"createPeerConnection",value:function(e){this.adapterRef.logger.log("AbstractWebRTC:init create rtcConnection");var t=null;(t=/Firefox/gi.test(navigator.userAgent)?this.rtcConnection=new RTCPeerConnection(e):this.rtcConnection=new RTCPeerConnection(e,{optional:[{googIPv6:!1},{googScreencastMinBitrate:400},{googPayloadPadding:!0},{googImprovedWifiBwe:!0},{googDscp:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googSuspendBelowMinBitrate:!0},{googCombinedAudioVideoBwe:!0},{googCpuOveruseDetection:!0},{googCpuOveruseEncodeUsage:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85}]})).uid=this.imInfo.uid,t.targetUid=this.targetUid,t.onicecandidate=this.onIceCandidate.bind(this),t.onnegotiationneeded=this.onNegotiationNeeded.bind(this),t.oniceconnectionstatechange=this.onIceStateChange.bind(this),t.onicecandidateerror=function(e){},t.onicegatheringstatechange=function(e){},t.onconnectionstatechange=function(e){},/Firefox/gi.test(navigator.userAgent)?t.ontrack=this.onAddRemoteTrack.bind(this):t.onaddstream=this.onAddRemoteStream.bind(this),t.onremovestream=this.onRemoveRemoteStream.bind(this)}},{key:"onIceCandidate",value:function(e){if(!e.candidate||this.rtcConnection.iceGatheringState&&"complete"===this.rtcConnection.iceGatheringState)return this.adapterRef.logger.log("AbstractWebRTC:onIceCandidate 收集完成"),void this.emit("iceCandidate",{uid:this.targetUid,ice:e.candidate,isGatherCompleted:!0});if(!(/ tcp /gi.test(e.candidate.candidate)||/\.1 /gi.test(e.candidate.candidate)||/ 2 UDP /gi.test(e.candidate.candidate))){if(this.adapterRef.logger.log("AbstractWebRTC:onIceCandidate targetUid: %s , gather candidate : %o",this.targetUid,e.candidate.candidate),this.targetUid==this.imInfo.uid){var t=e.candidate.candidate.match(/([0-9\.]+) ([0-9]+) typ host/);t&&t.length&&(this.adapterRef.instance.localIP&&this.adapterRef.instance.localIP!==t[1]&&this.adapterRef.instance.commondDatareport("setIpChange",{uid:""+this.imInfo.uid,cid:""+this.imInfo.cid,ip:t[1],time:Date.now()}),this.adapterRef.instance.localIP=t[1])}this.iceOffer.push(e.candidate),this.offerCount++,this.rtcConnection&&this.rtcConnection.signalingState&&"stable"==this.rtcConnection.signalingState&&this.doSendIce()}}},{key:"onNegotiationNeeded",value:function(e){this.emit("negotiaionNeeded",e)}},{key:"onIceStateChange",value:function(e){if(this.rtcConnection&&this.adapterRef&&this.adapterRef.webrtcGateWayBusiness){var t=this.rtcConnection.iceConnectionState;this.adapterRef.logger.log("AbstractWebRTC:onIceStateChange: %s, %s",t,this.targetUid),"connected"!==t&&"completed"!==t||(this.timer&&(clearTimeout(this.timer),this.timer=null),this.iceCompleted=!0,this.setProgress(!1)),"failed"===t&&(this.iceCompleted=!1),this.emit("iceStateChange",{rtc:this,state:this.rtcConnection.iceConnectionState})}else this.adapterRef.logger.warn("AbstractWebRTC:onIceStateChange 不存在的 rtcConnection")}},{key:"onAddRemoteStream",value:function(e){this.targetUid!=this.imInfo.uid?d.WebrtcUtil.isSupportGetRecvivers/*!this.adapterRef.instance._isFirefox() && this.rtcConnection.getReceivers*/?this.adapterRef.logger.warn("AbstractWebRTC:onAddRemoteStream 旧接口直接忽略"):(this.adapterRef.logger.warn("AbstractWebRTC:onAddRemoteStream targetUid: %s, remote Stream: %o ",this.targetUid,e),e.stream&&"default"===e.stream.id?this.adapterRef.logger.log("AbstractWebRTC:onAddRemoteStream ID为default的流收到时不做任何事"):this.emit("getRemoteStream",{uid:this.targetUid,stream:e.stream})):this.adapterRef.logger.log("AbstractWebRTC:onAddRemoteStream 自己的远程流直接忽略")}},{key:"onAddRemoteTrack",value:function(e){if(this.targetUid!=this.imInfo.uid){var t=e.streams[0];t?(this.adapterRef.logger.log("AbstractWebRTC:onAddRemoteTrack targetUid: %s",this.targetUid),this.emit("getRemoteStream",{uid:this.targetUid,stream:t,track:e.track})):this.adapterRef.logger.error("AbstractWebRTC:onAddRemoteTrack 未找到流")}else this.adapterRef.logger.log("AbstractWebRTC:onAddRemoteTrack 自己的远程流直接忽略")}},{key:"onRemoveRemoteStream",value:function(e){this.adapterRef.logger.log("AbstractWebRTC:onRemoveRemoteStream targetUid: %s",this.targetUid)}},{key:"setProgress",value:function(e){this.isProgress=e,!1===e&&"completed"===this.rtcConnection.iceConnectionState&&this.emit("ready")}},{key:"getReceivers",value:function(){return this.rtcConnection.getReceivers()}},{key:"getRemoteStreams",value:function(){return this.rtcConnection.getRemoteStreams()}},{key:"getIceConnectionState",value:function(){if(this.rtcConnection)return this.rtcConnection.iceConnectionState}},{key:"close",value:function(){this.adapterRef.logger.log("AbstractWebRTC:close targetUid: %s",this.targetUid);var e=this.rtcConnection;e&&(e.onicecandidate=null,e.onnegotiationneeded=null,e.oniceconnectionstatechange=null,e.ontrack=null,e.onaddstream=null,e.onremovestream=null,this.rtcConnection.disTimer&&(clearTimeout(this.rtcConnection.disTimer),this.rtcConnection.disTimer=null),e.close(),this.rtcConnection=null)}},{key:"doSendIce",value:function(){if(this.sdpAnswer){if(this.iceCompleted)return this.adapterRef.logger.log("AbstractWebRTC:doSendIce ice已协商完成"),void(this.iceOffer.length=0);if(0!==this.iceOffer.length){var e=this.iceOffer.shift();this.emit("iceCandidate",{uid:this.targetUid,ice:e}),this.doSendIce()}else this.adapterRef.logger.log("AbstractWebRTC:doSendIce iceOffer队列为空")}else this.adapterRef.logger.log("AbstractWebRTC:doSendIce 未协商完sdp，无法发送ice")}},{key:"updateStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];d.RtcUtil.updateMediaStream({peer:this.rtcConnection,currStream:this.currStream,streams:t}).then(function(t){e.currStream||(e.currStream=t)})}},{key:"getLocalSdp",value:function(){return this.rtcConnection.localDescription}},{key:"getRemoteSdp",value:function(){return this.rtcConnection.remoteDescription}},{key:"checkMediaStatus",value:function(e){return d.RtcUtil.checkMediaStatus(e)}},{key:"checkMeidaExistent",value:function(e){return d.RtcUtil.checkMeidaExistent(e)}},{key:"addRemoteIceCandidate",value:function(e){var t=this;this.adapterRef.logger.log("AbstractWebRTC:addRemoteIceCandidate targetUid:%s , ice candidate: %o ",this.targetUid,JSON.stringify(e,null," ")),this.adapterRef.instance._isMobileSafari()||this.adapterRef.instance._isWeixinBrowser()||this.rtcConnection.addIceCandidate(new RTCIceCandidate(e)).then(function(){t.iceAnswer.push(e),t.iceAnswer.length===t.offerCount&&(setTimeout(function(){t.rtcConnection&&"connected"===t.rtcConnection.connectionState&&"new"===t.rtcConnection.iceConnectionState&&(t.adapterRef.logger.warn("addRemoteIceCandidate: webrtc没有反馈ice成功的通知，这里手动反馈"),t.emit("iceCompleted",t.rtcConnection.targetUid))},1e3),t.iceAnswer=[],t.offerCount=0)}).catch(function(e){t.adapterRef.logger.error("AbstractWebRTC:addRemoteIceCandidate error:%o",e)})}},{key:"createOffer",value:function(){var e=this;return this.setProgress(!0),d.RtcUtil.createOffer(this.rtcConnection).then(function(t){e.adapterRef.logger.log("********************** 创建 sdp offer **********************"),e.adapterRef.logger.log("AbstractWebRTC:createOffer uid: ",e.targetUid),e._resetOfferRelativeStatus(),t.sdp=d.SdpUtil.maybePreferVideoReceiveCodec(t.sdp,{videoRecvCodec:"H264"}),e.currStream&&e.adapterRef.logger.log("AbstractWebRTC:createOffer currentStream: %o",e.currStream.getTracks().length);var r=!1;return"p2p"===e.adapterRef.imInfo.sessionMode&&(r=e.vp8Only||e.adapterRef.instance._getWebRTCGateWayManager().isVp8Only),(t=d.RtcUtil.formatSdp({offerOrAnswer:t,uid:e.imInfo.uid,cid:e.imInfo.cid,chromeScreenShareOpened:e.adapterRef.state.chromeScreenShareOpened,stream:e.currStream,highAudio:e.imInfo.sessionConfig.highAudio,stero:e.imInfo.sessionConfig.stero,targetUid:e.targetUid,netDetect:e.imInfo.netDetect,codec:e.imInfo.codec,vp8Only:r}))?Promise.resolve(t):(e.adapterRef.imInfo&&"p2p"===e.adapterRef.imInfo.sessionMode?(e.adapterRef.instance.hangup&&e.adapterRef.instance.hangup(),e.adapterRef.instance.emit(c.EVENT_OBJ.hangup.key,Object.assign(c.EVENT_CODE.USER_LEFT_REASON.timeout,{channelId:e.imInfo.cid,account:e.adapterRef.instance._getAccountByUid(e.imInfo.uid)}))):(e.adapterRef.instance.leaveChannel&&e.adapterRef.instance.leaveChannel(),e.adapterRef.instance.emit(c.EVENT_OBJ.leaveChannel.key,Object.assign(c.EVENT_CODE.USER_LEFT_REASON.timeout,{channelId:e.imInfo.cid,account:e.adapterRef.instance._getAccountByUid(e.imInfo.uid)}))),e.adapterRef.instance.emit(c.EVENT_OBJ.error.key,c.VideoErrorCode.VideoDecodeError),Promise.reject("该机型浏览器不支持H264编码"))})}},{key:"createAnswer",value:function(e){var t=this;return this.setProgress(!0),this.rtcConnection.createAnswer().then(function(e){return t.adapterRef.logger.log("AbstractWebRTC:createAnswer 原始sdp answer",e),e.sdp=d.SdpUtil.maybePreferVideoReceiveCodec(e.sdp,{videoRecvCodec:"H264"}),e=d.RtcUtil.formatSdp({offerOrAnswer:e,uid:t.imInfo.uid,cid:t.imInfo.cid,chromeScreenShareOpened:t.adapterRef.state.chromeScreenShareOpened,stream:t.currStream,highAudio:t.imInfo.sessionConfig.highAudio,stero:t.imInfo.sessionConfig.stero,targetUid:t.targetUid,netDetect:t.imInfo.netDetect})}).catch(function(e){t.adapterRef.logger.error("AbstractWebRTC:createAnswer error: %o",e)})}},{key:"setLocalDescription",value:function(e,t){var r=this;return this.sdpOffer=e,this.adapterRef.logger.log("AbstractWebRTC:setLocalDescription, uid %o, 设置到本地： %s \n",this.targetUid,e.sdp),this.rtcConnection.setLocalDescription(e).then(function(){return r.adapterRef.logger.log("AbstractWebRTC: setLocalDescription, uid %o 成功",r.targetUid),e.sdp=d.RtcUtil.setMediaBitrates({sdp:e.sdp}),"answer"===e.type?(r.sdpAnswer=e,r.iceCompleted&&r.emit("iceCompleted"),r.setProgress(!1)):r.sdpAnswer=null,Promise.resolve(e)}).catch(function(e){r.adapterRef.logger.error("AbstractWebRTC:setLocalDescription uid: %o, error: %o",r.targetUid,e)})}},{key:"setRemoteDescription",value:function(e,t){var r=this;"offer"===e.type&&(this.adapterRef.logger.log("********************** 创建 sdp offer(remote) **********************"),this.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription 对端 targetUid: %s, 原始SDP: %o",this.targetUid,e)),this.setProgress("offer"===e.type);var i={sdp:e.sdp,type:e.type};if("offer"===e.type&&!this.sdpAnswer)return Promise.reject();if(i.sdp=d.SdpUtil.maybePreferVideoSendCodec(i.sdp,{videoRecvCodec:"H264"}),i.sdp=d.RtcUtil.formatSdpRemote(i.sdp,this.sdpOffer,this.adapterRef.state.chromeScreenShareOpened),/Firefox/gi.test(navigator.userAgent)||this.adapterRef&&this.adapterRef.isPrivateDeployment&&this.adapterRef.privateDeploymentConf.turnServer||this.imInfo.serverMap&&this.imInfo.serverMap.relayaddrs&&this.imInfo.serverMap.relayaddrs.length>0&&this.imInfo.serverMap.relaytoken)i.sdp=i.sdp.replace(/\na=candidate:.+/g,"");else if(navigator.userAgent.toLowerCase().indexOf("se 2.x")>-1){var a=i.sdp.match(/a=ssrc-group:FID \d+ \d+/g);if(a&&a.length){var n=i.sdp.match(/a=ssrc-group:FID \d+ \d+/g)[0].match(/\d+/g)[1],o=new RegExp("\\na=ssrc:"+n+" .+","gi");i.sdp=i.sdp.replace(o,""),i.sdp=i.sdp.replace(/\na=ssrc-group:.+/g,"")}}this.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription sdp: %s",i.sdp),this.sdpAnswer="answer"===e.type?i:null;var s=this.rtcConnection;return this.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription peer state: ",s.signalingState),s.signalingState&&"have-local-offer"==s.signalingState?s.setRemoteDescription(i).then(function(){if(r.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription #### setRemoteDescription 成功 uid %s: ",s.targetUid),"answer"===e.type){if(r.iceCompleted)return r.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription ice已协商完成, targetUid: %s",s.targetUid),void r.emit("iceCompleted",s.targetUid);r.doSendIce()}return Promise.resolve()}).catch(function(e){if(r.adapterRef.logger.error("AbstractWebRTC:setRemoteDescription uid:%s, error: %o",s.uid,e),r.iceCompleted)return r.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription ice已协商完成, targetUid: %s",s.targetUid),r.emit("iceCompleted",s.targetUid),Promise.resolve()}):Promise.resolve()}},{key:"destroy",value:function(){this.adapterRef.logger.log("AbstractWebRTC:destroy"),this.close(),this._reset()}}]),t}(s.EventEmitter);t.AbstractWebRTC=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebAudio=void 0;var i=r(28),a=r(11),n=i.RtcSupport.checkWebAudio();function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.logger,r=void 0===t?console:t,i=e.stream,a=e.uid,o=e.isAnalyze,s=e.isRemote;this.support=n.WebAudio&&n.MediaStream,this.gain=1,this.stream=i,this.logger=r,this.support&&(this.audioIn={},this.uid=a||0,this.isAnalyze=o,this.isRemote=s||!1,this.instant=0,this.slow=0,this.clip=0,this.resetMixConf(),this.init())}o.ac=n.WebAudio&&n.MediaStream?new window.AudioContext:{},o.destination=o.ac.createMediaStreamDestination?o.ac.createMediaStreamDestination():{};var s=o.prototype;s.context=o.ac,s.init=function(){this.validateInput()&&(this.isAnalyze&&this.initMonitor(),this.formatStreams(),this.initWebAudio(),this.initAudioIn())},s.validateInput=function(){return/(Array|MediaStream|LocalMediaStream)/.test(this.stream.constructor)},s.initMonitor=function(){var e=this;(this.script=this.context.createScriptProcessor(0,1,1)).onaudioprocess=function(t){var r,i=t.inputBuffer.getChannelData(0),a=0,n=0;for(r=0;r<i.length;++r)a+=Math.abs(i[r]),Math.abs(i[r])>.99&&(n+=1);e.instant=Math.sqrt(a/i.length),e.slow=.95*e.slow+.05*e.instant,e.clip=n/i.length;var o=t.inputBuffer;t.outputBuffer.copyToChannel(o.getChannelData(0),0,0)}},s.initWebAudio=function(){var e=this.context;this.gainFilter=e.createGain(),this.destination=this.isRemote?o.destination:e.createMediaStreamDestination(),this.gainFilter.gain.value=this.gain},s.initAudioIn=function(){var e=this,t=this,r=this.stream,i=this.context,n=void 0;if(/(MediaStream|LocalMediaStream)/.test(r.constructor))return o(r),void(this.outputStream=this.destination.stream);function o(e){if(!/(MediaStream|LocalMediaStream)/.test(e.constructor))return null;if(0===e.getAudioTracks().length)return null;var r=i.createMediaStreamSource(e);return r.connect(t.gainFilter),t.mixAudioConf.state===a.AuidoMixingState.UNSTART&&(t.script?(t.gainFilter.connect(t.script),t.script.connect(t.destination)):t.gainFilter.connect(t.destination)),r}r.constructor===Array&&(r.forEach(function(t){(n=o(t))&&(e.audioIn[t.id]=n)}),this.outputStream=this.destination.stream),this.logger.log("WebAudio: addMs: 初始化音频 state: ",i.state),"running"!==i.state&&i.resume().then(function(){e.logger.log("WebAudio: addMs: 状态变更成功 state: ",i.state)}).catch(function(t){e.logger.log("WebAudio: addMs: 状态变更出错: ",t),i.resume()})},s.formatStreams=function(){var e=this.stream,t=[];if(/(MediaStream|LocalMediaStream)/.test(e.constructor))return e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))}),void(this.stream=t);e.constructor===Array&&(e.map(function(e){e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))})}),this.stream=t)},s.addStream=function(e){var t=this.context;if(0!==e.getAudioTracks().length){var r=t.createMediaStreamSource(e);this.isAnalyze&&this.script&&r.connect(this.script),r.connect(this.gainFilter),this.audioIn[e.id]=r,this.outputStream=this.destination.stream}},s.updateStream=function(e){if(this.audioIn)for(var t in this.audioIn)this.audioIn[t]&&this.audioIn[t].disconnect(0),this.audioIn[t]=null;this.audioIn={},this.stream=e,this.initAudioIn()},s.setGain=function(e){this.support&&(this.gainFilter.gain.value=e,this.gain=e)},s.getGain=function(){return this.gain},s.resetMixConf=function(){this.mixAudioConf&&this.mixAudioConf.replace&&(this.logger.log("伴音停止了，恢复mic"),this.script?(this.gainFilter.connect(this.script),this.script.connect(this.destination)):this.gainFilter.connect(this.destination)),this.mixAudioConf={state:a.AuidoMixingState.UNSTART,audioSource:null,gainFilter:null,replace:!1,cycle:0,pauseTime:0,startTime:0,totalTime:0,volume:1,playStartTime:0,setPlayStartTime:0,auidoMixingEnd:null}},s.startMix=function(e){var t=this;this.logger.log("开始混音: %s",JSON.stringify(e,null," ")),this.mixAudioConf.audioSource=this.context.createBufferSource(),this.mixAudioConf.gainFilter=this.context.createGain(),this.mixAudioConf.audioSource.buffer=e.buffer,this.mixAudioConf.replace=e.replace,this.mixAudioConf.cycle=e.cycle,this.mixAudioConf.playStartTime=e.playStartTime,this.mixAudioConf.auidoMixingEnd=e.auidoMixingEnd,this.mixAudioConf.audioSource.connect(this.mixAudioConf.gainFilter),this.mixAudioConf.gainFilter.connect(this.destination),e.replace&&(this.script?this.script.disconnect(0):this.gainFilter.disconnect(0),this.instant=0);if(this.mixAudioConf.audioSource.onended=function(e){t.audioEnd(e)},this.mixAudioConf.totalTime=e.buffer.duration,(this.mixAudioConf.playStartTime<0||this.mixAudioConf.playStartTime>=this.mixAudioConf.totalTime)&&(this.mixAudioConf.playStartTime=0),this.logger.log("设置音量: %s",this.mixAudioConf.volume),this.mixAudioConf.gainFilter.gain.value=this.mixAudioConf.volume,e.loopback&&e.cycle>1){this.mixAudioConf.audioSource.loop=e.loopback;var r=e.cycle*this.mixAudioConf.totalTime-this.mixAudioConf.playStartTime;this.logger.log("循环播放: options.playStartTime: ",this.mixAudioConf.playStartTime),this.logger.log("循环播放: totalTime: ",r),this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime,r-1)}else e.loopback&&1==e.cycle?(this.mixAudioConf.audioSource.loop=!1,this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime)):(this.logger.log("无限循环播放 loop: ",e.loopback),this.mixAudioConf.audioSource.loop=e.loopback,this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime));return this.mixAudioConf.state=a.AuidoMixingState.PLAYED,this.mixAudioConf.startTime=Date.now(),Promise.resolve()},s.pauseAudioMixing=function(e){this.logger.log("暂停混音"),this.mixAudioConf.audioSource.onended=null,this.mixAudioConf.audioSource.disconnect(0),this.mixAudioConf.gainFilter.disconnect(0),this.mixAudioConf.audioSource.stop(),this.mixAudioConf.pauseTime=Date.now(),this.mixAudioConf.state=a.AuidoMixingState.PAUSED;var t=(this.mixAudioConf.pauseTime-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return this.logger.log("已经播放的时间: ",t),t>this.mixAudioConf.totalTime&&(t%=this.mixAudioConf.totalTime),this.logger.log("暂停位置:",t),Promise.resolve()},s.resumeAudioMixing=function(e){return this.logger.log("恢复混音"),this.mixAudioConf.pauseTime=0,this.startMix(e)},s.stopAudioMixing=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.logger.log("停止混音, isFinished: ",e),this.mixAudioConf.audioSource.onended=null,this.mixAudioConf.audioSource.disconnect(0),this.mixAudioConf.gainFilter.disconnect(0),this.mixAudioConf.audioSource.stop(),this.mixAudioConf.state=a.AuidoMixingState.STOPED,e&&this.resetMixConf(),Promise.resolve()},s.audioEnd=function(e){if(this.mixAudioConf.state===a.AuidoMixingState.PLAYED){if(!(this.mixAudioConf.audioSource&&this.mixAudioConf.audioSource.loop&&this.mixAudioConf.cycle<=0))return this.logger.log("伴音播放完成: ",this.mixAudioConf),this.mixAudioConf.audioSource.onended=null,this.mixAudioConf.auidoMixingEnd&&(this.mixAudioConf.auidoMixingEnd(e),this.mixAudioConf.auidoMixingEnd=null),this.resetMixConf(),Promise.resolve();this.logger.log("无限循环时，伴音播放完成event: ",e)}},s.setAudioMixingVolume=function(e){return this.mixAudioConf.gainFilter.gain.value=e/255,this.mixAudioConf.volume=this.mixAudioConf.gainFilter.gain.value,Promise.resolve()},s.setAudioMixingPlayTime=function(e){return this.mixAudioConf.state===a.AuidoMixingState.PLAYED&&(this.mixAudioConf.setPlayStartTime=e.playStartTime),this.startMix(e)},s.getAudioMixingPlayedTime=function(){var e=Date.now();this.mixAudioConf.state==a.AuidoMixingState.PAUSED&&this.mixAudioConf.pauseTime&&(this.logger.log("当前是暂停状态"),e=this.mixAudioConf.pauseTime);var t=(e-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return t>this.mixAudioConf.totalTime&&(t%=this.mixAudioConf.totalTime),{playedTime:t}},s.getAudioMixingTotalTime=function(){return{totalTime:this.mixAudioConf.totalTime}},s.off=function(){return this.setGain(0)},s.on=function(){this.setGain(1)},s.destroy=function(){if(this.instant=0,this.slow=0,this.clip=0,this.gainFilter&&this.gainFilter.disconnect(0),this.script&&this.script.disconnect(0),this.audioIn)for(var e in this.audioIn)this.audioIn[e]&&this.audioIn[e].disconnect(0);this.audioIn={};var t=this.stream;function r(e){e&&e.getTracks().forEach(function(t){e.removeTrack(t)})}/(MediaStream|LocalMediaStream)/.test(t.constructor)&&r(t),t.constructor===Array&&t.forEach(function(e){r(e)}),this.stream=null,this.outputStream=null},s.getVolumeData=function(){return this.instant.toFixed(2)},t.WebAudio=o},,,,,,,,,,function(e,t,r){"use strict";var i=r(16),a=r(79),n=r(102);i(i.S,"Promise",{try:function(e){var t=a.f(this),r=n(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){"use strict";var i=r(16),a=r(6),n=r(8),o=r(104),s=r(101);i(i.P+i.R,"Promise",{finally:function(e){var t=o(this,a.Promise||n.Promise),r="function"==typeof e;return this.then(r?function(r){return s(t,e()).then(function(){return r})}:e,r?function(r){return s(t,e()).then(function(){throw r})}:e)}})},function(e,t,r){"use strict";var i=r(8),a=r(6),n=r(15),o=r(18),s=r(7)("species");e.exports=function(e){var t="function"==typeof a[e]?a[e]:i[e];o&&t&&!t[s]&&n.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var i=r(25);e.exports=function(e,t,r){for(var a in t)r&&e[a]?e[a]=t[a]:i(e,a,t[a]);return e}},function(e,t,r){var i=r(8),a=r(103).set,n=i.MutationObserver||i.WebKitMutationObserver,o=i.process,s=i.Promise,d="process"==r(38)(o);e.exports=function(){var e,t,r,c=function(){var i,a;for(d&&(i=o.domain)&&i.exit();e;){a=e.fn,e=e.next;try{a()}catch(i){throw e?r():t=void 0,i}}t=void 0,i&&i.enter()};if(d)r=function(){o.nextTick(c)};else if(!n||i.navigator&&i.navigator.standalone)if(s&&s.resolve){var u=s.resolve();r=function(){u.then(c)}}else r=function(){a.call(i,c)};else{var l=!0,p=document.createTextNode("");new n(c).observe(p,{characterData:!0}),r=function(){p.data=l=!l}}return function(i){var a={fn:i,next:void 0};t&&(t.next=a),e||(e=a,r()),t=a}}},function(e,t){e.exports=function(e,t,r){var i=void 0===r;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var i=r(36),a=r(107),n=r(106),o=r(14),s=r(68),d=r(82),c={},u={};(t=e.exports=function(e,t,r,l,p){var f,h,m,g,v=p?function(){return e}:d(e),R=i(r,l,t?2:1),_=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(n(v)){for(f=s(e.length);f>_;_++)if((g=t?R(o(h=e[_])[0],h[1]):R(e[_]))===c||g===u)return g}else for(m=v.call(e);!(h=m.next()).done;)if((g=a(m,R,h.value,t))===c||g===u)return g}).BREAK=c,t.RETURN=u},function(e,t){e.exports=function(e,t,r,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){"use strict";var i,a,n,o,s=r(44),d=r(8),c=r(36),u=r(81),l=r(16),p=r(23),f=r(50),h=r(176),m=r(175),g=r(104),v=r(103).set,R=r(173)(),_=r(79),y=r(102),C=r(101),b=d.TypeError,E=d.process,S=d.Promise,T="process"==u(E),A=function(){},O=a=_.f,k=!!function(){try{var e=S.resolve(1),t=(e.constructor={})[r(7)("species")]=function(e){e(A,A)};return(T||"function"==typeof PromiseRejectionEvent)&&e.then(A)instanceof t}catch(e){}}(),P=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},I=function(e,t){if(!e._n){e._n=!0;var r=e._c;R(function(){for(var i=e._v,a=1==e._s,n=0,o=function(t){var r,n,o,s=a?t.ok:t.fail,d=t.resolve,c=t.reject,u=t.domain;try{s?(a||(2==e._h&&M(e),e._h=1),!0===s?r=i:(u&&u.enter(),r=s(i),u&&(u.exit(),o=!0)),r===t.promise?c(b("Promise-chain cycle")):(n=P(r))?n.call(r,d,c):d(r)):c(i)}catch(e){u&&!o&&u.exit(),c(e)}};r.length>n;)o(r[n++]);e._c=[],e._n=!1,t&&!e._h&&D(e)})}},D=function(e){v.call(d,function(){var t,r,i,a=e._v,n=w(e);if(n&&(t=y(function(){T?E.emit("unhandledRejection",a,e):(r=d.onunhandledrejection)?r({promise:e,reason:a}):(i=d.console)&&i.error&&i.error("Unhandled promise rejection",a)}),e._h=T||w(e)?2:1),e._a=void 0,n&&t.e)throw t.v})},w=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){v.call(d,function(){var t;T?E.emit("rejectionHandled",e):(t=d.onrejectionhandled)&&t({promise:e,reason:e._v})})},W=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),I(t,!0))},x=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw b("Promise can't be resolved itself");(t=P(e))?R(function(){var i={_w:r,_d:!1};try{t.call(e,c(x,i,1),c(W,i,1))}catch(e){W.call(i,e)}}):(r._v=e,r._s=1,I(r,!1))}catch(e){W.call({_w:r,_d:!1},e)}}};k||(S=function(e){h(this,S,"Promise","_h"),f(e),i.call(this);try{e(c(x,this,1),c(W,this,1))}catch(e){W.call(this,e)}},(i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(172)(S.prototype,{then:function(e,t){var r=O(g(this,S));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=T?E.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&I(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),n=function(){var e=new i;this.promise=e,this.resolve=c(x,e,1),this.reject=c(W,e,1)},_.f=O=function(e){return e===S||e===o?new n(e):a(e)}),l(l.G+l.W+l.F*!k,{Promise:S}),r(43)(S,"Promise"),r(171)("Promise"),o=r(6).Promise,l(l.S+l.F*!k,"Promise",{reject:function(e){var t=O(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!k),"Promise",{resolve:function(e){return C(s&&this===o?S:this,e)}}),l(l.S+l.F*!(k&&r(105)(function(e){S.all(e).catch(A)})),"Promise",{all:function(e){var t=this,r=O(t),i=r.resolve,a=r.reject,n=y(function(){var r=[],n=0,o=1;m(e,!1,function(e){var s=n++,d=!1;r.push(void 0),o++,t.resolve(e).then(function(e){d||(d=!0,r[s]=e,--o||i(r))},a)}),--o||i(r)});return n.e&&a(n.v),r.promise},race:function(e){var t=this,r=O(t),i=r.reject,a=y(function(){m(e,!1,function(e){t.resolve(e).then(r.resolve,i)})});return a.e&&i(a.v),r.promise}})},function(e,t,r){r(87),r(42),r(48),r(177),r(170),r(169),e.exports=r(6).Promise},function(e,t,r){e.exports={default:r(178),__esModule:!0}},function(e,t){!function(t){"use strict";var r,i=Object.prototype,a=i.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",d=n.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=y;var l="suspendedStart",p="suspendedYield",f="executing",h="completed",m={},g={};g[o]=function(){return this};var v=Object.getPrototypeOf,R=v&&v(v(D([])));R&&R!==i&&a.call(R,o)&&(g=R);var _=S.prototype=b.prototype=Object.create(g);E.prototype=_.constructor=S,S.constructor=E,S[d]=E.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,d in e||(e[d]="GeneratorFunction")),e.prototype=Object.create(_),e},u.awrap=function(e){return{__await:e}},T(A.prototype),A.prototype[s]=function(){return this},u.AsyncIterator=A,u.async=function(e,t,r,i){var a=new A(y(e,t,r,i));return u.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(_),_[d]="Generator",_[o]=function(){return this},_.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},u.values=D,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,a){return s.type="throw",s.arg=e,t.next=i,a&&(t.method="next",t.arg=r),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var d=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(d&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(d){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var a=i.arg;P(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:D(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=r),m}}}function y(e,t,r,i){var a=t&&t.prototype instanceof b?t:b,n=Object.create(a.prototype),o=new I(i||[]);return n._invoke=function(e,t,r){var i=l;return function(a,n){if(i===f)throw new Error("Generator is already running");if(i===h){if("throw"===a)throw n;return w()}for(r.method=a,r.arg=n;;){var o=r.delegate;if(o){var s=O(o,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===l)throw i=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=f;var d=C(e,t,r);if("normal"===d.type){if(i=r.done?h:p,d.arg===m)continue;return{value:d.arg,done:r.done}}"throw"===d.type&&(i=h,r.method="throw",r.arg=d.arg)}}}(e,r,o),n}function C(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function b(){}function E(){}function S(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function A(e){var t;this._invoke=function(r,i){function n(){return new Promise(function(t,n){!function t(r,i,n,o){var s=C(e[r],e,i);if("throw"!==s.type){var d=s.arg,c=d.value;return c&&"object"==typeof c&&a.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,n,o)},function(e){t("throw",e,n,o)}):Promise.resolve(c).then(function(e){d.value=e,n(d)},o)}o(s.arg)}(r,i,t,n)})}return t=t?t.then(n,n):n()}}function O(e,t){var i=e.iterator[t.method];if(i===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,O(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=C(i,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,m;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,m):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function D(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(a.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=r,t.done=!0,t};return n.next=n}}return{next:w}}function w(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,r){var i=function(){return this}()||Function("return this")(),a=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,n=a&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,e.exports=r(180),a)i.regeneratorRuntime=n;else try{delete i.regeneratorRuntime}catch(e){i.regeneratorRuntime=void 0}},,function(e,t,r){var i=r(14),a=r(82);e.exports=r(6).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return i(t.call(e))}},function(e,t,r){r(48),r(42),e.exports=r(183)},function(e,t,r){e.exports={default:r(184),__esModule:!0}},function(e,t,r){var i=r(81),a=r(7)("iterator"),n=r(31);e.exports=r(6).isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||n.hasOwnProperty(i(t))}},function(e,t,r){r(48),r(42),e.exports=r(186)},function(e,t,r){e.exports={default:r(187),__esModule:!0}},,function(e,t,r){"use strict";var i=r(15),a=r(34);e.exports=function(e,t,r){t in e?i.f(e,t,a(0,r)):e[t]=r}},function(e,t,r){"use strict";var i=r(36),a=r(16),n=r(49),o=r(107),s=r(106),d=r(68),c=r(190),u=r(82);a(a.S+a.F*!r(105)(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,a,l,p=n(e),f="function"==typeof this?this:Array,h=arguments.length,m=h>1?arguments[1]:void 0,g=void 0!==m,v=0,R=u(p);if(g&&(m=i(m,h>2?arguments[2]:void 0,2)),null==R||f==Array&&s(R))for(r=new f(t=d(p.length));t>v;v++)c(r,v,g?m(p[v],v):p[v]);else for(l=R.call(p),r=new f;!(a=l.next()).done;v++)c(r,v,g?o(l,m,[a.value,v],!0):a.value);return r.length=v,r}})},function(e,t,r){r(42),r(191),e.exports=r(6).Array.from},function(e,t,r){e.exports={default:r(192),__esModule:!0}},function(e,t,r){"use strict";t.__esModule=!0;var i,a=r(193),n=(i=a)&&i.__esModule?i:{default:i};t.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return(0,n.default)(e)}},,function(e,t,r){"use strict";var i=r(5),a=i.chunkSize,n=r(66),o={mp4:"video/mp4",avi:"video/x-msvideo",wmv:"video/x-ms-wmv",mpeg:"video/mpeg",mov:"video/quicktime",aac:"audio/x-aac",wma:"audio/x-ms-wma",wav:"audio/x-wav",mp3:"audio/mp3"};e.exports=function e(t,r,s,d){var c={file:t.data[r],fileSize:t.data[r].size,fileUploadedSize:0,percentage:0},u=t.url;function l(e){var r=c.fileUploadedSize+e.loaded,i=Math.floor(1e4*r/c.fileSize)/100;if(parseInt(i)>=100&&(i=100,l=function(){}),c.percentage!==i){c.percentage=i;var a={docId:t.docId,total:c.fileSize,loaded:r,percentage:i,percentageText:i+"%"};t.fileInput&&(a.fileInput=t.fileInput),t.blob&&(a.blob=t.blob),t.uploadprogress(a)}}function p(e){try{e=JSON.parse(e)}catch(e){return void s.onError(e)}if(e.errMsg||e.errCode)s.onError(e);else if(e.offset<c.fileSize)delete g.onaftersend,c.fileUploadedSize=e.offset,s.sn=function(e,t,r,i){var o=e.offset,s=e.offset+a;return t.data=i.file.slice(o,s),t.query.offset=e.offset,t.query.complete=s>=i.fileSize,t.query.context=e.context,t.onuploading=l,t.onload=p,t.onerror=f,n(u,t)}(e,g,0,c);else{var r=i.genFileUrl(t.nosToken);"image"===t.type?n(r+"?imageInfo",{onload:function(r){try{r=JSON.parse(r),t.uploaddone(null,{docId:e.docId,w:r.Width,h:r.Height,orientation:r.Orientation||"",type:r.Type,size:r.Size||c.fileSize})}catch(e){o(e)}},onerror:function(i){if("undefined"!=typeof Image){var a=new Image;a.src=r,a.onload=function(){t.uploaddone(null,{docId:e.docId,w:a.width,h:a.height,size:c.fileSize})}}else o(i)}}):"video"===t.type||"audio"===t.type?n(r+"?vinfo",{onload:function(r){try{(r=JSON.parse(r)).GetVideoInfo&&r.GetVideoInfo.VideoInfo&&(r=r.GetVideoInfo.VideoInfo),t.uploaddone(null,{docId:e.docId,w:r.Width,h:r.Height,dur:r.Duration,orientation:r.Rotate,audioCodec:r.AudioCodec,videoCodec:r.VideoCodec,container:r.Container,size:r.Size||c.fileSize})}catch(e){o(e)}},onerror:o}):t.uploaddone(null,{docId:e.docId,size:c.fileSize})}function o(e){s.onError(e)}}function f(i){var a,o,u,l=i&&i.code;function p(){try{if(i.result)var e=JSON.parse(i.result);else e=i;s.onError(e)}catch(e){s.onError(e)}}0===c.fileUploadedSize&&t.lbsUrls&&"abort"!==l?t.edgeList?d<t.edgeList.length-1?e(t,r,s,d+1):p():(a=0,o=t.nosToken.bucket,u=t.lbsUrls,new Promise(function(e,t){function r(){n(u[a],{query:{version:"1.0",bucketname:o},method:"GET",onerror:i,onload:function(t){try{(t=JSON.parse(t))&&t.upload&&t.upload.length?e(t.upload):i()}catch(e){i()}}})}function i(){a<u.length-1?(a++,r()):e([])}r()})).then(function(i){i.length>0?(t.edgeList=i,t.updateNosEdgeList&&t.updateNosEdgeList(i),e(t,r,s,d+1)):p()}):p()}"number"!=typeof d&&(d=-1),t.edgeList&&t.edgeList.length&&(d=d>0?d:0,u=t.edgeList[d]),u+="/"+t.nosToken.bucket+"/"+t.nosToken.objectName;var h=t.data.file&&t.data.file.type;if(!h||h.indexOf("/")<0){var m=(t.fileInputName||"").split(".").pop();"image"===t.type?h="image/"+("jpg"===m?"jpeg":m):"audio"!==t.type&&"video"!==t.type||(h=o[m])}var g={query:{offset:0,complete:a>=c.fileSize,version:"1.0"},headers:{"Content-Type":h||"application/octet-stream","x-nos-token":t.nosToken.token},method:"POST",timeout:0,onaftersend:function(){t.beginupload(s)},onuploading:l,onload:p,onerror:f};return g.data=c.file.slice(0,a),n(u,g)}},function(e,t,r){"use strict";var i=r(66);e.exports=function(e,t){return t.method="POST",t.headers=t.headers||{},t.headers["Content-Type"]="multipart/form-data",t.timeout=0,t.type=t.type||"json",i(e,t)}},function(e,t,r){"use strict";var i,a,n=r(17),o=r(66),s=(i=/json/i,a=/post/i,function(e,t){var r=(t=t||{}).data=t.data||{},s=t.headers=t.headers||{},d=n.checkWithDefault(s,"Accept","application/json"),c=n.checkWithDefault(s,"Content-Type","application/json");return i.test(d)&&(t.type="json"),a.test(t.method)&&i.test(c)&&(t.data=JSON.stringify(r)),o(e,t)});e.exports=s},function(e,t,r){"use strict";var i=r(17),a=r(109),n=r(83),o={};function s(e){this.init(),n.call(this,e)}var d=n.prototype,c=s.prototype=Object.create(d);c.init=function(){var e="NEJ-AJAX-DATA:",t=!1;function r(t){var r=t.data;if(0===r.indexOf(e)){var i=(r=JSON.parse(r.replace(e,""))).key,a=o[i];a&&(delete o[i],r.result=decodeURIComponent(r.result||""),a.onLoad(r))}}return function(){!function(){if(!t){t=!0;var e=i.getGlobal();e.postMessage?i.on(e,"message",r):a.addMsgListener(r)}}()}}(),c.doSend=function(){var e=this.options,t=i.url2origin(e.url),r=e.proxyUrl||t+"/res/nej_proxy_frame.html",n=o[r];if(i.isArray(n))n.push(this.doSend.bind(this,e));else{if(!n)return o[r]=[this.doSend.bind(this,e)],void i.createIframe({src:r,onload:function(e){var t=o[r];o[r]=i.target(e).contentWindow,t.forEach(function(e){try{e()}catch(e){console.log("error:",e)}})}});if(!this.aborted){var s=this.key=i.uniqueID();o[s]=this;var d=i.fetch({method:"GET",url:"",data:null,headers:{},timeout:0},e);d.key=s,a.postMessage(n,{data:d}),this.afterSend()}}},c.abort=function(){this.aborted=!0,delete o[this.key],d.abort.call(this)},e.exports=s},function(e,t,r){"use strict";var i=r(17),a=r(83),n=r(109),o="NEJ-UPLOAD-RESULT:",s={};function d(e){this.init(),a.call(this,e)}var c=a.prototype,u=d.prototype=Object.create(c);u.init=function(){var e=!1;function t(e){var t=e.data;if(0===t.indexOf(o)){var r=(t=JSON.parse(t.replace(o,""))).key,i=s[r];i&&(delete s[r],t.result=decodeURIComponent(t.result||""),i.onLoad(t.result))}}return function(){!function(){if(!e){e=!0;var r=i.getGlobal();r.postMessage?i.on(r,"message",t):(n.addMsgListener(t),n.startTimer())}}()}}(),u.doSend=function(){var e=this,t=e.options,r=e.key="zoro-ajax-upload-iframe-"+i.uniqueID();s[r]=e;var a=e.form=i.html2node('<form style="display:none;"></form>');"undefined"==typeof document?console.log("error: document is undefined"):document.body.appendChild(a),a.target=r,a.method="POST",a.enctype="multipart/form-data",a.encoding="multipart/form-data";var n=t.url,o=i.genUrlSep(n);a.action=n+o+"_proxy_=form";var d=t.data,c=[],u=[];function l(){c.forEach(function(e,t){var r=u[t];r.parentNode&&(e.name=r.name,i.isFunction(e.setAttribute)&&e.setAttribute("form",r.getAttribute("form")),r.parentNode.replaceChild(e,r))})}d&&i.getKeys(d,t.putFileAtEnd).forEach(function(e){var t=d[e];if(t.tagName&&"INPUT"===t.tagName.toUpperCase()){if("file"===t.type){var r=t,n=r.cloneNode(!0);r.parentNode.insertBefore(n,r);var o=i.dataset(r,"name");o&&(r.name=o),a.appendChild(r),i.isFunction(r.setAttribute)&&(r.setAttribute("form",""),r.removeAttribute("form")),c.push(t),u.push(n)}}else{var s=i.html2node('<input type="hidden"/>');s.name=e,s.value=t,a.appendChild(s)}});var p=e.iframe=i.createIframe({name:r,onload:function(){e.aborted?l():(i.on(p,"load",e.checkResult.bind(e)),a.submit(),l(),e.afterSend())}})},u.checkResult=function(){var e,t;try{if((t=((e=this.iframe.contentWindow.document.body).innerText||e.textContent||"").trim()).indexOf(o)>=0||e.innerHTML.indexOf(o)>=0)return}catch(e){return void console.log("error:","ignore error if not same domain,",e)}this.onLoad(t)},u.onLoad=function(e){c.onLoad.call(this,{status:200,result:e}),i.remove(this.form),i.remove(this.iframe),c.destroy.call(this)},u.destroy=function(){i.remove(this.iframe),i.remove(this.form)},u.abort=function(){this.aborted=!0,delete s[this.key],c.abort.call(this)},e.exports=d},function(e,t,r){var i;
/*!
 * EventEmitter v5.2.4 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - http://oli.me.uk/
 * @preserve
 */!function(t){"use strict";function a(){}var n=a.prototype,o=t.EventEmitter;function s(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function d(e){return function(){return this[e].apply(this,arguments)}}n.getListeners=function(e){var t,r,i=this._getEvents();if(e instanceof RegExp)for(r in t={},i)i.hasOwnProperty(r)&&e.test(r)&&(t[r]=i[r]);else t=i[e]||(i[e]=[]);return t},n.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},n.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},n.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var r,i=this.getListenersAsObject(e),a="object"==typeof t;for(r in i)i.hasOwnProperty(r)&&-1===s(i[r],t)&&i[r].push(a?t:{listener:t,once:!1});return this},n.on=d("addListener"),n.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},n.once=d("addOnceListener"),n.defineEvent=function(e){return this.getListeners(e),this},n.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},n.removeListener=function(e,t){var r,i,a=this.getListenersAsObject(e);for(i in a)a.hasOwnProperty(i)&&-1!==(r=s(a[i],t))&&a[i].splice(r,1);return this},n.off=d("removeListener"),n.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},n.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},n.manipulateListeners=function(e,t,r){var i,a,n=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=r.length;i--;)n.call(this,t,r[i]);else for(i in t)t.hasOwnProperty(i)&&(a=t[i])&&("function"==typeof a?n.call(this,i,a):o.call(this,i,a));return this},n.removeEvent=function(e){var t,r=typeof e,i=this._getEvents();if("string"===r)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},n.removeAllListeners=d("removeEvent"),n.emitEvent=function(e,t){var r,i,a,n,o=this.getListenersAsObject(e);for(n in o)if(o.hasOwnProperty(n))for(r=o[n].slice(0),a=0;a<r.length;a++)!0===(i=r[a]).once&&this.removeListener(e,i.listener),i.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},n.trigger=d("emitEvent"),n.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},n.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},n._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},n._getEvents=function(){return this._events||(this._events={})},a.noConflict=function(){return t.EventEmitter=o,a},void 0===(i=function(){return a}.call(t,r,t,e))||(e.exports=i)}(this||{})},function(e,t,r){"use strict";var i=r(17),a=r(83);function n(e){e.onuploading&&this.on("uploading",e.onuploading),a.call(this,e)}var o=a.prototype,s=n.prototype=Object.create(o);s.doSend=function(){var e=this.options,t=e.headers,r=this.xhr=new XMLHttpRequest;if("multipart/form-data"===t["Content-Type"]){delete t["Content-Type"],r.upload.onprogress=this.onProgress.bind(this),r.upload.onload=this.onProgress.bind(this);var a=e.data;e.data=new window.FormData,a&&i.getKeys(a,e.putFileAtEnd).forEach(function(t){var r=a[t];r.tagName&&"INPUT"===r.tagName.toUpperCase()?"file"===r.type&&[].forEach.call(r.files,function(t){e.data.append(i.dataset(r,"name")||r.name||t.name||"file-"+i.uniqueID(),t)}):e.data.append(t,r)})}else t["x-nos-token"]&&(r.upload.onprogress=this.onProgress.bind(this),r.upload.onload=this.onProgress.bind(this));r.onreadystatechange=this.onStateChange.bind(this),0!==e.timeout&&(this.timer=setTimeout(this.onTimeout.bind(this),e.timeout)),r.open(e.method,e.url,!e.sync),Object.keys(t).forEach(function(e){r.setRequestHeader(e,t[e])}),e.cookie&&"withCredentials"in r&&(r.withCredentials=!0),r.send(e.data),this.afterSend()},s.onProgress=function(e){e.lengthComputable&&e.loaded<=e.total&&this.emit("uploading",e)},s.onStateChange=function(){var e,t=this.xhr;4===t.readyState&&(e={status:t.status,result:t.responseText||""},404===t.status&&(e.date=t.getResponseHeader("date")),this.onLoad(e))},s.getResponseHeader=function(e){var t=this.xhr;return t?t.getResponseHeader(e):""},s.destroy=function(){clearTimeout(this.timer);try{this.xhr.onreadystatechange=i.f,this.xhr.abort()}catch(e){console.log("error:","ignore error ajax destroy,",e)}o.destroy.call(this)},e.exports=n},,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCOption=t.NRTCOption=t.NetcallOption=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.NetcallOption=function e(t){(0,n.default)(this,e);var r=t.kickLast,i=t.nim,a=t.container,o=t.remoteContainer,s=t.mirror,d=t.mirrorRemote;this.kickLast=r,this.nim=i,this.container=a,this.remoteContainer=o,this.mirror=s,this.mirrorRemote=d},t.NRTCOption=function e(t){(0,n.default)(this,e);var r=t.chromeId,i=t.debug;this.chromeId=r,this.debug=i},t.WebRTCOption=function e(t){(0,n.default)(this,e);var r=t.nim,i=t.container,a=t.remoteContainer,o=t.chromeId,s=t.debug;this.nim=r,this.container=i,this.remoteContainer=a,this.chromeId=o,this.debug=s}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionConfig4P2P=t.SessionConfig4Meeting=t.SessionConfig4Live=t.SessionConfig=void 0;var i=o(r(4)),a=o(r(3)),n=o(r(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=t.SessionConfig=function e(t){(0,n.default)(this,e);var r=t.maxVideoQuality,i=t.videoQuality,a=t.videoFrameRate,o=t.videoBitrate,s=t.videoEncodeMode,d=t.highAudio,c=t.recordVideo,u=t.recordAudio,l=t.isHostSpeaker,p=t.recordType,f=t.rtmpUrl,h=t.splitMode,m=t.layout,g=t.liveEnable;this.maxVideoQuality=r,this.videoQuality=i,this.videoFrameRate=a,this.videoBitrate=o,this.videoEncodeMode=s,this.highAudio=d,this.liveEnable=g,void 0!==c&&(this.recordVideo=c),void 0!==u&&(this.recordAudio=u),void 0!==l&&(this.isHostSpeaker=l),void 0!==p&&(this.recordType=p),void 0!==f&&(this.rtmpUrl=f),void 0!==h&&(this.splitMode=h),void 0!==m&&(this.layout=m)};t.SessionConfig4Live=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.default)(this,t),delete e.recordVideo,delete e.recordAudio,delete e.isHostSpeaker,delete e.recordType,(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return(0,a.default)(t,e),t}(s),t.SessionConfig4Meeting=function(e){function t(e){return(0,n.default)(this,t),delete e.recordVideo,delete e.recordAudio,delete e.isHostSpeaker,delete e.recordType,delete e.rtmpUrl,delete e.splitMode,delete e.layout,(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return(0,a.default)(t,e),t}(s),t.SessionConfig4P2P=function(e){function t(e){return(0,n.default)(this,t),delete e.rtmpUrl,delete e.splitMode,delete e.layout,(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return(0,a.default)(t,e),t}(s)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(314);Object.defineProperty(t,"PushConfig",{enumerable:!0,get:function(){return i.PushConfig}});var a=r(205);Object.defineProperty(t,"SessionConfig",{enumerable:!0,get:function(){return a.SessionConfig}});var n=r(313);Object.defineProperty(t,"DEFAULT_SESSION_CONFIG",{enumerable:!0,get:function(){return n.DEFAULT_SESSION_CONFIG}});var o=r(297);Object.defineProperty(t,"DEFAULT_PUSH_CONFIG",{enumerable:!0,get:function(){return o.DEFAULT_PUSH_CONFIG}})},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){r[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(r(98)),a=s(r(97)),n=s(r(325)),o=s(r(100));function s(e){return e&&e.__esModule?e:{default:e}}var d=r(19),c=null;o.default.ios()&&"weixin"===o.default.browser.ua||(c=navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia);var u=window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,l=window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,p=window.RTCDataChannel=window.RTCDataChannel||window.DataChannel,f=window.MediaStream=window.MediaStream||window.webkitMediaStream;function h(e){var t=void 0;return t||(t=document.createElement("video")),!!t.canPlayType({ogg:'video/ogg; codecs="theora"',h264:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8, vorbis"',vp9:'video/webm; codecs="vp9"',hls:'application/x-mpegURL; codecs="avc1.42E01E"'}[e]||e)}var m={WebRTC:!!l&&!!f,RTCPeerConnection:!!l,Vp8:h("webm"),Vp9:h("vp9"),H264:h("h264"),GetUserMedia:!!c&&!!navigator.mediaDevices,DataChannel:!!(l&&p&&l.prototype&&l.prototype.createDataChannel),WebAudio:!(!u||!u.prototype.createMediaStreamSource),MediaStream:!!f};function g(){var e=d&&d.name,t=d&&d.version;return{prefix:e,version:t=t&&t.match(/\d+/)[0]}}t.default={checkWebRtc:function(){return m},checkWebAudio:function(){return{WebAudio:m.WebAudio,MediaStream:m.MediaStream}},checkCompatibility:function(){var e=Object.assign(g(),{system:d&&d.os.family+" "+d.os.version,browser:d&&d.name,version:d&&d.version});return new Promise(function(t,r){var o=this;(0,a.default)(i.default.mark(function r(){var a,s;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=Object.assign(e,m,{ScreenSharing:!1}),r.next=3,n.default.getDevices().catch(function(e){return console.warn(e),t(a)});case 3:return s=r.sent,a.MicrophoneList=s&&s.audioIn||[],a.CameraList=s&&s.video||[],a.Microphone=s&&s.audioIn&&s.audioIn.length>0||!1,a.Camera=s&&s.video&&s.video.length>0||!1,r.abrupt("return",t(a));case 9:case"end":return r.stop()}},r,o)}))()})},checkVersion:function(){return g()}},e.exports=t.default},function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r},function(e,t,r){var i=r(16),a=r(6),n=r(29);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e],o={};o[e]=t(r),i(i.S+i.F*n(function(){r(1)}),"Object",o)}},,,,,,,,function(e){e.exports={name:"nim",private:!1,version:"8.1.0",privateVersion:"7.9.0.0",nrtcVersion:"5.1.0",sdkVersion:150,nrtcSdkVersion:1,protocolVersion:1,pcAgentVersion:"3.0.1",description:"NIM Web SDK 网易云信|真正稳定的即时通讯云服务",main:"index.js",directories:{test:"test"},scripts:{clean:"node build/emptyDist.js","build:tag":"node build/parseTagMap.js","build:sdk":"cross-env PLATFORM=all webpack --config webpack.config.js","build:sdk:stats":"webpack --profile --json > dist/webpack-stats.json","build:tester":"node build/tester.js","build:api":"node build/api","build:guide":"node build/guide","watch:tag":"watch 'npm run build:tag' ./src/protocol/map -du --interval=0.25 --filter=./build/parseTagMapFilter.js","watch:sdk":"npm run build:sdk -- -w","zip:api":"cross-env NODE_ENV=production npm run build:api && node build/api/zip.js","zip:sdk":"cross-env NODE_ENV=production node build/sdk/zip.js","copy:sdk":"npm run zip:sdk && node build/sdk/copy.js","copy:api":"npm run build:api && node build/api/copy.js",dev:"yarn check && npm run clean && run-p watch:*","dev:prod":"cross-env PLATFORM=all NODE_ENV=production npm run dev","dev:nosm":"NO_SOURCE_MAP=true run-p watch:*","dev:rn":"cross-env PLATFORM=rn NO_SOURCE_MAP=true npm run dev","dev:miniapp":"cross-env PLATFORM=miniapp NO_SOURCE_MAP=true npm run dev",pack:"yarn check && npm run clean && npm run build:sdk && npm run build:tester && npm run deploy && npm run build:api && npm run build:guide","pack:test":"cross-env PLATFORM=all NODE_ENV=test npm run pack","pack:pre":"cross-env PLATFORM=all NODE_ENV=pre npm run pack","pack:prod":"cross-env PLATFORM=all NODE_ENV=production npm run pack && npm run zip:sdk","pack:miniapp":"cross-env PLATFORM=miniapp NODE_ENV=production npm run build:sdk -- -w","pack:nodejs":"cross-env PLATFORM=nodejs NODE_ENV=production npm run build:sdk -- -w","pack:rn":"cross-env PLATFORM=rn NODE_ENV=production npm run build:sdk -- -w","pack:custom":"cross-env PLATFORM=all NODE_ENV=custom npm run pack",deploy:"node build/deploy.js",tester:"cross-env PLATFORM=all NODE_ENV=test && node build/tester.js","update:demo":"node build/updateDemoSdk.js"},author:"netease im",license:"ISC",dependencies:{axios:"^0.18.0","babel-polyfill":"^6.26.0",backo2:"^1.0.2","crypto-js":"^4.0.0","deep-access":"^0.1.1","es6-promise":"^4.2.4",eventemitter3:"^2.0.2",gulp:"^3.9.1","gulp-jsdoc3":"^2.0.0",happypack:"^5.0.1","javascript-natural-sort":"^0.7.1",jsdoc:"^3.5.5",md5:"^2.2.1","sdp-transform":"^2.3.0","webrtc-adapter":"6.0.3",ws:"^5.1.1",x2js:"^3.2.1",xhr:"^2.4.1"},devDependencies:{archiver:"^2.1.1","babel-core":"^6.26.0","babel-loader":"^7.1.4","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-transform-async-to-generator":"^6.24.1","babel-plugin-transform-es3-member-expression-literals":"^6.22.0","babel-plugin-transform-es3-property-literals":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-preset-stage-2":"^6.24.1","cross-env":"^5.1.4",eslint:"^4.19.1","eslint-config-standard":"^11.0.0","eslint-plugin-import":"^2.11.0","eslint-plugin-node":"^6.0.1","eslint-plugin-promise":"^3.7.0","eslint-plugin-standard":"^3.1.0","fs-extra":"^5.0.0","imports-loader":"^0.8.0","ink-docstrap":"^1.3.2","javascript-state-machine":"^3.1.0","npm-run-all":"^4.1.2","on-build-webpack":"^0.1.0","pre-build-webpack":"^0.1.0",prettyjson:"^1.1.3",prompt:"^1.0.0","raw-loader":"^0.5.1","watch-cli":"^0.2.3",webpack:"^4.5.0","webpack-cli":"^2.0.14","webpack-merge":"^4.1.2","wolfy87-eventemitter":"^5.2.4","worker-loader":"^3.0.4",yaml:"^0.3.0",yargs:"^11.0.0"}}},function(e,t,r){"use strict";(function(t){var i=r(449);e.exports=i({window:t.window})}).call(this,r(24))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(471);Object.defineProperty(t,"WebRTC2GateWay",{enumerable:!0,get:function(){return i.WebRTC2GateWay}});var a=r(265);Object.defineProperty(t,"WebRTC2GateWayContext",{enumerable:!0,get:function(){return a.WebRTC2GateWayContext}});var n=r(470);Object.defineProperty(t,"WebRTC2GateWayManager",{enumerable:!0,get:function(){return n.WebRTC2GateWayManager}});var o=r(468);Object.defineProperty(t,"WebRTC2GateWayProtocolHandler",{enumerable:!0,get:function(){return o.WebRTC2GateWayProtocolHandler}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(478);Object.defineProperty(t,"WebRTCGateWay",{enumerable:!0,get:function(){return i.WebRTCGateWay}});var a=r(267);Object.defineProperty(t,"WebRTCGateWayContext",{enumerable:!0,get:function(){return a.WebRTCGateWayContext}});var n=r(475);Object.defineProperty(t,"WebRTCGateWayManager",{enumerable:!0,get:function(){return n.WebRTCGateWayManager}});var o=r(473);Object.defineProperty(t,"WebRTCGateWayProtocolHandler",{enumerable:!0,get:function(){return o.WebRTCGateWayProtocolHandler}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseAPI=void 0;var i=p(r(9)),a=p(r(1)),n=p(r(2)),o=p(r(4)),s=p(r(3)),d=r(479),c=r(27),u=r(11),l=r(51);function p(e){return e&&e.__esModule?e:{default:e}}var f=r(5),h=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.default)(this,t);var r=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.adapterRef.instance=r;var i=new l.CommonDataReport({adapterRef:r.adapterRef,sdkRef:r.sdkRef});return i.setDeviceinfo({}),i.send(),i=null,r}return(0,s.default)(t,e),(0,n.default)(t,[{key:"isSupportWebrtc",value:function(){var e=this._isSupportWebrtc();return e&&e.MediaStream&&e.RTCPeerConnection}},{key:"getAccount",value:function(){return this.adapterRef?this.adapterRef.callerInfo?this.adapterRef.callerInfo.account:this._getAccountByUid(this.getUid())||null:null}},{key:"getUid",value:function(){if(this.adapterRef){var e=this.adapterRef.callerInfo||this.adapterRef.imInfo;return e&&e.uid||"local"}}},{key:"getChannelInfo",value:function(){return{channelId:this.adapterRef.imInfo&&this.adapterRef.imInfo.cid,uid:this.getUid(),account:this.getAccount()}}},{key:"setEncryptionSecretKey",value:function(e){return e&&c.tool.isString(e)&&e.length?(this.adapterRef.mediaEncryption.secretKey=e,Promise.resolve()):this.adapterRef.mediaEncryption.algorithm?Promise.reject(u.CommonErrorCode.ParamError):(this.adapterRef.mediaEncryption.secretKey="",Promise.resolve())}},{key:"setEncryptionAlgorithm",value:function(e){return c.tool.isNumber(e)?(this.adapterRef.mediaEncryption.algorithm=e,Promise.resolve()):Promise.reject(u.CommonErrorCode.ParamError)}},{key:"downLogFile",value:function(){return this.adapterRef.logger.log("downLogFile"),this.adapterRef.logger.logHelper?(this.adapterRef.logger.logHelper.downloadLog(),Promise.resolve()):Promise.reject(u.CommonErrorCode.FunctionNotEnabled)}},{key:"cleanLogFile",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.adapterRef.logger.log("cleanLogFile"),this.adapterRef.logger.logHelper?(this.adapterRef.logger.logHelper.clear(),Promise.resolve()):Promise.reject(u.CommonErrorCode.FunctionNotEnabled)}},{key:"setClientRole",value:function(e){if(this.adapterRef.imInfo.sessionMode===u.SESSION_MODE.P2P)return this.adapterRef.imInfo.role=u.ROLE_FOR_MEETING.ROLE_PLAYER,Promise.reject(u.CommonErrorCode.StageNoPermission);if(e===this.adapterRef.imInfo.role)return Promise.resolve({role:e===u.ROLE_FOR_MEETING.ROLE_PLAYER?"normal":"audience"});var t={role:"normal"};Promise.resolve();return e===u.ROLE_FOR_MEETING.ROLE_AUDIENCE?(t={role:"audience"},this.adapterRef.imInfo.role=u.ROLE_FOR_MEETING.ROLE_AUDIENCE,this.adapterRef.webrtcBusiness?this.adapterRef.webrtcBusiness._switchRole().then(function(){return Promise.resolve(t)}):Promise.resolve(t)):(this.adapterRef.imInfo.role=u.ROLE_FOR_MEETING.ROLE_PLAYER,this.adapterRef.webrtcBusiness?this.adapterRef.webrtcBusiness._switchRole().then(function(){return Promise.resolve(t)}):Promise.resolve(t))}},{key:"setLocalVideoRenderer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.logger.log("setLocalVideoRenderer");var t=e.view,r=this.adapterRef.tempInfo;r.localContainer||c.tool.verifyOptions(e,"view"),t?r.localContainer=t:t=r.localContainer,this._getVideoHelperByUid("local").setVideoContainer(t)}},{key:"setRemoteVideoRenderer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.logger.log("setRemoteVideoRenderer");var t=e.account,r=e.view,i=e.uid;!i&&t&&(i=this._getUidByAccount(t)),c.tool.verifyOptions(e,"uid view"),this._getVideoHelperByUid(i).setVideoContainer(r)}},{key:"setLocalRenderMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getUid(),r=this.adapterRef.tempInfo;if(!t){if(!this.adapterRef.videoHelperLocal)return void(r.localViewParams=e);t=this.adapterRef.videoHelperLocal.uid}r.localViewParams||(r.localViewParams={}),Object.assign(r.localViewParams,e),this._getVideoHelperByUid(t).setVideoViewConfig(e)}},{key:"setRemoteRenderMode",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.account,i=t.uid;(!i&&r&&(i=this._getUidByAccount(r),t.uid=i),i)?this._getVideoHelperByUid(i).setVideoViewConfig(t):Object.keys(this.adapterRef.videoHelperMap).map(function(r){var i=e._getVideoHelperByUid(r);r!==e.adapterRef.imInfo.uid&&i.setVideoViewConfig(t)})}},{key:"setAudioProfile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.adapterRef.signalInited)throw u.CommonErrorCode.ChannelAlreadyInSession;this._setSessionConfig({highAudio:!0===e.highAudio})}},{key:"setVideoProfile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.adapterRef.signalInited)throw u.CommonErrorCode.ChannelAlreadyInSession;var t={};e.quality&&(t.videoQuality=e.quality),e.frameRate&&(t.videoFrameRate=e.frameRate),this._setSessionConfig(t)}},{key:"muteLocalVideoStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.logger.log("BaseAdaper: muteLocalVideoStream, options: "+JSON.stringify(t,null,""));var r=t.mute,i=void 0!==r&&r;return Promise.resolve().then(function(){return e.adapterRef.tempInfo.localVideoMuted===i?Promise.resolve():(e.adapterRef.signalInited||e.adapterRef.logger.log("BaseAdaper: muteLocalVideoStream 当前未开始音视频"),e.adapterRef.tempInfo.localVideoMuted=i,i?e._stopPushVideoStream():e.adapterRef.tempInfo.localVideoDisabled||e.adapterRef.imInfo.role!==u.ROLE_FOR_MEETING.ROLE_PLAYER?Promise.resolve():e._startPushVideoStream())}).then(function(){return Promise.resolve()})}},{key:"muteLocalAudioStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.logger.log("BaseAdaper: muteLocalAudioStream, options: "+JSON.stringify(t,null,""));var r=t.mute,i=void 0!==r&&r;return Promise.resolve().then(function(){return e.adapterRef.tempInfo.localAudioMuted===i?Promise.resolve():(e.adapterRef.tempInfo.localAudioMuted=i,e.adapterRef.signalInited||e.adapterRef.logger.log("BaseAdaper: muteLocalAudioStream 当前未开始音视频"),i?e._stopPushAudioStream():e.adapterRef.tempInfo.localVideoDisabled||e.adapterRef.imInfo.role!==u.ROLE_FOR_MEETING.ROLE_PLAYER?Promise.resolve():e._startPushAudioStream())}).then(function(){return Promise.resolve()})}},{key:"muteRemoteVideoStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.mute,i=void 0!==r&&r,a=e.uid;!a&&t&&(a=this._getUidByAccount(t));var n=this._getVideoHelperByUid(a);return n&&(i?(this.adapterRef.logger.log("BaseAdaper: muteRemoteVideoStream 停止接收视频: "+a),n.hide()):(this.adapterRef.logger.log("BaseAdaper: muteRemoteVideoStream 接收视频: "+a),n.show())),this.adapterRef.tempInfo.remoteVideoMuteMap[""+a]=i,Promise.resolve()}},{key:"muteRemoteAudioStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.mute,i=void 0!==r&&r,a=e.uid;!a&&t&&(a=this._getUidByAccount(t));var n=this._getAudioHelperByUid(a);return n&&(i?n.stopAudio():n.playAudio()),this.adapterRef.tempInfo.remoteAudioMuteMap[""+a]=i,Promise.resolve()}},{key:"enableLocalVideo",value:function(e){var t=this;if(!c.tool.isBoolean(e))throw u.CommonErrorCode.ParamError;if(e)return this.adapterRef.tempInfo.localVideoDisabled=!1,Promise.resolve();var r=this._getVideoHelperByUid("local");return Promise.resolve().then(function(){return r&&r.localScreenStream?t.stopDevice({type:u.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN}):Promise.resolve()}).then(function(){return r&&r.localCameraStream?t.stopDevice({type:u.DEVICE_TYPE.DEVICE_TYPE_VIDEO}):Promise.resolve()}).then(function(){return r&&r.hide(),t.adapterRef.tempInfo.localVideoDisabled=!0,Promise.resolve()})}},{key:"enableLocalAudio",value:function(e){var t=this;if(!c.tool.isBoolean(e))throw u.CommonErrorCode.ParamError;if(e)return this.adapterRef.tempInfo.localAudioDisabled=!1,Promise.resolve();var r=this._getAudioHelperByUid("local");return Promise.resolve().then(function(){return r.localAudioStreamFromMIC?t.stopDevice({type:u.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN}):Promise.resolve()}).then(function(){return t.adapterRef.tempInfo.localAudioDisabled=!0,Promise.resolve()})}},{key:"takeSnapshot",value:function(e){if(!e&&!e.account&&!e.uid)return Promise.reject(u.CommonErrorCode.ParamError);this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"snap_shot"});var t=e.uid||this._getUidByAccount(e.account);if(t){var r=this._getVideoHelperByUid(t);return r?r.takeSnapshot(e):Promise.reject(u.CommonErrorCode.ParamError)}return Promise.reject(u.CommonErrorCode.ParamError)}},{key:"getDevices",value:function(e){var t=e;return"object"===(void 0===e?"undefined":(0,i.default)(e))&&(t=e.type),this.adapterRef.deviceApi.getDevicesOfType(t)}},{key:"startDevice",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.type===u.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN){if(!this.adapterRef.instance._isChrome())return this.adapterRef.logger.log("该浏览器不支持屏幕共享功能，请使用chrome内核浏览器"),Promise.reject(u.CommonErrorCode.ParamError);if(!this.adapterRef.chromeId&&!this.adapterRef.instance._isChrome72())return this.adapterRef.logger.log("该chrome内核浏览器版本太低，不支持屏幕共享原生接口"),Promise.reject(u.CommonErrorCode.ParamError)}c.tool.verifyOptions(t,"type");var r=this.adapterRef.tempInfo,i=this._getVideoHelperByUid("local");return this._checkDevicePermissionEnabled(t).then(function(){var a="",n="";return t.type===u.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN?(a="self_mic_mute",n="set_mic"):t.type===u.DEVICE_TYPE.DEVICE_TYPE_AUDIO_OUT_LOCAL?a="self_mute":t.type===u.DEVICE_TYPE.DEVICE_TYPE_VIDEO&&(n="set_camera"),e.adapterRef.intervalCommonDataReport&&(a&&e.adapterRef.intervalCommonDataReport.triggerFunction({name:a,oper:"0"}),n&&e.adapterRef.intervalCommonDataReport.triggerFunction({name:n,oper:"1"})),e.adapterRef.deviceApi.startDevice(t).then(function(){if(t.type===u.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN||t.type===u.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_AUDIO){var a=e._getAudioHelperByUid("local");return e.adapterRef.imInfo.role===u.ROLE_FOR_MEETING.ROLE_PLAYER&&!e.adapterRef.tempInfo.localAudioMuted&&e.adapterRef.signalInited&&a.isFirstOpenMic?e._startPushAudioStream():Promise.resolve()}if(t.type===u.DEVICE_TYPE.DEVICE_TYPE_VIDEO||t.type===u.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN||t.type===u.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_VIDEO){var n=i.getLocalScreenStream()&&i.getLocalScreenStream().getVideoTracks()[0];return n&&(n.onended=function(t){e.adapterRef.logger.log("屏幕共享停止: ",t),e.adapterRef.state.chromeScreenShareOpened&&(u.VideoErrorCode.VideoEnded.type="screen",e.adapterRef.instance.emit("streamEnded",u.VideoErrorCode.VideoEnded))}),i._checkHasVideoStream()&&(r.localContainer&&e.setLocalVideoRenderer(),r.localViewParams&&e.setLocalRenderMode(r.localViewParams),e.adapterRef.imInfo.role===u.ROLE_FOR_MEETING.ROLE_PLAYER&&!e.adapterRef.tempInfo.localVideoMuted&&e.adapterRef.signalInited)?e._startPushVideoStream():Promise.resolve()}}).catch(function(t){return e.adapterRef.logger.error("开启媒体设备发生错误: ",t),Promise.reject(t)})}).catch(function(t){return e.adapterRef.logger.error("检查设备权限发生错误: ",t),Promise.reject(t)})}},{key:"_isMediaType",value:function(e){return e===u.DEVICE_TYPE.DEVICE_TYPE_VIDEO||e===u.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN}},{key:"stopDevice",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t===u.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN&&!this.adapterRef.instance._isChrome())return this.adapterRef.logger.log("该浏览器不支持屏幕共享功能，请使用chrome内核浏览器"),Promise.reject(u.CommonErrorCode.ParamError);c.tool.verifyOptions(t,"type");var r=t;"object"===(void 0===t?"undefined":(0,i.default)(t))&&(r=t.type);var a=!1;return this._checkDevicePermissionEnabled(t).then(function(){if(e._isMediaType(r)){var t=e._getVideoHelperByUid("local");a=t.isInMCUState()}try{var i="",n="";r===u.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN?(i="self_mic_mute",n="set_mic",e.adapterRef.apiReportHelper.uploadDataApi("update",{key:"self_mic_mute"})):r===u.DEVICE_TYPE.DEVICE_TYPE_AUDIO_OUT_LOCAL?i="self_mute":r===u.DEVICE_TYPE.DEVICE_TYPE_VIDEO&&(n="set_camera"),e.adapterRef.intervalCommonDataReport&&(i&&e.adapterRef.intervalCommonDataReport.triggerFunction({name:i,oper:"1"}),n&&e.adapterRef.intervalCommonDataReport.triggerFunction({name:n,oper:"0"}))}catch(t){e.adapterRef.logger.error(t)}return e.adapterRef.deviceApi.stopDevice(r)}).then(function(t){if(e._isMediaType(r)&&!a){var i=e._getVideoHelperByUid("local");t||i.stopPushLocalVideoStream()}return Promise.resolve()})}},{key:"startVideoPreview",value:function(e){return this.adapterRef.deviceApi.startDevice(e)}},{key:"stopVideoPreview",value:function(e){return this.adapterRef.deviceApi.stopDevice(e)}},{key:"openLocalAudio",value:function(e){return this.adapterRef.deviceApi.startDevice(e)}},{key:"stopLocalAudio",value:function(e){return this.adapterRef.deviceApi.stopDevice(e)}},{key:"getLocalAudioVolume",value:function(){return this.adapterRef.playApi&&this.adapterRef.playApi.getAudioVolume()}},{key:"getPlayVolume",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.uid;return r||(r=this._getUidByAccount(t)),this.adapterRef.playApi.getPlayVolume({uid:r})}},{key:"setCaptureVolume",value:function(e){if(e=+e,!Number.isInteger(e))throw u.CommonErrorCode.ParamError;return this.adapterRef.captureApi.setCaptureVolume(e)}},{key:"getCaptureVolume",value:function(){return this.adapterRef.captureApi.getCaptureVolume()}},{key:"getPlayState",value:function(e){return this.adapterRef.playApi.getPlayState(e)}},{key:"startMediaRecording",value:function(e){return this.adapterRef.recordApi.startMediaRecording(e)}},{key:"stopMediaRecording",value:function(e){return this.adapterRef.recordApi.stopMediaRecording(e)}},{key:"playMediaRecording",value:function(e){return this.adapterRef.recordApi.playMediaRecording(e)}},{key:"listMediaRecording",value:function(){return this.adapterRef.recordApi.listMediaRecording()}},{key:"cleanMediaRecording",value:function(e){return this.adapterRef.recordApi.cleanMediaRecording(e)}},{key:"downloadMediaRecording",value:function(e){return this.adapterRef.recordApi.downloadMediaRecording(e)}},{key:"setMediaMixConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(c.tool.verifyOptions(e,"enableMixVideo"),e.videoLayout&&!(c.tool.isNumber(e.videoLayout)&&e.videoLayout>=1&&e.videoLayout<=4))return u.CommonErrorCode.ParamError;if(e.videoCompressSize&&!(c.tool.isNumber(e.videoCompressSize)&&e.videoCompressSize>=0&&e.videoCompressSize<=6))return u.CommonErrorCode.ParamError;var t=this._getVideoHelperByUid("local");return this.adapterRef.logger.log("BaseAdapter: setMediaMixConfig: ",JSON.stringify(e,null," ")),!0===e.enableMixVideo?!this.adapterRef.mixVideoConf&&t.localCameraStream&&t.localScreenStream?u.VideoErrorCode.VideoMixStreamExceed:(this.adapterRef.mixVideoConf={},this.adapterRef.mixVideoConf.videoLayout=e.videoLayout||u.MIX_VIDEO_MODE.LAYOUT_TOP_RIGHT,this.adapterRef.mixVideoConf.videoCompressSize=e.videoCompressSize||u.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_LOW,this.adapterRef.mixVideoConf.videoMixRatio=e.videoMixRatio||0,this.adapterRef.mixVideoConf.videoSecWinType=e.videoSecWinType||u.DEVICE_TYPE.DEVICE_TYPE_VIDEO,t.setMixConf(),u.CommonErrorCode.OK):!1===e.enableMixVideo?(this.adapterRef.mixVideoConf=null,u.CommonErrorCode.OK):u.CommonErrorCode.ParamError}},{key:"startAudioMixing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._getAudioHelperByUid("local");return this.adapterRef.logger.log("BaseAdapter: startAudioMixing: %s",JSON.stringify(e,null," ")),Object.assign(this.adapterRef.mixAudioConf,e),this.adapterRef.mixAudioConf.index++,this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"audio_mix"}),t.startAudioMixing()}},{key:"pauseAudioMixing",value:function(){var e=this._getAudioHelperByUid("local");return this.adapterRef.logger.log("BaseAdapter: pauseAudioMixing"),e.pauseAudioMixing()}},{key:"resumeAudioMixing",value:function(){var e=this._getAudioHelperByUid("local");return this.adapterRef.logger.log("BaseAdapter: resumeAudioMixing"),e.resumeAudioMixing()}},{key:"stopAudioMixing",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=this._getAudioHelperByUid("local");return this.adapterRef.logger.log("BaseAdapter: stopAudioMixing"),e.stopAudioMixing()}},{key:"setAudioMixingVolume",value:function(e){var t=this._getAudioHelperByUid("local");return this.adapterRef.logger.log("BaseAdapter: setAudioMixingVolume"),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"mixing_send_volume"}),t.setAudioMixingVolume(e)}},{key:"setAudioMixingPlayTime",value:function(e){var t=this._getAudioHelperByUid("local");return this.adapterRef.logger.log("BaseAdapter: setAudioMixingPlayTime"),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"seek_to_time"}),t.setAudioMixingPlayTime(e)}},{key:"getAudioMixingPlayedTime",value:function(){return this._getAudioHelperByUid("local").getAudioMixingPlayedTime()}},{key:"getAudioMixingTotalTime",value:function(){var e=this._getAudioHelperByUid("local");return this.adapterRef.logger.log("BaseAdapter: getAudioMixingTotalTime"),e.getAudioMixingTotalTime()}},{key:"updateRtmpHost",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.uid;c.tool.verifyOptions(e,"uid");var r=(f.roomserver&&"https://"+f.roomserver+"/v1/sdk/command/rooms/"||"https://roomserver.netease.im/v1/sdk/command/rooms/")+this.adapterRef.imInfo.cid,i=this.adapterRef.imInfo.turnToken||this.adapterRef.imInfo.serverMap&&this.adapterRef.imInfo.serverMap.token;return i?(0,c.ajax)({type:"post",url:r,data:{suid:parseInt(this.adapterRef.imInfo.uid),cid:this.adapterRef.imInfo.cid,uid:parseInt(t),cmd:10001},header:{Token:i}}).then(function(e){if(200===e.code)return Promise.resolve();var t=void 0;switch(e.code){case 401:t=u.RoomServerErrorCode.RoomServerErrAuthError;break;case 404:t=u.RoomServerErrorCode.RoomServerErrChannelNotExist;break;case 405:t=u.RoomServerErrorCode.RoomServerErrUidNotExist;break;case 406:t=u.RoomServerErrorCode.RoomServerErrNoPermission;break;case 417:t=u.RoomServerErrorCode.RoomServerErrDataError;break;case 500:t=u.RoomServerErrorCode.RoomServerErrUnknown;break;case 600:t=u.RoomServerErrorCode.RoomServerErrServerError;break;default:t=u.RoomServerErrorCode.RoomServerErrInvilid}return Promise.reject(t)}):Promise.reject(u.CommonErrorCode.ParamError)}},{key:"detectNetworkStatus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.adapterRef.detectNetState.inDetecting)return Promise.reject(u.CommonErrorCode.NetworkInDetecting);if(this.adapterRef.webrtcBusiness&&this.adapterRef.webrtcBusiness.selfWebRtcInstance)return Promise.reject(u.CommonErrorCode.ChannelAlreadyInSession);var r=t.uid,i=t.cid,a=t.token,n=t.wssArr,o=t.codec,s=void 0===o?"h264":o,d=t.detectTime,l=void 0===d?20:d,p=t.fromDevice,h=t.imageNode,m=t.videoNode;r||(r=this._getDetectUid()),l=Math.max(l,5),this._isWeixinBrowser()?(this.adapterRef.logger.log("BaseAdaper: detectNetworkStatus: 当前是微信浏览器!"),s="vp8"):this._isMobileSafari()&&(this.adapterRef.logger.log("BaseAdaper: detectNetworkStatus: 当前是移动端safar浏览器!"),s="h264");var g=Promise.resolve(),v={uid:r,cid:i,token:a,wssArr:n,codec:s,fromDevice:p,imageNode:h,videoNode:m};return n||(g=g.then(function(){return e.adapterRef.logger.log("BaseAdaper: detectNetworkStatus: Config netDetectAddr "+f.netDetectAddr),(0,c.ajax)({type:"post",url:f.netDetectAddr,contentType:"application/json",data:{uid:r}})}).then(function(e){return Object.assign(v,{cid:e.cid,token:e.token,wssArr:e.detectAddrs.splice(0,1)}),Promise.resolve()})),g=g.then(function(){return e.adapterRef.detectNetState.inDetecting=!0,e._startDetect(v)}).then(function(){return new Promise(function(t,r){clearTimeout(e.adapterRef.detectNetState.detectTimer),e.adapterRef.detectNetState.detectTimer=setTimeout(function(){if(clearInterval(e.adapterRef.detectNetState.canvasTimer),e._isDetectNetwork()){var i=e.adapterRef.statsReportHelper.formatDataFromStats.disposalDataForNetDetect(null);t(i)}else e.adapterRef.statsReportHelper&&e.adapterRef.statsReportHelper.formatDataFromStats&&e.adapterRef.statsReportHelper.formatDataFromStats.disposalDataForNetDetect(e.adapterRef.instance._isDetectNetworkOfselfWebRtcConnected(),e.adapterRef.instance._isDetectNetworkOfremoteWebRtcConnected()),r(u.CommonErrorCode.ServerConnectionError);e._endDetect()},1e3*l)})}).then(function(e){return Promise.resolve(e)})}},{key:"_startDetect",value:function(e){var t=this;return Object.assign(this.adapterRef.imInfo,{appkey:"4c418f22935f1e2cf8488ff1c84229c0",cid:e.cid,uid:e.uid,token:e.token,codec:e.codec,wssArr:e.wssArr||["webrtcgwhz.netease.im?ip=223.252.198.177:5060"],role:u.ROLE_FOR_MEETING.ROLE_PLAYER,sessionMode:u.SESSION_MODE.MEETING,netDetect:!0,turnToken:null,relayaddrs:null,relaytoken:null}),this._setSessionConfig({liveEnable:!1,rtmpRecord:!1}),this._startSession().then(function(){return t.adapterRef.signalInited=!0,e.fromDevice?t._getStreamFromDevice():e.imageNode?t._getStreamFromImageNode(e.imageNode):e.videoNode?t._getStreamFromVideoNode(e.videoNode):t._getStreamFromDefaultVideo()}).catch(function(e){return t._endDetect(),Promise.reject(e)})}},{key:"_endDetect",value:function(){var e=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.uid);if(e){var t=e.getLocalVideoStream();if(t&&t.getTracks){var r=t.getTracks();r&&r.length>0&&r.forEach(function(e){e.stop(),t.removeTrack(e)})}}this.leaveChannel(),this.adapterRef.signalInited=!1,this.adapterRef.detectNetState.stream=null,this.adapterRef.detectNetState.canvasTimer&&(clearInterval(this.adapterRef.detectNetState.canvasTimer),this.adapterRef.detectNetState.canvasTimer=null),this.adapterRef.detectNetState.detectTimer&&(clearTimeout(this.adapterRef.detectNetState.detectTimer),this.adapterRef.detectNetState.detectTimer=null),this.adapterRef.detectNetState.detectDom&&this.adapterRef.detectNetState.detectDom.oncanplay&&(this.adapterRef.detectNetState.detectDom.oncanplay=null),this.adapterRef.detectNetState.detectDom=null,this.adapterRef.detectNetState.inDetecting=!1}},{key:"_getDetectUid",value:function(){return c.tool.randomNum(Math.pow(2,50),Math.pow(2,52))}},{key:"_getStreamFromDevice",value:function(){var e=this;return this.getDevices({type:u.DEVICE_TYPE.DEVICE_TYPE_VIDEO}).then(function(t){var r=null;return t&&t.length&&(r=t[t.length-1]),e.startDevice({type:u.DEVICE_TYPE.DEVICE_TYPE_VIDEO,device:r})}).then(function(t){return e.adapterRef.imInfo.remoteUid=e._getDetectUid(),e.adapterRef.webrtcBusiness.doClientJoin(e.adapterRef.imInfo.remoteUid),Promise.resolve()})}},{key:"_getStreamFromImageNode",value:function(e){var t=document.createElement("canvas");if(t.width=640,t.height=480,clearInterval(this.adapterRef.detectNetState.canvasTimer),this.adapterRef.detectNetState.canvasTimer=setInterval(function(){t.getContext("2d").drawImage(e,0,0)},20),this.adapterRef.detectNetState.stream=t.captureStream(),this.adapterRef.detectNetState.stream){var r=this._getVideoHelperByUid(this.adapterRef.imInfo.uid);return r&&r.handleStreamFromMp4File(this.adapterRef.detectNetState.stream),this._judgeSendSdpOfferOrUpdate(),this.adapterRef.imInfo.remoteUid=this._getDetectUid(),this.adapterRef.webrtcBusiness.doClientJoin(this.adapterRef.imInfo.remoteUid),Promise.resolve()}return Promise.reject(u.CommonErrorCode.DataError)}},{key:"_getStreamFromVideoNode",value:function(e){var t=this.adapterRef.detectNetState.detectDom=e;if(t.oncanplay=null,t.captureStream?this.adapterRef.detectNetState.stream=t.captureStream():t.mozCaptureStream&&(this.adapterRef.detectNetState.stream=t.mozCaptureStream()),this.adapterRef.detectNetState.stream){var r=this._getAudioHelperByUid(this.adapterRef.imInfo.uid);r&&r.handleStreamFromMp4File(this.adapterRef.detectNetState.stream);var i=this._getVideoHelperByUid(this.adapterRef.imInfo.uid);return i&&i.handleStreamFromMp4File(this.adapterRef.detectNetState.stream),this._judgeSendSdpOfferOrUpdate(),this.adapterRef.imInfo.remoteUid=this._getDetectUid(),this.adapterRef.webrtcBusiness.doClientJoin(this.adapterRef.imInfo.remoteUid),Promise.resolve()}return Promise.reject(u.VideoErrorCode.VideoStreamFetchError)}},{key:"_getStreamFromDefaultVideo",value:function(){var e=this;return new Promise(function(t,r){clearTimeout(e.adapterRef.detectNetState.outTimer),e.adapterRef.detectNetState.outTimer=setTimeout(function(){r(u.CommonErrorCode.ChannelReserveTimeOut)},1e3),e.adapterRef.detectNetState.stream=null,e.adapterRef.detectNetState.detectDom=document.createElement("video"),e.adapterRef.detectNetState.detectDom.autoplay="atuoplay",e.adapterRef.detectNetState.detectDom.loop=!0,e.adapterRef.detectNetState.detectDom.volume=.1/255,e.adapterRef.detectNetState.detectDom.oncanplay=function(){clearTimeout(e.adapterRef.detectNetState.outTimer),e._getStreamFromVideoNode(e.adapterRef.detectNetState.detectDom).then(function(){t()}).catch(function(e){r(e)})},e.adapterRef.detectNetState.detectDom.crossOrigin="anonymous",e.adapterRef.detectNetState.detectDom.src="https://vodegkofxdv.vod.126.net/vodegkofxdv/77a47edc-9942-4782-88ff-90bb46317813.mp4"})}}]),t}(d.AbstractAdapter);t.BaseAPI=h},function(e,t,r){var i=r(16);i(i.S,"Object",{create:r(67)})},function(e,t,r){r(223);var i=r(6).Object;e.exports=function(e,t){return i.create(e,t)}},function(e,t,r){e.exports={default:r(224),__esModule:!0}},function(e,t,r){var i=r(23),a=r(14),n=function(e,t){if(a(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{(i=r(36)(Function.call,r(72).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return n(e,r),t?e.__proto__=r:i(e,r),e}}({},!1):void 0),check:n}},function(e,t,r){var i=r(16);i(i.S,"Object",{setPrototypeOf:r(226).set})},function(e,t,r){r(227),e.exports=r(6).Object.setPrototypeOf},function(e,t,r){e.exports={default:r(228),__esModule:!0}},function(e,t,r){var i=r(16);i(i.S+i.F*!r(18),"Object",{defineProperty:r(15).f})},function(e,t,r){r(230);var i=r(6).Object;e.exports=function(e,t,r){return i.defineProperty(e,t,r)}},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC4SafariRelease=void 0;var i=s(r(1)),a=s(r(4)),n=s(r(3)),o=(r(27),r(158));r(11);r(219);r(12);function s(e){return e&&e.__esModule?e:{default:e}}window.StateMachine=r(259);var d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,n.default)(t,e),t}(o.AbstractWebRTC);t.WebRTC4SafariRelease=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC4FirefoxRelease=void 0;var i=o(r(1)),a=o(r(4)),n=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,n.default)(t,e),t}(r(158).AbstractWebRTC);t.WebRTC4FirefoxRelease=s},function(e,t,r){var i;i=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";e.exports=function(e,t){var r,i,a;for(r=1;r<arguments.length;r++)for(a in i=arguments[r])i.hasOwnProperty(a)&&(e[a]=i[a]);return e}},function(e,t,r){"use strict";var i=r(0);e.exports={build:function(e,t){var r,a,n,o=t.plugins;for(r=0,a=o.length;r<a;r++)(n=o[r]).methods&&i(e,n.methods),n.properties&&Object.defineProperties(e,n.properties)},hook:function(e,t,r){var i,a,n,o,s=e.config.plugins,d=[e.context];for(r&&(d=d.concat(r)),i=0,a=s.length;i<a;i++)o=s[i],(n=s[i][t])&&n.apply(o,d)}}},function(e,t,r){"use strict";function i(e){if(0===e.length)return e;var t,r,i=e.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return e;for(r=i[0].toLowerCase(),t=1;t<i.length;t++)r=r+i[t].charAt(0).toUpperCase()+i[t].substring(1).toLowerCase();return r}i.prepended=function(e,t){return e+(t=i(t))[0].toUpperCase()+t.substring(1)},e.exports=i},function(e,t,r){"use strict";var i=r(0),a=r(2);function n(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}i(n.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=a.prepended("onEnter",e),this.lifecycle.onLeave[e]=a.prepended("onLeave",e),this.lifecycle.on[e]=a.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=a.prepended("onBefore",e),this.lifecycle.onAfter[e]=a.prepended("onAfter",e),this.lifecycle.on[e]=a.prepended("on",e)},mapTransition:function(e){var t=e.name,r=e.from,i=e.to;return this.addState(r),"function"!=typeof i&&this.addState(i),this.addTransition(t),this.map[r][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(i({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(i({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var r,i,a;for(r=0,i=(e=e||[]).length;r<i;r++)"function"==typeof(a=e[r])&&(e[r]=a=a()),a.configure&&a.configure(this);return e},configureTransitions:function(e){var t,r,i,a,n,o=this.defaults.wildcard;for(r=0;r<e.length;r++)for(i=e[r],a=Array.isArray(i.from)?i.from:[i.from||o],n=i.to||o,t=0;t<a.length;t++)this.mapTransition({name:i.name,from:a[t],to:n})},transitionFor:function(e,t){var r=this.defaults.wildcard;return this.map[e][t]||this.map[r][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=n},function(e,t,r){var i=r(0),a=r(6),n=r(1),o=[null,[]];function s(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}i(s.prototype,{init:function(e){if(i(this.context,this.config.data.apply(this.context,e)),n.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var r=this.config.defaults.wildcard,i=this.config.transitionFor(this.state,e),a=i&&i.to;return"function"==typeof a?a.apply(this.context,t):a===r?this.state:a},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,r,i){var a=this.config.lifecycle,n=this.config.options.observeUnchangedState||t!==r;return r?this.isPending()?this.context.onPendingTransition(e,t,r):(this.config.addState(r),this.beginTransit(),i.unshift({transition:e,from:t,to:r,fsm:this.context}),this.observeEvents([this.observersForEvent(a.onBefore.transition),this.observersForEvent(a.onBefore[e]),n?this.observersForEvent(a.onLeave.state):o,n?this.observersForEvent(a.onLeave[t]):o,this.observersForEvent(a.on.transition),n?["doTransit",[this]]:o,n?this.observersForEvent(a.onEnter.state):o,n?this.observersForEvent(a.onEnter[r]):o,n?this.observersForEvent(a.on[r]):o,this.observersForEvent(a.onAfter.transition),this.observersForEvent(a.onAfter[e]),this.observersForEvent(a.on[e])],i)):this.context.onInvalidTransition(e,t,r)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,r=0,i=this.observers.length,a=[];r<i;r++)(t=this.observers[r])[e]&&a.push(t);return[e,a,!0]},observeEvents:function(e,t,r,i){if(0===e.length)return this.endTransit(void 0===i||i);var a=e[0][0],o=e[0][1],s=e[0][2];if(t[0].event=a,a&&s&&a!==r&&n.hook(this,"lifecycle",t),0===o.length)return e.shift(),this.observeEvents(e,t,a,i);var d=o.shift(),c=d[a].apply(d,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,a)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,a,c)},onInvalidTransition:function(e,t,r){throw new a("transition is invalid in current state",e,t,r,this.state)},onPendingTransition:function(e,t,r){throw new a("transition is invalid while previous transition is still in progress",e,t,r,this.state)}}),e.exports=s},function(e,t,r){"use strict";var i=r(0),a=r(2),n=r(1),o=r(3),s=r(4),d={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,r){return this._fsm.onInvalidTransition(e,t,r)},onPendingTransition:function(e,t,r){return this._fsm.onPendingTransition(e,t,r)}},c={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function u(e){return l(this||{},e)}function l(e,t){return p(e,new o(t,u)),e._fsm(),e}function p(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");n.build(e,t),Object.defineProperties(e,c),i(e,d),i(e,t.methods),t.allTransitions().forEach(function(t){e[a(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new s(this,t),this._fsm.init(arguments)}}u.version="3.0.1",u.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var r=new o(t,u);return p(e.prototype,r),e.prototype._fsm.config=r,e},u.apply=l,u.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=u},function(e,t,r){"use strict";e.exports=function(e,t,r,i,a){this.message=e,this.transition=t,this.from=r,this.to=i,this.current=a}}])},e.exports=i()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC4ChromeRelease=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(27),d=r(158),c=r(11);r(219);r(12);function u(e){return e&&e.__esModule?e:{default:e}}window.StateMachine=r(259);var l=s.RtcSupport.checkVersion(),p=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.initChrome(),r.devices=e.devices,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"initChrome",value:function(){this.getSdpResolve=null,this.setLocalOfferResolve=null,this.initFsm()}},{key:"initFsm",value:function(){this.fsm=new StateMachine({init:"stable",transitions:[{name:"getSdp",from:["stable","haveLocalSdp","haveLocalOffer"],to:"haveLocalSdp"},{name:"setLocalOffer",from:["stable","haveLocalSdp","haveLocalOffer"],to:"haveLocalOffer"},{name:"setRemoteAnswer",from:["haveLocalOffer","haveRemotePranser"],to:"stable"},{name:"close",from:["stable","haveLocalOffer","haveRemotePranser","setRemoteOffer","haveLocalPranswer"],to:"closed"}],data:{resolve:null},methods:{onBeforeGetSdp:this.beforeGetSdp.bind(this),onGetSdp:this.getSdp.bind(this),onLeaveStable:this.leaveStable.bind(this),onEnterHaveLocalSdp:this.enterHaveLocalSdp.bind(this),onAfterGetSdp:this.afterGetSdp.bind(this),onSetLocalOffer:this.setLocalOffer.bind(this),onAfterSetLocalOffer:this.afterSetLocalOffer.bind(this),onSetRemoteAnswer:this.setRemoteAnswer.bind(this),onAfterSetRemoteAnswer:this.afterSetRemoteAnswer.bind(this),onClose:this.close.bind(this)}})}},{key:"createPeerConnection",value:function(e){this.adapterRef.logger.log("chrome:createPeerConnection"),this.rtcConnection=new RTCPeerConnection(e,{optional:[{googIPv6:!1},{googScreencastMinBitrate:400},{googPayloadPadding:!0},{googImprovedWifiBwe:!0},{googDscp:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googSuspendBelowMinBitrate:!0},{googCombinedAudioVideoBwe:!0},{googCpuOveruseDetection:!0},{googCpuOveruseEncodeUsage:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85}]}),this.rtcConnection.uid=this.imInfo.uid,this.rtcConnection.targetUid=this.targetUid,this.rtcConnection.onicecandidate=this.onIceCandidate.bind(this),this.rtcConnection.onnegotiationneeded=this.onNegotiationNeeded.bind(this),this.rtcConnection.oniceconnectionstatechange=this.onIceStateChange.bind(this),this.rtcConnection.onicecandidateerror=function(e){},this.rtcConnection.onicegatheringstatechange=function(e){},this.rtcConnection.onconnectionstatechange=function(e){},this.rtcConnection.onaddstream=this.onAddRemoteStream.bind(this),this.rtcConnection.onremovestream=this.onRemoveRemoteStream.bind(this)}},{key:"getSdp",value:function(){this.adapterRef.logger.log("状态机 getSdp")}},{key:"beforeGetSdp",value:function(){}},{key:"leaveStable",value:function(){}},{key:"enterHaveLocalSdp",value:function(){}},{key:"afterGetSdp",value:function(){var e=this,t={offerToReceiveVideo:1,offerToReceiveAudio:1},r=this.rtcConnection;this.adapterRef.logger.log("chrome getSdp iceConnectionState :",r.iceConnectionState),r.iceConnectionState&&"failed"==r.iceConnectionState&&"connected"!=r.iceConnectionState&&"completed"!=r.iceConnectionState&&"closed"!=r.iceConnectionState&&(t.iceRestart=!0),this.rtcConnection.createOffer(t).then(function(t){e.adapterRef.logger.log("chrome createOffer 成功"),e.formatSdp(t).then(function(t){e.adapterRef.logger.log("chrome formatSdp 成功"),e.getSdpResolve?(e.adapterRef.logger.log("getSdp 反馈结果"),e.getSdpResolve(t)):e.adapterRef.logger.warn("getSdp 没有 getSdpResolve")})})}},{key:"formatSdp",value:function(e){this.adapterRef.logger.log("********************** chrome 创建 sdp offer **********************"),this.adapterRef.logger.log("AbstractWebRTC:createOffer uid: ",this.targetUid),e.sdp=s.SdpUtil.maybePreferVideoReceiveCodec(e.sdp,{videoRecvCodec:"H264"}),this.currStream&&this.adapterRef.logger.log("AbstractWebRTC:createOffer currentStream: %o",this.currStream.getTracks().length);var t=!1;return"p2p"===this.adapterRef.imInfo.sessionMode&&(t=this.vp8Only||this.adapterRef.instance._getWebRTCGateWayManager().isVp8Only),(e=s.RtcUtil.formatSdp({offerOrAnswer:e,uid:this.imInfo.userid||this.imInfo.uid,cid:this.imInfo.cid,chromeScreenShareOpened:this.adapterRef.state.chromeScreenShareOpened,stream:this.currStream,highAudio:this.imInfo.sessionConfig.highAudio,stero:this.imInfo.sessionConfig.stero,targetUid:this.targetUid,netDetect:this.imInfo.netDetect,codec:this.imInfo.codec,vp8Only:t}))?Promise.resolve(e):(console.warn("该机型浏览器不支持H264编码"),this.adapterRef.instance._exit(this.imInfo.uid),this.adapterRef.instance.emit(c.EVENT_OBJ.error.key,c.VideoErrorCode.VideoDecodeError),Promise.reject("该机型浏览器不支持H264编码"))}},{key:"setLocalOffer",value:function(){}},{key:"afterSetLocalOffer",value:function(){var e=this;return this.rtcConnection.setLocalDescription(this.sdpOffer).then(function(){e.adapterRef.logger.log("AbstractWebRTC: setLocalDescription, uid %o 成功",e.targetUid),e.setLocalOfferResolve?(e.adapterRef.logger.log("setLocalOffer 反馈结果"),e.setLocalOfferResolve(e.sdpOffer)):e.adapterRef.logger.warn("setLocalOffer 没有 setLocalOfferResolve")}).catch(function(t){e.adapterRef.logger.error("AbstractWebRTC:setLocalDescription uid: %o, error: %o",e.targetUid,t)})}},{key:"setRemoteAnswer",value:function(){this.adapterRef.logger.log("状态机 setRemoteAnswer")}},{key:"afterSetRemoteAnswer",value:function(){var e=this,t=this.sdpAnswer;t.sdp=s.SdpUtil.maybePreferVideoSendCodec(t.sdp,{videoRecvCodec:"H264"}),t.sdp=s.RtcUtil.formatSdpRemote(t.sdp,this.sdpOffer,this.adapterRef.state.chromeScreenShareOpened),this.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription sdp: ");for(var r=t.sdp.toString().split("\r\n"),i=0;i<r.length;i++)console.log(r[i]);var a=this.rtcConnection;return this.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription peer state: ",a.signalingState),a.setRemoteDescription(t).then(function(){if(e.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription #### setRemoteDescription 成功 uid %s: ",a.targetUid),e.iceCompleted)return e.adapterRef.logger.log("AbstractWebRTC:setRemoteDescription ice已协商完成, targetUid: %s",a.targetUid),void e.emit("iceCompleted",a.targetUid);e.doSendIce(),e.fsm.resolve&&(e.adapterRef.logger.log("setRemoteAnswer 反馈结果"),e.fsm.resolve(),e.fsm.resolve=null)}).catch(function(t){e.adapterRef.logger.error("AbstractWebRTC:setRemoteDescription uid:%s, error: %o",a.uid,t)})}},{key:"changeFsm",value:function(){switch(this.fsm.state){case"state":case"haveLocalSdp":case"haveLocalOffer":this.fsm.getSdp()}}},{key:"updateStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.adapterRef.logger.log("chrome updateStream: ",t.length);var r=this.checkCurrStream(this.rtcConnection),i={},a=this.currStream||new MediaStream;t.map(function(t){t.getTracks().map(function(t){e.adapterRef.logger.log("updateStream newTracks",t.id),i[t.id]=t})});var n=Object.keys(r.tracks).filter(function(e){return!i[e]});n.map(function(t){e.adapterRef.logger.log("updateStream 需要移除的track: ",JSON.stringify(t,null," "))});var o=Object.keys(i).filter(function(e){return!r.tracks[e]});o.map(function(t){e.adapterRef.logger.log("updateStream 需要添加的track: ",JSON.stringify(t,null," "))}),n&&n.map(function(t){var i=r.tracks[t].sender,n=r.tracks[t].track;if(n&&e.adapterRef.logger.log("updateStream remove old track ",n.id),("Chrome"===l.prefix||"Chrome Mobile"===l.prefix)&&l.version>=72||"weixin"==s.RtcSystem.browser.ua||"Electron"===l.prefix){e.adapterRef.logger.log("chrome 清除track");var o="audio"===n.kind?e.rtcConnection.audioSender:e.rtcConnection.videoSender;o&&o.replaceTrack(null)}else e.rtcConnection.removeTrack(i);a.removeTrack(n)}),o&&o.map(function(t){var r=i[t];e.adapterRef.logger.log("updateStream add new track: ",r&&r.id),a.addTrack(r);var n=e.rtcConnection;("Chrome"===l.prefix||"Chrome Mobile"===l.prefix)&&l.version>=72||"weixin"==s.RtcSystem.browser.ua||"Electron"===l.prefix?(e.adapterRef.logger.log("使用不同的api，添加track"),"audio"===r.kind?n.audioSender?n.audioSender.replaceTrack(r):n.audioSender=e.rtcConnection.addTrack(r,a):"video"===r.kind&&(n.videoSender?(e.adapterRef.logger.log("RtcUtil:_updateMediaStream open the camera"),n.videoSender.replaceTrack(r)):n.videoSender=e.rtcConnection.addTrack(r,a))):"video"===r.kind?n.videoSender=e.rtcConnection.addTrack(r,a):n.audioSender=e.rtcConnection.addTrack(r,a)}),this.checkCurrStream(this.rtcConnection),this.currStream=a}},{key:"checkCurrStream",value:function(e){var t=this,r={},i=[],a=e.getSenders();return a&&a.map(function(e){t.adapterRef.logger.log("chrome get Senders: ",e);var a=e.track;a?(r[a.id]={sender:e,track:a},t.adapterRef.logger.log("chrome: checkCurrStream --\x3e track id:",a.kind+":"+a.id)):i.push(e)}),{tracks:r,empty:i}}},{key:"createOffer",value:function(e){var t=this;return this.fsm.can("getSdp")?new Promise(function(r,i){t.getSdpResolve=e||r;try{t.fsm.getSdp()}catch(e){t.adapterRef.logger.error("执行getSdp发生错误，sdk自动修复，错误信息：",JSON.stringify(e,null," ")),setTimeout(function(){t.createOffer(r)},1e3)}}):Promise.reject(100)}},{key:"setLocalDescription",value:function(e,t){var r=this;this.sdpOffer=e;for(var i=e.sdp.toString().split("\r\n"),a=0;a<i.length;a++)console.log(i[a]);return new Promise(function(e,t){r.setLocalOfferResolve=e,r.fsm.setLocalOffer()})}},{key:"setRemoteDescription",value:function(e,t){var r=this;switch(this.adapterRef.logger.log("chrome setRemoteDescription 状态机状态: ",this.fsm.state),this.sdpAnswer={sdp:e.sdp,type:e.type},this.fsm.state){case"haveLocalSdp":this.adapterRef.logger.log("当前peerConnection正在生成sdp， answer等一会儿设置"),setTimeout(function(){r.setRemoteAnswer(e,t)},1e3);break;case"haveLocalOffer":return new Promise(function(e,t){r.fsm.resolve=e,r.fsm.setRemoteAnswer()});case"state":this.adapterRef.logger.log("当前peerConnection 进入稳定状态， 先设置offer，在设置answer"),this.rtcConnection.setLocalDescription(this.sdpOffer).then(function(e){r.fsm.resolve=resolve,r.fsm.setRemoteAnswer()})}}}]),t}(d.AbstractWebRTC);t.WebRTC4ChromeRelease=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isMatchVersion=function(e,t){var r=i[e];if(!(r&&r.length>0))return!1;return-1!==r.findIndex(function(e,r){return e===t})},t.maxVersion=function(e){var t=i[e];if(!(t&&t.length>0))return-1;for(var r=t[0],a=0,n=t.length;a<n;a++)r=Math.max(r,t[a]);return r};var i=t.RELEASE_VERSION_MAP={chrome:["65"],firefox:["59"],safari:["11"]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(158);Object.defineProperty(t,"AbstractWebRTC",{enumerable:!0,get:function(){return i.AbstractWebRTC}});var a=r(261);Object.defineProperty(t,"RELEASE_VERSION_MAP",{enumerable:!0,get:function(){return a.RELEASE_VERSION_MAP}}),Object.defineProperty(t,"isMatchVersion",{enumerable:!0,get:function(){return a.isMatchVersion}}),Object.defineProperty(t,"maxVersion",{enumerable:!0,get:function(){return a.maxVersion}});var n=r(437);Object.defineProperty(t,"WebRTCBuilder",{enumerable:!0,get:function(){return n.WebRTCBuilder}});var o=r(260);Object.defineProperty(t,"WebRTC4ChromeRelease",{enumerable:!0,get:function(){return o.WebRTC4ChromeRelease}});var s=r(258);Object.defineProperty(t,"WebRTC4FirefoxRelease",{enumerable:!0,get:function(){return s.WebRTC4FirefoxRelease}});var d=r(257);Object.defineProperty(t,"WebRTC4SafariRelease",{enumerable:!0,get:function(){return d.WebRTC4SafariRelease}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(r(1)),a=d(r(2)),n=d(r(19)),o=r(27),s=d(r(155));function d(e){return e&&e.__esModule?e:{default:e}}var c=r(5),u=c.info.nrtcVersion,l=function(){function e(t){(0,i.default)(this,e),this.configs=t||{};var r=t.adapterRef,a=void 0===r?{}:r,d=t.sdkRef,c=void 0===d?{}:d,u=a.nim&&a.nim.options,l=a.instance,p=u&&u.appKey,f=l._params&&l._params.appkey,h=p||f,m=a.imInfo||{},g=m.sessionConfig,v=void 0===g?{}:g,R=""+(m.cid||m.channelId||""),_=""+(m.uid||""),y=m.sessionStart||v.signalStartTime||Date.now();this.adapterRef=a,this.common={ver:"2.0",sdk_type:"nrtc",sdk_ver:c.versionRtc||"",platform:"web",os_ver:n.default.os.family+n.default.os.version,time:y,session_id:(0,s.default)(R+":"+_+":"+y),device_id:(0,o.deviceId)(),manufacturer:n.default.manufacturer||"",app_key:h||""},this.event=[]}return(0,a.default)(e,[{key:"addEvent",value:function(e){return-1==this.event.indexOf(e)&&this.event.push(e),this}},{key:"updateCommon",value:function(e){return Object.assign(this.common,e),this}},{key:"setEvent",value:function(e,t){this.addEvent(e),this[e]=t}},{key:"setFeedback",value:function(e){var t=e.rate,r=e.uid,i=e.cid,a=e.description,n=void 0===a?"":a;return this.addEvent("feedback"),this.feedback={rate:t,uid:r,cid:i,description:n},this}},{key:"setDeviceinfo",value:function(e){var t,r,i,a=e.app_key,o=void 0===a?this.common.app_key:a,s=e.sdk_ver,d=void 0===s?u:s,c=e.platform,l=void 0===c?"Web":c,p=e.compat_id,f=void 0===p?"":p,h=e.os_ver,m=e.manufacturer,g=void 0===m?"":m,v=e.system,R=void 0===v?"":v,_=e.browser,y=void 0===_&&navigator.userAgent.toLowerCase(),C=e.model,b=void 0===C?"":C,E=e.app_name,S=void 0===E?"NRTC":E,T=e.pkg_name,A=void 0===T?"":T,O=e.device,k=void 0===O?"":O,P=e.device_detail_info,I=void 0===P?"":P;this.addEvent("deviceinfo"),r=n.default.os.family,i=void 0,i=/Windows/i.test(r)?"Win":r,l=(i=/OS X/i.test(i)?"Mac":i)+"-"+n.default.os.version+"-webrtc",y=n.default.name+"-"+n.default.version,t=this.common.os_ver,this.deviceinfo={app_key:o,sdk_ver:d,platform:l,compat_id:f,os_ver:t,manufacturer:g,system:R,browser:y,model:b,app_name:S,pkg_name:A,device:k,device_detail_info:I}}},{key:"setLogin",value:function(e){var t=e.uid,r=e.cid,i=e.meeting_mode,a=e.a_record,n=e.v_record,o=e.record_type,s=e.host_speaker,d=e.server_ip,c=e.result,u=e.time,l=e.network,p=e.isp,f=void 0===p?"":p,h=e.signalling_time,m=void 0===h?0:h,g=e.connect_time,v=void 0===g?0:g,R=e.meeting,_=e.live;this.addEvent("login");var y=this.adapterRef.imInfo.sessionConfig;y&&(m=(y.signalEndTime||0)-(y.signalStartTime||0),v=(y.rtcEndTime||0)-(y.signalEndTime||0)),_=y&&y.liveEnable||!1,R=/^meeting$/gi.test(this.adapterRef.imInfo.sessionMode),this.login={uid:t,cid:r,meeting_mode:i,a_record:a,v_record:n,record_type:o,host_speaker:s,server_ip:d,result:c,time:u,network:l,isp:f,signalling_time:m,connect_time:v,meeting:R,live:_}}},{key:"setLogout",value:function(e){var t=e.uid,r=e.cid,i=e.time;this.addEvent("logout"),this.logout={uid:t,cid:r,time:i}}},{key:"setIpChange",value:function(e){var t=e.uid,r=e.cid,i=e.ip,a=e.time;this.addEvent("ipChange"),this.ipChange={uid:t,cid:r,ip:i,time:a}}},{key:"setDisconnect",value:function(e){var t=e.uid,r=e.cid,i=e.reason,a=e.time;this.addEvent("disconnect"),this.disconnect={uid:t,cid:r,reason:i,time:a}}},{key:"setRecvFirstFrame",value:function(e){var t=e.uid,r=e.cid,i=e.pull_uid,a=e.time,n=e.type,o=e.duration,s=void 0===o?0:o;this.addEvent("recvFirstFrame"),this.recvFirstFrame={uid:t,cid:r,pull_uid:i,time:a,type:n,duration:s}}},{key:"setSendFirstPackage",value:function(e){var t=e.uid,r=e.cid,i=e.time,a=e.type;this.addEvent("sendFirstPackage"),this.sendFirstPackage={uid:t,cid:r,time:i,type:a}}},{key:"setRecvFirstPackage",value:function(e){var t=e.uid,r=e.cid,i=e.pull_uid,a=e.time,n=e.type;this.addEvent("recvFirstPackage"),this.recvFirstPackage={uid:t,cid:r,pull_uid:i,time:a,type:n}}},{key:"reset",value:function(){this.event=[]}},{key:"send",value:function(e){var t=this,r={common:this.common};if(e||(e=this.event||[]),!e.length)return this;r.event=e.reduce(function(e,r){return e[r]=t[r],e},{});var i="https://statistic.live.126.net/statics/report/common/form",a=(this.configs.adapterRef.nim&&this.configs.adapterRef.nim.options||{}).statisticServer||"";return a?i=a:c.wssServer&&(i=i.replace("statistic.live.126.net",c.wssServer)),(0,o.ajax)({type:"post",url:i,data:r,header:{sdktype:this.common.sdk_type,appkey:this.common.app_key,platform:"web",sdkver:u}}).then(function(e){"function"==typeof t.reset&&t.reset()}).catch(function(e){console.log("CommonDataReport: send: err",e)}),this}}]),e}();t.default=l,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeTrackFromMediaStream=t.getScreenStream=t.getMediaStream=void 0;var i=r(11);t.getMediaStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:console,r=arguments[2];if(r){var i=new MediaStream;return i.addTrack(r),Promise.resolve(i)}return/safari/gi.test(platform.name)&&(e.video?e.video={deviceId:{exact:e.video.deviceId}}:e.audio&&(e.audio={deviceId:{exact:e.audio.deviceId}})),t.log("MediaTool: getLocalStream constraint:",JSON.stringify(e,null," ")),navigator.mediaDevices.getUserMedia(e).then(function(r){if(/Firefox/gi.test(platform.name)&&r.getVideoTracks().length>0){var i={width:{max:e.video.width},height:{max:e.video.height},advanced:[{width:e.video.width,height:e.video.height}]},a=r.getVideoTracks()[0];return t.log("MediaTool:constraints:",i),a.applyConstraints(i).then(function(){return t.log("变更视频流成功: ",r),Promise.resolve(r)}).catch(function(e){t.error("变更视频流失败，",e);var r={event:e};return Promise.reject(r)})}return Promise.resolve(r)}).catch(function(e){var t={event:e};return Promise.reject(t)})},t.getScreenStream=function(e,t){var r=Promise.resolve();if(e={video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:5,max:5}}},t.log("MediaTool: getLocalStream constraint:",JSON.stringify(e,null," ")),navigator.getDisplayMedia)r=navigator.getDisplayMedia(e);else{if(!navigator.mediaDevices.getDisplayMedia)return Promise.reject(i.VideoErrorCode.VideoScreenShareNotSupport);r=navigator.mediaDevices.getDisplayMedia(e)}return r.then(function(e){return Promise.resolve(e)}).catch(function(e){t.warn("获取屏幕共享流失败: ",e);var r={event:e};return Promise.reject(r)})},t.removeTrackFromMediaStream=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:console;if(e){var r=e.getTracks();r&&0!==r.length&&r.forEach(function(r){t.log("stop track",e.id),r.stop(),e.removeTrack(r)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC2GateWayContext=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.WebRTC2GateWayContext=function e(t){(0,n.default)(this,e),this.externalid=""+t.externalid,this.cid=""+t.cid;var r=t.subtype,i=t.role,a=t.username,o=t.token,s=t.version,d=t.roomname,c=t.engineversion,u=t.sessionmode,l=t.browser,p=t.rtmp,f=t.record,h=t.aslmode;this.subtype=r||"select",this.role=i||"presenter",this.username=a||"",this.token=o,this.version=s||"1.0.0",this.roomname=d,this.sessionmode=u||"meeting",this.engineversion=c||"",this.usertype="16",this.aslmode=h||"0",this.rtmp=p,this.record=f,this.browser=l}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractProtocolHandler=void 0;var i=n(r(1)),a=n(r(2));function n(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,i.default)(this,e)}return(0,a.default)(e,[{key:"pack",value:function(e,t){this.adapterRef.logger.error("AbstractProtocolHandler:pack 需要子类实现")}},{key:"unpack",value:function(e){this.adapterRef.logger.error("AbstractProtocolHandler:unpack 需要子类实现")}}]),e}();t.AbstractProtocolHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCGateWayContext=void 0;var i=o(r(1)),a=o(r(4)),n=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.uid=""+r.uid,r.cid=""+r.cid;var n=e.hasAudio,o=e.hasVideo,s=e.netDetect,d=e.session_mode,c=e.params,u=e.browser,l=e.bypass_rtmp,p=e.record,f=e.vp8_only,h=e.et,m=void 0===h?0:h,g=e.ek;return r.hasAudio=n,r.hasVideo=o,r.netDetect=s,r.session_mode=d,r.params=c,r.browser=u,r.bypass_rtmp=l,r.record=p,r.vp8_only=f,r.et=m,r.ek=g,r}return(0,n.default)(t,e),t}(r(476).AbstractGateWayContext);t.WebRTCGateWayContext=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=r(155),n=(i=a)&&i.__esModule?i:{default:i};t.default=function(){var e,t,r,i=(e="BrowserLeaks,com <canvas> 1.0",t=document.createElement("canvas"),(r=t.getContext("2d")).textBaseline="top",r.font="14px 'Arial'",r.textBaseline="alphabetic",r.fillStyle="#f60",r.fillRect(125,1,62,20),r.fillStyle="#069",r.fillText(e,2,15),r.fillStyle="rgba(102, 204, 0, 0.7)",r.fillText(e,4,17),t.toDataURL());return(0,n.default)(i)},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AuidoMixingState={UNSTART:0,STARTING:1,PLAYED:2,PAUSED:3,STOPED:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Webrtc2ErrorCode={OK:{name:"OK",code:200,desc:"success"},clientNotYetUninitialized:{name:"client not yet uninitialized",code:1e3,desc:"请先调用createClient创建Client"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(270);Object.defineProperty(t,"Webrtc2ErrorCode",{enumerable:!0,get:function(){return i.Webrtc2ErrorCode}});t.CommonErrorCode={OK:{name:"OK",code:200,desc:"success"},ChannelReserveTimeOut:{name:"ChannelReserveTimeOut",code:101,desc:"请求超时"},ChannelReserveErrorParam:{name:"ChannelReserveErrorParam",code:414,desc:"服务器请求参数错误"},ChannelReserveMoreThanTwoUser:{name:"ChannelReserveMoreThanTwoUser",code:600,desc:"只支持两个用户, 有第三个人试图使用相同的频道名分配频道"},ChannelReserveServerFail:{name:"ChannelReserveServerFail",code:601,desc:"分配频道服务器出错"},ChannelJoinTimeOut:{name:"ChannelJoinTimeOut",code:20101,desc:"请求超时"},ChannelJoinMeetingModeError:{name:"ChannelJoinMeetingModeError",code:20102,desc:"会议模式错误"},ChannelJoinRtmpModeError:{name:"ChannelJoinRtmpModeError",code:20103,desc:"rtmp用户加入非rtmp频道"},ChannelJoinRtmpNodesError:{name:"ChannelJoinRtmpNodesError",code:20104,desc:"超过频道最多rtmp人数限制"},ChannelJoinRtmpHostError:{name:"ChannelJoinRtmpHostError",code:20105,desc:"已经存在一个主播"},ChannelJoinRtmpCreateError:{name:"ChannelJoinRtmpCreateError",code:20106,desc:"需要旁路直播, 但频道创建者非主播"},ChannelJoinLayoutError:{name:"ChannelJoinLayoutError",code:20208,desc:"主播自定义布局错误"},ChannelJoinInvalidParam:{name:"ChannelJoinInvalidParam",code:20400,desc:"参数错误"},ChannelJoinDesKey:{name:"ChannelJoinDesKey",code:20401,desc:"密码加密错误"},ChannelJoinInvalidRequst:{name:"ChannelJoinInvalidRequst",code:20417,desc:"错误请求"},ChannelServerUnknown:{name:"ChannelServerUnknown",code:20500,desc:"服务器内部错误"},ChannelStartFail:{name:"ChannelStartFail",code:11e3,desc:"通道发起失败"},ChannelDisconnected:{name:"ChannelDisconnected",code:11001,desc:"断开连接"},VersionSelfLow:{name:"VersionSelfLow",code:11002,desc:"本人SDK版本太低不兼容"},VersionRemoteLow:{name:"VersionRemoteLow",code:11003,desc:"对方SDK版本太低不兼容"},BrowserNotSupport:{name:"BrowserNotSupport",code:11004,desc:"浏览器版本不支持"},ChannelClosed:{name:"ChannelClosed",code:11005,desc:"通道被关闭"},ChannelKicked:{name:"ChannelKicked",code:11006,desc:"账号被踢"},DataError:{name:"DataError",code:11400,desc:"数据错误"},Invalid:{name:"Invalid",code:11403,desc:"无效的操作"},ParamError:{name:"ParamError",code:11405,desc:"参数错误"},ChannelCreatingError:{name:"ChannelCreatingError",code:20110,desc:"创建房间失败"},ChannelJoinError:{name:"ChannelJoinError",code:20111,desc:"加入房间失败"},ChannelJoinAlreadyIn:{name:"ChannelJoinAlreadyIn",code:20112,desc:"已经在房间中"},ChannelSessionNotExists:{name:"ChannelSessionNotExists",code:20113,desc:"会话/连接不存在"},ChannelAlreadyInSession:{name:"ChannelAlreadyInSession",code:20114,desc:"会话已建立，请在会话建立前调用"},NIMNotInited:{name:"NIMNotInited",code:20115,desc:"NIM Info 未被初始化"},ServerConnectionError:{name:"ServerConnectionError",code:20116,desc:"服务器连接错误"},StageNotMatch:{name:"StageNotMatch",code:20117,desc:"场景不匹配(P2P/MEETING)"},StageNoPermission:{name:"StageNoPermission",code:20118,desc:"当前场景没有权限"},RoleNoPermission:{name:"RoleNoPermission",code:20119,desc:"当前角色没有权限"},NetworkInDetecting:{name:"NetworkInDetecting",code:20120,desc:"网络正在探测中"},FunctionNotEnabled:{name:"FunctionNotEnabled",code:20500,desc:"该功能没有启用"}},t.RoomServerErrorCode={OK:{name:"RoomServerErrOK",code:200,desc:"操作成功"},RoomServerErrAuthError:{name:"RoomServerErrAuthError",code:401,desc:"认证错误"},RoomServerErrChannelNotExist:{name:"RoomServerErrChannelNotExist",code:404,desc:"房间不存在"},RoomServerErrUidNotExist:{name:"RoomServerErrUidNotExist",code:405,desc:"房间下的uid不存在"},RoomServerErrNoPermission:{name:"RoomServerErrUidNotExist",code:406,desc:"没有权限"},RoomServerErrDataError:{name:"RoomServerErrDataError",code:417,desc:"请求数据不对"},RoomServerErrUnknown:{name:"RoomServerErrUnknown",code:500,desc:"内部错误（TurnServer请求异常）"},RoomServerErrServerError:{name:"RoomServerErrServerError",code:600,desc:"服务器内部错误"},RoomServerErrInvilid:{name:"RoomServerErrInvilid",code:11403,desc:"无效的操作"}},t.VideoRecordErrorCode={VideoRecordClose:{name:"VideoRecordClose",code:0,desc:"视频录制正常结束"},VideoRecordVideoSizeError:{name:"VideoRecordVideoSizeError",code:1,desc:"视频录制结束，视频画面大小变化"},VideoRecordOutDiskSpace:{name:"VideoRecordOutDiskSpace",code:2,desc:"视频录制结束，磁盘空间不足"},VideoRecordThreadBusy:{name:"VideoRecordThreadBusy",code:3,desc:"视频录制结束，录制线程繁忙"},VideoRecordCreate:{name:"VideoRecordCreate",code:200,desc:"视频录制文件创建"},VideoRecordExsit:{name:"VideoRecordExsit",code:400,desc:"视频录制文件已经存在，请下载或清除"},VideoRecordCreateError:{name:"VideoRecordCreateError",code:403,desc:"视频录制文件创建失败"},VideoRecordInvalid:{name:"VideoRecordInvalid",code:404,desc:"通话不存在"},RecordNotExist:{name:"RecordNotExist",code:67001,desc:"录制对象不存在或录制已结束"},RecordLackAccount:{name:"RecordLackAccount",code:67002,desc:"需要录制的帐号缺失"},RecordNoStream:{name:"RecordNoStream",code:67003,desc:"当前没有音视频数据，无法进行录制"},RecordBrowserNotSupport:{name:"RecordBrowserNotSupport",code:67004,desc:"当前浏览器不支持音视频录制功能"},RecordBrowserNotSupportFormat:{name:"RecordBrowserNotSupportFormat",code:67005,desc:"当前浏览器不支持对应格式的音视频录制"},RecordInRecording:{name:"RecordInRecording",code:67006,desc:"音视频正在录制中，请勿重复操作"},RecordFormatError:{name:"RecordFormatError",code:67007,desc:"音视频解码/格式化失败"},RecordStreamInvalid:{name:"RecordStreamInvalid",code:67008,desc:"音视频流错误"}},t.AudioRecordErrorCode={AudioRecordClose:{name:"AudioRecordClose",code:0,desc:"音频录制正常结束"},AudioRecordOutDiskSpace:{name:"AudioRecordOutDiskSpace",code:2,desc:"音频录制结束，磁盘空间不足"},AudioRecordCreate:{name:"AudioRecordCreate",code:200,desc:"音频录制文件创建成功"},AudioRecordExsit:{name:"AudioRecordExsit",code:400,desc:"音频录制文件已经存在"},AudioRecordCreateError:{name:"AudioRecordCreateError",code:403,desc:"音频录制文件文件创建失败"},AudioRecordInvalid:{name:"AudioRecordInvalid",code:404,desc:"通话不存在"}},t.LiveStatusErrorCode={LiveStatusInitial:{name:"LiveStatusInitial",code:500,desc:"初始状态"},LiveStatusLayoutError:{name:"LiveStatusLayoutError",code:501,desc:"主播设置定制布局，布局参数错误"},LiveStatusStartConnecting:{name:"LiveStatusStartConnecting",code:502,desc:"开始连接"},LiveStatusConnectted:{name:"LiveStatusConnected",code:503,desc:"连接成功"},LiveStatusConnectFail:{name:"LiveStatusConnectFail",code:504,desc:"连接失败"},LiveStatusPushing:{name:"LiveStatusPushing",code:505,desc:"推流中"},LiveStatusPushFail:{name:"LiveStatusPushFail",code:506,desc:"互动直播推流失败"},LiveStatusInnerError:{name:"LiveStatusInnerError",code:507,desc:"内部错误"},LiveStatusPeopleLimit:{name:"LiveStatusPeopleLimit",code:508,desc:"人数超出限制"}},t.GateWayErrorCode={GateWayLoginFail:{name:"GateWayLoginFail",code:61001,desc:"网关登录失败"},GateWaySdpAnswerError:{name:"GateWaySdpAnswerError",code:61002,desc:"网关服务器验证不通过"},GateWayConnectionTimeout:{name:"GateWayConnectionTimeout",code:61003,desc:"网关连接超时"},GateWayAddressNotAvailable:{name:"GateWayAddressNotAvailable",code:61004,desc:"无可用的网关地址，请确保对方打开了WebRTC兼容开关"},GateWayLoginAlready:{name:"GateWayLoginAlready",code:61005,desc:"网关管理已初始化或已登录，重复操作"},GateWayServerError:{name:"GateWayServerError",code:61006,desc:"网关服务器错误"},GateWayAuthError:{name:"GateWayAuthError",code:61007,desc:"网关服务器鉴权失败"},GateWayRTCConnectFail:{name:"GateWayRTCConnectFail",code:61008,desc:"RTC连接失败"},GateWayRTCUploadStreamFail:{name:"GateWayRTCUploadStreamFail",code:61009,desc:"RTC发起上行流失败"}},t.VideoErrorCode={VideoDecodeError:{name:"VideoDecodeError",code:62001,desc:"该机型浏览器不支持H264编码"},VideoStreamFetchError:{name:"VideoStreamFetchError",code:62002,desc:"获取流媒体失败"},VideoStreamSwitchError:{name:"VideoStreamSwitchError",code:62003,desc:"视频流切换失败"},VideoUserHasBeenLeft:{name:"VideoUserHasBeenLeft",code:62005,desc:"用户已登出/离开房间"},VideoContainerNotExist:{name:"VideoContainerNotExist",code:62006,desc:"未设置画布容器"},VideoDisabled:{name:"VideoDisabled",code:62007,desc:"视频功能已被禁用"},VideoEnded:{name:"VideoEnded",code:62008,desc:"媒体流已经停止工作了"},VideoMixStreamExceed:{name:"VideoMixStreamExceed",code:62101,desc:"新开启或关闭混频功能时，最多只能开启一路设备"},VideoScreenShareNotSupport:{name:"VideoScreenShareNotSupport",code:62102,desc:'不支持原生屏幕共享功能，请确认浏览器版本或"chrome://flags/"是否开启"Experimental Web Platform features"'}},t.AudioErrorCode={AudioStreamFetchError:{name:"AudioStreamFetchError",code:63002,desc:"获取音频流失败"},AudioUserHasBeenLeft:{name:"AudioUserHasBeenLeft",code:63005,desc:"用户已登出/离开房间"},AudioDisabled:{name:"AudioDisabled",code:63007,desc:"音频功能已被禁用"},MusicalAccompanimentError:{name:"AudioMixingError",code:63100,desc:"伴音出错"},AudioFileDownloadError:{name:"AudioFileDownloadError",code:63101,desc:"伴音文件加载失败"},MusicalAccompanimentUnsupport:{name:"AudioMixingUnsupport",code:63102,desc:"该浏览器不支持伴音功能"},UnpauseMusicalAccompaniment:{name:"UnpauseMusicalAccompaniment",code:63103,desc:"当前没有暂停伴音"},pausedMusicalAccompaniment:{name:"pausedMusicalAccompaniment",code:63104,desc:"已经暂停暂停伴音"},UnstartMusicalAccompaniment:{name:"UnstartMusicalAccompaniment",code:63105,desc:"当前没有伴音"}},t.DeviceErrorCode={DeviceNotSupport:{name:"DeviceNotSupport",code:65001,desc:"不支持的设备类型"},DeviceNotExists:{name:"DeviceNotExists",code:65002,desc:"设备不存在/无任何设备"},DeviceVideoOccupied:{name:"VideoDeciveOccupied",code:65003,desc:"视频设备已被占用"},DeviceAudioOccupied:{name:"AudioDeciveOccupied",code:65004,desc:"音频设备已被占用"},DeviceOpenError:{name:"DeviceOpenError",code:65005,desc:"设备开启失败，未知错误"},DeviceNotOpen:{name:"DeviceNotOpen",code:65006,desc:"设备未开启/未初始化"},DeviceAlreadyOpen:{name:"DeviceAlreadytOpen",code:65007,desc:"设备已开启，重复操作"},DeviceNotAvailable:{name:"DeviceNotAvailable",code:65008,desc:"获取可用设备列表失败"},DevicePluginNotInstalled:{name:"DevicePluginNotInstalled",code:62008,desc:"未安装插件"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WEBRTC2_GATE_WAY_API={login_req:{key:"login_req",label:"登录"},login_ack:{key:"login_ack",label:"登录响应"},keep_alive:{key:"keep_alive",label:"信令层探活"},keep_alive_ack:{key:"keep_alive_ack",label:"信令层探活响应"},logout:{key:"logout",label:"退出"},user_update:{key:"user_update",label:"更新会者基本信息"},media_update:{key:"media_update",label:"更新会者媒体信息"},sub_source:{key:"sub_source",label:"订阅指定质量视频"},ssrc_update:{key:"ssrc_update",label:"接收者分辨率切换"},mute_update:{key:"mute_update",label:"更新用户指定设备下的状态"},user_pub:{key:"user_pub",label:"用户发布信息"},pub_ack:{key:"pub_ack",label:"用户发布信息响应"},user_sub:{key:"user_sub",label:"用户订阅信息"},sub_ack:{key:"sub_ack",label:"用户订阅信息响应"},user_asl_sub:{key:"user_asl_sub",label:"ASL subscribe的消息"},user_asl_sub_ack:{key:"user_asl_sub_ack",label:"ASL subscribe的消息响应"},channel_state:{key:"channel_state",label:"频道状态信息"}},t.CLIENT_LOGIN_OF_WEBRTC2={cmd_type:"login_req",externalid:"",cid:"",subtype:"",role:"",username:"",token:"",version:"",roomname:"",sessionmode:"",engineversion:"",usertype:"16",aslmode:"",rtmp:{host:"0",support:"0",needrecord:"0",rtmpurl:"",Participantmode:"",layout:""},record:{startcaller:"0",host:"0",support_video:"0",support_auido:"0",recordtype:"",layout:""},browser:{name:"",version:""}},t.LOGIN_ACK_OF_WEBRTC2={cmd_type:"login_ack",externalid:"",cid:"",result:"",record:"",userid:"",aslmode:"",serverfp:""},t.KEEP_ALIVE_OF_WEBRTC2={cmd_type:"keep_alive",userid:"",cid:""},t.KEEP_ALIVE_ACK_OF_WEBRTC2={cmd_type:"keep_alive_ack",userid:"",cid:"",livecode:""},t.LOGOUT_OF_WEBRTC2={cmd_type:"logout",userid:"",cid:"",reason:""},t.USER_UPDATE_WEBRTC2={cmd_type:"user_update",cid:"",updatetype:"",users:[]},t.MEDIA_UPDATE_WEBRTC2={cmd_type:"media_update",cid:"",users:[]},t.SUB_SOURCE_WEBRTC2={cmd_type:"sub_source",cid:"",userid:"",mediatype:"video",deviceid:"",quality:"",maxbitrate:""},t.SSRC_UPDATE_WEBRTC2={cmd_type:"ssrc_update",cid:"",userid:"",sid:"",mediatype:"video",deviceid:"",cname:"",mlabel:"",mslabel:"",ssrc:"",nack_ssrc:""},t.MUTE_UPDATE_WEBRTC2={cmd_type:"mute_update",cid:"",userid:"",sid:"",mediatype:"video",deviceid:"",status:""},t.USER_PUB_WEBRTC2={cmd_type:"user_pub",cid:"",userid:"",negotype:"",sdp:"",devices:[]},t.PUB_ACK_WEBRTC2={cmd_type:"pub_ack",cid:"",sid:"",sdp:""},t.USER_SUB_WEBRTC2={cmd_type:"user_sub",cid:"",userid:"",sid:"",negotype:"",sdp:"",devices:[]},t.SUB_ACK_WEBRTC2={cmd_type:"sub_ack",cid:"",userid:"",sid:"",deviceid:"",sdp:""},t.USER_ASL_SUB_WEBRTC2={cmd_type:"user_asl_sub",cid:"",userid:"",subtype:""},t.USER_ASL_SUB_ACK_WEBRTC2={cmd_type:"user_asl_sub_ack",cid:"",userid:"",result:""},t.CHANNEL_STATE_WEBRTC2={cmd_type:"channel_state",cid:"",userid:"",reason:""}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WEBRTC_GATE_WAY_API={client_login:{key:"client_login",label:"登录"},login_ack:{key:"login_ack",label:"登录响应"},sdp_offer:{key:"sdp_offer",label:"发送sdp offer描述"},sdp_answer:{key:"sdp_answer",label:"sdp answer响应"},ice_offer:{key:"ice_offer",label:"发送ice offer描述"},ice_answer:{key:"ice_answer",label:"ice answer响应"},keep_alive:{key:"keep_alive",label:"信令层探活"},keep_alive_ack:{key:"keep_alive_ack",label:"信令层探活响应"},sdp_update:{key:"sdp_update",label:"sdp更新（关闭/打开设备时发送）"},client_join:{key:"client_join",label:"人员加入通知"},client_update:{key:"client_update",label:"人员更新（关闭/打开设备时发送）"},client_logout:{key:"client_logout",label:"人员离开"},logout:{key:"logout",label:"退出"},client_error:{key:"client_error",label:"客户端出现错误"},detect_network:{key:"net_detect_result",label:"网关反馈网络探测结果"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SDP_UPDATE_OF_WEBRTC=t.SDP_OFFER_OF_WEBRTC=t.SDP_ANSWER_OF_WEBRTC=void 0;var i=r(28);t.SDP_ANSWER_OF_WEBRTC={type:"sdp_answer",uid:"",cid:"",h5_flag:i.RtcSystem.h5()||!1,params:{auth_res:200,dst_id:"",content:{type:"answer",sdp:""}}},t.SDP_OFFER_OF_WEBRTC={type:"sdp_offer",uid:"",cid:"",hasAudio:!0,hasVideo:!0,session_mode:"p2p",h5_flag:i.RtcSystem.h5()||!1,params:{content:{type:"offer",sdp:""},dst_id:"",user_token_type:0,user_type:3,version:1,is_multi_peerconnection:!0,sdk_version:"5.4.0",streamSetting:{video:{width:640,height:480,frameRate:20}}},browser:{name:"",version:""},bypass_rtmp:{is_host:!1,support_bypass_rtmp:!1,support_bypass_rtmp_record:!1,bypass_rtmp_url:"",layout:"",participant_mode:""},record:{support_audio_record:!1,support_video_record:!1}},t.SDP_UPDATE_OF_WEBRTC={type:"sdp_update",uid:"",cid:"",hasAudio:!0,hasVideo:!0,session_mode:"p2p",h5_flag:i.RtcSystem.h5()||!1,params:{content:{type:"offer",sdp:""},dst_id:"",user_token_type:0,user_type:3,version:1,is_multi_peerconnection:!0,sdk_version:"5.4.0",streamSetting:{video:{width:640,height:480,frameRate:20}}},browser:{name:"",version:""},bypass_rtmp:{is_host:!1,support_bypass_rtmp:!1,support_bypass_rtmp_record:!1,bypass_rtmp_url:"",layout:"",participant_mode:""},record:{support_audio_record:!1,support_video_record:!1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LOGOUT_OF_WEBRTC=t.LOGIN_ACK_OF_WEBRTC=void 0;var i=r(28);t.LOGIN_ACK_OF_WEBRTC={type:"login_ack",uid:"",cid:"",h5_flag:i.RtcSystem.h5()||!1,params:{auth_res:200}},t.LOGOUT_OF_WEBRTC={type:"logout",uid:"",cid:"",h5_flag:i.RtcSystem.h5()||!1,browser:{name:"",version:""},params:{content:{timestamp:0}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEEP_ALIVE_ACK_OF_WEBRTC=t.KEEP_ALIVE_OF_WEBRTC=void 0;var i=r(28);t.KEEP_ALIVE_OF_WEBRTC={type:"keep_alive",uid:"",cid:"",h5_flag:i.RtcSystem.h5()||!1,browser:{name:"",version:""},params:{content:{timestamp:0}}},t.KEEP_ALIVE_ACK_OF_WEBRTC={type:"keep_alive_ack",uid:"",cid:"",params:{content:{timestamp:0}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICE_OFFER_OF_WEBRTC=t.ICE_ANSWER_OF_WEBRTC=void 0;var i=r(28);t.ICE_ANSWER_OF_WEBRTC={type:"ice_answer",uid:"",cid:"",h5_flag:i.RtcSystem.h5()||!1,params:{dst_id:"",content:{candidate:"",sdpMid:"",sdpMLineIndex:""}}},t.ICE_OFFER_OF_WEBRTC={type:"ice_offer",uid:"",cid:"",h5_flag:i.RtcSystem.h5()||!1,params:{dst_id:"",content:{candidate:"",sdpMid:"",sdpMLineIndex:"",usernameFragment:""}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_ERROR_OF_WEBRTC=t.CLIENT_DETECT_NETWORK_RESULT_WEBRTC=t.CLIENT_UPDATE_OF_WEBRTC=t.CLIENT_JOIN_OF_WEBRTC=t.CLIENT_LOGOUT_OF_WEBRTC=t.CLIENT_LOGIN_OF_WEBRTC=void 0;var i=r(28);t.CLIENT_LOGIN_OF_WEBRTC={type:"client_login",uid:"",cid:"",hasAudio:!0,hasVideo:!0,netDetect:!1,session_mode:"p2p",h5_flag:i.RtcSystem.h5()||!1,params:{content:{},dst_id:"",user_token_type:0,token:"",user_type:3,version:1,is_multi_peerconnection:!0,sdk_version:"5.4.0",streamSetting:{video:{width:640,height:480,frameRate:20}}},browser:{name:"",version:""},bypass_rtmp:{is_host:!1,support_bypass_rtmp:!1,support_bypass_rtmp_record:!1,bypass_rtmp_url:"",layout:"",participant_mode:""},record:{support_audio_record:!1,support_video_record:!1,single_record_in_meeting:!1}},t.CLIENT_LOGOUT_OF_WEBRTC={type:"client_logout",uid:"",cid:"",params:{content:{logout_type:"normal",timestamp:0}}},t.CLIENT_JOIN_OF_WEBRTC={type:"client_join",uid:"",cid:"",params:{client_id:"123122",has_audio:!0,has_video:!0}},t.CLIENT_UPDATE_OF_WEBRTC={type:"client_update",uid:"",cid:"",params:{client_id:"123122",has_audio:!0,has_video:!0}},t.CLIENT_DETECT_NETWORK_RESULT_WEBRTC={type:"net_detect_result",uid:"",cid:"",params:{dst_id:"",loss:"",rtt:""}},t.CLIENT_ERROR_OF_WEBRTC={type:"client_error",uid:"",cid:"",params:{content:{error_code:"",timestamp:0}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(278);Object.defineProperty(t,"CLIENT_JOIN_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_JOIN_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_LOGIN_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_LOGIN_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_LOGOUT_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_LOGOUT_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_ERROR_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_ERROR_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_DETECT_NETWORK_RESULT_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_DETECT_NETWORK_RESULT_WEBRTC}}),Object.defineProperty(t,"CLIENT_UPDATE_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_UPDATE_OF_WEBRTC}});var a=r(277);Object.defineProperty(t,"ICE_ANSWER_OF_WEBRTC",{enumerable:!0,get:function(){return a.ICE_ANSWER_OF_WEBRTC}}),Object.defineProperty(t,"ICE_OFFER_OF_WEBRTC",{enumerable:!0,get:function(){return a.ICE_OFFER_OF_WEBRTC}});var n=r(276);Object.defineProperty(t,"KEEP_ALIVE_OF_WEBRTC",{enumerable:!0,get:function(){return n.KEEP_ALIVE_OF_WEBRTC}}),Object.defineProperty(t,"KEEP_ALIVE_ACK_OF_WEBRTC",{enumerable:!0,get:function(){return n.KEEP_ALIVE_ACK_OF_WEBRTC}});var o=r(275);Object.defineProperty(t,"LOGIN_ACK_OF_WEBRTC",{enumerable:!0,get:function(){return o.LOGIN_ACK_OF_WEBRTC}}),Object.defineProperty(t,"LOGOUT_OF_WEBRTC",{enumerable:!0,get:function(){return o.LOGOUT_OF_WEBRTC}});var s=r(274);Object.defineProperty(t,"SDP_ANSWER_OF_WEBRTC",{enumerable:!0,get:function(){return s.SDP_ANSWER_OF_WEBRTC}}),Object.defineProperty(t,"SDP_OFFER_OF_WEBRTC",{enumerable:!0,get:function(){return s.SDP_OFFER_OF_WEBRTC}}),Object.defineProperty(t,"SDP_UPDATE_OF_WEBRTC",{enumerable:!0,get:function(){return s.SDP_UPDATE_OF_WEBRTC}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(279);Object.defineProperty(t,"CLIENT_JOIN_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_JOIN_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_LOGIN_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_LOGIN_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_LOGOUT_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_LOGOUT_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_ERROR_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_ERROR_OF_WEBRTC}}),Object.defineProperty(t,"CLIENT_DETECT_NETWORK_RESULT_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_DETECT_NETWORK_RESULT_WEBRTC}}),Object.defineProperty(t,"CLIENT_UPDATE_OF_WEBRTC",{enumerable:!0,get:function(){return i.CLIENT_UPDATE_OF_WEBRTC}}),Object.defineProperty(t,"ICE_ANSWER_OF_WEBRTC",{enumerable:!0,get:function(){return i.ICE_ANSWER_OF_WEBRTC}}),Object.defineProperty(t,"ICE_OFFER_OF_WEBRTC",{enumerable:!0,get:function(){return i.ICE_OFFER_OF_WEBRTC}}),Object.defineProperty(t,"KEEP_ALIVE_ACK_OF_WEBRTC",{enumerable:!0,get:function(){return i.KEEP_ALIVE_ACK_OF_WEBRTC}}),Object.defineProperty(t,"KEEP_ALIVE_OF_WEBRTC",{enumerable:!0,get:function(){return i.KEEP_ALIVE_OF_WEBRTC}}),Object.defineProperty(t,"LOGIN_ACK_OF_WEBRTC",{enumerable:!0,get:function(){return i.LOGIN_ACK_OF_WEBRTC}}),Object.defineProperty(t,"LOGOUT_OF_WEBRTC",{enumerable:!0,get:function(){return i.LOGOUT_OF_WEBRTC}}),Object.defineProperty(t,"SDP_ANSWER_OF_WEBRTC",{enumerable:!0,get:function(){return i.SDP_ANSWER_OF_WEBRTC}}),Object.defineProperty(t,"SDP_OFFER_OF_WEBRTC",{enumerable:!0,get:function(){return i.SDP_OFFER_OF_WEBRTC}}),Object.defineProperty(t,"SDP_UPDATE_OF_WEBRTC",{enumerable:!0,get:function(){return i.SDP_UPDATE_OF_WEBRTC}});var a=r(273);Object.defineProperty(t,"WEBRTC_GATE_WAY_API",{enumerable:!0,get:function(){return a.WEBRTC_GATE_WAY_API}});var n=r(272);Object.defineProperty(t,"WEBRTC2_GATE_WAY_API",{enumerable:!0,get:function(){return n.WEBRTC2_GATE_WAY_API}}),Object.defineProperty(t,"CLIENT_LOGIN_OF_WEBRTC2",{enumerable:!0,get:function(){return n.CLIENT_LOGIN_OF_WEBRTC2}}),Object.defineProperty(t,"LOGIN_ACK_OF_WEBRTC2",{enumerable:!0,get:function(){return n.LOGIN_ACK_OF_WEBRTC2}}),Object.defineProperty(t,"KEEP_ALIVE_OF_WEBRTC2",{enumerable:!0,get:function(){return n.KEEP_ALIVE_OF_WEBRTC2}}),Object.defineProperty(t,"KEEP_ALIVE_ACK_OF_WEBRTC2",{enumerable:!0,get:function(){return n.KEEP_ALIVE_ACK_OF_WEBRTC2}}),Object.defineProperty(t,"LOGOUT_OF_WEBRTC2",{enumerable:!0,get:function(){return n.LOGOUT_OF_WEBRTC2}}),Object.defineProperty(t,"USER_UPDATE_WEBRTC2",{enumerable:!0,get:function(){return n.USER_UPDATE_WEBRTC2}}),Object.defineProperty(t,"MEDIA_UPDATE_WEBRTC2",{enumerable:!0,get:function(){return n.MEDIA_UPDATE_WEBRTC2}}),Object.defineProperty(t,"SUB_SOURCE_WEBRTC2",{enumerable:!0,get:function(){return n.SUB_SOURCE_WEBRTC2}}),Object.defineProperty(t,"SSRC_UPDATE_WEBRTC2",{enumerable:!0,get:function(){return n.SSRC_UPDATE_WEBRTC2}}),Object.defineProperty(t,"MUTE_UPDATE_WEBRTC2",{enumerable:!0,get:function(){return n.MUTE_UPDATE_WEBRTC2}}),Object.defineProperty(t,"USER_PUB_WEBRTC2",{enumerable:!0,get:function(){return n.USER_PUB_WEBRTC2}}),Object.defineProperty(t,"PUB_ACK_WEBRTC2",{enumerable:!0,get:function(){return n.PUB_ACK_WEBRTC2}}),Object.defineProperty(t,"USER_SUB_WEBRTC2",{enumerable:!0,get:function(){return n.USER_SUB_WEBRTC2}}),Object.defineProperty(t,"SUB_ACK_WEBRTC2",{enumerable:!0,get:function(){return n.SUB_ACK_WEBRTC2}}),Object.defineProperty(t,"USER_ASL_SUB_WEBRTC2",{enumerable:!0,get:function(){return n.USER_ASL_SUB_WEBRTC2}}),Object.defineProperty(t,"USER_ASL_SUB_ACK_WEBRTC2",{enumerable:!0,get:function(){return n.USER_ASL_SUB_ACK_WEBRTC2}}),Object.defineProperty(t,"CHANNEL_STATE_WEBRTC2",{enumerable:!0,get:function(){return n.CHANNEL_STATE_WEBRTC2}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GATE_WAY_RESPONSE_CODE={OK:"OK",NO_CONNECTION:"NO_CONNECTION"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(281);Object.defineProperty(t,"GATE_WAY_RESPONSE_CODE",{enumerable:!0,get:function(){return i.GATE_WAY_RESPONSE_CODE}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetVideoViewRemoteSizeRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.SetVideoViewRemoteSizeRequestParam=function e(t){(0,n.default)(this,e);var r=t.account,i=t.width,a=t.height,o=t.cut;this.account=r,this.width=i,this.height=a,this.cut=o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetVideoViewSizeRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.SetVideoViewSizeRequestParam=function e(t){(0,n.default)(this,e);var r=t.width,i=t.height,a=t.cut;this.width=r,this.height=i,this.cut=a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartRemoteStreamRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.StartRemoteStreamRequestParam=function e(t){(0,n.default)(this,e);var r=t.account,i=t.node,a=t.poster;this.account=r,this.node=i,this.poster=a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartDeviceRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.StartDeviceRequestParam=function e(t){(0,n.default)(this,e);var r=t.type,i=t.device,a=t.width,o=t.height,s=t.account,d=t.uid;this.type=r,this.device=i,void 0!==a&&(this.width=a),void 0!==o&&(this.height=o),void 0!==s&&(this.account=s),void 0!==d&&(this.uid=d)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetVideoScaleRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.SetVideoScaleRequestParam=function e(t){(0,n.default)(this,e);var r=t.account,i=t.type;this.account=r,this.type=i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JoinChannelRequestParam4NRTC=void 0;var i={channelName:"",uid:0,accid:"",role:r(142).ROLE_FOR_MEETING.ROLE_PLAYER,videoDeviceId:null,audioDeviceId:null,joinChannelRecordConfig:{recordAudio:!1,recordVideo:!1,recordType:0,isHostSpeaker:!1},joinChannelLiveConfig:{rtmpRecord:!1,liveEnable:!1,rtmpUrl:"",splitMode:0,layout:""}};t.JoinChannelRequestParam4NRTC=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JoinChannelRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.JoinChannelRequestParam=function e(t){(0,n.default)(this,e);var r=t.channelName,i=t.type,a=t.sessionConfig;this.channelName=r,this.type=i,this.sessionConfig=a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateChannelRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.CreateChannelRequestParam=function e(t){(0,n.default)(this,e);var r=t.channelName,i=t.custom,a=t.webrtcEnable;this.channelName=r,this.custom=i,this.webrtcEnable=a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.ControlRequestParam=function e(t){(0,n.default)(this,e);var r=t.channelId,i=t.command;this.channelId=r,this.command=i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.ResponseRequestParam=function e(t){(0,n.default)(this,e);var r=t.accepted,i=t.beCalledInfo,a=t.sessionConfig,o=t.channelId,s=t.command;this.accepted=r,this.beCalledInfo=i,this.sessionConfig=a,this.channelId=o,this.command=s}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallRequestParam=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.CallRequestParam=function e(t){(0,n.default)(this,e);var r=t.type,i=t.webrtcEnable,a=t.account,o=t.pushConfig,s=t.sessionConfig;this.type=r,this.webrtcEnable=i,this.account=a,this.pushConfig=o,this.sessionConfig=s}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ApiParams=void 0;var i=r(293),a=r(292),n=r(291),o=r(290),s=r(289),d=r(288),c=r(287),u=r(286),l=r(285),p=r(284),f=r(283),h={CallRequestParam:i.CallRequestParam,ResponseRequestParam:a.ResponseRequestParam,ControlRequestParam:n.ControlRequestParam,CreateChannelRequestParam:o.CreateChannelRequestParam,JoinChannelRequestParam:s.JoinChannelRequestParam,JoinChannelRequestParam4NRTC:d.JoinChannelRequestParam4NRTC,SetVideoScaleRequestParam:c.SetVideoScaleRequestParam,StartDeviceRequestParam:u.StartDeviceRequestParam,StartRemoteStreamRequestParam:l.StartRemoteStreamRequestParam,SetVideoViewSizeRequestParam:p.SetVideoViewSizeRequestParam,SetVideoViewRemoteSizeRequestParam:f.SetVideoViewRemoteSizeRequestParam};t.ApiParams=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_WEBRTC_OPTION=t.DEFAULT_NRTC_OPTION=t.DEFAULT_NETCALL_OPTION=void 0;var i=r(204);t.DEFAULT_NETCALL_OPTION=new i.NetcallOption({kickLast:!1,nim:null,container:null,remoteContainer:null,mirror:!1,mirrorRemote:!1}),t.DEFAULT_NRTC_OPTION=new i.NRTCOption({appkey:"",chromeId:null,debug:!1}),t.DEFAULT_WEBRTC_OPTION=new i.WebRTCOption({nim:null,container:null,remoteContainer:null,chromeId:null,debug:!1})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(204);Object.defineProperty(t,"NetcallOption",{enumerable:!0,get:function(){return i.NetcallOption}}),Object.defineProperty(t,"WebRTCOption",{enumerable:!0,get:function(){return i.WebRTCOption}}),Object.defineProperty(t,"NRTCOption",{enumerable:!0,get:function(){return i.NRTCOption}});var a=r(295);Object.defineProperty(t,"DEFAULT_NETCALL_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_NETCALL_OPTION}}),Object.defineProperty(t,"DEFAULT_NRTC_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_NRTC_OPTION}}),Object.defineProperty(t,"DEFAULT_WEBRTC_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_WEBRTC_OPTION}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PUSH_CONFIG=void 0;var i=r(206);t.DEFAULT_PUSH_CONFIG=new i.PushConfig({enable:!0,needBadge:!0,needPushNick:!0,pushContent:"",custom:"",pushPayload:"",sound:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SCALE_TYPE={CHAT_VIDEO_SCALE_None:0,CHAT_VIDEO_SCALE_1x1:1,CHAT_VIDEO_SCALE_4x3:2,CHAT_VIDEO_SCALE_16x9:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VIDEO_ENCODE_MODE={CHAT_VIDEO_ENCODEMODE_NORMAL:0,CHAT_VIDEO_ENCODEMODE_SMOOTH:1,CHAT_VIDEO_ENCODEMODE_QUALITY:2,CHAT_VIDEO_ENCODEMODE_SCREEN:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DECTECT_TYPE={NETDETECT_AUDIO:0,NETDETECT_VIDEO:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DECTECT_RESULT_TYPE={CHAT_NET_STATUS_VERY_GOOD:0,CHAT_NET_STATUS_GOOD:1,CHAT_NET_STATUS_POOR:2,CHAT_NET_STATUS_BAD:3,CHAT_NET_STATUS_VERY_BAD:4,CHAT_NET_STATUS_VERY_BAD_VIDEO_CLOSE:-1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SESSION_MODE={P2P:"p2p",MEETING:"meeting"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ROLE_FOR_MEETING={ROLE_PLAYER:0,ROLE_AUDIENCE:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MIX_VIDEO_MODE={LAYOUT_TOP_LEFT:1,LAYOUT_TOP_RIGHT:2,LAYOUT_BOTTOM_LEFT:3,LAYOUT_BOTTOM_RIGHT:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SPLIT_MODE={LAYOUT_SPLITBOTTOMHORFLOATING:0,LAYOUT_SPLITTOPHORFLOATING:1,LAYOUT_SPLITLATTICETILE:2,LAYOUT_SPLITLATTICECUTTINGTILE:3,LAYOUT_SPLITCUSTOM:4,LAYOUT_SPLITAUDIO:5}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NETCALL_TYPE={NETCALL_TYPE_AUDIO:1,NETCALL_TYPE_VIDEO:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICE_TYPE_REV=t.DEVICE_TYPE=void 0;var i,a,n=r(94),o=(i=n)&&i.__esModule?i:{default:i};var s=t.DEVICE_TYPE={DEVICE_TYPE_AUDIO_IN:0,DEVICE_TYPE_AUDIO_OUT_LOCAL:1,DEVICE_TYPE_AUDIO_OUT_CHAT:2,DEVICE_TYPE_VIDEO:3,DEVICE_TYPE_DESKTOP_SCREEN:4,DEVICE_TYPE_DESKTOP_WINDOW:5,DEVICE_TYPE_DESKTOP_CHROME_SCREEN:6,DEVICE_TYPE_CUSTOM_AUDIO:7,DEVICE_TYPE_CUSTOM_VIDEO:8};t.DEVICE_TYPE_REV=(a={},(0,o.default)(a,s.DEVICE_TYPE_AUDIO_IN,"audioIn"),(0,o.default)(a,s.DEVICE_TYPE_AUDIO_OUT_LOCAL,"audioOut"),(0,o.default)(a,s.DEVICE_TYPE_AUDIO_OUT_CHAT,"audioOut"),(0,o.default)(a,s.DEVICE_TYPE_VIDEO,"video"),a)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONFIG_MAP=void 0;var i,a,n,o=r(94),s=(i=o)&&i.__esModule?i:{default:i};var d={CURRENT:{SDK_TYPE:null},SDK_TYPE:{NETCALL:1,WEBRTC:2,WHITEBOARD:3,NRTC:4,WEBRTC2:5},SDK_NAME:{1:"Netcall",2:"WebRTC",3:"WhiteBoard",4:"NRTC",5:"WEBRTC2"}};d.STATS_FUN=(a={},(0,s.default)(a,d.SDK_TYPE.NETCALL,1),(0,s.default)(a,d.SDK_TYPE.WEBRTC,1),(0,s.default)(a,d.SDK_TYPE.WEBRTC2,1),(0,s.default)(a,d.SDK_TYPE.NRTC,1),(0,s.default)(a,d.SDK_TYPE.WHITEBOARD,0),a),d.STATS_RTC=(n={},(0,s.default)(n,d.SDK_TYPE.WEBRTC,1),(0,s.default)(n,d.SDK_TYPE.WEBRTC2,1),(0,s.default)(n,d.SDK_TYPE.NRTC,1),(0,s.default)(n,d.SDK_TYPE.WHITEBOARD,0),n),t.CONFIG_MAP=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CONTROL_TYPE={NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_ON:1,NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_OFF:2,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_ON:3,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_OFF:4,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO:5,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_AGREE:6,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_REJECT:7,NETCALL_CONTROL_COMMAND_SWITCH_VIDEO_TO_AUDIO:8,NETCALL_CONTROL_COMMAND_BUSY:9,NETCALL_CONTROL_COMMAND_SELF_CAMERA_INVALID:10,NETCALL_CONTROL_COMMAND_SELF_ON_BACKGROUND:11,NETCALL_CONTROL_COMMAND_START_NOTIFY_RECEIVED:12,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_START:13,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_STOP:14,NETCALL_CONTROL_COMMAND_SELF_AUDIO_INVALID:16}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ENCRYPTION_ALGORITHM_MODE={ENCRYPTION_ALGORITHM_NONE:0,ENCRYPTION_ALGORITHM_RSA:1,ENCRYPTION_ALGORITHM_AES_128_ECB:2,ENCRYPTION_ALGORITHM_AES_256_CBC:3,ENCRYPTION_ALGORITHM_AES_256_CTR:4,ENCRYPTION_ALGORITHM_AES_128_XTS:5,ENCRYPTION_ALGORITHM_AES_256_XTS:6}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_FRAME_RATE_REV=t.VIDEO_FRAME_RATE=void 0;var i,a,n=r(94),o=(i=n)&&i.__esModule?i:{default:i};t.validateVideoFrameRate=function(e){var t=Object.keys(s),r=!1;for(var i in t)s[i]===e&&(r=!0);return r};var s=t.VIDEO_FRAME_RATE={CHAT_VIDEO_FRAME_RATE_NORMAL:0,CHAT_VIDEO_FRAME_RATE_5:1,CHAT_VIDEO_FRAME_RATE_10:2,CHAT_VIDEO_FRAME_RATE_15:3,CHAT_VIDEO_FRAME_RATE_20:4,CHAT_VIDEO_FRAME_RATE_25:5};t.VIDEO_FRAME_RATE_REV=(a={},(0,o.default)(a,s.CHAT_VIDEO_FRAME_RATE_NORMAL,15),(0,o.default)(a,s.CHAT_VIDEO_FRAME_RATE_5,5),(0,o.default)(a,s.CHAT_VIDEO_FRAME_RATE_10,10),(0,o.default)(a,s.CHAT_VIDEO_FRAME_RATE_15,15),(0,o.default)(a,s.CHAT_VIDEO_FRAME_RATE_20,20),(0,o.default)(a,s.CHAT_VIDEO_FRAME_RATE_25,25),a)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_QUALITY_REV=t.VIDEO_QUALITY=void 0;var i,a,n=r(94),o=(i=n)&&i.__esModule?i:{default:i};t.validateVideoQuality=function(e){var t=Object.keys(s),r=!1;for(var i in t)s[i]===e&&(r=!0);return r};var s=t.VIDEO_QUALITY={CHAT_VIDEO_QUALITY_NORMAL:0,CHAT_VIDEO_QUALITY_LOW:1,CHAT_VIDEO_QUALITY_MEDIUM:2,CHAT_VIDEO_QUALITY_HIGH:3,CHAT_VIDEO_QUALITY_480P:4,CHAT_VIDEO_QUALITY_540P:5,CHAT_VIDEO_QUALITY_720P:6,CHAT_VIDEO_QUALITY_1080P:7,VIDEO_QUALITY_180p:2,VIDEO_QUALITY_360p:4,VIDEO_QUALITY_720p:8,VIDEO_QUALITY_1080p:16};t.VIDEO_QUALITY_REV=(a={},(0,o.default)(a,s.CHAT_VIDEO_QUALITY_NORMAL,"640x480"),(0,o.default)(a,s.CHAT_VIDEO_QUALITY_LOW,"176x144"),(0,o.default)(a,s.CHAT_VIDEO_QUALITY_MEDIUM,"352x288"),(0,o.default)(a,s.CHAT_VIDEO_QUALITY_HIGH,"480x360"),(0,o.default)(a,s.CHAT_VIDEO_QUALITY_480P,"640x480"),(0,o.default)(a,s.CHAT_VIDEO_QUALITY_540P,"960x540"),(0,o.default)(a,s.CHAT_VIDEO_QUALITY_720P,"1280x720"),(0,o.default)(a,s.CHAT_VIDEO_QUALITY_1080P,"1920x1080"),a)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_SESSION_CONFIG=t.DEFAULT_SESSION_CONFIG_P2P=t.DEFAULT_SESSION_CONFIG_P2P_PCAGENT=t.DEFAULT_SESSION_CONFIG_MEETING=t.DEFAULT_SESSION_CONFIG_MEETING_PCAGENT=t.DEFAULT_SESSION_CONFIG_LIVE=t.DEFAULT_SESSION_CONFIG_LIVE_PCAGENT=void 0;var i=r(205),a=r(142);t.DEFAULT_SESSION_CONFIG_LIVE_PCAGENT=new i.SessionConfig4Live({videoQuality:a.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL,videoFrameRate:a.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,highAudio:!1,recordType:0,isHostSpeaker:0,rtmpUrl:"",splitMode:a.SPLIT_MODE.LAYOUT_SPLITBOTTOMHORFLOATING,layout:"",videoBitrate:1e5,videoEncodeMode:a.VIDEO_ENCODE_MODE.CHAT_VIDEO_ENCODEMODE_NORMAL}),t.DEFAULT_SESSION_CONFIG_LIVE=new i.SessionConfig4Live({videoQuality:a.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL,videoFrameRate:a.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,highAudio:!1,rtmpUrl:"",splitMode:a.SPLIT_MODE.LAYOUT_SPLITBOTTOMHORFLOATING,layout:""}),t.DEFAULT_SESSION_CONFIG_MEETING_PCAGENT=new i.SessionConfig4Meeting({videoQuality:a.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL,videoFrameRate:a.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,highAudio:!1,isHostSpeaker:!1,recordType:0,videoBitrate:1e5,videoEncodeMode:a.VIDEO_ENCODE_MODE.CHAT_VIDEO_ENCODEMODE_NORMAL}),t.DEFAULT_SESSION_CONFIG_MEETING=new i.SessionConfig4Meeting({videoQuality:a.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL,videoFrameRate:a.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,highAudio:!1,liveEnable:!1}),t.DEFAULT_SESSION_CONFIG_P2P_PCAGENT=new i.SessionConfig4P2P({videoQuality:a.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL,videoFrameRate:a.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,highAudio:!1,recordVideo:!1,recordAudio:!1,singleRecord:!1,isHostSpeaker:!1,recordType:0,videoBitrate:1e5,videoEncodeMode:a.VIDEO_ENCODE_MODE.CHAT_VIDEO_ENCODEMODE_NORMAL}),t.DEFAULT_SESSION_CONFIG_P2P=new i.SessionConfig4P2P({videoQuality:a.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL,videoFrameRate:a.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,highAudio:!1,recordVideo:!1,recordAudio:!1,singleRecord:!1,isHostSpeaker:!1,recordType:"0",liveEnabled:!1}),t.DEFAULT_SESSION_CONFIG=new i.SessionConfig({maxVideoQuality:a.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_720P,videoQuality:a.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL,videoFrameRate:a.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,highAudio:!1,recordVideo:!1,recordAudio:!1,singleRecord:!1,isHostSpeaker:!1,recordType:"0",liveEnabled:!1,rtmpRecord:!1,rtmpUrl:"",splitMode:a.SPLIT_MODE.LAYOUT_SPLITBOTTOMHORFLOATING,layout:""})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PushConfig=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.PushConfig=function e(t){(0,n.default)(this,e);var r=t.enable,i=t.needBadge,a=t.needPushNick,o=t.pushContent,s=t.custom,d=t.pushPayload,c=t.sound;this.enable=r,this.needBadge=i,this.needPushNick=a,this.pushContent=o,this.custom=s,this.pushPayload=d,this.sound=c}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(206);Object.defineProperty(t,"PushConfig",{enumerable:!0,get:function(){return i.PushConfig}}),Object.defineProperty(t,"SessionConfig",{enumerable:!0,get:function(){return i.SessionConfig}}),Object.defineProperty(t,"DEFAULT_PUSH_CONFIG",{enumerable:!0,get:function(){return i.DEFAULT_PUSH_CONFIG}}),Object.defineProperty(t,"DEFAULT_SESSION_CONFIG",{enumerable:!0,get:function(){return i.DEFAULT_SESSION_CONFIG}});var a=r(296);Object.defineProperty(t,"NetcallOption",{enumerable:!0,get:function(){return a.NetcallOption}}),Object.defineProperty(t,"WebRTCOption",{enumerable:!0,get:function(){return a.WebRTCOption}}),Object.defineProperty(t,"NRTCOption",{enumerable:!0,get:function(){return a.NRTCOption}}),Object.defineProperty(t,"DEFAULT_NETCALL_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_NETCALL_OPTION}}),Object.defineProperty(t,"DEFAULT_WEBRTC_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_WEBRTC_OPTION}}),Object.defineProperty(t,"DEFAULT_NRTC_OPTION",{enumerable:!0,get:function(){return a.DEFAULT_NRTC_OPTION}});var n=r(294);Object.defineProperty(t,"ApiParams",{enumerable:!0,get:function(){return n.ApiParams}});var o=r(142);Object.defineProperty(t,"VIDEO_QUALITY",{enumerable:!0,get:function(){return o.VIDEO_QUALITY}}),Object.defineProperty(t,"VIDEO_QUALITY_REV",{enumerable:!0,get:function(){return o.VIDEO_QUALITY_REV}}),Object.defineProperty(t,"validateVideoQuality",{enumerable:!0,get:function(){return o.validateVideoQuality}}),Object.defineProperty(t,"VIDEO_FRAME_RATE",{enumerable:!0,get:function(){return o.VIDEO_FRAME_RATE}}),Object.defineProperty(t,"VIDEO_FRAME_RATE_REV",{enumerable:!0,get:function(){return o.VIDEO_FRAME_RATE_REV}}),Object.defineProperty(t,"validateVideoFrameRate",{enumerable:!0,get:function(){return o.validateVideoFrameRate}}),Object.defineProperty(t,"ENCRYPTION_ALGORITHM_MODE",{enumerable:!0,get:function(){return o.ENCRYPTION_ALGORITHM_MODE}}),Object.defineProperty(t,"CONTROL_TYPE",{enumerable:!0,get:function(){return o.CONTROL_TYPE}}),Object.defineProperty(t,"CONFIG_MAP",{enumerable:!0,get:function(){return o.CONFIG_MAP}}),Object.defineProperty(t,"DECTECT_RESULT_TYPE",{enumerable:!0,get:function(){return o.DECTECT_RESULT_TYPE}}),Object.defineProperty(t,"DECTECT_TYPE",{enumerable:!0,get:function(){return o.DECTECT_TYPE}}),Object.defineProperty(t,"DEVICE_TYPE",{enumerable:!0,get:function(){return o.DEVICE_TYPE}}),Object.defineProperty(t,"DEVICE_TYPE_REV",{enumerable:!0,get:function(){return o.DEVICE_TYPE_REV}}),Object.defineProperty(t,"NETCALL_TYPE",{enumerable:!0,get:function(){return o.NETCALL_TYPE}}),Object.defineProperty(t,"SCALE_TYPE",{enumerable:!0,get:function(){return o.SCALE_TYPE}}),Object.defineProperty(t,"SPLIT_MODE",{enumerable:!0,get:function(){return o.SPLIT_MODE}}),Object.defineProperty(t,"MIX_VIDEO_MODE",{enumerable:!0,get:function(){return o.MIX_VIDEO_MODE}}),Object.defineProperty(t,"NIM_SIGNALING",{enumerable:!0,get:function(){return o.NIM_SIGNALING}}),Object.defineProperty(t,"VIDEO_ENCODE_MODE",{enumerable:!0,get:function(){return o.VIDEO_ENCODE_MODE}}),Object.defineProperty(t,"ROLE_FOR_MEETING",{enumerable:!0,get:function(){return o.ROLE_FOR_MEETING}}),Object.defineProperty(t,"SESSION_MODE",{enumerable:!0,get:function(){return o.SESSION_MODE}});var s=r(282);Object.defineProperty(t,"GATE_WAY_RESPONSE_CODE",{enumerable:!0,get:function(){return s.GATE_WAY_RESPONSE_CODE}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EVENT_CODE={USER_LEFT_REASON:{quit:{name:"USER_LEFT_QUIT",code:0,desc:"用户主动离开"},timeout:{name:"USER_LEFT_TIMEOUT",code:1,desc:"因长时间收不到对方数据包，超时掉线"}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EVENT_OBJ={error:{key:"error",label:"异常事件"},beCalling:{key:"beCalling",label:"收到呼叫通知"},callAccepted:{key:"callAccepted",label:"主叫收到被叫应答通知: 接受"},callRejected:{key:"callRejected",label:"主叫收到被叫应答通知: 拒绝"},control:{key:"control",label:"通话进行中收到对端的控制通知"},hangup:{key:"hangup",label:"收到挂断通知"},callerAckSync:{key:"callerAckSync",label:"其他端已处理的通知"},joinChannel:{key:"joinChannel",label:"收到自己加入频道的通知"},leaveChannel:{key:"leaveChannel",label:"收到自己离开频道的通知"},userJoined:{key:"userJoined",label:"收到用户加入频道的通知"},userLeft:{key:"userLeft",label:"收到用户离开频道的通知"},sessionDuration:{key:"sessionDuration",label:"通话计时"},audioVolume:{key:"audioVolume",label:"当前所有参与通话者的音量大小实时回调通知"},deviceAdd:{key:"deviceAdd",label:"新增设备的通知"},deviceRemove:{key:"deviceRemove",label:"设备移除通知"},deviceStatus:{key:"deviceStatus",label:"设备状态变化通知"},streamEnded:{key:"streamEnded",label:"媒体流停止通知"},remoteTrack:{key:"remoteTrack",label:"收到用户媒体流的通知"},addTrack:{key:"addTrack",label:"添加轨道事件"},removeTrack:{key:"removeTrack",label:"删除轨道事件"},remoteSignalClosed:{key:"remoteSignalClosed",label:"远端信令已关闭"},sessionConnected:{key:"sessionConnected",label:"会话已连接"},recordStopped:{key:"recordStopped",label:"录制已结束"},gatewayClosed:{key:"gatewayClosed",label:"网关连接断开"},userStateUpdated:{key:"userUpdated",label:"远端状态更新"},auidoMixingEnd:{key:"auidoMixingEnd",label:"伴音文件播放完成"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(317);Object.defineProperty(t,"EVENT_OBJ",{enumerable:!0,get:function(){return i.EVENT_OBJ}});var a=r(316);Object.defineProperty(t,"EVENT_CODE",{enumerable:!0,get:function(){return a.EVENT_CODE}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=r(100),n=(i=a)&&i.__esModule?i:{default:i};t.default={logger:console,peer:null,isSupportGetRecvivers:!1,isSupportVp8Only:function(){var e=this;return new Promise(function(t,r){e.getSdp().then(function(r){return"firefox"!==n.default.browser.ua&&e.peer.getReceivers&&("chrome"===n.default.browser.ua?n.default.browser.version>=72&&(e.isSupportGetRecvivers=!0):e.isSupportGetRecvivers=!0),e.peer.close(),e.peer=null,"weixin"===n.default.browser.ua||navigator.userAgent.indexOf("HUAWEI M2")>0?t({vp8:!0,h264:!1}):/vp8/.test(r.sdp.toLowerCase())?/h264/.test(r.sdp.toLowerCase())?t({vp8:!0,h264:!0}):t({vp8:!0,h264:!1}):/h264/.test(r.sdp.toLowerCase())?t({vp8:!1,h264:!0}):t({vp8:!1,h264:!1})}).catch(function(r){return console.error("webrtcUtil 发送错误 err: ",r),e.peer.close(),e.peer=null,t({})})})},getSdp:function(){if(this.peer=new RTCPeerConnection,"safari"===n.default.browser.ua)return this.peer.addTransceiver("video",{direction:"recvonly"}),this.peer.createOffer();return this.peer.createOffer({offerToReceiveVideo:1})}},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=r(194),n=(i=a)&&i.__esModule?i:{default:i};var o=/^ssrc_/i,s=/^(bweforvideo|Conn-audio-1-0|Conn-0-1-0|ssrc_)/i,d=/ssrc_(\d+)_send/i,c=/ssrc_(\d+)_recv/i,u=/^outbound_/i,l=/^inbound_/i,p=/^remote/i,f={googAvailableSendBandwidth:1,googTargetEncBitrate:1,googActualEncBitrate:1,googRetransmitBitrate:1,googTransmitBitrate:1},h={googCaptureStartNtpTimeMs:1};t.default={getStats:function(e){var t=this;if(e&&!/(failed|closed)/gi.test(e.iceConnectionState))return navigator.mozGetUserMedia?this.getStatsFirefox(e):/^((?!chrome).)*safari((?!chrome).)*$/gi.test(navigator.userAgent)?this.getStatsSafari(e):new Promise(function(r,i){e.getStats(function(i){var a={};i.result().forEach(function(e){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,a[t.id]=t}),e.lastStats=e.lastStats||{},a=t.format(e,a),r(a)})})},getStatsFirefox:function(e){var t=this;return e.getStats(null).then(function(r){return e.lastStats=e.lastStats||{},r=t.format(e,r),Promise.resolve(r)})},getStatsSafari:function(e){var t=this;return e.getStats().then(function(r){return e.lastStats=e.lastStats||{},r=t._formatSSRC_S(e,r),Promise.resolve(r)})},format:function(e,t){return!e||/(failed|closed)/gi.test(e.iceConnectionState)?{}:t=parseInt(e.uid)-parseInt(e.targetUid)==0?this.ssrcLocal(e,t):this.ssrcRemote(e,t)},formatSSRC:function(e,t,r,i){return this[navigator.mozGetUserMedia?"_formatSSRC_F":"_formatSSRC_G"](e,t,r,i)},_formatSSRC_G:function(e,t,r,i){var a=this,n={};return Object.values(t).forEach(function(t){if(("recv"!==i||o.test(t.id))&&("send"!==i||s.test(t.id))){t=a.formatData(t);var r=("send"===i?d:c).exec(t.id),u=t.id;n[u]=t,r&&r[1]&&("recv"!==i||0!==e.uid?(t.id="ssrc_"+e.uid+"_"+i+"_"+("recv"===i?e.targetUid:0)+"_"+t.mediaType,-1==(t=a.computeData(e,t)).googInterframeDelayMax&&(t.googInterframeDelayMax=0),n[t.id]=t,delete n[u]):delete n[u])}}),n},_formatSSRC_F:function(e,t,r,i){var a=this,o={},s="send"===i?u:l;return(t.values?[].concat((0,n.default)(t.values())):Object.values(t)).map(function(t){if(s.test(t.id)){var r=p.test(t.type),n="ssrc_"+e.uid+"_"+(r?"recv":"send")+"_"+("recv"===i?e.targetUid:0)+"_"+t.mediaType;t=a.computeData(e,t),o[n]=t}}),o},_formatSSRC_S:function(e,t){var r=this,i={},a=null;return t.forEach(function(t){if("inbound-rtp"===t.type||"inboundrtp"===t.type){if(-1!=t.id.indexOf("Video")){t=r.computeData(e,t);var n="ssrc_"+(e.uid||"123456")+"_recv_"+(0|e.targetUid)+"_video";a=n,i[n]={},i[n].bitsReceivedPerSecond=t.bitsReceivedPerSecond||0,i[n].bytesReceived=t.bytesReceived||0,i[n].packetsLost=t.packetsLost||0,i[n].packetsReceived=t.packetsReceived||0,i[n].packetsReceivedPerSecond=t.packetsReceivedPerSecond||0,i[n].framesDecoded=t.framesDecoded||0,i[n].googFrameRateOutput=t.framesDecoded||0}}else if("outbound-rtp"===t.type||"outboundrtp"===t.type){if(-1!=t.id.indexOf("Video")){t=r.computeData(e,t);var o="ssrc_"+(e.uid||"123456")+"_send_0_video";i[o]={},i[o].bitsSentPerSecond=t.bitsSentPerSecond||0,i[o].bytesSent=t.bytesSent||0,i[o].packetsLost=t.packetsLost||0,i[o].packetsSent=t.packetsSent||0,i[o].packetsSentPerSecond=t.packetsSentPerSecond||0,i[o].framesEncoded=t.framesEncoded||0,i[o].googFrameRateSent=t.framesEncoded||0}}else"track"===t.type&&(i.track=t)}),i.track&&a&&(i[a].googFrameHeightReceived=i.track.frameHeight,i[a].googFrameWidthReceived=i.track.frameWidth),i},formatData:function(e){return Object.keys(e).map(function(t){f[t]&&(e[t]=(e[t]/1024).toFixed(2)),h[t]&&(e[t]=(e[t]/1024/1024).toFixed(2))}),e},computeData:function(e,t){var r={peer:e,ssrcKey:t.ssrc,currentItem:t};return t.bytesSent&&(t.bitsSentPerSecond=this.getLastStats(Object.assign({},r,{valueKey:"bytesSent"}))),t.packetsSent&&(t.packetsSentPerSecond=this.getLastStats(Object.assign({},r,{valueKey:"packetsSent"}))),t.bytesReceived&&(t.bitsReceivedPerSecond=this.getLastStats(Object.assign({},r,{valueKey:"bytesReceived"}))),t.packetsReceived&&(t.packetsReceivedPerSecond=this.getLastStats(Object.assign({},r,{valueKey:"packetsReceived"}))),t},ssrcLocal:function(e,t){if(e&&e.localDescription){var r=e.localDescription;return this.formatSSRC(e,t,r.sdp,"send")}},ssrcRemote:function(e,t){if(e&&e.remoteDescription){var r=e.remoteDescription;return this.formatSSRC(e,t,r.sdp,"recv")}},getLastStats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer,r=e.ssrcKey,i=e.valueKey,a=e.currentItem,n=0;if(t.lastStats[r]&&t.lastStats[r][i]){if(!(a[i]-t.lastStats[r][i]>0))return n;n=a[i]-t.lastStats[r][i]}else t.lastStats[r]||(t.lastStats[r]={}),n=a[i];return n=/bytes/gi.test(i)?Math.round(8*n/200):n,t.lastStats[r][i]=a[i],n}},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(r(98)),a=l(r(97)),n=l(r(1)),o=l(r(2)),s=l(r(4)),d=l(r(3)),c=r(12),u=l(r(320));function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,n.default)(this,t);var r=(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.webrtcBusiness=e.webrtcBusiness||null,r.interval=e.interval||1e3,r}return(0,d.default)(t,e),(0,o.default)(t,[{key:"reset",value:function(){this.times=0,this.timer&&clearInterval(this.timer),this.timer=null,this.webrtcBusiness=null}},{key:"start",value:function(){this.timer||(this.timer=setInterval(this.getStats.bind(this),this.interval))}},{key:"stop",value:function(){this.reset()}},{key:"getStats",value:function(){var e=(0,a.default)(i.default.mark(function e(){var t,r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webrtcBusiness&&this.webrtcBusiness.selfWebRtcInstance&&this.webrtcBusiness.selfWebRtcInstance.rtcConnection,r=this.webrtcBusiness&&this.webrtcBusiness.remoteWebRtcInstanceMap&&Object.keys(this.webrtcBusiness.remoteWebRtcInstanceMap).length>0&&Object.values(this.webrtcBusiness.remoteWebRtcInstanceMap)[0].rtcConnection,t||r){e.next=4;break}return e.abrupt("return");case 4:if(!this.webrtcBusiness.adapterRef.imInfo||!this.webrtcBusiness.adapterRef.imInfo.netDetect||this.webrtcBusiness.adapterRef.instance._isDetectNetwork()){e.next=6;break}return e.abrupt("return");case 6:return a={},e.next=9,this.getLocalStats();case 9:return a.self=e.sent,e.next=12,this.getRemoteStats();case 12:a.other=e.sent;try{Object.keys(a.other).map(function(e){a.self=Object.assign({},a.self,a.other[e])})}catch(e){console.warn(e)}this.times=(this.times||0)+1,this.emit("stats",a.self,this.times);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getLocalStats",value:function(){var e=(0,a.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.webrtcBusiness)&&t.selfWebRtcInstance){e.next=3;break}return e.abrupt("return",{});case 3:return e.next=5,u.default.getStats(t.selfWebRtcInstance.rtcConnection);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getRemoteStats",value:function(){var e=(0,a.default)(i.default.mark(function e(){var t,r,n,o,s,d,c,l,p,f,h=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.webrtcBusiness)&&t.remoteWebRtcInstanceMap){e.next=3;break}return e.abrupt("return",{});case 3:r={},n=t.remoteWebRtcInstanceMap,o=Object.keys(n).map(function(){var e=(0,a.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n[t]||!n[t].rtcConnection){e.next=5;break}return e.next=3,u.default.getStats(n[t].rtcConnection);case 3:return r[t]=e.sent,e.abrupt("return",r[t]);case 5:case"end":return e.stop()}},e,h)}));return function(t){return e.apply(this,arguments)}}()),s=!0,d=!1,c=void 0,e.prev=9,l=o[Symbol.iterator]();case 11:if(s=(p=l.next()).done){e.next=18;break}return f=p.value,e.next=15,f;case 15:s=!0,e.next=11;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(9),d=!0,c=e.t0;case 24:e.prev=24,e.prev=25,!s&&l.return&&l.return();case 27:if(e.prev=27,!d){e.next=30;break}throw c;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.abrupt("return",r);case 33:case"end":return e.stop()}},e,this,[[9,20,24,32],[25,,27,31]])}));return function(){return e.apply(this,arguments)}}()}]),t}(c.EventEmitter);t.default=p,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=r(151),n=(i=a)&&i.__esModule?i:{default:i};t.default={logger:console,randomSSRC:function(){var e=Math.floor(1e8*Math.random())+1e7;return e>1e8?99999999:e},_createLocalDescription:function(e,t){var r={},i=this._iceGatherer.getLocalParameters(),a=this._iceGatherer.getLocalCandidates(),o=this._dtlsTransport.getLocalParameters(),s=this._dtlsTransport.getRemoteParameters(),d=this._localCapabilities,c=this._localTrackInfos;"offer"===t&&this._sdpGlobalFields.version++,r.version=0,r.origin={address:"127.0.0.1",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"jitsi-ortc-webrtc-shim"},r.name="-",r.timing={start:0,stop:0},r.msidSemantic={semantic:"WMS",token:"*"},r.groups=[{mids:Array.from(this._mids.keys()).join(" "),type:"BUNDLE"}],r.media=[],r.fingerprint={hash:o.fingerprints[0].value,type:o.fingerprints[0].algorithm};var u=!1,l=!0,p=!1,f=void 0;try{for(var h,m=d.codecs[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var g=h.value;if("video"===g.kind&&"rtx"===g.name){u=!0;break}}}catch(e){p=!0,f=e}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}var v=!0,R=!1,_=void 0;try{for(var y,C=this._mids[Symbol.iterator]();!(v=(y=C.next()).done);v=!0){var b=y.value,E=(0,n.default)(b,2),S=E[0],T=E[1];A.call(this,S,T)}}catch(e){R=!0,_=e}finally{try{!v&&C.return&&C.return()}finally{if(R)throw _}}return new RTCSessionDescription({type:t,_sdpObject:r});function A(e,n){var o={};switch(o.type=n,n){case"audio":case"video":o.protocol="RTP/SAVPF",o.port=9,o.direction="sendrecv";break;case"application":o.protocol="DTLS/SCTP",o.port=0,o.payloads="0",o.direction="inactive"}o.connection={ip:"127.0.0.1",version:4},o.mid=e,o.iceUfrag=i.usernameFragment,o.icePwd=i.password,o.candidates=[];var l=!0,p=!1,f=void 0;try{for(var h,m=a[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var g=h.value,v={component:1};v.foundation=g.foundation,v.ip=g.ip,v.port=g.port,v.priority=g.priority,v.transport=g.protocol.toLowerCase(),v.type=g.type,"tcp"===v.transport&&(v.tcptype=g.tcpType),o.candidates.push(v)}}catch(e){p=!0,f=e}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}if(o.endOfCandidates="end-of-candidates",o.setup="offer"===t?"actpass":"server"===s.role?"active":"passive","audio"===n||"video"===n){o.rtp=[],o.rtcpFb=[],o.fmtp=[];var R=[],_=!0,y=!1,C=void 0;try{for(var b,E=d.codecs[Symbol.iterator]();!(_=(b=E.next()).done);_=!0){var S=b.value;if(!S.kind||S.kind===n){R.push(S.preferredPayloadType);var T={codec:S.name,payload:S.preferredPayloadType,rate:S.clockRate};if(S.numChannels>1&&(T.encoding=S.numChannels),o.rtp.push(T),S.parameters){var A={config:"",payload:S.preferredPayloadType},O=!0,k=!1,P=void 0;try{for(var I,D=Object.keys(S.parameters)[Symbol.iterator]();!(O=(I=D.next()).done);O=!0){var w=I.value;A.config&&(A.config+=";"),A.config+=w+"="+S.parameters[w]}}catch(e){k=!0,P=e}finally{try{!O&&D.return&&D.return()}finally{if(k)throw P}}A.config&&o.fmtp.push(A)}var M=!0,W=!1,x=void 0;try{for(var N,L=(S.rtcpFeedback||[])[Symbol.iterator]();!(M=(N=L.next()).done);M=!0){var V=N.value;o.rtcpFb.push({payload:S.preferredPayloadType,subtype:V.parameter||void 0,type:V.type})}}catch(e){W=!0,x=e}finally{try{!M&&L.return&&L.return()}finally{if(W)throw x}}}}}catch(e){y=!0,C=e}finally{try{!_&&E.return&&E.return()}finally{if(y)throw C}}0===R.length?(o.payloads="9",o.port=0,o.direction="inactive"):o.payloads=R.join(" "),o.ssrcs=[],o.ssrcGroups=[];var B=!0,U=!1,j=void 0;try{for(var F,H=c.values()[Symbol.iterator]();!(B=(F=H.next()).done);B=!0){var G=F.value,Y=G.rtpSender,J=G.stream.id,K=Y.track;if("ended"!==K.readyState&&K.kind===n){G.ssrc||(G.ssrc=this.randomSSRC());var z=u&&"video"===K.kind;z&&!G.rtxSsrc&&(G.rtxSsrc=G.ssrc+1),o.ssrcs.push({attribute:"cname",id:G.ssrc,value:CNAME}),o.ssrcs.push({attribute:"msid",id:G.ssrc,value:J+" "+K.id}),o.ssrcs.push({attribute:"mslabel",id:G.ssrc,value:J}),o.ssrcs.push({attribute:"label",id:G.ssrc,value:K.id}),z&&(o.ssrcs.push({attribute:"cname",id:G.rtxSsrc,value:CNAME}),o.ssrcs.push({attribute:"msid",id:G.rtxSsrc,value:J+" "+K.id}),o.ssrcs.push({attribute:"mslabel",id:G.rtxSsrc,value:J}),o.ssrcs.push({attribute:"label",id:G.rtxSsrc,value:K.id}),o.ssrcGroups.push({semantics:"FID",ssrcs:G.ssrc+" "+G.rtxSsrc}))}}}catch(e){U=!0,j=e}finally{try{!B&&H.return&&H.return()}finally{if(U)throw j}}o.ext=[];var q=!0,Q=!1,$=void 0;try{for(var X,Z=d.headerExtensions[Symbol.iterator]();!(q=(X=Z.next()).done);q=!0){var ee=X.value;ee.kind&&ee.kind!==n||o.ext.push({value:ee.preferredId,uri:ee.uri})}}catch(e){Q=!0,$=e}finally{try{!q&&Z.return&&Z.return()}finally{if(Q)throw $}}o.rtcpMux="rtcp-mux",o.rtcpRsize="rtcp-rsize"}r.media.push(o)}},mergeConstraints:function(e,t){if(!e||!t)return e||t;var r=e;for(var i in t)r[i]=t[i];return r},iceCandidateType:function(e){return e.split(" ")[7]},formatTypePreference:function(e){if(/Chrome\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TLS";case 1:return"TURN/TCP";case 2:return"TURN/UDP"}else if(/Firefox\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TCP";case 5:return"TURN/UDP"}return""},maybeSetOpusOptions:function(e,t){return"true"===t.opusStereo?e=this.setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=this.removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=this.setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=this.removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=this.setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=this.removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=this.setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},maybeSetAudioSendBitRate:function(e,t){return t.audioSendBitrate?(this.logger.log("Prefer audio send bitrate: "+t.audioSendBitrate),this.preferBitRate(e,t.audioSendBitrate,"audio")):e},maybeSetAudioReceiveBitRate:function(e,t){return t.audioRecvBitrate?(this.logger.log("SDPUtil:maybeSetAudioReceiveBitRate Prefer audio receive bitrate: "+t.audioRecvBitrate),this.preferBitRate(e,t.audioRecvBitrate,"audio")):e},maybeSetVideoSendBitRate:function(e,t){return t.videoSendBitrate?(this.logger.log("SDPUtil:maybeSetVideoSendBitRate video send bitrate: "+t.videoSendBitrate),this.preferBitRate(e,t.videoSendBitrate,"video")):e},maybeSetVideoReceiveBitRate:function(e,t){return t.videoRecvBitrate?(this.logger.log("SDPUtil:maybeSetVideoReceiveBitRate video receive bitrate: "+t.videoRecvBitrate),this.preferBitRate(e,t.videoRecvBitrate,"video")):e},preferBitRate:function(e,t,r){var i=e.split("\r\n"),a=this.findLine(i,"m=",r);if(null===a)return this.logger.log("SDPUtil:preferBitRate Failed to add bandwidth line to sdp, as no m-line found"),e;var n=this.findLineInRange(i,a+1,-1,"m=");null===n&&(n=i.length);var o=this.findLineInRange(i,a+1,n,"c=");if(null===o)return this.logger.log("SDPUtil:preferBitRate Failed to add bandwidth line to sdp, as no c-line found"),e;var s=this.findLineInRange(i,o+1,n,"b=AS");s&&i.splice(s,1);var d="b=AS:"+t;return i.splice(o+1,0,d),e=i.join("\r\n")},maybeSetVideoSendInitialBitRate:function(e,t){var r=t.videoSendInitialBitrate;if(!r)return e;var i=r,a=t.videoSendBitrate;a&&(r>a&&(this.logger.log("SDPUtil:maybeSetVideoSendInitialBitRate Clamping initial bitrate to max bitrate of "+a+" kbps."),r=a,t.videoSendInitialBitrate=r),i=a);var n=e.split("\r\n");if(null===this.findLine(n,"m=","video"))return this.logger.log("SDPUtil:maybeSetVideoSendInitialBitRate Failed to find video m-line"),e;var o=t.videoRecvCodec;return e=this.setCodecParam(e,o,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=this.setCodecParam(e,o,"x-google-max-bitrate",i.toString())},removePayloadTypeFromMline:function(e,t){e=e.split(" ");for(var r=0;r<e.length;++r)e[r]===t.toString()&&e.splice(r,1);return e.join(" ")},removeCodecByName:function(e,t){var r=this.findLine(e,"a=rtpmap",t);if(null===r)return e;var i=this.getCodecPayloadTypeFromLine(e[r]);e.splice(r,1);var a=this.findLine(e,"m=","video");return null===a?e:(e[a]=this.removePayloadTypeFromMline(e[a],i),e)},removeCodecByPayloadType:function(e,t){var r=this.findLine(e,"a=rtpmap",t.toString());if(null===r)return e;e.splice(r,1);var i=this.findLine(e,"m=","video");return null===i?e:(e[i]=this.removePayloadTypeFromMline(e[i],t),e)},maybeRemoveVideoFec:function(e,t){if("false"!==t.videoFec)return e;var r=e.split("\r\n"),i=this.findLine(r,"a=rtpmap","red");if(null===i)return e;var a=this.getCodecPayloadTypeFromLine(r[i]);if(r=this.removeCodecByPayloadType(r,a),r=this.removeCodecByName(r,"ulpfec"),null===(i=this.findLine(r,"a=fmtp",a.toString())))return e;var n=this.parseFmtpLine(r[i]).pt;return null===n?e:(r.splice(i,1),(r=this.removeCodecByPayloadType(r,n)).join("\r\n"))},maybePreferAudioSendCodec:function(e,t){return this.maybePreferCodec(e,"audio","send",t.audioSendCodec)},maybePreferAudioReceiveCodec:function(e,t){return this.maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},maybePreferVideoSendCodec:function(e,t){return this.maybePreferCodec(e,"video","send",t.videoSendCodec)},maybePreferVideoReceiveCodec:function(e,t){return this.maybePreferCodec(e,"video","receive",t.videoRecvCodec)},maybePreferCodec:function(e,t,r,i){var a=t+" "+r+" codec";if(!i)return this.logger.log("SDPUtil:maybePreferCodec No preference on "+a+"."),e;this.logger.log("SDPUtil:maybePreferCodec Prefer "+a+": "+i);var n=e.split("\r\n"),o=this.findLine(n,"m=",t);if(null===o)return e;var s=this.getCodecPayloadType(n,i);return s?n[o]=this.setDefaultCodec(n[o],s):this.logger.log("SDPUtil:maybePreferCodec no prefered codec found for ",i),e=n.join("\r\n")},setCodecParam:function(e,t,r,i){var a=e.split("\r\n"),n=this.findFmtpLine(a,t),o={};if(null===n){var s=this.findLine(a,"a=rtpmap",t);if(null===s)return e;var d=this.getCodecPayloadTypeFromLine(a[s]);o.pt=d.toString(),o.params={},o.params[r]=i,a.splice(s+1,0,this.writeFmtpLine(o))}else(o=this.parseFmtpLine(a[n])).params[r]=i,a[n]=this.writeFmtpLine(o);return e=a.join("\r\n")},removeCodecParam:function(e,t,r){var i=e.split("\r\n"),a=this.findFmtpLine(i,t);if(null===a)return e;var n=this.parseFmtpLine(i[a]);delete n.params[r];var o=this.writeFmtpLine(n);return null===o?i.splice(a,1):i[a]=o,e=i.join("\r\n")},parseFmtpLine:function(e){var t={},r=e.indexOf(" "),i=e.substring(r+1).split("; "),a=new RegExp("a=fmtp:(\\d+)"),n=e.match(a);if(!n||2!==n.length)return null;t.pt=n[1];for(var o={},s=0;s<i.length;++s){var d=i[s].split("=");2===d.length&&(o[d[0]]=d[1])}return t.params=o,t},writeFmtpLine:function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,r=e.params,i=[],a=0;for(var n in r)i[a]=n+"="+r[n],++a;return 0===a?null:"a=fmtp:"+t.toString()+" "+i.join("; ")},findFmtpLine:function(e,t){var r=this.getCodecPayloadType(e,t);return r?this.findLine(e,"a=fmtp:"+r.toString()):null},findLine:function(e,t,r){return this.findLineInRange(e,0,-1,t,r)},findLineInRange:function(e,t,r,i,a){for(var n=-1!==r?r:e.length,o=t;o<n;++o)if(0===e[o].indexOf(i)&&(!a||-1!==e[o].toLowerCase().indexOf(a.toLowerCase())))return o;return null},getCodecPayloadType:function(e,t){var r=this.findLine(e,"a=rtpmap",t);return r?this.getCodecPayloadTypeFromLine(e[r]):null},getCodecPayloadTypeFromLine:function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null},setDefaultCodec:function(e,t){var r=e.split(" "),i=r.slice(0,3);i.push(t);for(var a=3;a<r.length;a++)r[a]!==t&&i.push(r[a]);return i.join(" ")}},e.exports=t.default},function(e,t,r){var i=r(207),a=/%[sdv%]/g,n=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var o=t.names[n];t.name?i.push(r[t.name][o]):i.push(r[t.names[n]])}else i.push(r[t.name]);return function(e){var t=1,r=arguments,i=r.length;return e.replace(a,function(e){if(t>=i)return e;var a=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return""}})}.apply(null,i)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||o,a=t.innerOrder||s,d=[];return r.forEach(function(t){i[t].forEach(function(r){r.name in e&&null!=e[r.name]?d.push(n(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){d.push(n(t,r,e))})})}),e.media.forEach(function(e){d.push(n("m",i.m[0],e)),a.forEach(function(t){i[t].forEach(function(r){r.name in e&&null!=e[r.name]?d.push(n(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){d.push(n(t,r,e))})})})}),d.join("\r\n")+"\r\n"}},function(e,t,r){var i=function(e){return String(Number(e))===e?Number(e):e},a=function(e,t,r){var a=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:a&&!t[e.name]&&(t[e.name]={});var n=e.push?{}:a?t[e.name]:t;!function(e,t,r,a){if(a&&!r)t[a]=i(e[1]);else for(var n=0;n<r.length;n+=1)null!=e[n+1]&&(t[r[n]]=i(e[n+1]))}(r.match(e.reg),n,e.names,e.name),e.push&&t[e.push].push(n)},n=r(207),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach(function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),i=r[r.length-1]);for(var s=0;s<(n[t]||[]).length;s+=1){var d=n[t][s];if(d.reg.test(o))return a(d,i,o)}}),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=i(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(i),a=0;a<r.length;a+=3)t.push({component:r[a],ip:r[a+1],port:r[a+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(98)),a=n(r(97));function n(e){return e&&e.__esModule?e:{default:e}}t.default={getDevices:function(){var e=this;return(0,a.default)(i.default.mark(function t(){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=3;break}return e.abrupt("return",Promise.reject("your browser not support this feature, see https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"));case 3:return e.next=5,navigator.mediaDevices.enumerateDevices().then(function(e){0!==e.length&&(r={video:[],audioIn:[],audioOut:[]},e.forEach(function(e){"videoinput"===e.kind?r.video.push({deviceId:e.deviceId,label:e.label?e.label:"camera "+(r.video.length+1)}):"audioinput"===e.kind?r.audioIn.push({deviceId:e.deviceId,label:e.label?e.label:"microphone "+(r.audioIn.length+1)}):"audiooutput"===e.kind&&r.audioOut.push({deviceId:e.deviceId,label:e.label?e.label:"speaker "+(r.audioOut.length+1)})}))});case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}},t,e)}))()}},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(208)),a=n(r(100));function n(e){return e&&e.__esModule?e:{default:e}}var o=r(111),s=i.default.checkVersion(),d={};t.default={logger:console,fnShake:function(e){var t=this,r=e.fn,i=e.peer,a=void 0===i?{}:i;if(r){if(a)return a.id||(a.id=Object.keys(d).length+1),r="_"+r,d[a.id]||(d[a.id]={}),d[a.id]&&d[a.id][r]&&(this.logger.log("RtcUtil:fnShake destroy "+r+" timer"),clearTimeout(d[a.id][r]),d[a.id][r]=null),this.logger.log("RtcUtil:fnShake create "+r+" timer"),new Promise(function(i){d[a.id][r]=setTimeout(function(){d[a.id][r]=null,i(t[r](e))},200)});this.logger.error("RtcUtil:fnShake peer is null")}},createOffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fnShake({peer:e,fn:"createOffer"})},_createOffer:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).peer;if(e){this.logger.log("RtcUtil:_createOffer ------ do createoffer ------");var t={offerToReceiveVideo:1,offerToReceiveAudio:1};if(e.uid-e.targetUid!=0){var r=e.getLocalStreams&&e.getLocalStreams(),i=r&&r[0]&&r[0].getTracks()||!1;if("Safari"===s.prefix&&(!i||0===i.length))return"connected"==e.iceConnectionState||"completed"==e.iceConnectionState||(e.addTransceiver("audio",{direction:"recvonly"}),e.addTransceiver("video",{direction:"recvonly"})),e.createOffer()}return this.logger.log("RtcUtil:_createOffer iceConnectionState :",e.iceConnectionState),e.iceConnectionState&&"failed"==e.iceConnectionState?t.iceRestart=!0:"connected"!=e.iceConnectionState&&"completed"!=e.iceConnectionState&&"closed"!=e.iceConnectionState&&(t.iceRestart=!0),e.createOffer(t)}},formatOfferSdpForSafari:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sdp,r=(e.direction,o.parse(t));return r.media&&r.media.map(function(e){"video"===e.type&&(e.direction="recvonly",e.ssrcs.length=0)}),t=o.write(r)},formatSdp:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.offerOrAnswer,i=t.uid,n=t.highAudio,d=t.stero,c=t.targetUid,u=t.netDetect,l=t.codec,p=t.chromeScreenShareOpened,f=t.vp8Only,h=t.stream||new MediaStream,m=r.sdp,g=(r.type,[]),v=[],R=o.parse(m);this.logger.log("RtcUtil:formatSdp uid "+c+"\n");var _=h.getAudioTracks()[0],y=h.getVideoTracks()[0];return R.rtcpXr="rcvr-rtt=all:10000",R.media&&R.media.map(function(t){if(t.candidates&&delete t.candidates,c!==i?t.direction="recvonly":(t.direction=/recvonly/.test(t.direction)?"recvonly":"sendonly","firefox"==a.default.browser.ua&&a.default.browser.version>=72&&(("audio"!==t.type||_)&&("video"!==t.type||y)||(t.direction="recvonly"))),(/audio/.test(t.type)&&!_||/video/.test(t.type)&&!y)&&delete t.ssrcs&&delete t.ssrcGroups&&delete t.msid,"audio"===t.type&&(v.push(t.mid),t,t.rtcpFb&&1==t.rtcpFb.length&&t.rtcpFb.push({payload:t.rtcpFb[0].payload,type:"nack"})),"video"===t.type&&y){/h264/i.test(m)||"Chrome Mobile"===s.prefix||"Chrome"===s.prefix||e.logger.error("RtcUtil:formatSdp 该机型浏览器不支持H264编码");var o=[];if(t.rtp&&t.rtp.length&&t.rtp.map(function(e){"H264"===e.codec?o.push(e.payload):"VP8"===e.codec&&t.fmtp.push({payload:e.payload,config:"x-google-max-bitrate=2048;x-google-min-bitrate=512;x-google-start-bitrate=1024"})}),t.fmtp&&t.fmtp.length&&t.fmtp.map(function(e){p?-1!=o.indexOf(e.payload)&&e.config&&(e.config.indexOf("x-google-min-bitrate=512")>0&&(e.config=e.config.replace(";x-google-max-bitrate=2048;x-google-min-bitrate=512;x-google-start-bitrate=1024","")),-1===e.config.indexOf("x-google-min-bitrate=1024")&&(e.config+=";x-google-min-bitrate=1024")):-1!=o.indexOf(e.payload)&&e.config&&(e.config.indexOf("x-google-min-bitrate=1024")>0&&(e.config=e.config.replace(";x-google-min-bitrate=1024","")),-1===e.config.indexOf("x-google-min-bitrate=512")&&(e.config+=";x-google-max-bitrate=2048;x-google-min-bitrate=512;x-google-start-bitrate=1024"))}),"Firefox"===s.prefix&&t.msid){var u=t.msid.split(" ");if(u[1]==y.id){u[1]=u[1].replace(/([\da-zA-Z]{4})/,function(e,t,r){var i="",a=t,n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];e&&(a=Math.round(Math.random()*(r-t))+t);for(var o=0;o<a;o++)i+=n[Math.round(Math.random()*(n.length-1))];return i}(!1,4))}else u[1]=y.id;t.msid=u.join(" ")}}else navigator.userAgent.toLowerCase().indexOf("se 2.x");if("audio"===t.type&&(t.ptime=60,t.maxptime=60,t.fmtp&&t.fmtp.length)){var l=!1,f=n?48e3:16e3;t.fmtp.map(function(e){e.config&&-1!==e.config.indexOf("minptime=")&&(e.config=e.config.replace(/minptime=\d+/,"minptime=60")),e.config&&-1!==e.config.indexOf("sprop-maxcapturerate=")&&-1!==e.config.indexOf("maxplaybackrate")&&(l=!0,e.config=e.config.replace(/sprop-maxcapturerate=\d+/,"sprop-maxcapturerate="+f),e.config=e.config.replace(/maxplaybackrate=\d+/,"maxplaybackrate="+f)),l||(e.config+=";maxplaybackrate="+f+";sprop-maxcapturerate="+f),d&&(e.config+=";maxaveragebitrate=131072;stereo=1;sprop-stereo=1;cbr=1")})}if("offer"===r.type){var h=t.mid;R.groups&&R.groups.map(function(e){if(e.mids&&e.mids.split){var r=e.mids.split(" ");-1!==r.indexOf(h)&&(r.splice(r.indexOf(h),1,t.mid),e.mids=r.join(" "))}})}t.fmtp=e.limitFrame(t.fmtp)}),u?R=this.keepCodec(R,l):("weixin"===a.default.browser.ua||f)&&(this.logger.log("清除H264 codec"),R=this.keepCodec(R,"vp8")),r.sdp=o.write(R),r.sdp=r.sdp.replace(/t=([0-9 ]*)\r\n/,"t=$1\r\na=rtcp-xr:rcvr-rtt=all:10000\r\n"),g.length>0&&g.map(function(e){var t=new RegExp("a=ssrc:"+e+".+\\r\\n","gi");r.sdp=r.sdp.replace(t,"")}),r},keepCodec:function(e,t){var r=this;if(t&&e){var i=[];return e.media.map(function(e){if("video"===e.type){if(e.rtp&&e.rtp.length){var n=!1;e.rtp.map(function(e){e.codec.toLowerCase()!==t||n||(n=!0,i.push(e.payload))})}i.length&&e.fmtp&&e.fmtp.length&&e.fmtp.map(function(e){var t=/apt=(\d*)/gi.exec(e.config);t&&t.length&&i.map(function(r){r===parseInt(t[t.length-1],10)&&i.push(e.payload)})}),r.logger.warn("保留的payloads: ",i),i.length&&(e.payloads=i.join(" "),e.fmtp=a(e.fmtp,i),e.rtcpFb=a(e.rtcpFb,i),e.rtp=a(e.rtp,i))}}),e}function a(e,t){var r=[];if(e.map(function(e){t.map(function(t){e.payload===t&&r.push(e)})}),r.length)return r}this.logger.log("RtcUtil:keepCodec Invalid Argument")},limitFrame:function(e){return e.map(function(e){/42e01f/gi.test(e.config)&&(e.config+=";max-fs=12288")}),e},setMediaBitrates:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sdp,r=e.bit,i=void 0===r?{}:r,a=i.video,n=void 0===a?500:a,s=i.audio,d=void 0===s?500:s,c=o.parse(t);return c.media&&c.media.map(function(e){e.bandwidth=[{type:navigator.mozGetUserMedia?"TIAS":"AS",limit:"audio"===e.type?d:n}]}),o.write(c)},formatSSRCChrome:function(e,t,r){return e.map(function(e,i){return e.id=t+"0"+r+"0"+Math.floor(i/4),e.id-=0,e})},formatSSRCFirefox:function(e,t,r){return e.map(function(e,i){return e.id=t+"0"+r+"0"+Math.floor(i/4),e.id-=0,e})},formatSdpRemote:function(e,t,r){var i=/Chrome/gi.test(s.prefix);return/Safari/gi.test(s.prefix)?e:i?this.formatSdpRemoteChrome(e,t,r):this.formatSdpRemoteFirefox(e,t)},formatSdpRemoteChrome:function(e,t){return-1===(e=e.replace(/a=msid:.+\r\na=ssrc:\d+ cname:.+/gi,function(e){var t=e.match(/a=ssrc:(\d+)/),r=e.match(/a=msid:(.+) (.+)/);return t[1]&&(e=e.replace("a=msid","a=ssrc:"+t[1]+" msid")),r[1]&&t[1]&&(e=e+"\r\na=ssrc:"+t[1]+" mslabel:"+r[1]),r[2]&&t[1]&&(e=e+"\r\na=ssrc:"+t[1]+" label:"+r[2]),e})).indexOf("b=AS:1024")&&(e=e.replace(/m=video ([0-9./ A-Z]*)\n/g,"m=video $1\nb=AS:1024\n")),e},formatSdpRemoteFirefox:function(e,t){if(e=e.replace(/\r\na=msid:.+\r\na=ssrc:\d+ cname:.+/gi,function(e){var t=e.match(/\r\na=ssrc:\d+ cname:.+/);return e=(e=e.replace(/a=ssrc:\d+ cname:.+/,"")).replace("a=msid",t[0]+"\r\na=msid")}),t&&t.sdp){var r=o.parse(e),i=o.parse(t.sdp);r.media.length,i.media.length}return-1===e.indexOf("b=AS:1024")&&(e=e.replace(/m=video ([0-9./ A-Z]*)\n/g,"m=video $1\nb=AS:1024\n")),e},parse:function(e){var t=o.parse(e);this.logger.log("RtcUtil:parse 原始sdp\n",e),this.logger.log("RtcUtil:parse 处理后sdp\n",t)},updateMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="updateMediaStream",this.fnShake(e)},_updateMediaStream:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.peer,i=t.currStream,n=t.streams,o=void 0===n?[]:n;this.logger.log("RtcUtil:_updateMediaStream: ");var d=this.checkCurrStream(r),c={},u=r,l=i||new MediaStream;o.map(function(e){e.getTracks().map(function(e){c[e.id]=e})});var p=Object.keys(d.tracks).filter(function(e){return!c[e]});this.logger.log("RtcUtil:_updateMediaStream 获取移除的列表",p);var f=Object.keys(c).filter(function(e){return!d.tracks[e]});return this.logger.log("RtcUtil:_updateMediaStream 获取新加的列表",f),p&&p.map(function(t){var i=d.tracks[t].sender,n=d.tracks[t].track;if(n&&e.logger.log("RtcUtil:_updateMediaStream remove old track ",n.id),a.default.browser.greaterThanOrEqualToSafari_12_1_1()||"Firefox"===s.prefix||("Chrome"===s.prefix||"Chrome Mobile"===s.prefix)&&s.version>=72){e.logger.log("使用不同的api，清除track");var o="audio"===n.kind?r.audioSender:r.videoSender;o&&o.replaceTrack(null)}else u.removeTrack(i);l.removeTrack(n)}),f&&f.map(function(t){var i=c[t];e.logger.log("RtcUtil:_updateMediaStream add new track: ",i&&i.id),l.addTrack(i),a.default.browser.greaterThanOrEqualToSafari_12_1_1()||"Firefox"===s.prefix||("Chrome"===s.prefix||"Chrome Mobile"===s.prefix)&&s.version>=72?(e.logger.log("使用不同的api，添加track"),"audio"===i.kind?r.audioSender?r.audioSender.replaceTrack(i):r.audioSender=u.addTrack(i,l):"video"===i.kind&&(r.videoSender?(e.logger.log("RtcUtil:_updateMediaStream open the camera"),r.videoSender.replaceTrack(i)):r.videoSender=u.addTrack(i,l))):"video"===i.kind?r.videoSender=u.addTrack(i,l):r.audioSender=u.addTrack(i,l)}),this.checkCurrStream(r),Promise.resolve(l)},removeTrack:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.peer,i=t.currStream,a=t.tracks,n=void 0===a?[]:a;if(0!==n.length){var o=this.checkCurrStream(r);n.map(function(t){o.tracks[t.id]&&(e.logger.log("RtcUtil:removeTrack ====remove track",t,t.readyState,o.tracks[t.id].sender),i.removeTrack(t),r.removeTrack(o.tracks[t.id].sender))})}},checkCurrStream:function(e){var t=this,r={},i=[],a=e.getSenders();return a&&a.map(function(e){var a=e.track;a?(r[a.id]={sender:e,track:a},t.logger.log("RtcUtil: checkCurrStream --\x3e track id:",a.kind+":"+a.id)):i.push(e)}),{tracks:r,empty:i}},checkMediaStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.videoTrack,r=e.sdp,i=(e.uid,{video:!1});return i.video=new RegExp(t.id).test(r),this.logger.log("checkMediaStatus ----\x3e result",i),i},checkMeidaExistent:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.sdp,i=t.type,a=!0,n=o.parse(r);return n.media&&n.media&&n.media.map(function(t){t.type&&t.type===i&&(("sendonly"==t.direction||"sendrecv"==t.direction)&&t.ssrcs&&t.ssrcs.length?(e.logger.log("对方发送 %s流",i),a=!0):(e.logger.log("对方不发送 %s流",i),a=!1))}),a},validMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sdp,r=e.msid,i=e.trackid;if(!r||!i)return!1;var a=!1;return r&&(a=new RegExp(r).test(t)),a?(i&&(a=new RegExp(i).test(t)),a):a}},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(r(1)),a=o(r(2)),n=r(27);function o(e){return e&&e.__esModule?e:{default:e}}var s=r(5),d=s.info.nrtcVersion,c=r(19),u="https://statistic.live.126.net/webrtc/stat",l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e);var r=t.appkey;this.infos={},this.init(r),this.resetStatus()}return(0,a.default)(e,[{key:"resetStatus",value:function(){}},{key:"init",value:function(e){this.infos=Object.assign(this.infos,{interval:30,ver:2,platform:p.convertPlatform(c.os.family)+"-"+c.os.version,browser:c.name+"-"+c.version,sdk_ver:d||"3.6.0",uid:null,appkey:e,time:null,data:{}})}},{key:"clear",value:function(){this.infos.data={}}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.infos.appkey=e.appKey||e.appkey||this.infos.appkey,this.infos.cid=e.cid,this.infos.uid=e.uid}},{key:"stop",value:function(){this.send(),this.clear()}},{key:"update",value:function(e){this.infos.data["stat_"+Date.now()]=e,Object.keys(this.infos.data).length===this.infos.interval&&this.send()}},{key:"send",value:function(){var e=this;0!==Object.keys(this.infos.data).length&&(this.infos.time=Date.now(),s.wssServer&&(u=u.replace("statistic.live.126.net",s.wssServer)),(0,n.ajax)({type:"post",url:u,data:this.infos,header:{sdktype:"nrtc",appkey:this.infos.appkey,platform:"web",sdkver:d}}).then(function(t){e.clear()}).catch(function(e){console.log("err",e)}))}}]),e}();t.default=l;var p={convertNetwork:function(e){return{wlan:"wifi",lan:"ethernet"}[e]||"unknown"},convertPlatform:function(e){var t=void 0;return t=/Windows/i.test(e)?"Win":e,t=/OS X/i.test(t)?"Mac":t}};e.exports=t.default},function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t){var r,i;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&i.rotl(e,8)|4278255360&i.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=i.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,i=0;r<e.length;r++,i+=8)t[i>>>5]|=e[r]<<24-i%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],i=0;i<e.length;i+=3)for(var a=e[i]<<16|e[i+1]<<8|e[i+2],n=0;n<4;n++)8*i+6*n<=8*e.length?t.push(r.charAt(a>>>6*(3-n)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],i=0,a=0;i<e.length;a=++i%4)0!=a&&t.push((r.indexOf(e.charAt(i-1))&Math.pow(2,-2*a+8)-1)<<2*a|r.indexOf(e.charAt(i))>>>6-2*a);return t}},e.exports=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(r(1)),a=s(r(2)),n=r(27),o=s(r(155));function s(e){return e&&e.__esModule?e:{default:e}}var d=r(5),c=d.info.nrtcVersion,u=r(19),l="https://statistic.live.126.net/statistic/realtime/sdkinfo",p="https://statistic.live.126.net/statics/report/webrtc/networkProbeLog",f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e);var r=t.appkey,a=t.adapterRef;this.infos={},this.userlist=[],this.localVolume=0,this.local={},this.remote={},this.audioBwe={bitsSentCurrent:0,bitsRecvCurrent:[]},this.videoBwe={bitsSentCurrent:0,bitsRecvCurrent:[]},this.netDetectDownData={v_lost:[],rtt:[],real_v_res:[],real_v_kbps_n:[],v_fps:[]},this.webrtcStats=[],this.remoteAudioHelperMap={},this.publicIP="",this.adapterRef=a,this.init(r),this.resetStatus()}return(0,a.default)(e,[{key:"init",value:function(e){this.infos=Object.assign(this.infos,{ver:3,isp:-1,sdk_ver:c||"3.6.0",appkey:e,interval:60,samples:30,time:null,qos_algorithm:-1,fec_algorithm:-1,qos_scene:-1,qos_strategy:-1})}},{key:"resetStatus",value:function(){this.infos=Object.assign(this.infos,{uid:null,cid:null,push_url:null,turn_ip:null,proxy_ip:null}),this.videoStuckReport={},this.audioStuckReport={},this.clearInfoData(),this.remoteAudioHelperMap={},this.uidSsrcMap={},this.userlist=[],this.audioBwe={bitsSentCurrent:0,bitsRecvCurrent:[]},this.videoBwe={bitsSentCurrent:0,bitsRecvCurrent:[]}}},{key:"initInfoData",value:function(e){var t=this.imInfo.sessionStart||this.sessionConfig.signalStartTime||Date.now(),r=this.imInfo&&this.imInfo.cid||0,i={uid:e,cid:r,push_url:this.sessionConfig&&this.sessionConfig.rtmpUrl||"",turn_ip:this.imInfo&&this.imInfo.turnMap||"",proxy_ip:this.imInfo&&this.imInfo.turnMap||"",session_id:(0,o.default)(r+":"+e+":"+t),device_id:(0,n.deviceId)(),p2p:!1,net:-1,connect_state:this.imInfo&&this.imInfo.code||200};this.infos=Object.assign(this.infos,i)}},{key:"clearInfoData",value:function(){this.localVolume=0,this.infos=Object.assign(this.infos,{a_p_volume:[],rx:{audio:[],video:[]},tx:{a_lost:[],v_lost:[],rtt:[],rtt_mdev:[],v_cap_fps:[],qos_v_fps:[],v_fps:[],real_v_res:[],real_v_kbps:[],real_v_kbps_n:[],real_a_kbps:[],real_a_kbps_n:[],qos_v_kbps:[],a_volume:[],a_cap_volume:[],a_codec:[],a_stream_ended:[],a_ssrc:[],v_codec:[],v_stream_ended:[],v_ssrc:[]}})}},{key:"start",value:function(e){var t=e.imInfo,r=e.sessionConfig,i=e.videoConfig;t&&(this.infos.appkey=this.infos.appkey,this.imInfo=t||{},this.infos.cid=this.imInfo.cid,this.infos.uid=this.imInfo.uid,this.sessionConfig=r||{},this.videoConfig=i||{},this.clearSecond(),this.getTurnMap(),this.initInfoData(this.infos.uid))}},{key:"stop",value:function(){this.send(),this.resetStatus()}},{key:"clearSecond",value:function(){this.paramSecond={upAudioCache:{},upVideoCache:{},downAudioCache:{},downVideoCache:{}}}},{key:"getPacketLossRate",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!t)return 0;var i=parseInt(e.packetsLost)||0,a=parseInt(t.packetsLost)||0;if(a<=i)return 0;var n=r?e.packetsSent:e.packetsReceived,o=r?t.packetsSent:t.packetsReceived,s=parseInt(n)||0,d=parseInt(o)||0;return d<=s?0:r?parseFloat(((a-i)/(d-s)*100).toFixed(1)):parseFloat(((a-i)/(a-i+(d-s))*100).toFixed(1))}},{key:"getVrdor",value:function(e,t){var r=0,i=0;if(!e||!t)return{vrdolr:r,vrdohr:i};var a=parseInt(e.googInterframeDelayMax),n=parseInt(t.googInterframeDelayMax);if(n<=a)return{vrdolr:r,vrdohr:i};var o=0,s=0,d=0,c=0;return a>200&&a<400&&(o=a/2e3),n>200&&n<400&&(s=n/2e3),a>400&&(d=a/2e3),n>400&&(c=n/2e3),{vrdolr:r=o+s,vrdohr:i=d+c}}},{key:"update",value:function(e,t){this.imInfo.netDetect&&console.log("sdk数据上报更新 data: ",e);var r=[],i=[],a=[],n=[];for(var o in 2==this.webrtcStats.length&&this.webrtcStats.shift(),this.webrtcStats.push(e),e){var s=parseFloat(o.split("_")[3]);-1!==o.indexOf("_send_")&&-1!==o.indexOf("_audio")?(this.paramSecond.upAudioCache[s]&&(e[o].alr=this.getPacketLossRate(this.paramSecond.upAudioCache[s],e[o],!0)),this.paramSecond.upAudioCache[s]=e[o],r.push(e[o])):-1!==o.indexOf("_send_")&&-1!==o.indexOf("_video")?(this.paramSecond.upVideoCache[s]&&(e[o].vlr=this.getPacketLossRate(this.paramSecond.upVideoCache[s],e[o],!0)),Object.assign(e[o],e.bweforvideo),this.paramSecond.upVideoCache[s]=e[o],i.push(e[o])):-1!==o.indexOf("_recv_")&&-1!==o.indexOf("_audio")?(this.paramSecond.downAudioCache[s]&&(e[o].alr=this.getPacketLossRate(this.paramSecond.downAudioCache[s],e[o])),this.paramSecond.downAudioCache[s]=e[o],a.push(e[o])):-1!==o.indexOf("_recv_")&&-1!==o.indexOf("_video")?(this.paramSecond.downVideoCache[s]&&(e[o].vlr=this.getPacketLossRate(this.paramSecond.downVideoCache[s],e[o]),Object.assign(e[o],this.getVrdor(this.paramSecond.downVideoCache[s],e[o]))),this.paramSecond.downVideoCache[s]=e[o],n.push(e[o])):-1!==o.indexOf("Conn-audio-1-0")?this.publicIP=e[o]&&e[o].googLocalAddress.match(/([0-9\.]+)/)[1]:this.network=e[o]&&e[o].network}1!==t&&(t%2==0&&(this.updateTxMediaInfo(r,i),this.updateRxMediaInfo(a,n),(Object.keys(this.infos.rx.audio).length||Object.keys(this.infos.rx.video).length||Object.keys(this.infos.tx.video).length)===this.infos.interval/2&&this.send()))}},{key:"updateOnce",value:function(e){var t=e.imInfo,r=e.sessionConfig,i=e.rtcConnection;t&&(this.imInfo=t||{},this.sessionConfig=r||{},this.rtcConnection=i||{},this.videoConfig=e.videoConfig||{},this.getTurnMap(),this.initInfoData(),this.send())}},{key:"updateLocalVolume",value:function(e){this.localVolume=32768*e}},{key:"updateLocalStreamEnable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.LocalAudioEnable=e,this.localVideoEnable=t}},{key:"updateRemoteMap",value:function(e){this.remoteAudioHelperMap=e}},{key:"updateRxMediaInfo",value:function(e,t){var r=this;if(this.imInfo.netDetect){var i={v_lost:t[0].vlr||0,rtt:parseFloat(t[0]&&t[0].googRtt||0)||0,real_v_kbps_n:t.length&&t[0].bitsReceivedPerSecond||0,v_fps:parseFloat(t[0]&&t[0].googFrameRateOutput||0)||0,real_v_res:(t[0]&&t[0].googFrameWidthReceived||0)+"x"+(t[0]&&t[0].googFrameHeightReceived||0)};for(var a in i)this.netDetectDownData[a].push(i[a])}var n={u:[],g:[],c:[],bn:[],bc:[],jbN:[],jbP:[],jbC:[],jbD:[],alr:[],astuck:[],acodec:[],avolume:[],assrc:[]},o={u:[],i:[],bn:[],bc:[],r:[],f:[],vrdolr:[],vrdohr:[],vstuck:[],vJBbdmax:[],vlr:[],vframed:[],renderDelay:[],nack:[],pli:[],vcodec:[],vssrc:[]};e.map(function(e){var t=null;e.id&&(t=parseFloat(e.id.split("_")[3])),n.u.push(t),n.g.push(-1),n.c.push(-1),n.bn.push(e.bitsReceivedPerSecond||0),n.bc.push(-1),n.jbN.push(parseInt(e.googDecodingNormal)||0),n.jbP.push(parseInt(e.googDecodingPLC)||0),n.jbC.push(parseInt(e.googDecodingCNG)||0),n.jbD.push(parseInt(e.googJitterBufferMs)||0),n.alr.push(parseInt(e.alr)||0),n.acodec.push(e.googCodecName||0),n.avolume.push(parseInt(e.audioOutputLevel)||0),n.assrc.push(e.ssrc||"");var i=r.audioStuckReport[t];i&&i.length?(void 0===n.astuck&&(n.astuck=[]),n.astuck.push(i.reduce(function(e,t){return e+t})),i.length=0):n.astuck.push(0)});var s=e.length?Math.max.apply(Math,e.map(function(e){return e.audioOutputLevel})):0;this.infos.a_p_volume.push(s),t.map(function(e){var t=null;e.id&&(t=parseFloat(e.id.split("_")[3])),t&&o.u.push(t),o.i.push(parseFloat(e.googInterframeDelayMax)),o.bn.push(e.bitsReceivedPerSecond||0),o.bc.push(-1),o.r.push((e.googFrameWidthReceived||0)+"x"+(e.googFrameHeightReceived||0)),o.f.push(parseInt(e.googFrameRateOutput)),o.vrdolr.push(e.vrdolr||0),o.vrdohr.push(e.vrdohr||0),o.vJBbdmax.push(parseInt(e.googJitterBufferMs)),o.vframed.push(parseInt(e.googMaxDecodeMs)),o.renderDelay.push(parseInt(e.googRenderDelayMs)),o.vlr.push(parseInt(e.vlr)||0),o.nack.push(parseInt(e.googNacksSent)),o.pli.push(parseInt(e.googPlisSent)),o.vcodec.push(e.googCodecName||"H264"),o.vssrc.push(e.ssrc||"");var i=r.videoStuckReport[t];i&&i.length?(o.vstuck.push(i.reduce(function(e,t){return e+t})),i.length=0):o.vstuck.push(0)}),this.infos.rx.audio.push(n),this.infos.rx.video.push(o)}},{key:"getLocalMediaStats",value:function(e,t){var r={a_lost:e[0]&&e[0].alr||0,v_lost:t[0]&&t[0].vlr||0,rtt:parseInt(t[0]&&t[0].googRtt)||0,rtt_mdev:-1,v_cap_fps:parseInt(t[0]&&t[0].googFrameRateInput)||0,qos_v_fps:parseInt(t[0]&&t[0].googFrameRateInput)||0,v_fps:parseInt(t[0]&&t[0].googFrameRateSent)||0,real_v_res:(t[0]&&t[0].googFrameWidthSent||0)+"x"+(t[0]&&t[0].googFrameHeightSent||0),real_v_kbps:parseFloat(t[0]&&t[0].googActualEncBitrate)||0,real_v_kbps_n:parseFloat(t[0]&&t[0].googTransmitBitrate)||0,real_a_kbps:-1,real_a_kbps_n:parseInt(e[0]&&e[0].bitsSentPerSecond)||0,qos_v_kbps:-1,a_volume:parseInt(e[0]&&e[0].audioInputLevel)||0,a_cap_volume:Math.round(this.localVolume)||0,a_codec:e[0]&&e[0].googCodecName||"opus",a_stream_ended:this.LocalAudioEnable||!1,a_ssrc:e[0]&&e[0].ssrc||"",v_codec:t[0]&&t[0].googCodecName||"h264",v_stream_ended:this.localVideoEnable||!1,v_ssrc:t[0]&&t[0].ssrc||""};return r.real_a_kbps_n<=2&&this.adapterRef.instance._isWeixinBrowser()&&(this.adapterRef.logger.warn("音频的上行码率: ",r.real_a_kbps_n),this.adapterRef.webrtcBusiness&&this.adapterRef.webrtcBusiness.selfWebRtcInstance&&this.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection&&this.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection.audioSender&&(this.adapterRef.logger.error("上行音频没有发送，重新建立上行链路"),this.adapterRef.webrtcBusiness._doIceFail4Self())),r}},{key:"updateTxMediaInfo",value:function(e,t){var r=this.getLocalMediaStats(e,t);for(var i in r)this.infos.tx[i].push(r[i]);var a=((navigator.connection||{}).type||"unknown").toString().toLowerCase();this.infos.net=h.convertNetwork(this.network||a)}},{key:"getTurnMap",value:function(){if(this.imInfo){var e=this.imInfo;e.serverMap?(e.serverMap.constructor===Object?e.turnMap=e.serverMap||null:e.turnMap=JSON.parse(e.serverMap||null),e.turnMap=e.turnMap&&e.turnMap.turnaddrs,e.turnMap=e.turnMap&&e.turnMap[0],e.turnMap=e.turnMap.constructor===Array?e.turnMap[0]:e.turnMap,e.turnMap=e.turnMap&&e.turnMap.match(/\d+\.\d+.\d+\.\d+/),e.turnMap=e.turnMap[0]):e.relayaddrs&&e.relayaddrs.length?e.turnMap=e.relayaddrs[0].match(/\d+\.\d+.\d+\.\d+/)[0]:e.turnMap="0.0.0.0"}else console.warn("尚未连接网关，不统计")}},{key:"send",value:function(){var e=this;this.infos.uid&&this.infos.cid&&(this.imInfo.netDetect||(this.infos.time=Date.now(),this.infos.samples=this.infos.rx.audio.length,d.wssServer&&(l=l.replace("statistic.live.126.net",d.wssServer)),(0,n.ajax)({type:"post",url:l,data:this.infos,header:{sdktype:"nrtc",appkey:this.infos.appkey,platform:"web",sdkver:c}}).then(function(t){e.clearInfoData()}).catch(function(t){console.log("data uploader send",t),e.clearInfoData()})))}},{key:"updateVideoStuckData",value:function(e){var t=this;Object.keys(e).forEach(function(r){var i=e[r],a=t.videoStuckReport[r];void 0===a&&(a=t.videoStuckReport[r]=[]),a.push(i)})}},{key:"updateAudioStuckData",value:function(e){var t=this;Object.keys(e).forEach(function(r){var i=e[r],a=t.audioStuckReport[r];void 0===a&&(a=t.audioStuckReport[r]=[]),a.push(i)})}},{key:"updateVideoCache",value:function(e){}},{key:"disposalDataForNetDetect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.NetDetectData={},this.NetDetectData.cid=this.infos.cid,this.NetDetectData.user_ip=this.publicIP||"127.0.0.1",this.NetDetectData.browser=u.name+"-"+u.version,this.NetDetectData.server_ip=this.imInfo.wssArr&&this.imInfo.wssArr.length&&this.imInfo.wssArr[0],this.NetDetectData.upload_network_status=[],this.NetDetectData.download_network_status=[],this.imInfo.netDetect&&(console.log("整理网络探测的数据: 计算RTT: ",this.infos.tx.rtt),console.log("整理网络探测的数据: 计算上行帧率: ",this.infos.tx.v_fps),console.log("整理网络探测的数据: 计算下行帧率: ",this.netDetectDownData.v_fps),console.log("整理网络探测的数据: 计算上行丢包率: ",this.infos.tx.v_lost),console.log("整理网络探测的数据: 计算下行丢包率: ",this.netDetectDownData.v_lost),console.log("整理网络探测的数据: 计算上行带宽: ",this.infos.tx.real_v_kbps_n),console.log("整理网络探测的数据: 计算下行带宽: ",this.netDetectDownData.real_v_kbps_n)),this.NetDetectData.upload_network_status.push({up_rtt:h.getRealValue(this.infos.tx.rtt)||0,up_loss:parseInt(h.getRealValue(this.infos.tx.v_lost))||0,up_bwe:h.calculateAverage(this.infos.tx.real_v_kbps_n,0)||0,up_framerate:h.getRealValue(this.infos.tx.v_fps)||0,up_resolution:h.getRealValue(this.infos.tx.real_v_res)||"0x0",codec:this.imInfo.codec,network_status:"",up_status:t?"success":"failed"}),this.NetDetectData.download_network_status.push({down_rtt:this.NetDetectData.upload_network_status[this.NetDetectData.upload_network_status.length-1].up_rtt||0,down_loss:parseInt(h.getRealValue(this.netDetectDownData.v_lost))||0,down_bwe:h.calculateAverage(this.netDetectDownData.real_v_kbps_n,0)||0,down_framerate:h.getRealValue(this.netDetectDownData.v_fps)||0,down_resolution:h.getRealValue(this.netDetectDownData.real_v_res)||"0X0",codec:this.imInfo.codec,network_status:"",down_status:r?"success":"failed"}),e&&(console.log("Safari自己计算的统计结果: ",JSON.stringify(this.NetDetectData,null," ")),console.log("服务器反馈后的统计结果: ",JSON.stringify(e,null," ")),this.NetDetectData.user_ip=e.user_ip,e.upload_network_status&&(this.NetDetectData.upload_network_status[0].up_rtt=e.upload_network_status.up_rtt,this.NetDetectData.upload_network_status[0].up_loss=e.upload_network_status.up_loss),e.download_network_status&&(this.NetDetectData.download_network_status[0].down_rtt=e.download_network_status.down_rtt),this.NetDetectData.download_network_status[0].down_rtt&&this.NetDetectData.upload_network_status[0].up_rtt?this.NetDetectData.download_network_status[0].down_rtt>this.NetDetectData.upload_network_status[0].up_rtt?this.NetDetectData.download_network_status[0].down_rtt=this.NetDetectData.upload_network_status[0].up_rtt:this.NetDetectData.upload_network_status[0].up_rtt=this.NetDetectData.download_network_status[0].down_rtt:this.NetDetectData.download_network_status[0].down_rtt?this.NetDetectData.upload_network_status[0].up_rtt=this.NetDetectData.download_network_status[0].down_rtt:this.NetDetectData.upload_network_status[0].up_rtt&&(this.NetDetectData.download_network_status[0].down_rtt=this.NetDetectData.upload_network_status[0].up_rtt),this.NetDetectData.upload_network_status[0].up_framerate=h.calculateFrameRate(this.infos.tx.v_fps)||0,this.NetDetectData.download_network_status[0].down_framerate=h.calculateFrameRate(this.netDetectDownData.v_fps)||0,console.log("safar自己统计并且结合服务器反馈后的重合结果: ",JSON.stringify(this.NetDetectData,null," "))),this.NetDetectData=h.assignResolution(this.NetDetectData),this.NetDetectData=this.computeNetStatus(this.NetDetectData),this.transportTime=0,this.sendNetDetectData(this.NetDetectData),this.NetDetectData}},{key:"computeNetStatus",value:function(e){if(e){if(e.download_network_status){e.download_network_status[0].down_loss>e.upload_network_status[0].up_loss?(e.loss_rate=e.download_network_status[0].down_loss,e.download_network_status[0].down_loss=e.download_network_status[0].down_loss-e.upload_network_status[0].up_loss):e.download_network_status[0].down_loss-e.upload_network_status[0].up_loss<=3&&e.download_network_status[0].down_loss-e.upload_network_status[0].up_loss>=-3?(console.log("差距少于等于3"),e.download_network_status[0].down_loss=0,e.loss_rate=e.upload_network_status[0].up_loss):(console.log("差距大"),e.download_network_status[0].down_loss=0,e.loss_rate=e.upload_network_status[0].up_loss);var t=e.loss_rate/20*.5+e.download_network_status[0].down_rtt/1200*.25+50/150*.25;console.log("网络探测计算结果：",t),e.download_network_status[0].network_status=t<=.2625?"网络状况非常好，音视频通话流畅":t<.55?"网络状况好，音视频通话偶有卡顿":t<=1?"网络状况差, 音频通话流畅":"网络状况非常差，音频通话偶有卡顿",e.upload_network_status[0].up_bwe&&e.upload_network_status[0].up_framerate&&e.upload_network_status[0].up_rtt||(console.log("统计信息，没有获取到上行行带宽、帧率或者時延"),e.download_network_status[0].network_status="网络状况非常糟糕，无法进行音视频通话"),e.upload_network_status[0].network_status=e.download_network_status[0].network_status}return e}console.log("computeNetStatus: Invalid Parameter")}},{key:"sendNetDetectData",value:function(e){var t=this;d.wssServer&&(p=p.replace("statistic.live.126.net",d.wssServer)),(0,n.ajax)({type:"post",url:p,data:e}).then(function(e){e&&e.code&&200==e.code&&console.warn("网络探测结果发送成功：",e)}).catch(function(e){console.log("网络探测结果发送失败：",e),t.transportTime<2?(t.sendNetDetectData(t.NetDetectData),t.transportTime++):t.transportTime=0})}}]),e}();t.default=f;var h={convertNetwork:function(e){return{wlan:"wifi",lan:"ethernet"}[e]||"unknown"},convertPlatform:function(e){var t=void 0;return t=/Windows/i.test(e)?"Win":e,t=/OS X/i.test(t)?"Mac":t},calculateAverage:function(e,t){if(e&&0!=e.length)return e.length<3&&e.length>1?e[e.length-1]||e[e.length-2]:1==e.length?e[0]:((e=e.slice(2)).sort(function(e,t){return e-t}),0==t?Math.round(e.reduce(r)/e.length):(e.reduce(r)/e.length).toFixed(t));function r(e,t){return e+t}},getRealValue:function(e){if(e&&0!=e.length){for(var t=e.length;t>0;t--)if(e[t])return e[t];return 0}},calculateFrameRate:function(e){if(!e||0==e.length)return 0;if(1==e.length)return e[0];for(var t=null,r=null,i=e.length;i>=0;i--){if(r&&r>e[i]){t=e[i];break}e[i]&&!r&&(r=e[i])}return r&&t?Math.round((r-t)/2):0},assignResolution:function(e){return e&&e.upload_network_status&&0!=e.upload_network_status.length&&e.download_network_status&&0!=e.download_network_status.length?"0x0"!=e.upload_network_status[0].up_resolution&&"0X0"!=e.download_network_status[0].down_resolution?e:"0x0"!=e.download_network_status[0].down_resolution?(e.upload_network_status[0].up_resolution=e.download_network_status[0].down_resolution,e):"0x0"!=e.upload_network_status[0].up_resolution?(e.download_network_status[0].down_resolution=e.upload_network_status[0].up_resolution,e):e:e}};e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(r(1)),a=o(r(2)),n=r(27);function o(e){return e&&e.__esModule?e:{default:e}}var s=r(5),d=s.info.nrtcVersion,c="https://statistic.live.126.net/statics/report/webrtc/global",u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e),this.logger=t.logger||console,this.data={},this.adapterRef=t,this.adapterRef.instance._params.appkey?this.appkey=this.adapterRef.instance._params.appkey:this.appkey=this.adapterRef.nim&&this.adapterRef.nim.options&&this.adapterRef.nim.options.appKey||this.adapterRef.imInfo.appkey,this.init()}return(0,a.default)(e,[{key:"init",value:function(){this.calling=!1,this.data=Object.assign(this.data,{account:"",uid:0,cid:0,deviceList:[],sessionInfo:{},mediaConstraint:{},peerConnections:[],mediaPlay:{},ext:""})}},{key:"update",value:function(e){Object.assign(this.data,e)}},{key:"send",value:function(e){var t=this;this.logger.log("----- send apiData ------",e),s.wssServer&&(c=c.replace("statistic.live.126.net",s.wssServer)),(0,n.ajax)({type:"post",url:c,data:e,header:{sdktype:"nrtc",appkey:this.appkey,platform:"web",sdkver:d}}).then(function(e){t.init()}).catch(function(e){console.log("err",e),t.init()})}}]),e}();t.default=u,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(r(1)),a=o(r(2)),n=r(27);function o(e){return e&&e.__esModule?e:{default:e}}var s=r(5),d=s.info.nrtcVersion,c="https://statistic.live.126.net/statistic/realtime/sdkFunctioninfo",u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e);var r=t.appkey,a=t.platform,n=t.statisticServer;this.apis={},this.isRtc=/WebRTC/.test(a),this.init(r,a,n),this.resetStatus()}return(0,a.default)(e,[{key:"init",value:function(e,t,r){this.apis=Object.assign(this.apis,{ver:1,platform:t,sdk_ver:d||"v4.4.0",uid:null,appkey:e,time:null,statisticServer:r})}},{key:"start",value:function(e){this.calling=!0,this.apis=Object.assign(this.apis,e)}},{key:"resetStatus",value:function(){this.calling=!1,this.apis=Object.assign(this.apis,{p2p:{value:0},meeting:{value:0},bypass:{value:0},call_control_type:{value:0},self_mute:{value:-1},self_mic_mute:{value:-1},set_mic:{value:-1},set_camera:{value:-1},mute_remote_audio:{value:-1},mute_remote_video:{value:-1},switch_p2p_type:{value:0},audio_to_video:{value:0},video_to_audio:{value:0},set_speaker:{value:-1},net_detect:{value:this.isRtc?-1:0},beautify:{value:-1},water_mark:{value:-1},audio_samples:{value:-1},video_samples:{value:-1},pre_view_mirror:{value:-1},code_mirror:{value:-1},custom_audio:{value:-1},custom_video:{value:-1},audio_mix:{value:-1},mixing_send_volume:{value:-1},seek_to_time:{value:-1},snap_shot:{value:-1},record:{value:0},audio_record:{value:0},display:{value:0},android_compatibility:{value:-1},hd_audio:{value:0},video_quality:{value:0},fps:{value:0},prefered_video_encoder:{value:-1},prefered_video_decoder:{value:-1},video_max_encode_bitrate:{value:this.isRtc?-1:0},audio_scene:{value:-1},video_adaptive_strategy:{value:this.isRtc?-1:0},ans:{value:this.isRtc?-1:0},agc:{value:-1},dtx:{value:-1},aec:{value:this.isRtc?-1:0},awc:{value:this.isRtc?-1:0},actor:{value:0},always_keep_calling:{value:0},server_record_audio:{value:0},server_record_video:{value:0},record_module:{value:0},record_speaker:{value:0},server_record_single_user:{value:0},screen_sharing_module:{value:0},video_crop:{value:0},switch_live_url:{value:0},set_v_fps:{value:15},set_video_quality:{value:0},set_video_custom_bitrate:{value:0},set_video_cut:{value:1}})}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],r=e.key,i=e.ext,a=e.value;e.constructor===String&&(r=e),i=i||t,this.apis[r]&&(this.apis[r].value="record_module"==r?a:1,void 0!==i&&(this.apis[r].ext=i),/(p2p|meeting)/.test(r)&&(this.calling=!0))}},{key:"send",value:function(){var e=this;this.calling&&(this.calling=!1,this.apis.time=Date.now(),this.apis.statisticServer?c=this.apis.statisticServer:s.wssServer&&(c=c.replace("statistic.live.126.net",s.wssServer)),(0,n.ajax)({type:"post",url:c,data:this.apis,header:{sdktype:"nrtc",appkey:this.apis.appkey,platform:"web",sdkver:d}}).then(function(t){e.resetStatus()}).catch(function(t){console.log("ApiInvokeData: send: err",t),e.resetStatus()}))}}]),e}();t.default=u,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=t.tool={merge:function(){var e=arguments;return e[0]=Object.assign.apply(Object.assign,arguments),e[0]},verifyOptions:function(){var e=arguments;if(e[0]&&e[0].constructor===Object)for(var t=1;t<arguments.length;t++){var r=e[t];(r=r.split(" ")).map(function(t){if(void 0===e[0][t])throw Error("参数缺失 "+t)})}},guid:(i=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return i()+i()+i()+i()+i()+i()+i()+i()}),sortDevices:function(e){e&&e.length>1&&e.sort(function(e,t){var r=-1!==e.name.toLowerCase().indexOf("virtual"),i=-1!==e.path.toLowerCase().indexOf("virtual"),a=-1!==t.name.toLowerCase().indexOf("virtual"),n=-1!==t.path.toLowerCase().indexOf("virtual");return i?1:n?-1:r&&a?0:r?1:a?-1:0})},randomNum:function(e,t){var r=t-e,i=Math.random();return 0==Math.round(i*r)?e+1:Math.round(i*t)==t?(index++,t-1):e+Math.round(i*r)-1},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},isNull:function(e){return null===e},isUndefined:function(e){return void 0===e},exist:function(e){return!a.isNull(e)&&!a.isUndefined(e)},formatTime:function(){var e=new Date;return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(/Object/i.test(e[t])?JSON.stringify(e[t]):e[t])}).join("&")};t.ajax=function(e){if(!e||!e.url)return Promise.reject("参数不完整，无法发起请求");e.dataType=e.dataType||"json";var t=new XMLHttpRequest;t.open(e.type||"GET",e.url,!0),t.responseType=""+e.dataType;var r=e.contentType||"application/json;charset=UTF-8";return t.setRequestHeader("Content-type",r),e.header&&Object.keys(e.header).map(function(r){t.setRequestHeader(r,e.header[r])}),new Promise(function(a,n){t.onload=function(){if(t.status>400)return Promise.reject("参数不完整，无法发起请求");var e=t.response;a(e)},t.onerror=function(e){n(e)},r.indexOf("x-www-form-urlencoded")>=0?e.data?t.send(i(e.data)):t.send():e.data?t.send(JSON.stringify(e.data)):t.send()})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.element={html2node:function(e){var t=document.createElement("div");t.innerHTML=e;var r=[],i=void 0,a=void 0;if(t.children)for(i=0,a=t.children.length;i<a;i++)r.push(t.children[i]);else for(i=0,a=t.childNodes.length;i<a;i++){var n=t.childNodes[i];1==n.nodeType&&r.push(n)}return r.length>1?t:r[0]},n2node:function(e){return e?/HTML.+Element/gi.test(e)?e:e[0]&&/HTML.+Element/gi.test(e[0])?e[0]:null:null}}},function(e,t,r){"use strict";var i=r(17),a=r(19),n=i.getGlobal();function o(e,t){for(var r in t)e[r]=t[r];return e}n.Object.assign||(console.log("Object.assign polyfill"),n.Object.assign=function(){for(var e=arguments,t=1;t<e.length;t++)e[0]=o(e[0],e[t]);return e[0]}),n.platform=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.util;return i=t.notundef,a};var i=void 0;function a(e){i(e.enable)&&(this.enable=e.enable?1:0),i(e.needBadge)&&(this.needBadge=e.needBadge?1:0),i(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0),i(e.pushContent)&&(this.pushContent=""+e.pushContent),i(e.custom)&&(this.custom=""+e.custom),i(e.pushPayload)&&(this.pushPayload=""+e.pushPayload),i(e.sound)&&(this.sound=""+e.sound),i(e.webrtcEnable)&&(this.webrtcEnable=e.webrtcEnable?1:0),i(e.forceKeepCalling)&&(this.forceKeepCalling=e.forceKeepCalling?1:0)}e.exports=t.default},function(e,t,r){var i=r(26),a=r(72).f;r(210)("getOwnPropertyDescriptor",function(){return function(e,t){return a(i(e),t)}})},function(e,t,r){r(338);var i=r(6).Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},function(e,t,r){e.exports={default:r(339),__esModule:!0}},function(e,t,r){var i=r(49),a=r(93);r(210)("getPrototypeOf",function(){return function(e){return a(i(e))}})},function(e,t,r){r(341),e.exports=r(6).Object.getPrototypeOf},function(e,t,r){e.exports={default:r(342),__esModule:!0}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NRTCAdapter=void 0;var i=l(r(1)),a=l(r(2)),n=l(r(4)),o=l(r(84)),s=l(r(3)),d=r(222),c=r(11),u=r(27);function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,i.default)(this,t),e=Object.assign(c.DEFAULT_NRTC_OPTION,e),c.CONFIG_MAP.CURRENT.SDK_TYPE=c.CONFIG_MAP.SDK_TYPE.NRTC;var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.SDK_TYPE=c.CONFIG_MAP.SDK_TYPE.NRTC,r.adapterRef.instance._isFirefox()?window.addEventListener("beforeunload",function(){r.adapterRef.logger.log("NRTCAdapter: beforeunload event fire"),r.leaveChannel()}):window.addEventListener("pagehide",function(){r.adapterRef.logger.log("NRTCAdapter:pagehide event fire"),r.leaveChannel()}),r._nrtcInit(e),r}return(0,s.default)(t,e),(0,a.default)(t,[{key:"_nrtcInit",value:function(e){var t=e.appkey;t||this.adapterRef.logger.error("NRTCAdapter: _nrtcInit error: 请传入appkey"),this._params.appkey=t}},{key:"joinChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.adapterRef.detectNetState.inDetecting?Promise.reject(c.CommonErrorCode.NetworkInDetecting):(u.tool.verifyOptions(e,"channelName uid"),Object.assign(this._params.JoinChannelRequestParam4NRTC,e),this.setStartSessionTime(),this.adapterRef.meeting4NRTCApi.joinChannel(Object.assign(this._params.JoinChannelRequestParam4NRTC,{appkey:this._params.appkey})))}},{key:"leaveChannel",value:function(){return this.setEndSessionTime(),this.adapterRef.meeting4NRTCApi.leaveChannel()}},{key:"setPlayVolume",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.volume,r=e.uid;return 0===r.length?this.adapterRef.playApi.setPlayVolume(+t):this.adapterRef.playApi.setPlayVolume({uid:r,volume:+t})}},{key:"destroy",value:function(){(0,o.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(d.BaseAPI);t.NRTCAdapter=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var i=d(r(1)),a=d(r(2)),n=d(r(4)),o=d(r(84)),s=d(r(3));function d(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.streamId="",r.attributes={maxFrameRate:15,maxVideoBW:500,minFrameRate:15,minVideoBW:20,resolution:"640x480"},r.audio=!0,r.microphoneId="",r.audioConstraint={deviceId:{exact:""}},r.audioMixing={},r.video=!0,r.videoConstraint={},r.cameraId="",r.userId="",r}return(0,s.default)(t,e),(0,a.default)(t,[{key:"getId",value:function(){this.adapterRef.logger.log("获取音视频流 ID")}},{key:"init",value:function(){this.adapterRef.logger.log("初始化音视频流对象")}},{key:"play",value:function(){this.adapterRef.logger.log("播放音视频流")}},{key:"stop",value:function(){this.adapterRef.logger.log("播放音视频流")}},{key:"isPlaying",value:function(){this.adapterRef.logger.log("检查音视频流是否在播放状态")}},{key:"close",value:function(){this.adapterRef.logger.log("关闭音视频输入设备，如摄像头")}},{key:"unmuteAudio",value:function(){this.adapterRef.logger.log("启用音频轨道")}},{key:"muteAudio",value:function(){this.adapterRef.logger.log("获取音频 flag")}},{key:"hasAudio",value:function(){this.adapterRef.logger.log("播放音视频流")}},{key:"getAudioLevel",value:function(){this.adapterRef.logger.log("获取当前音量")}},{key:"setAudioProfile",value:function(){this.adapterRef.logger.log("设置音频属性")}},{key:"setAudioVolume",value:function(){this.adapterRef.logger.log("调节播放订阅流的音量大小")}},{key:"setAudioOutput",value:function(){this.adapterRef.logger.log("设置音频输出设备，可以在麦克风和扬声器之间切换。")}},{key:"switchDevice",value:function(){this.adapterRef.logger.log("切换媒体输入设备，比如麦克风、扬声器、摄像头")}},{key:"unmuteVideo",value:function(){this.adapterRef.logger.log("启用视频轨道")}},{key:"muteVideo",value:function(){this.adapterRef.logger.log("禁用视频轨道")}},{key:"hasVideo",value:function(){this.adapterRef.logger.log("获取视频 flag")}},{key:"setVideoProfile",value:function(){this.adapterRef.logger.log("设置视频属性")}},{key:"setVideoEncoderConfiguration",value:function(){this.adapterRef.logger.log("自定义视频编码配置")}},{key:"setBeautyEffectOptions",value:function(){this.adapterRef.logger.log("设置美颜效果选项")}},{key:"setScreenProfile",value:function(){this.adapterRef.logger.log("设置屏幕共享中的屏幕属性")}},{key:"startAudioMixing",value:function(){this.adapterRef.logger.log("开始播放伴奏")}},{key:"stopAudioMixing",value:function(){this.adapterRef.logger.log("停止播放伴奏")}},{key:"pauseAudioMixing",value:function(){this.adapterRef.logger.log("暂停播放伴奏")}},{key:"resumeAudioMixing",value:function(){this.adapterRef.logger.log("恢复播放伴奏")}},{key:"adjustAudioMixingVolume",value:function(){this.adapterRef.logger.log("调节伴奏音量")}},{key:"getAudioMixingDuration",value:function(){this.adapterRef.logger.log("获取伴奏时长")}},{key:"getAudioMixingCurrentPosition",value:function(){this.adapterRef.logger.log("获取伴奏播放进度")}},{key:"setAudioMixingPosition",value:function(){this.adapterRef.logger.log("设置伴奏音频文件的播放位置。可以根据实际情况播放文件，而不是非得从头到尾播放一个文件。")}},{key:"destroy",value:function(){(0,o.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(r(12).EventEmitter);t.Stream=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC2=void 0;var i=l(r(1)),a=l(r(2)),n=l(r(4)),o=l(r(84)),s=l(r(3)),d=r(222),c=r(11),u=r(27);function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,i.default)(this,t),e=Object.assign(c.DEFAULT_NRTC_OPTION,e),c.CONFIG_MAP.CURRENT.SDK_TYPE=c.CONFIG_MAP.SDK_TYPE.WEBRTC2;var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.SDK_TYPE=c.CONFIG_MAP.SDK_TYPE.WEBRTC2,r.adapterRef.instance._isFirefox()?window.addEventListener("beforeunload",function(){r.adapterRef.logger.log("NRTCAdapter: beforeunload event fire"),r.leaveChannel()}):window.addEventListener("pagehide",function(){r.adapterRef.logger.log("NRTCAdapter:pagehide event fire"),r.leaveChannel()}),r._nrtcInit(e),r}return(0,s.default)(t,e),(0,a.default)(t,[{key:"_nrtcInit",value:function(e){var t=e.appkey;t||this.adapterRef.logger.error("NRTCAdapter: _nrtcInit error: 请传入appkey"),this._params.appkey=t}},{key:"join",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.adapterRef.logger.log("加入频道, options: ",JSON.stringify(e,null," ")),u.tool.verifyOptions(e,"uid"),this._params.JoinChannelRequestParam4WebRTC2={},Object.assign(this._params.JoinChannelRequestParam4WebRTC2,e),this.setStartSessionTime(),this.adapterRef.meeting4WebRTC2Api.joinChannel(Object.assign(this._params.JoinChannelRequestParam4WebRTC2,{appkey:this._params.appkey}))}},{key:"leave",value:function(){return this.adapterRef.logger.log("离开频道"),this.setEndSessionTime(),this.adapterRef.meeting4WebRTC2Api.leaveChannel()}},{key:"publish",value:function(e){this.adapterRef.logger.log("发布视频");options.type}},{key:"unpublish",value:function(e){this.adapterRef.logger.log("取消发布本地音视频流");options.type}},{key:"subscribe",value:function(e){this.adapterRef.logger.log("订阅远端音视频流")}},{key:"unsubscribe",value:function(e){this.adapterRef.logger.log("取消订阅远端音视频流")}},{key:"setRemoteVideoStreamType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.adapterRef.logger.log("订阅分辨率"),this.adapterRef.meeting4WebRTC2Api.subResolution(e)}},{key:"enableAudioVolumeIndicator",value:function(){this.adapterRef.logger.log("关闭双流模式")}},{key:"enableDualStream",value:function(){this.adapterRef.logger.log("开启双流模式")}},{key:"disableDualStream",value:function(){this.adapterRef.logger.log("关闭双流模式")}},{key:"setClientRole",value:function(e){this.adapterRef.logger.log("设置用户角色: ",e)}},{key:"getConnectionState",value:function(){this.adapterRef.logger.log("获取 SDK 与服务器的连接状态")}},{key:"destroy",value:function(){(0,o.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(d.BaseAPI);t.WebRTC2=p},function(e,t,r){"use strict";var i,a=r(9),n=(i=a)&&i.__esModule?i:{default:i};e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;if(e.maxLogsLines&&"number"==typeof e.maxLogsLines&&!isNaN(e.maxLogsLines)||(e.maxLogsLines=5e3),e.logFilename&&(e.logFilename=e.logFilename+".txt"),t.useTimestamps=e.useTimestamps||!1,t.useLocalStorage=e.useLocalStorage||!1,t.autoTrim=!0,t.maxLines=e.maxLogsLines||5e3,t.tailNumLines=100,t.logFilename=e.logFilename||"nimWebRtcLog.txt",t.maxDepth=5,t.depth=0,t.parentSizes=[0],t.currentResult="",t.startTime=new Date,t.output="",this.getLog=function(){var e=new Date;if(t.useLocalStorage){var r=window.localStorage.getItem("nimWebRtcLog");r&&(r=JSON.parse(r),t.startTime=new Date(r.startTime),t.output=r.log,e=new Date(r.lastLog))}return t.output+"\n---- Log retrieved: "+e+" ----\n"+t.formatSessionDuration(t.startTime,e)},this.tail=function(e){return e=e||t.tailLines,t.trimLog(t.getLog(),e)},this.search=function(e){for(var r=t.output.split("\n"),i=new RegExp(e),a=[],n=0;n<r.length;n++){var o="["+n+"] ";r[n].match(i)&&a.push(o+r[n])}var s=a.join("\n");return 0==s.length&&(s='Nothing found for "'+e+'".'),s},this.getSlice=function(e,r){return t.output.split("\n").slice(e,e+r).join("\n")},this.downloadLog=function(){var e=t.getLog(),r=new Blob([e],{type:"data:text/plain;charset=utf-8"}),i=document.createElement("a");i.href=window.URL.createObjectURL(r),i.target="_blank",i.download=t.logFilename,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(i.href)},this.clear=function(){var e=new Date;if(t.output="---- Log cleared: "+e+" ----\n",t.useLocalStorage){var r={startTime:t.startTime,log:t.output,lastLog:e};r=JSON.stringify(r),window.localStorage.setItem("nimWebRtcLog",r)}},this.log=function(e){var r=t.determineType(e);if(null!=r){var i=t.formatType(r,e);if(t.useTimestamps){var a=new Date;t.output+=t.formatTimestamp(a)}if(t.output+=i+"\n",t.autoTrim&&(t.output=t.trimLog(t.output,t.maxLines)),t.useLocalStorage){var n=new Date,o={startTime:t.startTime,log:t.output,lastLog:n};o=JSON.stringify(o),window.localStorage.setItem("nimWebRtcLog",o)}}t.depth=0,t.parentSizes=[0],t.currentResult=""},this.determineType=function(e){if(null!=e){var t=void 0===e?"undefined":(0,n.default)(e);return"object"==t?null==e.length?"function"==typeof e.getTime?"Date":"function"==typeof e.test?"RegExp":"Object":"Array":t}return null},this.formatType=function(e,r){if(t.maxDepth&&t.depth>=t.maxDepth)return"... (max-depth reached)";switch(e){case"Object":t.currentResult+="{\n",t.depth++,t.parentSizes.push(t.objectSize(r));var i=0;for(var a in r){t.currentResult+=t.indentsForDepth(t.depth),t.currentResult+=a+": ";var n=t.determineType(r[a]);(o=t.formatType(n,r[a]))?("function"!==n&&(t.currentResult+=o),i!=t.parentSizes[t.depth]-1&&(t.currentResult+=","),t.currentResult+="\n"):(i!=t.parentSizes[t.depth]-1&&(t.currentResult+=","),t.currentResult+="\n"),i++}if(t.depth--,t.parentSizes.pop(),t.currentResult+=t.indentsForDepth(t.depth),t.currentResult+="}",0==t.depth)return t.currentResult;break;case"Array":for(t.currentResult+="[",t.depth++,t.parentSizes.push(r.length),i=0;i<r.length;i++){var o;"Object"!=(n=t.determineType(r[i]))&&"Array"!=n||(t.currentResult+="\n"+t.indentsForDepth(t.depth)),(o=t.formatType(n,r[i]))?(t.currentResult+=o,i!=t.parentSizes[t.depth]-1&&(t.currentResult+=", "),"Array"==n&&(t.currentResult+="\n")):(i!=t.parentSizes[t.depth]-1&&(t.currentResult+=", "),"Object"!=n?t.currentResult+="\n":i==t.parentSizes[t.depth]-1&&(t.currentResult+="\n"))}if(t.depth--,t.parentSizes.pop(),t.currentResult+="]",0==t.depth)return t.currentResult;break;case"function":var s=(r+="").split("\n");for(i=0;i<s.length;i++)s[i].match(/\}/)&&t.depth--,t.currentResult+=t.indentsForDepth(t.depth),s[i].match(/\{/)&&t.depth++,t.currentResult+=s[i]+"\n";return t.currentResult;case"RegExp":return"/"+r.source+"/";case"Date":case"string":return t.depth>0||0==r.length?'"'+r+'"':r;case"boolean":return r?"true":"false";case"number":return r+""}},this.indentsForDepth=function(e){for(var t="",r=0;r<e;r++)t+="\t";return t},this.trimLog=function(e,t){var r=e.split("\n");return r.length>t&&(r=r.slice(r.length-t)),r.join("\n")},this.lines=function(){return t.output.split("\n").length},this.formatSessionDuration=function(e,t){var r=t-e,i=Math.floor(r/1e3/60/60),a=("0"+i).slice(-2);r-=1e3*i*60*60;var n=Math.floor(r/1e3/60),o=("0"+n).slice(-2);r-=1e3*n*60;var s=Math.floor(r/1e3);return r-=1e3*s,"---- Session duration: "+a+":"+o+":"+("0"+s).slice(-2)+" ----"},this.formatTimestamp=function(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"]: "},this.objectSize=function(e){var t,r=0;for(t in e)e.hasOwnProperty&&e.hasOwnProperty(t)&&r++;return r},t.useLocalStorage){var r=window.localStorage.getItem("nimWebRtcLog");if(r){r=JSON.parse(r),t.output=r.log;var i=new Date(r.startTime),a=new Date(r.lastLog);t.output+="\n---- Session end: "+r.lastLog+" ----\n",t.output+=t.formatSessionDuration(i,a),t.output+="\n\n"}}t.output+="---- Session started: "+t.startTime+" ----\n\n"}},function(e,t,r){"use strict";var i=r(19),a=r(0),n=(r(46),r(422));function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.merge(this,{options:e,debug:!1,api:"log",style:"color:#1cb977;",log:a.emptyFunc,info:a.emptyFunc,warn:a.emptyFunc,error:a.emptyFunc}),this.prefix=e.prefix||"",this.setDebug(e.debug),e.isSavedLogs&&(this.logHelper=new n(e))}var s=o.prototype,d=["Chrome","Safari","Firefox"];s.setDebug=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;if(t.debug=e,e.style&&(t.style=e.style),t.debug&&a.exist(console)){var r=console;t.debug=function(){this.logHelper&&this.logHelper.log(arguments);var e=t.formatArgs(arguments);-1!==d.indexOf(i.name)&&a.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,t.style)),t._log("debug",e)},t.log=function(){this.logHelper&&this.logHelper.log(arguments);var e=t.formatArgs(arguments);-1!==d.indexOf(i.name)&&a.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,t.style)),t._log("log",e)},t.info=function(){this.logHelper&&this.logHelper.log(arguments);var e=t.formatArgs(arguments);-1!==d.indexOf(i.name)&&a.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,t.style)),t._log("info",e)},t.warn=function(){this.logHelper&&this.logHelper.log(arguments);var e=t.formatArgs(arguments);-1!==d.indexOf(i.name)&&a.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,t.style)),t._log("warn",e)},t.error=function(){this.logHelper&&this.logHelper.log(arguments);var e=t.formatArgs(arguments);-1!==d.indexOf(i.name)&&a.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,t.style)),t._log("error",e)},t._log=function(e,i){var n=t.options.logFunc,o=null;if(n&&(n[e]&&(o=n[e]),a.isFunction(o)))o.apply(n,i);else if(r[e])try{r[e].apply?t.chrome(e,i):t.ie(e,i)}catch(e){}},t.chrome=function(e,a){-1!==d.indexOf(i.name)?r[e].apply(r,a):t.ie(e,a)},t.ie=function(e,t){t.forEach(function(t){r[e](JSON.stringify(t,null,4))})}}},s.formatArgs=function(e){e=[].slice.call(e,0);var t=new Date,r="[WEBRTC LOG "+(c(t.getMonth()+1)+"-"+c(t.getDate())+" "+c(t.getHours())+":"+c(t.getMinutes())+":"+c(t.getSeconds())+":"+c(t.getMilliseconds(),3))+" "+this.prefix.toUpperCase()+"]  ";return a.isString(e[0])?e[0]=r+e[0]:e.splice(0,0,r),e.forEach(function(t,r){(a.isArray(t)||a.isObject(t))&&(e[r]=a.simpleClone(t))}),e};var c=function(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r};e.exports=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayApi=void 0;var i=c(r(1)),a=c(r(2)),n=c(r(4)),o=c(r(3)),s=r(12),d=r(11);function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"startLocalStream",value:function(e){this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"display"});var t=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.uid);return this.adapterRef.logger.log("startLocalStream 开启自己画面"),t.show(e||this.adapterRef.tempInfo.localContainer),Promise.resolve()}},{key:"stopLocalStream",value:function(){this.adapterRef.imInfo&&this.adapterRef.imInfo.uid&&(this.adapterRef.logger.log("stopLocalStream 关闭自己画面"),this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.uid).hide())}},{key:"startRemoteStream",value:function(e){var t=this,r=e.account,i=e.node,a=(e.poster,r);return a?(this.adapterRef.logger.log("startRemoteStream 开启对端画面, uid "+a),this.adapterRef.instance._getVideoHelperByUid(a).show(i||this.adapterRef.tempInfo.remoteContainer),Promise.resolve()):(Object.keys(this.adapterRef.videoHelperMap).forEach(function(e,r){e!=t.adapterRef.imInfo.uid&&(t.adapterRef.logger.log("startRemoteStream 开启对端画面: "+e),t.adapterRef.instance._getVideoHelperByUid(e).show(i||t.adapterRef.tempInfo.remoteContainer))}),Promise.resolve())}},{key:"stopRemoteStream",value:function(e){var t=this,r=e;if(r)return this.adapterRef.logger.log("startLocalStream 关闭对端画面: "+r),void(this.adapterRef.instance._getVideoHelperByUidWithoutCreate(r)&&this.adapterRef.instance._getVideoHelperByUidWithoutCreate(r).hide());Object.keys(this.adapterRef.videoHelperMap).forEach(function(e,r){e!=t.adapterRef.imInfo.uid&&(t.adapterRef.logger.log("startLocalStream 关闭对端画面: "+e),t.adapterRef.instance._getVideoHelperByUid(e).hide())})}},{key:"setPlayVolume",value:function(e){var t=this;if("number"==typeof e){Object.keys(this.adapterRef.audioHelperMap).map(function(r){t.adapterRef.instance._getAudioHelperByUid(r).setPlayVolume(e)})}else{var r=e.uid;e=void 0===e.volume?1:e.volume,this.adapterRef.instance._getAudioHelperByUid(r).setPlayVolume(e)}return e}},{key:"getPlayVolume",value:function(e){var t=this.adapterRef.instance._getAudioHelperByUid(e);if(t){var r=t.getPlayVolume();return Math.round(255*r)}return 0}},{key:"getAudioVolume",value:function(){var e=this.adapterRef.imInfo.uid||"local";if(!this.adapterRef||!this.adapterRef.imInfo||!e)return{volume:0};var t=this.adapterRef.instance._getAudioHelperByUid(e);return t?t.getAudioVolume():{volume:0}}},{key:"setVideoViewSize",value:function(e){this.adapterRef.logger.log("设置本端视频画面大小: ",JSON.stringify(e,null," ")),this.adapterRef.apiReportHelper&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_crop"});var t=this.adapterRef.imInfo.uid,r=this.adapterRef.instance._getVideoHelperByUid(t);!0===r._checkHasVideoStream()&&r.videoDomHelper?r.videoDomHelper.resize(e):this.adapterRef.logger.warn("Play: setVideoViewSize: 未检测到视频流，请检查媒体设备是否开启!")}},{key:"setVideoViewRemoteSize",value:function(e){var t=this;this.adapterRef.logger.log("设置对端视频画面大小: ",JSON.stringify(e,null," ")),this.adapterRef.apiReportHelper&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_crop"});var r=e.uid;r?this.adapterRef.instance._getVideoHelperByUid(r).setVideoViewConfig({width:e.width,height:e.height,cut:e.cut}):Object.keys(this.adapterRef.videoHelperMap).map(function(r){var i=t.adapterRef.instance._getVideoHelperByUid(r);!0===i._checkHasVideoStream()&&r!=t.adapterRef.imInfo.uid?i.videoDomHelper?i.setVideoViewConfig({width:e.width,height:e.height,cut:e.cut}):t.adapterRef.logger.warn("Play: setVideoViewRemoteSize: 远程节点的承载容器尚未创建出来, "+i.uid):t.adapterRef.logger.warn("Play: setVideoViewRemoteSize: 未检测到视频流，请检查媒体设备是否开启, "+i.uid)});return Promise.resolve()}},{key:"resumeLocalStream",value:function(){var e=this.adapterRef.imInfo.uid;this.adapterRef.instance._getVideoHelperByUid(e).resumeLocalStream()}},{key:"suspendLocalStream",value:function(){var e=this.adapterRef.imInfo.uid;this.adapterRef.instance._getVideoHelperByUid(e).suspendLocalStream()}},{key:"resumeRemoteStream",value:function(e){var t=this;e?this.adapterRef.instance._getVideoHelperByUid(e).resumeRemoteStream(e):Object.keys(this.adapterRef.videoHelperMap).map(function(e){e!=t.adapterRef.imInfo.uid&&t.adapterRef.instance._getVideoHelperByUid(e).resumeRemoteStream(e)})}},{key:"suspendRemoteStream",value:function(e){var t=this;e?this.adapterRef.instance._getVideoHelperByUid(e).suspendRemoteStream():Object.keys(this.adapterRef.videoHelperMap).map(function(e){e!=t.adapterRef.imInfo.uid&&t.adapterRef.instance._getVideoHelperByUid(e).suspendRemoteStream()})}},{key:"getPlayState",value:function(e){function t(e,t,r){var i=0,a=0,n=0;for(var o in e)if("bweforvideo"===o);else{var s=o.match(/ssrc_(\d+)_(send|recv)_(\d+)_(audio|video)/),d=void 0,c=void 0,u=void 0;if(s&&s.length>=5&&(d=s[1],s[2],c=s[3],u=s[4]),t==c){if(a=e[o].packetsReceived,"audio"===u){if(i=e[o].googDecodingNormal,n=e[o].audioOutputLevel,r===u)break}else if(i=e[o].framesDecoded,r===u)break}else if(t==d&&"0"==c)if(a=e[o].packetsSent,"audio"===u){if(i=e[o].packetsSentPerSecond,r===u)break}else if(i=e[o].googFrameHeightSent,r===u)break}return this.adapterRef.logger.log("解析: ",r," stats: ",{decode:i,recvStream:a,remoteAudioVolume:n}),{decode:i,recvStream:a,remoteAudioVolume:n}}this.adapterRef.logger.log("获取播放状态: ",e);var r=this.adapterRef.instance._getUidByAccount(e);if(r){var i={audioState:null,videoState:null},a=this.adapterRef.instance._getAudioHelperByUid(r),n=this.adapterRef.instance._getVideoHelperByUid(r),o=this.adapterRef.statsReportHelper&&this.adapterRef.statsReportHelper.formatDataFromStats.webrtcStats,s={},c={};if(o&&o.length>1){var u=t(o[0],r,"audio"),l=t(o[1],r,"audio"),p=t(o[0],r,"video"),f=t(o[1],r,"video");r===this.adapterRef.imInfo.uid?(s.decode=l.decode>0&&u.decode>0,s.recvStream=l.recvStream-u.recvStream>0,s.remoteAudioVolume=l.remoteAudioVolume,s.beSelf=!0,c.decode=f.decode>0&&p.decode>0,c.recvStream=f.recvStream-p.recvStream>0):(s.decode=l.decode-u.decode>0,s.recvStream=l.recvStream-u.recvStream>0,s.remoteAudioVolume=l.remoteAudioVolume,s.beSelf=!1,c.decode=f.decode-p.decode>0,c.recvStream=f.recvStream-p.recvStream>0)}return this.adapterRef.logger.warn("currentAudioStats: ",s),this.adapterRef.logger.warn("currentVidooStats: ",c),a&&(i.audioState=a.getPlayState(s)),n&&(i.videoState=n.getPlayState(c)),this.adapterRef.logger.warn("playState: ",JSON.stringify(i,null,"")),Promise.resolve(i)}return this.adapterRef.logger.log("获取播放状态，账号(%s)不存在",e),Promise.reject(d.CommonErrorCode.ParamError)}}]),t}(s.EventEmitter);t.PlayApi=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommonApi=void 0;var i=s(r(1)),a=s(r(2)),n=s(r(4)),o=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"_doStopDevice4PlayVideo",value:function(e){return Promise.resolve()}},{key:"setAudioBlack",value:function(e){var t=this;if(e)if(-1==e){this.adapterRef.instance._getAudioHelperByUid("local").stopAudio()}else{this.adapterRef.instance._getAudioHelperByUid(e).stopAudio(),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"mute_remote_audio"})}else Object.keys(this.adapterRef.audioHelperMap).map(function(e){if(e=""+e,""+t.adapterRef.imInfo.uid!==e){var r=t.adapterRef.instance._getAudioHelperByUid(e);t.adapterRef.apiReportHelper.uploadDataApi("update",{key:"mute_remote_audio"}),r.stopAudio()}})}},{key:"setAudioStart",value:function(e){-1==e?this.adapterRef.deviceApi._doStartDevice4PlayLocalAudio():this.adapterRef.deviceApi._doStartDevice4PlayRemoteAudio(e)}},{key:"setVideoBlack",value:function(e){}},{key:"setVideoShow",value:function(e){}},{key:"startRtc",value:function(){return this.adapterRef.instance._startSession()}}]),t}(r(12).EventEmitter);t.CommonApi=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.P2P4WebRTCApi=void 0;var i=c(r(1)),a=c(r(2)),n=c(r(4)),o=c(r(3)),s=r(12),d=r(11);function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"call",value:function(e){if(this.adapterRef.calling)return Promise.reject(d.CommonErrorCode.ChannelAlreadyInSession);var t=e.account,r=e.type,i=e.pushConfig,a=e.sessionConfig;if(this.adapterRef.calling=!0,this.adapterRef.isCaller=!0,this.adapterRef.callee=t,this.adapterRef.target.account=t,this.adapterRef.instance._setSessionConfig(a),this.adapterRef.instance._setSessionConfig({signalStartTime:Date.now()}),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"p2p"}),a.highAudio&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"hd_audio"}),i.forceKeepCalling&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"always_keep_calling"}),void 0!==a.videoFrameRate&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"fps",ext:0==+a.videoFrameRate?0:+a.videoFrameRate+1}),void 0!==a.videoQuality){var n=+a.videoQuality;n===d.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_540P?n=d.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_720P:n===d.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_720P&&(n=d.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_540P),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_quality",ext:n||0})}return this.adapterRef.imBusiness.initNetcall({type:r,pushConfig:i})}},{key:"setNetcallSession",value:function(e){return this.adapterRef.calling?Promise.reject(d.CommonErrorCode.ChannelAlreadyInSession):(this.adapterRef.signalInited=!0,this.adapterRef.calling=!0,this.adapterRef.channelId=e.channelId,this.adapterRef.imInfo=e,this.adapterRef.type=e.netcallType,this.adapterRef.imInfo.serverAddrs=e.rtcServerMap,this.adapterRef.imInfo.rtcUrls=e.rtcServerMap,this.beCalledInfo=this.adapterRef.imInfo,this.adapterRef.imInfo.sessionConfig&&this.adapterRef.instance._setSessionConfig(this.adapterRef.imInfo.sessionConfig),this.adapterRef.imBusiness._parseAccountUidMap(e.accountUidMap),Promise.resolve())}},{key:"response",value:function(e){var t=e.sessionConfig,r=void 0===t?{}:t,i=e;if(this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"p2p"}),r.highAudio&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"hd_audio"}),void 0!==r.videoFrameRate&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"fps",ext:0==+r.videoFrameRate?0:+r.videoFrameRate+1}),void 0!==r.videoQuality){var a=+r.videoQuality;a===d.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_540P?a=d.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_720P:a===d.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_720P&&(a=d.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_540P),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_quality",ext:a||0})}return i.fn="calleeAck",this.adapterRef.imBusiness.baseResponse(i)}},{key:"hangup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.fn="hangup",e.recordType="cancelNetcallBeforeAccept",this.adapterRef.imBusiness.baseHangup(e)}},{key:"control",value:function(e){var t=e;return t.fn="netcallControl",this.adapterRef.imBusiness.baseControl(t)}},{key:"switchAudioToVideo",value:function(){if(this.adapterRef.logger.log("switchAudioToVideo"),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"switch_p2p_type"}),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"audio_to_video"}),!this.adapterRef.webrtcGateWayBusiness.webRTCGateWayManager.state.hasLogined)return Promise.reject(d.CommonErrorCode.ChannelSessionNotExists);var e=this.adapterRef.instance._getUidByAccount(this.adapterRef.imInfo.account);return this.adapterRef.instance._getVideoHelperByUid(e)&&this.adapterRef.webrtcBusiness._enableDevice(d.DEVICE_TYPE.DEVICE_TYPE_VIDEO),this.adapterRef.type=d.NETCALL_TYPE.NETCALL_TYPE_VIDEO,Promise.resolve()}},{key:"switchVideoToAudio",value:function(){if(this.adapterRef.logger.log("switchVideoToAudio"),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"switch_p2p_type"}),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_to_audio"}),!this.adapterRef.webrtcGateWayBusiness.webRTCGateWayManager.state.hasLogined)return Promise.reject(d.CommonErrorCode.ChannelSessionNotExists);var e=this.adapterRef.instance._getUidByAccount(this.adapterRef.imInfo.account);return this.adapterRef.instance._getVideoHelperByUid(e)&&this.adapterRef.webrtcBusiness._disableDevice(d.DEVICE_TYPE.DEVICE_TYPE_VIDEO),this.adapterRef.type=d.NETCALL_TYPE.NETCALL_TYPE_AUDIO,Promise.resolve()}}]),t}(s.EventEmitter);t.P2P4WebRTCApi=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Meeting4WebRTC2Api=void 0;var i=l(r(1)),a=l(r(2)),n=l(r(4)),o=l(r(3)),s=r(12),d=(r(27),r(11)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(5)),u=r(51);function l(e){return e&&e.__esModule?e:{default:e}}r(218).version;var p=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"joinChannel",value:function(e){var t=this,r=(e.appkey,e.channelName),i=e.uid,a=e.videoMode;e.wssArr,e.scene,e.joinChannelRecordConfig,e.joinChannelLiveConfig,c.nrtcWebRTC2;if(this.adapterRef.signalInited)return Promise.reject(d.CommonErrorCode.ChannelJoinAlreadyIn);window.channelName=r,this.adapterRef.imInfo.uid=i;var n=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.uid),o=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.uid),s=[];return n.getLocalVideoStream()&&s.push(this.adapterRef.deviceApi.stopDevice(d.DEVICE_TYPE.DEVICE_TYPE_VIDEO)),o.getLocalAudioStream()&&s.push(this.adapterRef.deviceApi.stopDevice(d.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN)),Promise.all(s).then(function(){t.adapterRef.signalInited=!0,t.adapterRef.instance._startSessionInit();var r=t.adapterRef.tempInfo,i=(r.localVideoDisabled,r.localAudioDisabled),n=void 0!==i&&i,o=Object.assign({},e,{video:a,//!localVideoDisabled,
audio:!n});return t.adapterRef.instance._startDevicesByMode(o)}).then(function(){return t.adapterRef.webrtcGateWayBusiness.doTryInit()}).then(function(){console.error("开始推流 音频"),a?t.adapterRef.instance._startPushAudioStream().then(function(){console.error("音频流推完，开始推流 视频频"),t.adapterRef.instance._startPushVideoStream().then(function(){return console.error("视频推流 完成"),Promise.resolve()})}):t.adapterRef.instance._startPushAudioStream().then(function(){return console.error("音频流推完"),Promise.resolve()})}).then(function(){console.error("播放音视频");var e=t.adapterRef.tempInfo;return e.localContainer&&t.adapterRef.instance.setLocalVideoRenderer(),e.localViewParams&&t.adapterRef.instance.setLocalRenderMode(e.localViewParams),Promise.resolve()}).catch(function(r){var a=r.event||{},n=e.joinChannelRecordConfig,o=e.scene;try{var s="";a.ips?a.ips.webrtcarray&&(s=a.ips.webrtcarray[0].split("ip=")[1].split(":")[0]):s="";var c=new u.CommonDataReport({adapterRef:t.adapterRef,sdkRef:t.sdkRef});c.setLogin({uid:i,cid:a.cid||"",meeting_mode:o===d.SESSION_MODE.MEETING?1:0,a_record:n.recordAudio,v_record:n.recordVideo,record_type:n.recordType,host_speaker:n.isHostSpeaker,server_ip:s,time:Date.now(),network:"UNKNOWN",result:-2}),c.send(),c=null}catch(r){t.adapterRef.logger.error(r)}return Promise.reject(r)})}},{key:"leaveChannel",value:function(){var e=this;return this.adapterRef.signalInited?(this.adapterRef.signalInited=!1,console.warn("离开房间"),this.adapterRef.instance._getWebRTCGateWayManager().doSendLogout().then(function(){return e.adapterRef.instance._stopSession()})):(this.adapterRef.logger.error("Meeting: leaveChannel: signalInited为false！"),Promise.reject(d.CommonErrorCode.ChannelSessionNotExists))}},{key:"subResolution",value:function(e){return this.adapterRef.signalInited?(console.warn("subResolution"),this.adapterRef.webrtcBusiness._subResolution(e)):(this.adapterRef.logger.error("Meeting: subResolution: signalInited为false！"),Promise.reject(d.CommonErrorCode.ChannelSessionNotExists))}}]),t}(s.EventEmitter);t.Meeting4WebRTC2Api=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Meeting4WebRTCApi=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(27),c=r(11);r(51);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"createChannel",value:function(e){var t=this,r=e;return this.adapterRef.logger.log("创建房间, options: ",JSON.stringify(r,null,"")),d.tool.verifyOptions(r,"channelName"),r.custom=r.custom||"",r.webrtcEnable=!0,r.rtmpConf&&r.rtmpConf.rtmpTasks&&r.rtmpConf.rtmpTasks.length&&(r.rtmpConf=JSON.stringify(r.rtmpConf)),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"meeting"}),this.adapterRef.instance._setSessionConfig({signalStartTime:Date.now()}),this.adapterRef.imBusiness.baseCreateChannel("createChannel",r).then(function(e){return Promise.resolve(e)}).catch(function(e){return t.adapterRef.logger.error("Meeting: createChannel: error=%o",e),t.adapterRef.instance._setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})}},{key:"joinChannel",value:function(e){var t=this,r=e;if(this.adapterRef.signalInited)return this.adapterRef.logger.error("Meeting: joinChannel: 已经加入房间..."),Promise.reject(c.CommonErrorCode.ChannelJoinAlreadyIn);d.tool.verifyOptions(r,"channelName type"),this.adapterRef.logger.log("Meeting: joinChannel conf: ",JSON.stringify(e,null," "));var i=r.sessionConfig,a=void 0===i?{}:i;return a.liveEnable=r.liveEnable||a.liveEnable,a.rtmpRecord=r.rtmpRecord||a.rtmpRecord,this.adapterRef.instance._setSessionConfig(a),this.adapterRef.instance._setSessionConfig({signalStartTime:Date.now()}),this.adapterRef.imBusiness.baseJoinChannel("joinChannel",{channelName:r.channelName,liveEnable:r.liveEnable,rtmpRecord:r.rtmpRecord}).then(function(e){return t.adapterRef.logger.log("Meeting: joinChannel: success"),t.adapterRef.type=e.type=r.type,e.account=t.adapterRef.nim.account,t.adapterRef.imInfo=Object.assign(t.adapterRef.imInfo,e),t.adapterRef.imInfo.role=void 0===r.role?c.ROLE_FOR_MEETING.ROLE_PLAYER:r.role,t.adapterRef.channelId=e.channelId,t.adapterRef.apiReportHelper.uploadDataApi("start",{uid:e.uid}),t.adapterRef.instance._getVideoHelperByUid(t.adapterRef.imInfo.uid),t.adapterRef.instance._getAudioHelperByUid(t.adapterRef.imInfo.uid),Promise.resolve({uid:e.uid,account:t.adapterRef.nim.account,channelId:t.adapterRef.channelId,type:e.type,custom:e.custom})}).catch(function(e){t.adapterRef.logger.log("Meeting: joinChannel: error=%o",e);try{var i=r.sessionConfig,a=r.scene,n=e.event||{},o="";if(n.serverMap){var s="string"==typeof n.serverMap?JSON.parse(n.serverMap):n.serverMap;s.webrtcarray.length&&(o=s.webrtcarray[0].split("ip=")[1].split(":")[0])}else o="";t.adapterRef.instance.commondDatareport("setLogin",{uid:t.adapterRef.instance.getUid(),cid:t.adapterRef.channelId||"",meeting_mode:"p2p"==a?0:1,a_record:i.recordAudio,v_record:i.recordVideo,record_type:i.recordType,host_speaker:i.isHostSpeaker,server_ip:o,time:Date.now(),network:"UNKNOWN",result:e.serverCode})}catch(e){t.adapterRef.logger.error(e)}return Promise.reject(e)})}},{key:"leaveChannel",value:function(){return this.adapterRef.imInfo&&this.adapterRef.imInfo.netDetect?(this.adapterRef.apiReportHelper.uploadDataApi("send"),this.adapterRef.logReportHelper.uploadData("send"),this.adapterRef.statsReportHelper&&this.adapterRef.statsReportHelper.stopStats(),this.adapterRef.imBusiness.hangup(),this.adapterRef.instance._resetStatus(),Promise.resolve()):this.adapterRef.signalInited?this.adapterRef.sessionMode?this.adapterRef.sessionMode!==c.SESSION_MODE.MEETING?(this.adapterRef.logger.error("Meeting: leaveChannel: 不是一个会议通话！"),Promise.reject(c.CommonErrorCode.ChannelJoinMeetingModeError)):(this.adapterRef.logger.log("Meeting: leaveChannel"),this.adapterRef.apiReportHelper.uploadDataApi("send"),this.adapterRef.logReportHelper.uploadData("send"),this.adapterRef.statsReportHelper&&this.adapterRef.statsReportHelper.stopStats(),this.adapterRef.imBusiness.hangup(),this.adapterRef.instance._resetStatus(),Promise.resolve()):(this.adapterRef.logger.error("Meeting: leaveChannel: sessionMode为空！"),Promise.reject(c.CommonErrorCode.ChannelSessionNotExists)):(this.adapterRef.logger.error("Meeting: leaveChannel: signalInited为空！"),Promise.reject(c.CommonErrorCode.ChannelSessionNotExists))}},{key:"changeRoleToPlayer",value:function(){if(this.adapterRef.imInfo.sessionMode!==c.SESSION_MODE.P2P)return this.adapterRef.imInfo.role===c.ROLE_FOR_MEETING.ROLE_PLAYER?Promise.resolve({role:"player"}):(this.adapterRef.imInfo.role=c.ROLE_FOR_MEETING.ROLE_PLAYER,this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"actor"}),this.adapterRef.webrtcBusiness._switchRole().then(function(){return Promise.resolve({role:"normal"})}));this.adapterRef.logger.error("Meeting: changeRoleToPlayer: 点对点场景不支持此方法")}},{key:"changeRoleToAudience",value:function(){if(this.adapterRef.imInfo.sessionMode!==c.SESSION_MODE.P2P)return this.adapterRef.imInfo.role===c.ROLE_FOR_MEETING.ROLE_AUDIENCE?Promise.resolve({role:"player"}):(this.adapterRef.imInfo.role=c.ROLE_FOR_MEETING.ROLE_AUDIENCE,this.adapterRef.webrtcBusiness._switchRole().then(function(){return Promise.resolve({role:"audience"})}));this.adapterRef.logger.error("Meeting: changeRoleToAudience: 点对点场景不支持此方法")}}]),t}(s.EventEmitter);t.Meeting4WebRTCApi=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Meeting4NRTCApi=void 0;var i=p(r(1)),a=p(r(2)),n=p(r(4)),o=p(r(3)),s=r(12),d=r(27),c=r(11),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(5)),l=r(51);function p(e){return e&&e.__esModule?e:{default:e}}r(218).version;var f=r(218).nrtcVersion,h=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"joinChannel",value:function(e){var t=this,r=e.appkey,i=e.channelName,a=e.uid,n=e.wssArr,o=e.scene,s=e.joinChannelRecordConfig,p=e.joinChannelLiveConfig,h=u.nrtcNetcall;return this.adapterRef.signalInited?Promise.reject(c.CommonErrorCode.ChannelJoinAlreadyIn):(this.adapterRef.instance._setSessionConfig({signalStartTime:Date.now()}),(0,d.ajax)({url:h.checkSumUrl,type:"POST",contentType:"application/x-www-form-urlencoded",data:{uid:a,appkey:r}}).then(function(e){if(200===e.code)return(0,d.ajax)({url:h.getChannelInfoUrl,type:"POST",contentType:"application/x-www-form-urlencoded",data:{uid:a,appkey:r,channelName:i,secureType:"1",osType:"4",mode:o===c.SESSION_MODE.MEETING?2:1,netType:"0",version:f+".0"||"1.0.0.0",curtime:+new Date,checksum:e.checksum,webrtc:1}},{url:h.getChannelInfoUrl});var t=Object.assign({serverCode:e.code,event:e},c.GateWayErrorCode.GateWayAuthError);return Promise.reject(t)}).then(function(e){if(200!==e.code){var r=Object.assign({serverCode:e.code,event:e},c.GateWayErrorCode.GateWayAuthError);return Promise.reject(r)}t.adapterRef.imInfo||(t.adapterRef.imInfo={}),t.adapterRef.instance._setSessionConfig({signalEndTime:Date.now()});var i=e.ips,d=void 0===i?{}:i,u=e.config&&e.config.quality_level_limit||c.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_720P;Object.assign(t.adapterRef.imInfo,{cid:e.cid,token:e.token,turnToken:d.token,wssArr:n||d.webrtcarray||[],relayaddrs:d.relayaddrs||null,relaytoken:d.relaytoken||null,maxVideoQuality:u,netDetect:!1},{uid:a,sessionMode:o}),t.adapterRef.instance._setSessionConfig(Object.assign({maxVideoQuality:u},p,s))}).then(function(){var e=t.adapterRef.instance._getVideoHelperByUid(t.adapterRef.imInfo.uid),r=t.adapterRef.instance._getAudioHelperByUid(t.adapterRef.imInfo.uid),i=[];return e.getLocalVideoStream()&&i.push(t.adapterRef.deviceApi.stopDevice(c.DEVICE_TYPE.DEVICE_TYPE_VIDEO)),r.getLocalAudioStream()&&i.push(t.adapterRef.deviceApi.stopDevice(c.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN)),Promise.all(i)}).then(function(){t.adapterRef.signalInited=!0,t.adapterRef.instance._startSessionInit();var r=t.adapterRef.tempInfo,i=r.localVideoDisabled,a=void 0!==i&&i,n=r.localAudioDisabled,o=void 0!==n&&n,s=Object.assign({},e,{video:!a,audio:!o});return t.adapterRef.instance._startDevicesByMode(s)}).then(function(){return t.adapterRef.webrtcGateWayBusiness.doTryInit()}).then(function(){return t.adapterRef.tempInfo.localVideoDisabled||t.adapterRef.tempInfo.localVideoMuted||t.adapterRef.instance._startPushVideoStream(),t.adapterRef.tempInfo.localAudioDisabled||t.adapterRef.tempInfo.localAudioMuted||t.adapterRef.instance._startPushAudioStream(),Promise.resolve()}).then(function(){var e=t.adapterRef.tempInfo;return e.localContainer&&t.adapterRef.instance.setLocalVideoRenderer(),e.localViewParams&&t.adapterRef.instance.setLocalRenderMode(e.localViewParams),Promise.resolve()}).catch(function(r){var i=r.event||{},n=e.joinChannelRecordConfig,o=e.scene;try{var s="";i.ips?i.ips.webrtcarray&&(s=i.ips.webrtcarray[0].split("ip=")[1].split(":")[0]):s="";var d=new l.CommonDataReport({adapterRef:t.adapterRef,sdkRef:t.sdkRef});d.setLogin({uid:a,cid:i.cid||"",meeting_mode:o===c.SESSION_MODE.MEETING?1:0,a_record:n.recordAudio,v_record:n.recordVideo,record_type:n.recordType,host_speaker:n.isHostSpeaker,server_ip:s,time:Date.now(),network:"UNKNOWN",result:-2}),d.send(),d=null}catch(r){t.adapterRef.logger.error(r)}return Promise.reject(r)}))}},{key:"leaveChannel",value:function(){return this.adapterRef.signalInited?(this.adapterRef.signalInited=!1,this.adapterRef.instance._stopSession()):(this.adapterRef.logger.error("Meeting: leaveChannel: signalInited为false！"),Promise.reject(c.CommonErrorCode.ChannelSessionNotExists))}}]),t}(s.EventEmitter);t.Meeting4NRTCApi=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecordApi=void 0;var i=l(r(1)),a=l(r(2)),n=l(r(4)),o=l(r(3)),s=r(12),d=r(11),c=r(27),u=r(51);function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r.recordId=1,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"_preParseOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="local",r="",i=e.type||"video",a=!1;return c.tool.isString(e)?(t=this.adapterRef.instance._getUidByAccount(e))||(t=e):c.tool.isObject(e)&&(c.tool.isString(e.mediaType)?(a=!0,t="local"):(e.account?(t=this.adapterRef.instance._getUidByAccount(e.account),r=e.account):(t=e.uid||"local",r=this.adapterRef.instance.getAccount()),t!==this.adapterRef.imInfo.uid&&"local"!==t||(a=!0))),{recordName:t+"-"+this.recordId++,uid:t,account:r,mediaType:i,isRecordLocal:a}}},{key:"startMediaRecording",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reset,r=this._preParseOptions(e),i=r.uid,a=void 0===i?"local":i,n=r.account,o=r.recordName,s=r.mediaType,c=r.isRecordLocal;this.adapterRef.apiReportHelper&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_record"});var l=this.adapterRef.instance._getAudioHelperByUid(a),p=this.adapterRef.instance._getVideoHelperByUid(a);if(!l||!p)return Promise.reject(d.VideoRecordErrorCode.VideoRecordInvalid);var f=[];if(c){var h=l.getLocalAudioStream();switch(s){case"screen":p.getLocalScreenStream()&&f.push(p.getLocalScreenStream()),h&&f.push(h),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"record"});break;case"camera":p.getLocalCameraStream()&&f.push(p.getLocalCameraStream()),h&&f.push(h),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"record"});break;case"video":p.getLocalVideoStream()&&f.push(p.getLocalVideoStream()),h&&f.push(h),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"record"});break;case"audio":var m=this.adapterRef.audioHelperMap;Object.values(m).forEach(function(e){(e.remoteAudioStream||e.localAudioStream)&&f.push(e.remoteAudioStream||e.localAudioStream)});var g=this.adapterRef.instance._getAudioHelperByUid("local");g&&g.localAudioStream&&f.push(g.localAudioStream),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"audio_record"})}}else l.remoteAudioStream&&(this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"audio_record"}),f.push(l.remoteAudioStream)),p.remoteVideoStream&&(f.push(p.remoteVideoStream),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"record"}));var v=this.adapterRef.mediaRecordHelper[o];return v||(v=this.adapterRef.mediaRecordHelper[o]=new u.MediaRecordHelper({sdkRef:this.sdkRef,adapterRef:this.adapterRef})).on("stop",this._onRecordStop.bind(this)),0===f.length?(delete this.adapterRef.mediaRecordHelper[o],Promise.reject(d.VideoRecordErrorCode.RecordNoStream)):v.checkIsRecording()?(this.adapterRef.logger.log("Record: startMediaRecording: 视频正在录制中..."),Promise.resolve({recordId:o})):v.start(f,{uid:a,account:n,type:s,reset:t}).then(function(){return Promise.resolve({recordId:o})})}},{key:"stopMediaRecording",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).recordId;if(!e)return Promise.reject(d.CommonErrorCode.ParamError);var t=this.adapterRef.mediaRecordHelper[e];return t&&t.checkIsRecording()?t.stop():Promise.reject(d.VideoRecordErrorCode.RecordNotExist)}},{key:"stopMediaRecordingByUid",value:function(e){var t=this;this.adapterRef.mediaRecordHelper&&Object.values(this.adapterRef.mediaRecordHelper).forEach(function(r){var i=r.getRecordStatus();e&&i.uid!==""+e||r.checkIsRecording()&&(t.adapterRef.logger.log("RecordApi::stopMediaRecordingByUid: "+i.recordId),r.stop())})}},{key:"playMediaRecording",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.recordId;if(!t)return Promise.reject(d.CommonErrorCode.ParamError);var r=this.adapterRef.mediaRecordHelper[t];return r&&r.checkIsRecording()?r.stop().then(function(){return r.play(e.div)}):r.checkIsRecording()?Promise.reject(d.VideoRecordErrorCode.RecordNotExist):r.play(e.div)}},{key:"listMediaRecording",value:function(){var e={},t=this.adapterRef.mediaRecordHelper;return Object.keys(t).forEach(function(r){t[r]&&(e[r]=t[r].getRecordStatus(),e[r].id=r)}),e}},{key:"downloadMediaRecording",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).recordId;if(!e)return Promise.reject(d.CommonErrorCode.ParamError);var t=this.adapterRef.mediaRecordHelper[e];return t?t.download():Promise.reject(d.VideoRecordErrorCode.RecordNotExist)}},{key:"cleanMediaRecording",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).recordId;if(!e)return Promise.reject(d.CommonErrorCode.ParamError);var t=this.adapterRef.mediaRecordHelper[e];return t&&t.checkIsRecording()?t.clean():Promise.resolve()}},{key:"_onRecordStop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.instance.emit(d.EVENT_OBJ.recordStopped.key,e)}}]),t}(s.EventEmitter);t.RecordApi=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureApi=void 0;var i=s(r(1)),a=s(r(2)),n=s(r(4)),o=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"setCaptureVolume",value:function(e){return Number.isInteger(e)?(e<0?e=0:e>255&&(e=255),this.adapterRef.instance._getAudioHelperByUid("local").setGain(e/255),e):-1}},{key:"getCaptureVolume",value:function(e){var t=this.adapterRef.instance._getAudioHelperByUid("local").getGain();return Math.round(255*t)}}]),t}(r(12).EventEmitter);t.CaptureApi=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceApi=void 0;var i=c(r(1)),a=c(r(2)),n=c(r(4)),o=c(r(3)),s=r(12),d=r(11);function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"getDevicesOfType",value:function(e){if(e==d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_AUDIO||e==d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_VIDEO)return Promise.resolve([]);var t=this.sdkRef.getDeviceTypeMap(e);return this.adapterRef&&this.adapterRef.deviceBusiness&&this.adapterRef.deviceBusiness.mediaDeviceHelper?(this.adapterRef.logger.log("getDevicesOfType deviceBusiness map2key: ",t),this.adapterRef.deviceBusiness.mediaDeviceHelper.getDevicesOfType(t)):(this.adapterRef.logger.error("getDevicesOfType deviceBusiness undefined: ",this.adapterRef),Promise.reject(d.DeviceErrorCode.DeviceNotAvailable))}},{key:"startDevice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=e.device,i=e.account,a=e.uid,n=e.enableEchoCancellation,o=void 0===n||n,s=e.chromeSourceId,c=e.audioSource,u=void 0===c?null:c,l=e.videoSource,p=void 0===l?null:l;return t===d.DEVICE_TYPE.DEVICE_TYPE_AUDIO_OUT_LOCAL?(this.adapterRef.logger.log("Device: 播放本地声音"),this._doStartDevice4PlayLocalAudio()):t===d.DEVICE_TYPE.DEVICE_TYPE_AUDIO_OUT_CHAT?(!a&&i&&(a=this.adapterRef.instance._getUidByAccount(i)),this.adapterRef.logger.log("Device: 播放远端声音, options ",JSON.stringify(e,null," ")),this._doStartDevice4PlayRemoteAudio(a)):t===d.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN?(this.adapterRef.state.lastDeviceStatus.audio={type:t,device:r},this.adapterRef.state.audioDeviceHasOpened=!0,this.adapterRef.logger.log("Device: 开启麦克风, options ",JSON.stringify(e,null," ")),this._doStartDeviceCommon(t,r,o)):t===d.DEVICE_TYPE.DEVICE_TYPE_VIDEO?(this.adapterRef.state.lastDeviceStatus.video={type:t,device:r},this.adapterRef.state.videoDeviceHasOpened=!0,this.adapterRef.mixVideoConf||(this.adapterRef.state.chromeScreenShareOpened=!1),this.adapterRef.logger.log("Device: 开启摄像头, options ",JSON.stringify(e,null," ")),this._doStartDeviceCommon(t,r)):t===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_SCREEN||t===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_WINDOW||t===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN?(this.adapterRef.apiReportHelper&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"screen_sharing_module"}),this.adapterRef.state.chromeScreenShareOpened=!0,this.adapterRef.mixVideoConf||(this.adapterRef.state.videoDeviceHasOpened=!1),this.adapterRef.logger.log("Device: 开启屏幕共享, options ",JSON.stringify(e,null," ")),this._doStartDeviceCommon(t,r,null,s)):t===d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_AUDIO?(this.adapterRef.state.lastDeviceStatus.audio={type:t,device:r},this.adapterRef.state.audioDeviceHasOpened=!0,this.adapterRef.logger.log("Device: 发送自定义音频数据, options ",JSON.stringify(e,null," ")),this._doStartDeviceCommon(t,r,null,null,u)):t===d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_VIDEO?(this.adapterRef.state.lastDeviceStatus.video={type:t,device:r},this.adapterRef.state.videoDeviceHasOpened=!0,this.adapterRef.mixVideoConf||(this.adapterRef.state.chromeScreenShareOpened=!1),this.adapterRef.logger.log("Device: 发送自定义视频数据, options ",JSON.stringify(e,null," ")),this._doStartDeviceCommon(t,r,null,null,null,p)):Promise.reject(d.DeviceErrorCode.DeviceNotSupport)}},{key:"_doStartDeviceCommon",value:function(e,t,r,i,a,n){var o=this,s=Promise.resolve(),c=this,u=!t||!t.deviceId;u&&(s=this.getDevicesOfType(e));var l=e===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_SCREEN||e===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_WINDOW||e===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN;function p(){l?c.adapterRef.instance._getVideoHelperByUid("local")&&c.adapterRef.instance._getVideoHelperByUid("local").localVideoStream?c.adapterRef.state.chromeScreenShareOpened=!0:c.adapterRef.state.chromeScreenShareOpened=!1:e===d.DEVICE_TYPE.DEVICE_TYPE_VIDEO&&(c.adapterRef.instance._getVideoHelperByUid("local")&&c.adapterRef.instance._getVideoHelperByUid("local").localVideoStream?c.adapterRef.state.videoDeviceHasOpened=!0:c.adapterRef.state.videoDeviceHasOpened=!1)}return new Promise(function(c,f){s.then(function(s){var h=null;if(e==d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_AUDIO||e==d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_VIDEO);else if(u&&!l){if(!s||0==s.length)return o.adapterRef.logger.log("%s设备列表为空",e),p(),void f(d.DeviceErrorCode.DeviceNotExists);h=s[0]}else h=t;if(e===d.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN){var m=o.adapterRef.instance._getAudioHelperByUid("local");return m.hasStartAudioDeviceRepeat(h).then(function(){return m.startAudioDevice(h,r,null,c,f)}).catch(function(e){/重复操作/.test(e)?(o.adapterRef.logger("音频设备重复开启"),c()):(o.adapterRef.logger("音频设备检测出错"),m.localAudioStream?o.adapterRef.state.audioDeviceHasOpened=!0:o.adapterRef.state.audioDeviceHasOpened=!1,e=Object.assign(d.DeviceErrorCode.DeviceAudioOccupied,{event:e}),f(e))})}if(e===d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_AUDIO)return o.adapterRef.instance._getAudioHelperByUid("local").startAudioDevice(h,r,a,c,f);if(e===d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_VIDEO)return o.adapterRef.instance._getVideoHelperByUid("local").startVideoDevice(h,n,c,f);if(e===d.DEVICE_TYPE.DEVICE_TYPE_VIDEO){var g=o.adapterRef.instance._getVideoHelperByUid("local");return g.hasStartVideoDeviceRepeat(h).then(function(){return g.startVideoDevice(h,null,c,f)})}if(l){var v=o.adapterRef.instance._getVideoHelperByUid("local");return v.hasStartScreenShareRepeat().then(function(){return v.startScreenShare(i,c,f)})}}).catch(function(e){o.adapterRef.logger.log("媒体设备检测出错: ",e),p(),e=Object.assign(d.DeviceErrorCode.DeviceOpenError,{event:e}),f(e)})})}},{key:"stopDevice",value:function(e){var t=this;return new Promise(function(r,i){if(e===d.DEVICE_TYPE.DEVICE_TYPE_VIDEO){if(t.adapterRef.logger.log("Device: stopDevice: 关闭摄像头"),!t.adapterRef.state.videoDeviceHasOpened)return t.adapterRef.logger.log("Device: stopDevice: 当前没有开启摄像头，直接返回"),r(d.VideoErrorCode.VideoStreamFetchError);var a=t.adapterRef.instance._getVideoHelperByUid("local");return t.adapterRef.state.videoDeviceHasOpened=!1,a?a.stopVideoDevice(r):(t.adapterRef.logger.error("Device: stopDevice: 不存在的videoHelper对象，直接返回"),i(d.DeviceErrorCode.DeviceNotOpen))}if(e===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_SCREEN||e===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_WINDOW||e===d.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN){if(t.adapterRef.logger.log("Device: stopDevice: 关闭屏幕共享"),!t.adapterRef.state.chromeScreenShareOpened)return t.adapterRef.logger.log("Device: stopDevice: 当前没有开启屏幕共享，直接返回"),r(d.VideoErrorCode.VideoStreamFetchError);var n=t.adapterRef.instance._getVideoHelperByUid("local");return t.adapterRef.state.chromeScreenShareOpened=!1,n?n.stopScreenShare(r):(t.adapterRef.logger.error("Device: stopDevice: 不存在的videoHelper对象，直接返回"),i(d.DeviceErrorCode.DeviceNotOpen))}if(e===d.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN){if(t.adapterRef.logger.log("Device: stopDevice: 关闭麦克风"),!t.adapterRef.state.audioDeviceHasOpened)return t.adapterRef.logger.log("Device: stopDevice: 当前没有开启麦克风，直接返回"),r(d.VideoErrorCode.VideoStreamFetchError);var o=t.adapterRef.instance._getAudioHelperByUid("local");if(t.adapterRef.state.audioDeviceHasOpened=!1,!o)return t.adapterRef.logger.error("Device: stopDevice: 不存在的audioHelper对象，直接返回"),i(d.DeviceErrorCode.DeviceNotOpen);o.destroyMedia(),r()}else if(e===d.DEVICE_TYPE.DEVICE_TYPE_AUDIO_OUT_LOCAL)t.adapterRef.logger.log("Device: stopDevice: 停止本地声音"),t._doStopDevice4PlayLocalAudio(),r();else if(e===d.DEVICE_TYPE.DEVICE_TYPE_AUDIO_OUT_CHAT)t.adapterRef.logger.log("Device: stopDevice: 停止远程声音"),t._doStopDevice4PlayRemoteAudio(),r();else if(e===d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_AUDIO){if(t.adapterRef.logger.log("Device: stopDevice: 停止自定义声音"),!t.adapterRef.state.audioDeviceHasOpened)return t.adapterRef.logger.log("Device: stopDevice: 当前没有开启自定义声音，直接返回"),r(d.VideoErrorCode.VideoStreamFetchError);var s=t.adapterRef.instance._getAudioHelperByUid("local");if(t.adapterRef.state.audioDeviceHasOpened=!1,!s)return t.adapterRef.logger.error("Device: stopDevice: 不存在的audioHelper对象，直接返回"),i(d.DeviceErrorCode.DeviceNotOpen);s.destroyMedia(),r()}else if(e===d.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_VIDEO){if(t.adapterRef.logger.log("Device: stopDevice: 停止自定义视频"),!t.adapterRef.state.videoDeviceHasOpened)return t.adapterRef.logger.log("Device: stopDevice: 当前没有开启自定义视频，直接返回"),r(d.VideoErrorCode.VideoStreamFetchError);var c=t.adapterRef.instance._getVideoHelperByUid("local");return t.adapterRef.state.videoDeviceHasOpened=!1,c?c.stopVideoDevice(r):(t.adapterRef.logger.error("Device: stopDevice: 不存在的videoHelper对象，直接返回"),i(d.DeviceErrorCode.DeviceNotOpen))}})}},{key:"_doStopDevice4PlayLocalAudio",value:function(){return this.adapterRef.instance._getAudioHelperByUid("local").stopAudio(),Promise.resolve()}},{key:"_doStopDevice4PlayRemoteAudio",value:function(e,t){return t||e?t?this._doStopRemoteAudioByUid(t):e&&(t=this.adapterRef.instance._getUidByAccount(e),this._doStopRemoteAudioByUid(t)):this._doStopChatAudioOfAllRemoteAudio(),Promise.resolve()}},{key:"_doStopChatAudioOfAllRemoteAudio",value:function(){var e=this;Object.keys(this.adapterRef.audioHelperMap).forEach(function(t){e._doStopRemoteAudioByUid(t)})}},{key:"_doStopRemoteAudioByUid",value:function(e){""+this.adapterRef.imInfo.uid!=""+e?this.adapterRef.instance._getAudioHelperByUid(e).stopAudio():this.adapterRef.logger.warn("Device: _doStopRemoteAudioByUid: 非远程流账号或UID，无法停止：UID=%s",e)}},{key:"_doStartDevice4PlayLocalAudio",value:function(){return this.adapterRef.instance._getAudioHelperByUid("local").playAudio(),Promise.resolve()}},{key:"_doStartDevice4PlayRemoteAudio",value:function(e){return e?e&&this._doPlayRemoteAudioByUid(e):this._doPlayChatAudioOfAllRemoteAudio(),Promise.resolve()}},{key:"_doPlayChatAudioOfAllRemoteAudio",value:function(){var e=this;Object.keys(this.adapterRef.audioHelperMap).forEach(function(t){e._doPlayRemoteAudioByUid(t)})}},{key:"_doPlayRemoteAudioByUid",value:function(e){if(""+this.adapterRef.imInfo.uid!=""+e){var t=this.adapterRef.instance._getAudioHelperByUid(e);t.setMuted(!1),t.playAudio()}else this.adapterRef.logger.warn("Device: _doStopRemoteAudioByUid: 非远程流账号或UID，无法播放：UID=%s",e)}}]),t}(s.EventEmitter);t.DeviceApi=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(432);Object.defineProperty(t,"DeviceApi",{enumerable:!0,get:function(){return i.DeviceApi}});var a=r(431);Object.defineProperty(t,"CaptureApi",{enumerable:!0,get:function(){return a.CaptureApi}});var n=r(430);Object.defineProperty(t,"RecordApi",{enumerable:!0,get:function(){return n.RecordApi}});var o=r(429);Object.defineProperty(t,"Meeting4NRTCApi",{enumerable:!0,get:function(){return o.Meeting4NRTCApi}});var s=r(428);Object.defineProperty(t,"Meeting4WebRTCApi",{enumerable:!0,get:function(){return s.Meeting4WebRTCApi}});var d=r(427);Object.defineProperty(t,"Meeting4WebRTC2Api",{enumerable:!0,get:function(){return d.Meeting4WebRTC2Api}});var c=r(426);Object.defineProperty(t,"P2P4WebRTCApi",{enumerable:!0,get:function(){return c.P2P4WebRTCApi}});var u=r(425);Object.defineProperty(t,"CommonApi",{enumerable:!0,get:function(){return u.CommonApi}});var l=r(424);Object.defineProperty(t,"PlayApi",{enumerable:!0,get:function(){return l.PlayApi}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IMBusiness=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(27),d=r(11),c=r(110);r(51);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r._bindImEvent(),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null}},{key:"_isCurrentChannelId",value:function(e){return this.adapterRef.channelId&&this.adapterRef.channelId==e}},{key:"resetWhenHangup",value:function(){this.adapterRef.instance._stopSession(),this.adapterRef.nim.protocol.setCurrentNetcall()}},{key:"_initSession",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.sessionMode=d.SESSION_MODE.P2P;var r=this.adapterRef.isCaller?this.adapterRef.callerInfo:t.beCalledInfo;this._parseAccountUidMap(r.accountUidMap),!r.account&&r.uid&&(r.account=this.adapterRef.instance._getAccountByUid(r.uid)),this.adapterRef.callAccepted=!0,this.adapterRef.instance._setSessionConfig({signalEndTime:Date.now()}),this.adapterRef.apiReportHelper.uploadDataApi("start",{uid:r.uid}),this.adapterRef.target.uid=this.adapterRef.instance._getUidByAccount(this.adapterRef.target.account);var i={type:r.type,account:this.adapterRef.target&&this.adapterRef.target.account||r.account,channelId:r.channelId};r.netcallType&&(i.netcallType=r.netcallType),this.adapterRef.imInfo.target=this.target,setTimeout(function(){e.adapterRef.instance.setStartSessionTime(),e.adapterRef.instance.emit(d.EVENT_OBJ.callAccepted.key,i)},1)}},{key:"_bindImEvent",value:function(){this.adapterRef.logger.log("IMBusiness:_bindImEvent");var e=this.adapterRef.nim;e?(e.on("beCalled",this._handleBeCalledEvent.bind(this)),e.on("notifyCalleeAck",this._hanldeNotifyCalleeAckEvent.bind(this)),e.on("notifyHangup",this._hanldeNotifyHangupEvent.bind(this)),e.on("netcallControl",this._handleNetCallControlEvent.bind(this)),e.on("notifyCalleeAckSync",this._handleNotifyCalleeAckSyncEvent.bind(this)),e.on("notifyJoin",this._handleNotifyJoinEvent.bind(this))):this.adapterRef.logger.warn("IMBusiness:_bindImEvent 不存在nim实例...")}},{key:"_unbindImEvent",value:function(){var e=this.adapterRef.nim;e?(e.removeListener("beCalled",this._handleBeCalledEvent.bind(this)),e.removeListener("notifyCalleeAck",this._hanldeNotifyCalleeAckEvent.bind(this)),e.removeListener("notifyHangup",this._hanldeNotifyHangupEvent.bind(this)),e.removeListener("netcallControl",this._handleNetCallControlEvent.bind(this)),e.removeListener("notifyCalleeAckSync",this._handleNotifyCalleeAckSyncEvent.bind(this)),e.removeListener("notifyJoin",this._handleNotifyJoinEvent.bind(this))):this.adapterRef.logger.warn("IMBusiness:_bindImEvent 不存在nim实例...")}},{key:"_handleBeCalledEvent",value:function(e){this.adapterRef.logger.log("IMBusiness: _handleBeCalledEvent event=%o",e),this.adapterRef.beCalledUid=e.account,this.adapterRef.instance.emit(d.EVENT_OBJ.beCalling.key,e)}},{key:"_hanldeNotifyCalleeAckEvent",value:function(e){var t=e.account,r=e.type,i=e.accepted,a=e.channelId;if(this._isCurrentChannelId(a)){this.adapterRef.logger.log("IMBusiness: _hanldeNotifyCalleeAckEvent event=%o \n oldChannelId=%o",JSON.stringify(e,null," "),this.adapterRef.channelId);var n=this.adapterRef.beCalledInfo||this.adapterRef.callerInfo;if(this.adapterRef.target.account=t,this.adapterRef.beCalledUid=t,this.adapterRef.instance._setSessionConfig({signalEndTime:Date.now()}),i)this.adapterRef.callAccepted=!0,this._initSession();else{try{var o=this.adapterRef.imInfo,s=o.cid,c=o.channelId,u=o.uid,l=o.sessionConfig,p=(o.sessionMode,o.serverMap),f=o.wssArr,h="",m=function(e){return e.split("?ip=")[1].split(":")[0]};if(f&&(h+=m(f[0])),p)h=m(("string"==typeof p?JSON.parse(p):p).webrtcarray[0]);this.adapterRef.instance.commondDatareport("setLogin",{uid:""+u,cid:""+(s||c),meeting_mode:0,a_record:l.recordAudio,v_record:l.recordVideo,record_type:l.recordType,host_speaker:l.isHostSpeaker,server_ip:h,time:Date.now(),network:"UNKNOWN",result:1})}catch(e){this.adapterRef.logger.error(e)}this._packNetcallRecord({type:r,channelId:a,isCaller:!0,target:t,recordType:"netcallRejected"}),this.resetWhenHangup(),this.adapterRef.instance.emit(d.EVENT_OBJ.callRejected.key,{type:n.type,account:t})}}else this.adapterRef.logger.warn("IMBusiness: _hanldeNotifyCalleeAckEvent 非当前频道ID的通话，直接忽略...")}},{key:"_hanldeNotifyHangupEvent",value:function(e){var t=this,r=e.channelId,i=e.account,a=e.timetag;this.adapterRef.logger.log("IMBusiness: _hanldeNotifyHangupEvent event=%o, %o",e,this.adapterRef.target),this.adapterRef.beCalledUid?(this.adapterRef.target&&this.adapterRef.target.account==i&&(this.adapterRef.apiReportHelper.uploadDataApi("send"),this.adapterRef.logReportHelper&&this.adapterRef.logReportHelper.uploadData("send"),this.adapterRef.statsReportHelper&&this.adapterRef.statsReportHelper.stopStats(),setTimeout(function(){t.adapterRef.logger.log("IMBusiness: _hanldeNotifyHangupEvent 主动挂断处理，1s后"),t.resetWhenHangup()},1e3),this.adapterRef.instance.setEndSessionTime()),this.adapterRef.instance.emit(d.EVENT_OBJ.hangup.key,Object.assign(d.EVENT_CODE.USER_LEFT_REASON.quit,{channelId:r,account:i,timetag:a}))):this.adapterRef.logger.warn("IMBusiness: _hanldeNotifyHangupEvent 未定义的beCalledUid ... ")}},{key:"_handleNetCallControlEvent",value:function(e){this.adapterRef.logger.log("IMBusiness: _handleNetCallControlEvent event=%o",JSON.stringify(e,null," "));var t={};t.channelId=e.channelId,t.type=e.type,t.command=e.type,e.account&&(t.account=e.account),this.adapterRef.instance.emit(d.EVENT_OBJ.control.key,t)}},{key:"_handleNotifyCalleeAckSyncEvent",value:function(e){this.adapterRef.logger.log("IMBusiness: _handleNotifyCalleeAckSyncEvent event=%o",e);var t=e.timetag,r=e.channelId,i=e.type,a=e.accepted,n=e.fromClientType;this.adapterRef.instance.emit(d.EVENT_OBJ.callerAckSync.key,{timetag:t,channelId:r,type:i,accepted:a,fromClientType:n}),this._isCurrentChannelId(r)&&this.resetWhenHangup()}},{key:"_handleNotifyJoinEvent",value:function(e){this.adapterRef.logger.log("IMBusiness: _handleNotifyJoinEvent event=%o",e);var t=e.accountUidMap;this._parseAccountUidMap(t);var r=this.adapterRef.needQueryAccountMap;for(var i in t){var a=t[i];if(a in r){var n=r[a];n.account=i,this.adapterRef.logger.log("IMBusiness:_handleNotifyJoinEvent 需要反查映射表删除键 uid=%s, account=%s",a,i),delete r[a],this.adapterRef.instance.emit("joinChannel",n),this.adapterRef.instance.emit(d.EVENT_OBJ.userJoined.key,n)}}}},{key:"_packNetcallRecord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.logger.log("IMBusiness: _packNetcallRecord options=%o",e);var t=e.recordType,r=e.type||this.adapterRef.type,i=e.channelId||this.adapterRef.channelId,a=e.duration||0,n=e.isCaller||this.adapterRef.isCaller,o=e.target||this.adapterRef.target.account,d=this.adapterRef.nim&&this.adapterRef.nim.account,c=n?d:o,u=n?o:d,l=+new Date;this.adapterRef.nim.protocol.onMsg({content:{msg:{attach:JSON.stringify({data:{calltype:r,channel:i,duration:a,ids:[d,o],time:l},id:t}),from:c,fromClientType:n?16:0,fromDeviceId:"",fromNick:"",idClient:s.tool.guid(),idServer:s.tool.guid(),scene:0,time:l,to:u,type:5}}})}},{key:"_parseAccountUidMap",value:function(e){var t=this;this.adapterRef.logger.log("IMBusiness: _parseAccountUidMap 解析点对点映射表..."),Object.keys(e).forEach(function(r){t._addAccountUidMap({account:r,uid:e[r]})})}},{key:"_addAccountUidMap",value:function(e){this.adapterRef.logger.log("IMBusiness: _addAccountUidMap 追加正反向映射表...");var t=e.account,r=e.uid;this._addUid4AccountMap(t,r),this._addAccount4UidMap(t,r)}},{key:"_addUid4AccountMap",value:function(e,t){this.adapterRef.logger.log("IMBusiness: _addUid4AccountMap uid -> account 映射表..."),this.adapterRef.uid4AccountMap||(this.adapterRef.logger.log("IMBusiness: _addUid4AccountMap 初始化uid4AccountMap ={} "),this.adapterRef.uid4AccountMap={}),this.adapterRef.uid4AccountMap[t]=e}},{key:"_addAccount4UidMap",value:function(e,t){this.adapterRef.logger.log("IMBusiness:_addAccount4UidMap uid -> account 映射表..."),this.adapterRef.account4UidMap||(this.adapterRef.logger.log("IMBusiness: _addAccount4UidMap 初始化account4UidMap ={} "),this.adapterRef.account4UidMap={}),this.adapterRef.account4UidMap[e]=t}},{key:"initNetcall",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.logger.log("IMBusiness: initNetcall options=%o",JSON.stringify(t,null," "));var r=this,i=t.type,a=t.pushConfig;return this.adapterRef.type=i,this.adapterRef.instance._setSessionConfig({signalStartTime:Date.now()}),this.adapterRef.nim.initNetcall({type:i,accounts:[this.adapterRef.callee],pushConfig:a,webrtcEnable:!0}).then(function(t){e.adapterRef.logger.log("IMBusiness: initNetcall response=%o",t),r.adapterRef.signalInited=!0,r.adapterRef.sessionMode=d.SESSION_MODE.P2P,r.adapterRef.callerInfo=Object.assign({},t),r.adapterRef.channelId=t.channelId,r.adapterRef.imInfo=Object.assign(r.adapterRef.imInfo,r.adapterRef.callerInfo),r.adapterRef.imInfo.sessionMode=r.adapterRef.sessionMode,r.adapterRef.imInfo.role=d.ROLE_FOR_MEETING.ROLE_PLAYER}).catch(function(t){e.adapterRef.logger.error("IMBusiness: initNetcall error=%o",t),r.adapterRef.instance._setSessionConfig({signalEndTime:Date.now()});var i=t&&t.event||{};try{e.adapterRef.imInfo=beCalledInfo;var a=e.adapterRef.imInfo,n=a.cid,o=a.channelId,s=a.uid,c=a.sessionConfig,u=void 0===c?{}:c,l=a.sessionMode,p=(void 0===l&&d.SESSION_MODE.P2P,a.serverMap),f=a.wssArr,h="",m=function(e){return e.split("?ip=")[1].split(":")[0]};if(f&&(h+=m(f[0])),p)h=m(("string"==typeof p?JSON.parse(p):p).webrtcarray[0]);e.adapterRef.instance.commondDatareport("setLogin",{uid:""+s,cid:""+(n||o),meeting_mode:0,a_record:!!u.recordAudio,v_record:!!u.recordVideo,record_type:!!u.recordType,host_speaker:!!u.isHostSpeaker,server_ip:h,time:Date.now(),network:"UNKNOWN",result:i.code})}catch(t){e.adapterRef.logger.error(t)}r.resetWhenHangup();var g=Object.assign({serverCode:i.code,reason:i.message},d.CommonErrorCode.ChannelStartFail,t);return Promise.reject(g)})}},{key:"baseResponse",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.logger.log("IMBusiness: baseResponse options=%s",JSON.stringify(t,null," "));var r=t.fn||"calleeAck",i=t.beCalledInfo||this.adapterRef.beCalledInfo,a=i.accepted=0!=t.accepted;return a?(this.adapterRef.signalInited=!0,this.adapterRef.sessionMode=d.SESSION_MODE.P2P,this.adapterRef.type=i.type,this.adapterRef.channelId=i.channelId,this.adapterRef.target.account=i.account,this.adapterRef.calling=!0,this.adapterRef.imInfo=i,this.adapterRef.imInfo.sessionMode=this.adapterRef.sessionMode,this.adapterRef.imInfo.role=d.ROLE_FOR_MEETING.ROLE_PLAYER,this.adapterRef.instance._setSessionConfig({signalStartTime:Date.now()})):this._packNetcallRecord({type:i.type,channelId:i.channelId,isCaller:!1,target:i.account,recordType:"rejectNetcall"}),this.adapterRef.nim[r](i).then(function(){if(e.adapterRef.logger.log("IMBusiness: baseResponse success"),e.adapterRef.signalInited&&a)t.sessionConfig&&e.adapterRef.instance._setSessionConfig(t.sessionConfig),e.adapterRefbeCalledInfo=i,e._initSession({beCalledInfo:i});else{var r=e.adapterRef.imInfo;try{e.adapterRef.imInfo=i;var n=e.adapterRef.imInfo,o=n.cid,s=n.channelId,c=n.uid,u=n.sessionConfig,l=void 0===u?{}:u,p=n.sessionMode,f=(void 0===p&&d.SESSION_MODE.P2P,n.serverMap),h=n.wssArr,m="",g=function(e){return e.split("?ip=")[1].split(":")[0]};if(h&&(m+=g(h[0])),f)m=g(("string"==typeof f?JSON.parse(f):f).webrtcarray[0]);e.adapterRef.instance.commondDatareport("setLogin",{uid:""+c,cid:""+(o||s),meeting_mode:0,a_record:!!l.recordAudio,v_record:!!l.recordVideo,record_type:!!l.recordType,host_speaker:!!l.isHostSpeaker,server_ip:m,time:Date.now(),network:"UNKNOWN",result:1})}catch(t){e.adapterRef.logger.error(t)}e.adapterRef.imInfo=r}},function(t){throw e.adapterRef.logger.error("IMBusiness: baseResponse error=%o",t),t})}},{key:"baseHangup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.logger.warn("IMBusiness: baseHandup options=%o",e),this.adapterRef.apiReportHelper.uploadDataApi("send"),this.adapterRef.logReportHelper&&this.adapterRef.logReportHelper.uploadData("send"),this.adapterRef.statsReportHelper&&this.adapterRef.statsReportHelper.stopStats();var t=e.channelId,r=e.recordType;if(!t&&this.adapterRef.calling&&this.adapterRef.channelId&&(t=this.adapterRef.channelId),t){var i=e.fn||"hangup";this.adapterRef.nim[i]({channelId:t})}t===this.adapterRef.channelId&&(this.adapterRef.isCaller&&!this.adapterRef.callAccepted&&this._packNetcallRecord({recordType:r}),this.resetWhenHangup())}},{key:"baseControl",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.adapterRef.logger.log("IMBusiness: baseControl options=%o",t),t.channelId=t.channelId||this.adapterRef.channelId,t.command&&t.channelId){this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"call_control_type"}),t.command==d.CONTROL_TYPE.NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO?this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"audio_to_video"}):t.command==d.CONTROL_TYPE.NETCALL_CONTROL_COMMAND_SWITCH_VIDEO_TO_AUDIO&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_to_audio"});var r=t.fn||"netcallControl";return t.type=t.command,this.adapterRef.nim[r](t).catch(function(t){e.adapterRef.logger.error("IMBusiness: baseControl error=%o",t)})}}},{key:"baseCreateChannel",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.tool.verifyOptions(r,"channelName"),r.custom=r.custom||"",this.adapterRef.instance._setSessionConfig({signalStartTime:Date.now()}),this.adapterRef.nim[e](r).then(function(e){return t.adapterRef.logger.log("IMBusiness: baseCreateChannel success=%o",e),Promise.resolve(e)}).catch(function(e){t.adapterRef.logger.error("IMBusiness: baseCreateChannel error=%o",e),t.adapterRef.instance._setSessionConfig({signalEndTime:Date.now()});var r=e&&e.event||{},i=Object.assign({serverCode:r.code,reason:r.message},{event:e},d.CommonErrorCode.ChannelCreatingError);return Promise.reject(i)})}},{key:"baseJoinChannel",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.adapterRef.nim[e](r).then(function(e){return t.adapterRef.instance._setSessionConfig({signalEndTime:Date.now()}),t.adapterRef.signalInited=!0,t.adapterRef.sessionMode=e.sessionMode="meeting",t._parseAccountUidMap(e.accountUidMap),e.uid=t.adapterRef.instance._getUidByAccount(t.adapterRef.nim.account),Promise.resolve(e)}).catch(function(e){t.adapterRef.instance._setSessionConfig({signalEndTime:Date.now()});var r=e&&e.event||{},i=Object.assign({serverCode:r.code,reason:r.message},{event:e},d.CommonErrorCode.ChannelJoinError);return Promise.reject(i)})}},{key:"hangup",value:function(){this.adapterRef.instance._stopSession(),this.adapterRef.instance._resetStatus()}},{key:"destroy",value:function(){this.adapterRef.logger.log("IMBusiness:destroy"),this._unbindImEvent()}}]),t}(c.AbstractBusiness);t.IMBusiness=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC2Business=void 0;var i=f(r(1)),a=f(r(2)),n=f(r(4)),o=f(r(3)),s=r(110),d=f(r(19)),c=r(262),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(111)),l=r(11),p=r(28);function f(e){return e&&e.__esModule?e:{default:e}}var h=r(5),m=(h.info.nrtcSdkVersion,h.info.version,function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null,this.selfWebRtcInstance=null,this.remoteWebRtcInstanceMap={}}},{key:"_createWebRTCInstance",value:function(e,t){return new c.WebRTCBuilder({imInfo:this.adapterRef.imInfo,adapterRef:this.adapterRef,devices:t,targetUid:e,platformName:d.default.name,platformVersion:d.default.version}).build()}},{key:"createSelfWebRTCInstance",value:function(){var e=this._createWebRTCInstance(this.adapterRef.imInfo.userid);return this.selfWebRtcInstance=e,this._bindWebRTCEvent(e),e}},{key:"_destroyRtcSelf",value:function(){var e=this.selfWebRtcInstance;this.adapterRef.logger.log("WebRTC2Business: _destroyRtcSelf: local rtc"),e&&(e.close(),this.selfWebRtcInstance=null)}},{key:"_destroyRtcByUid",value:function(e){var t=this.remoteWebRtcInstanceMap[e];this.adapterRef.logger.log("WebRTC2Business: _destroyRtcByUid: remote rtc "+e),t&&(t.close(),clearInterval(t.reConnectTimer),delete this.remoteWebRtcInstanceMap[e])}},{key:"createRemoteWebRTCInstance",value:function(e,t){var r=this._createWebRTCInstance(e,t);return this.remoteWebRtcInstanceMap[e]=r,this._bindWebRTCEvent(r),r}},{key:"_bindWebRTCEvent",value:function(e){e.on("ready",this._handleReadyEvent4WebRTC.bind(this)),e.on("iceCandidate",this._handleIceCandidateEvent4WebRTC.bind(this)),e.on("iceCompleted",this._handleIceCompletedEvent4WebRTC.bind(this)),e.on("negotiationNeeded",this._handleNegotiationNeededEvent4WebRTC.bind(this)),e.on("iceStateChange",this._handleIceStateChangeEvent4WebRTC.bind(this)),e.on("iceCandidateTimeOut",this._handleIceCandidateTimeOutEvent4WebRTC.bind(this)),e.on("getRemoteStream",this._handleGetRemoteStreamEvent4WebRTC.bind(this))}},{key:"_unbindWebRTCEvent",value:function(e){e.removeListener("ready",this._handleReadyEvent4WebRTC.bind(this)),e.removeListener("iceCandidate",this._handleIceCandidateEvent4WebRTC.bind(this)),e.removeListener("iceCompleted",this._handleIceCompletedEvent4WebRTC.bind(this)),e.removeListener("negotiationNeeded",this._handleNegotiationNeededEvent4WebRTC.bind(this)),e.removeListener("iceStateChange",this._handleIceStateChangeEvent4WebRTC.bind(this)),e.removeListener("iceCandidateTimeOut",this._handleIceCandidateTimeOutEvent4WebRTC.bind(this)),e.removeListener("getRemoteStream",this._handleGetRemoteStreamEvent4WebRTC.bind(this))}},{key:"_handleReadyEvent4WebRTC",value:function(e){}},{key:"_handleIceCandidateEvent4WebRTC",value:function(e){this.adapterRef.logger.log("WebRTC2Business:_handleIceCandidateEvent4WebRTC event: %o",JSON.stringify(e,null," "));var t=e.uid,r=e.ice,i=e.isGatherCompleted;if(/\d tcp \d/gi.test(r&&r.candidate))this.adapterRef.logger.warn("tcp candidate 忽略 ");else{var a=this.getRtcObject(t);i&&(t==this.adapterRef.imInfo.userid?this._sendUserPub({rtc:a,offer:""}):this._sendUserSub({rtc:a,offer:""}))}}},{key:"_handleIceCompletedEvent4WebRTC",value:function(e){this.adapterRef.logger.log("WebRTC2Business:_handleIceCompletedEvent4WebRTC event: ",e);var t=e,r=this.getRtcObject(t);if(t!==this.adapterRef.imInfo.userid&&p.WebrtcUtil.isSupportGetRecvivers/*!this.adapterRef.instance._isFirefox() && rtc && rtc.getReceivers*/){this.adapterRef.logger.log("remote stream (uid): %d, streams num: %d",t,r.getReceivers().length);var i=void 0,a=void 0;return r.getReceivers().forEach(function(e){e&&"audio"===e.track.kind?i=e.track:e&&"video"===e.track.kind&&(a=e.track)}),i&&this.adapterRef.instance._getAudioHelperByUid(t).setIsRemote(!0).composeTrack(t,i),void(a&&this.adapterRef.instance._getVideoHelperByUid(t).setIsRemote(!0).composeTrack(t,a))}var n=this.adapterRef.instance._getVideoHelperByUid(t);if(n&&r&&r.rtcConnection&&r.rtcConnection.remoteDescription&&r.rtcConnection.remoteDescription.sdp){this.adapterRef.logger.log("确保是拉流的updata sdp 触发的");var o=r.rtcConnection.remoteDescription.sdp;if(n.checkRemoteTrack(t,o,r.rtcConnection)&&(this.adapterRef.logger.log("视频需要检查远程轨道"),n.delayVideoShow(t,!0),n.remoteVideoStream)){var s=n.remoteVideoStream.getVideoTracks()[0];this.adapterRef.instance.emit(l.EVENT_OBJ.remoteTrack.key,{account:this.adapterRef.instance._getAccountByUid(t),uid:t,track:s});var d=this.adapterRef.instance._getAudioHelperByUid(t);this.adapterRef.instance._isChrome72()&&d&&d.remoteAudioStream&&this.adapterRef.instance.emit(l.EVENT_OBJ.remoteTrack.key,{account:this.adapterRef.instance._getAccountByUid(t),uid:t,track:d.remoteAudioStream.getAudioTracks()[0]})}}this._handleUpdateLog(t,"completed",r)}},{key:"_handleNegotiationNeededEvent4WebRTC",value:function(e){this.adapterRef.logger.log("WebRTC2Business:_handleNegotiationNeededEvent4WebRTC event: %o",e)}},{key:"_handleIceStateChangeEvent4WebRTC",value:function(e){var t=this;if(this.adapterRef.webrtcBusiness){this.adapterRef.logger.log("WebRTC2Business: _handleIceStateChange4WebRTC event: ",e.state);var r=e.rtc,i=e.state,a=r.targetUid;if(this.adapterRef.imInfo.netDetect&&(this.adapterRef.logger.log("WebRTC2Business: _handleIceStateChange4WebRTC 重新赋值remoteWebRtcInstanceMap"),this.adapterRef.webrtcBusiness.remoteWebRtcInstanceMap=this.remoteWebRtcInstanceMap),"connected"===i)if(a==this.adapterRef.imInfo.userid)this.adapterRef.instance.emit(l.EVENT_OBJ.sessionConnected.key);else if(/*!this.adapterRef.instance._isFirefox() && rtc.getReceivers*/p.WebrtcUtil.isSupportGetRecvivers){this.adapterRef.logger.log("remote stream (uid): %s, streams num: %d",a,r.getReceivers().length);var n=void 0,o=void 0;r.getReceivers().forEach(function(e){e&&"audio"===e.track.kind?n=e.track:e&&"video"===e.track.kind&&(o=e.track)}),n&&this.adapterRef.instance._getAudioHelperByUid(a).setIsRemote(!0).composeTrack(a,n),o&&this.adapterRef.instance._getVideoHelperByUid(a).setIsRemote(!0).composeTrack(a,o)}if("connected"===i||"completed"===i?(r.disTimer&&(clearTimeout(r.disTimer),r.disTimer=null),r&&r.reConnectTimer&&(this.adapterRef.logger.warn("下行重连成功: ",a),clearInterval(r.reConnectTimer),r.reConnectTimer=null),this._doSdpUpdata(r)):"disconnected"===i&&(r.disTimer&&(clearTimeout(r.disTimer),r.disTimer=null),r.disTimer=setTimeout(function(){t.adapterRef.logger.warn("超时触发，ICE 连接失败: ",a),t._doIceFail4Self()},15e3)),"failed"===i){if(this.adapterRef.logger.warn("ICE 连接失败: ",a),r.disTimer&&(clearTimeout(r.disTimer),r.disTimer=null),a==this.adapterRef.imInfo.userid||this.adapterRef.instance._isFirefox())return void this._doIceFail4Self();this._doIceFail4Remote(a)}"failed"!==i&&"completed"!==i||!this.adapterRef.logReportHelper||this._handleUpdateLog(a,i,r)}}},{key:"_handleIceCandidateTimeOutEvent4WebRTC",value:function(e){var t=e.rtc,r=e.state;"completed"!==r&&"connected"!==r&&"closed"!==r&&t&&(this.adapterRef.logger.log("WebRTC2Business: _handleGetRemoteStreamEvent4WebRTC event: %o","中继连接失败开始直连"),"WebRTC"===l.CONFIG_MAP.SDK_NAME[l.CONFIG_MAP.CURRENT.SDK_TYPE]?this.adapterRef.imInfo.serverMap.relayaddrs=null:"NRTC"===l.CONFIG_MAP.SDK_NAME[l.CONFIG_MAP.CURRENT.SDK_TYPE]&&(this.adapterRef.imInfo.relayaddrs=null),t.close(),t._resetPeerTimeOut(),t._init(),t.targetUid==this.adapterRef.imInfo.userid?this.adapterRef.instance._judgeSendSdpOfferOrUpdate():this.adapterRef.webrtcBusiness._createOffer({rtc:t}))}},{key:"_handleUpdateLog",value:function(e,t,r){if(this.adapterRef.logReportHelper){var i=function(e){var t={audioId:"",videoId:"",ext:""};return e&&e.length&&e.map(function(e){e.track&&"audio"==e.track.kind?t.audioId=e.track.id:e.track&&"video"==e.track.kind&&(t.videoId=e.track.id)}),t.ext="",t},a={};a.uid=this.adapterRef.imInfo&&this.adapterRef.imInfo.userid||"",a.remoteUid=e,a.ext="",a.iceConnection=t,a.localSdp=r&&r.rtcConnection.localDescription.sdp,a.remoteSdp=r&&r.rtcConnection.remoteDescription.sdp,a.locallCECandidates=[],a.remoteICECandidates=[],r&&r.rtcConnection&&r.rtcConnection.getSenders&&(a.upStream=i(r.rtcConnection.getSenders())),r&&r.rtcConnection&&r.rtcConnection.getReceivers&&(a.downStream=i(r.rtcConnection.getReceivers())),this.adapterRef.logReportHelper.uploadData("peerConnections",a)}}},{key:"_handleGetRemoteStreamEvent4WebRTC",value:function(e){this.adapterRef.logger.log("WebRTC2Business:_handleGetRemoteStreamEvent4WebRTC event: %o",e);var t=e.uid,r=e.stream,i=e.track;t?this.adapterRef.instance._doRemoteStream(r,t,i):this.adapterRef.logger.error("未找到远程流的UID...")}},{key:"_doSdpUpdata",value:function(e){var t=e.rtcConnection;this.adapterRef.logger.log("WebRTC2Business: _doSdpUpdata");var r=t.getSenders();if(e.targetUid==this.adapterRef.imInfo.userid&&r&&r.length>0)if(r.length>1&&r[0].track&&r[1]&&r[1].track)this.adapterRef.logger.log(" --\x3e media type: %s %s",r[0].track.kind,r[1].track.kind);else{if(!this.adapterRef.instance._isPlayer())return;var i=[],a=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.userid),n=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.userid),o=a.getLocalAudioStream(!0),s=n.getLocalVideoStream(!0);o&&i.push(o),s&&i.push(s);var d=!1;"WebRTC"===l.CONFIG_MAP.SDK_NAME[l.CONFIG_MAP.CURRENT.SDK_TYPE]?d=2==i.length:"NRTC"===l.CONFIG_MAP.SDK_NAME[l.CONFIG_MAP.CURRENT.SDK_TYPE]&&(d=2==i.length&&!this.adapterRef.tempInfo.localVideoMuted&&!this.adapterRef.tempInfo.localAudioMuted),d&&(this.adapterRef.logger.log("WebRTC2Business: _doSdpUpdata 上行需要进行sdp协商!"),this.selfWebRtcInstance.updateStream(i),this._createOffer({rtc:e}))}else e.isNeedUpdataSdp&&(this.adapterRef.logger.log("WebRTC2Business: _doSdpUpdata 下行(%s)需要进行sdp协商!",e.targetUid),e.isNeedUpdataSdp=!1,this._createOffer({rtc:e}));e.targetUid,this.adapterRef.imInfo.userid}},{key:"_doIceFail4Self",value:function(){this.adapterRef.logger.log("WebRTC2Business: _doIceFail4Self 自己断开，_onSignalTimeout 开始重连!"),this.adapterRef.reconnectState.isReconnect=!0,this.adapterRef.instance._onSignalTimeout()}},{key:"_doIceFail4Remote",value:function(e){var t=this;this.adapterRef.logger.log("WebRTC2Business:_doIceFail4Remote (%s）断开连接了，现在开始进行下行第一次重连...",e);var r=this.getRtcObject(e);r?this.adapterRef&&this.adapterRef.reconnectState&&this.adapterRef.reconnectState.isStoped||this.adapterRef&&this.adapterRef.reconnectState&&this.adapterRef.reconnectState.startReconnect||(r.reConnectTimer=setInterval(function(){r&&!r.rtcConnection&&t.adapterRef&&t.adapterRef.webrtcBusiness?r.rtcConnection.iceConnectionState||"connected"==r.rtcConnection.iceConnectionState||"completed"==r.rtcConnection.iceConnectionState||"closed"==r.rtcConnection.iceConnectionState?clearInterval(r.reConnectTimer):(t.adapterRef.logger.warn("WebRTC2Business:_doIceFail4Remote (%s)下行第%s重连结束, state: ",e,r.count,r.rtcConnection.iceConnectionState),r.count>2&&(clearInterval(r.reConnectTimer),t.adapterRef.logger.warn("(%s)连接失败，现在清除该下行重连...",e),t.adapterRef.instance.emit(l.EVENT_OBJ.remoteSignalClosed.key,e),t.adapterRef.instance.doClearAfterRemoteLeave(e)),r.count++,t._createOffer({rtc:r})):clearInterval(r.reConnectTimer)},15e3),r.count=0,r.count++,this._createOffer({rtc:r})):this.adapterRef.logger.error("WebRTC2Business:_doIceFail4Remote 不存在的远程rtc对象")}},{key:"getRtcObject",value:function(e){var t=null;return t=e==this.adapterRef.imInfo.userid?this._getSelfWebRtcInstance():this._getRemoteWebRtcInstance(e),this.adapterRef.logger.log("WebRTC2Business:getRtcObject %s, userid=%s",e==this.adapterRef.imInfo.userid?"上行":"下行",e),t}},{key:"_hasAudio",value:function(){if(!this.adapterRef.deviceBusiness)return this.adapterRef.logger.log("WebRTC2Business:_hasAudio no deviceBusiness"),!1;var e=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.userid),t=!1;e&&(t=e.isMixAuido());var r=this.adapterRef.state.audioDeviceHasOpened||t;return this.adapterRef.deviceBusiness.hasAudio(this.adapterRef.deviceBusiness.mediaDeviceHelper.getDeviceStatus(),r,this.adapterRef.imInfo.role)}},{key:"_hasVideo",value:function(){if(!this.adapterRef.deviceBusiness)return this.adapterRef.logger.log("WebRTC2Business:_hasVideo no deviceBusiness"),!1;if("NRTC"===l.CONFIG_MAP.SDK_NAME[l.CONFIG_MAP.CURRENT.SDK_TYPE]){var e=this.adapterRef.instance._getVideoHelperByUid("local");return!(!e||!e.pushVideoStream||this.adapterRef.imInfo.role!==l.ROLE_FOR_MEETING.ROLE_PLAYER)}if("WebRTC"===l.CONFIG_MAP.SDK_NAME[l.CONFIG_MAP.CURRENT.SDK_TYPE])return this.adapterRef.deviceBusiness.hasVideo(this.adapterRef.deviceBusiness.mediaDeviceHelper.getDeviceStatus(),this.adapterRef.state.videoDeviceHasOpened,this.adapterRef.state.chromeScreenShareOpened,this.adapterRef.imInfo.role);if("WebRTC2"===l.CONFIG_MAP.SDK_NAME[l.CONFIG_MAP.CURRENT.SDK_TYPE]){var t=this.adapterRef.instance._getVideoHelperByUid("local");return!(!t||!t.pushVideoStream)}}},{key:"_getSelfWebRtcInstance",value:function(){return this.selfWebRtcInstance}},{key:"_getRemoteWebRtcInstance",value:function(e){return this.remoteWebRtcInstanceMap[e]}},{key:"_getWebRtcInstance",value:function(e){return e===this.adapterRef.imInfo.userid?this.selfWebRtcInstance:this.remoteWebRtcInstanceMap[e]}},{key:"_startRTCIfHasDeviceOpened",value:function(){this.adapterRef.logger.log("WebRTC2Business:_startRTCIfHasDeviceOpened 如果有本地设备启用则初始化rtc"),this.adapterRef.imInfo.netDetect||this._hasAudio()||this._hasVideo()?this._initWebRTCInstance4Self(!1,!0):this.adapterRef.logger.log("WebRTC2Business:_startRTCIfHasDeviceOpened 重连之后，不需要推流")}},{key:"_initWebRTCInstance4Self",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.adapterRef.logger.log("WebRTC2Business:_initWebRTCInstance4Self 初始化WebRTC流程管理器 ..."),this.selfWebRtcInstance)return this.adapterRef.logger.log("WebRTC2Business:_initWebRTCInstance4Self 已初始流程管理器，只更新流"),void(e&&(this._updateRtcStream(),this._startRtc(!0)));this.createSelfWebRTCInstance(),e&&(this._updateRtcStream(),this._startRtc(!0))}},{key:"_updateRtcStream",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.selfWebRtcInstance){this.adapterRef.logger.log("WebRTC2Business:_updateRtcStream 更新流到RTC中");var e=[],t=this.adapterRef.instance._getAudioHelperByUid("local"),r=this.adapterRef.instance._getVideoHelperByUid("local");if(t){var i=t.getLocalAudioStream(!0);i&&e.push(i)}if(r){var a=r.getLocalVideoStream(!0);a&&e.push(a)}this.selfWebRtcInstance.updateStream(e)}else this.adapterRef.logger.error("WebRTC2Business:_updateRtcStream 自己的上行webrtc流程管理器实例未创建，无法更新流")}},{key:"_startRtc",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._createOffer({isUpdate:t}).then(function(){return new Promise(function(t,r){e.once("sessionConnected",function(r){e.adapterRef.logger.log("WebRTC2Business:_startRtc ===== RTC连接成功...."),e.adapterRef.state.rtcConnected=!0,e.adapterRef.instance._setSessionConfig({rtcEndTime:Date.now()}),t(r)}),e.once("rtcConnectError",function(t){e.adapterRef.logger.error("WebRTC2Business:_startRtc ===== RTC连接失败...");var i=Object.assign({event:t},l.GateWayErrorCode.GateWayRTCConnectFail);r(i)})})}).catch(function(t){e.adapterRef.logger.error("WebRTC2Business:_startRtc 发起上行流失败 error=%o",t);var r=Object.assign({event:t},l.GateWayErrorCode.GateWayRTCConnectFail);return Promise.reject(r)})}},{key:"_createOffer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.isUpdate,i=void 0!==r&&r,a=t.rtc,n=void 0===a?this.selfWebRtcInstance:a;return this.adapterRef.logger.log("WebRTC2Business:_createOffer uid %o",n.targetUid),n.targetUid==this.adapterRef.imInfo.userid&&"p2p"===this.adapterRef.imInfo.sessionMode&&(n.vp8Only=this.adapterRef.instance._getWebRTCGateWayManager().isVp8Only),n.createOffer().then(function(t){return e.adapterRef.logger.log("WebRTC2Business:_createOffer, 开始设置本地描述..."),t.sdp=e.changeSDP(t.sdp,n),n.setLocalDescription(t,i).then(function(t){return e.adapterRef.logger.log("WebRTC2Business:_createOffer 本地描述设置成功, targetUid: ",n.targetUid),(t.sdp.indexOf("a=candidate:")>0||"connected"==n.rtcConnection.iceConnectionState)&&(n.targetUid==e.adapterRef.imInfo.userid?e._sendUserPub({rtc:n,offer:t}):e._sendUserSub({rtc:n,offer:t})),Promise.resolve()}).catch(function(t){e.adapterRef.logger.error("setLocalDescription 错误: ",t),e.adapterRef.logger.warn(t)})}).catch(function(t){return e.adapterRef.logger.error("createOffer 错误: ",t),Promise.reject(t)})}},{key:"_sendUserPub",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.isUpdate,e.rtc),r=void 0===t?this.selfWebRtcInstance:t;this.adapterRef.logger.log("WebRTC2Business:_sendUserPub 发送 pub 消息：",e);var i=e.offer;i||(i=r&&r.rtcConnection&&r.rtcConnection.localDescription);var a=[];i.sdp&&(a=this.getDeivcesId(i.sdp,r)),i.sdp=i.sdp.replace(/a=candidate:([\w \.\-:]*)tcp([\w \.\-:]*)\r\n/g,""),i.sdp=i.sdp.replace(/a=candidate:([\w \.\-:]*)\.1 ([\w \.\-:]*)\r\n/g,"");var n=this.adapterRef.instance._getWebRTCGateWayManager();return n?(n.doSendUserPub({sdp:i.sdp,devices:a}),Promise.resolve()):Promise.reject(l.GateWayErrorCode.GateWayRTCConnectFail)}},{key:"_sendUserSub",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.isUpdate,e.rtc),r=void 0===t?this.selfWebRtcInstance:t;this.adapterRef.logger.log("WebRTC2Business:_sendUserSub 发送 sub 消息: ",e);var i=e.offer;i||(i=r&&r.rtcConnection&&r.rtcConnection.localDescription);var a=[];i.sdp&&(a=this.getDeivcesId(i.sdp,r)),i.sdp=i.sdp.replace(/a=candidate:([\w \.\-:]*)tcp([\w \.\-:]*)\r\n/g,""),i.sdp=i.sdp.replace(/a=candidate:([\w \.\-:]*)\.1 ([\w \.\-:]*)\r\n/g,"");var n=this.adapterRef.instance._getWebRTCGateWayManager();return n?(n.doSendUserSub({sid:r.targetUid,sdp:i.sdp,devices:a}),Promise.resolve()):Promise.reject(l.GateWayErrorCode.GateWayRTCConnectFail)}},{key:"_subResolution",value:function(e){var t=this,r=e.resolution,i=e.userid,a=this._getRemoteWebRtcInstance(i);this.adapterRef.logger.log("WebRTC2Business:_sendUserSub 发送 sub 消息: ",e);var n=[];a.devices.map(function(e){t.adapterRef.logger.warn("_subResolution: ",JSON.stringify(e,null," ")),"video"==e.mediatype&&n.push({mediatype:e.mediatype,deviceid:e.deviceid,quality:r})});var o=this.adapterRef.instance._getWebRTCGateWayManager();return o?(o.doSendUserSub({negotype:"1",sid:a.targetUid,sdp:"",devices:n}),Promise.resolve()):Promise.reject(l.GateWayErrorCode.GateWayRTCConnectFail)}},{key:"doClientJoin",value:function(e,t){if(this.adapterRef.logger.log("WebRTC2Business: doClientJoin: ===== 人员加入，创建下行流, uid: ",e),this.adapterRef.webrtcBusiness._getRemoteWebRtcInstance(e))return this.adapterRef.logger.log("WebRTC2Business: doClientJoin: 已存在远程rtc实例，即将执行_onclient_update"),this.doClientUpdate(e,!0,t,0);var r=this.adapterRef.webrtcBusiness.createRemoteWebRTCInstance(e,t);if(!this.adapterRef.imInfo.netDetect){var i=this.adapterRef.instance._getAudioHelperByUid(e),a=this.adapterRef.instance._getVideoHelperByUid(e);a.isJoined=!0,a.setRTC(r),i.setRTC(r)}this._createOffer({rtc:r})}},{key:"doClientUpdate",value:function(e,t,r,i){if(this.adapterRef.logger.log("WebRTC2Business:doClientUpdate uid=%o, hasVideo=%o",e,t),!this.adapterRef.webrtcBusiness._getRemoteWebRtcInstance(e))return this.adapterRef.logger.log("WebRTC2Business: doClientUpdate: 不存在远程rtc实例，即将执行doClientJoin"),this.doClientJoin(e,r);var a=this.getRtcObject(e);a?(r&&(0==i?(console.warn("递增添加"),a.devices=a.devices.concat(r)):(console.warn("覆盖"),a.devices=r)),1==t?a.rtcConnection&&a.rtcConnection.localDescription&&a.rtcConnection.iceConnectionState&&"connected"!==a.rtcConnection.iceConnectionState&&"completed"!==a.rtcConnection.iceConnectionState?(this.adapterRef.logger.warn("create rtc later"),a.isNeedUpdataSdp=!0):this._createOffer({rtc:a}):this.adapterRef.instance._getVideoHelperByUid(e).delayVideoShow(e,t)):this.adapterRef.logger.error("WebRTC2Business:doClientUpdate 不存在的远程rtc对象")}},{key:"switchTrackEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stream,r=e.uid,i=e.bindTrackEvent,a=void 0===i||i;t&&r?(this.adapterRef.logger.log("WebRTC2Business:switchTrackEvent stream=%o, uid=%o, bindTrackEvent=%o",t,r,a),a?this._doBindTrackEvent(e):this._doUnBindTrackEvent(e)):this.adapterRef.logger.error("WebRTC2Business:switchTrackEvent 不存在的流或uid")}},{key:"_doUnBindTrackEvent",value:function(e){var t=e.stream,r=e.uid;this.adapterRef.logger.log("WebRTC2Business:_doUnBindTrackEvent 解绑轨道事件 stream=%o, uid=%o",t&&t.id,r),t.onaddtrack=null,t.onremovetrack=null}},{key:"_doBindTrackEvent",value:function(e){var t=e.stream,r=e.uid;this.adapterRef.logger.log("WebRTC2Business:_doBindTrackEvent 绑定轨道事件 stream=%o, uid=%o",t,r),t&&r?(t.onaddtrack||this._doRegisterAddTrackEvent(t,r),t.onremovetrack||this._doRegisterRemoveTrackEvent(t,r)):this.adapterRef.logger.error("WebRTC2Business:_doBindTrackEvent 不存在的流对象或uid")}},{key:"_doRegisterAddTrackEvent",value:function(e,t){var r=this;this.adapterRef.logger.log("WebRTC2Business:_doRegisterAddTrackEvent 添加轨道添加事件 stream=%o, uid=%o",e,t),e.onaddtrack=function(e){if(r.adapterRef.imInfo.netDetect)r.adapterRef.logger.log("audioHelper:_composeTrack 网络探测直接忽略");else{r.adapterRef.instance.emit(l.EVENT_OBJ.addTrack.key,e),r.adapterRef.logger.log("stream 添加轨道添加事件: ",e);var i=e.track;if("audio"==i.kind)return r.adapterRef.instance._getAudioHelperByUid(t).composeTrack(t,i),void r.adapterRef.logger.warn("WebRTC2Business:_doRegisterAddTrackEvent 非video直接返回...");var a=r.adapterRef.instance._getVideoHelperByUid(t);a.composeTrack(t,i),a.setIsRemote(!0);var n=r.getRtcObject(t);if(r.adapterRef.instance.emit(l.EVENT_OBJ.remoteTrack.key,{account:r.adapterRef.instance._getAccountByUid(t),uid:t,track:i}),n.rtcConnection&&n.rtcConnection.remoteDescription&&n.rtcConnection.remoteDescription.sdp){var o=n.rtcConnection.remoteDescription.sdp;a.checkRemoteTrack(t,o)}a.delayVideoShow(t)}}}},{key:"_doRegisterRemoveTrackEvent",value:function(e,t){var r=this;this.adapterRef.logger.log("WebRTC2Business:_doRegisterRemoveTrackEvent 删除轨道事件 stream=%o, uid=%o",e,t),e.onremovetrack=function(e){var i=e.track.kind;if(r.adapterRef.instance.emit(l.EVENT_OBJ.removeTrack.key,e),"audio"!==i){var a=r.adapterRef.instance._getVideoHelperByUid(t);a.remoteVideoStream&&a.hide()}else r.adapterRef.logger.warn("WebRTC2Business:_doRegisterRemoveTrackEvent 非video直接返回...")}}},{key:"_switchRole",value:function(){this.adapterRef.logger.log("WebRTC2Business:_switchRole ");var e=this.adapterRef.instance._getWebRTCGateWayManager();return e&&e.state.hasLogined?this.adapterRef.instance._updateRtc(!0,!0):Promise.resolve()}},{key:"_enableDevice",value:function(e){return this.adapterRef.logger.log("WebRTC2Business:_enableDevice 设备解禁"),this._switchDeviceTrackStatus(e,!0),Promise.resolve()}},{key:"_disableDevice",value:function(e){return this.adapterRef.logger.log("WebRTC2Business:_disableDevice 设备禁用"),this._switchDeviceTrackStatus(e,!1),Promise.resolve()}},{key:"_switchDeviceTrackStatus",value:function(e,t){var r=[];if(e===l.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN){var i=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.userid);i.localAudioStream&&(r=i.localAudioStream.getTracks())}else{var a=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.userid);a.localVideoStream&&(r=a.localVideoStream.getTracks())}r.map(function(e){e.enabled=t})}},{key:"changeSDP",value:function(e,t){var r=Math.random().toString(8).substr(3,5),i=this.adapterRef.instance._getWebRTCGateWayManager().context,a=this.adapterRef.imInfo.userid,n=t.targetUid,o=this.generateDeviceid(r,n);e=(e=(e=(e=(e=(e=e.replace(/a=extmap:([\w \\\.\-:=]*):sdes:([\w \\\.\-:=]*)\r\n/g,"")).replace(/a=extmap:([\w]*) urn:ietf:params:rtp-hdrext:toffset\r\n/g,"")).replace(/a=extmap:([\w]*) http:\/\/tools\.ietf\.org\/html\/draft-ietf-avtext-framemarking-07\r\n/g,"")).replace(/a=extmap:([\w \\\.\-:=]*)http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/([\w \\\.\-:=]*)\r\n/g,"")).replace(/a=extmap:([0-9]*) http:\/\/www\.ietf\.org\/id\/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\n/g,"a=extmap:5 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\n")).replace(/a=extmap:([0-9]*) urn:3gpp:video-orientation\r\n/g,"a=extmap:4 urn:3gpp:video-orientation\r\n");var s=u.parse(e);return s=p.RtcUtil.keepCodec(s,"h264"),console.warn("changeSDP parsed: ",s),s.media.map(function(e){if(e.ssrcs&&e.ssrcs.length&&e.ssrcs.map(function(t){"msid"==t.attribute?t.value=n+" "+e.type+"-default":"mslabel"==t.attribute?t.value=n:"label"==t.attribute&&(t.value=e.type+"-default")}),e.iceUfrag&&(e.iceUfrag=i.cid+"#"+a+"#"+n+"#"+o+"#"),e.msid&&(e.msid=n+" "+e.type+"-default"),"audio"==e.type){for(var t=null,r=0;r<e.rtp.length;r++)"opus"==e.rtp[r].codec?t=e.rtp[r].payload:(e.rtp.splice(r,1),r--);var s=new RegExp("([\\w ]*)"+t+"([\\w ]*)");e.payloads=e.payloads.replace(s,t),e.mid="audio"}else if("video"==e.type){e.mid="video";var d=null,c=null;e.rtp.map(function(e){"H264"==e.codec?(d=e.payload,e.payload=100):(c=e.payload,e.payload=101)}),e.rtcpFb.map(function(e){e.payload=100}),e.fmtp.map(function(e){e.payload==d?e.payload=100:(e.payload=101,e.config="apt=100")});var u=new RegExp(""+d);e.payloads=e.payloads.replace(u,100),u=new RegExp(""+c),e.payloads=e.payloads.replace(u,101)}}),s.groups.map(function(e){"BUNDLE"===e.type&&(e.mids="audio video")}),e=u.write(s)}},{key:"getDeivcesId",value:function(e,t){var r=[],i=this._hasAudio()||!0,a=this._hasVideo()||!0,n=t.targetUid==this.adapterRef.imInfo.userid;this.adapterRef.logger.log("WebRTC2Business:getDeivcesId  hasAudio: %s, hasVideo: %s, isLocalPack: ",i,a,n);u.parse(e).media.map(function(e){e.msid&&e.msid.split(" ")[0],n&&("video"===e.type&&a&&e.msid?r.push({mediatype:"video",deviceid:"video-default",quality:"8",status:"open"}):"audio"===e.type&&a&&e.msid&&r.push({mediatype:"audio",deviceid:"audio-default",quality:"1",status:"open"}))}),n||t.devices.map(function(e){console.warn("开始添加视频 拉流的时候: ",JSON.stringify(e,null," ")),r.push({mediatype:e.mediatype,deviceid:e.deviceid,quality:e.quality})}),console.warn("devicesList: ",r);for(var o=0;o<r.length;o++)console.warn("devicesList 值: ",JSON.stringify(r[o],null," "));return r}},{key:"generateDeviceid",value:function(e,t){function r(e){var t=parseInt(e,10).toString(2);return("00000000000000000000000000000000"+t).slice(t.length)}if(e){(function(e){for(var t=0,r=0;r<e.length;r++)t=131*t+e.charCodeAt(r)})(e);for(var i=r(e)+r(t),a=8,n=null;0<i;4)return n=i.slice(0,4),2147483647&(a=a<<5^a>>27^(n=parseInt(n,2)))}}},{key:"destroy",value:function(){this.adapterRef.logger.log("WebRTC2Business:destroy"),this.selfWebRtcInstance&&(this._unbindWebRTCEvent(this.selfWebRtcInstance),this.selfWebRtcInstance.destroy(),this.selfWebRtcInstance=null),this.rtcWathcher&&(this.rtcWathcher.destroy(),this.rtcWathcher=null);var e=this.remoteWebRtcInstanceMap;for(var t in e){var r=e[t];r&&(this._unbindWebRTCEvent(r),r.destroy(),r=null)}}}]),t}(s.AbstractBusiness));t.WebRTC2Business=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(r(1)),a=l(r(2)),n=l(r(4)),o=l(r(3)),s=r(28),d=l(r(19)),c=r(12),u=r(51);function l(e){return e&&e.__esModule?e:{default:e}}var p=/^ssrc_(\d+)_(send|recv)_(0)_(\w+)/,f=/^ssrc_(\d+)_recv_(\d+)_(\w+)/,h=/^ssrc_(\d+)_send_(\d+)_(\w+)/,m=function(e){function t(e){var r=e.rtcBusiness,a=e.adapterRef,o=e.sdkRef;(0,i.default)(this,t);var d=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return d.rtcBusiness=r,d.adapterRef=a,d.sdkRef=o,d.interval=200,d.firstData={recvFirstData:{},sendFirstAudioPackage:!1,sendFirstVideoPackage:!1},d.rttMemo={},d.lostRateMemo={packetsLost:[],packetsSent:[]},d.stuckReports={},d.processStatsCount=Math.ceil(1e3/d.interval),d.checkStuckReportCount=Math.ceil(2e3/d.interval),d.MAX_QUEUE_SAMLE_LEN=Math.ceil(300/d.interval),d.rtcStatsNew=new s.RtcStatsNew({webrtcBusiness:r,interval:d.interval}),d.rtcStatsNew.on("stats",d._netStatusCheck.bind(d)),d}return(0,o.default)(t,e),(0,a.default)(t,[{key:"startStats",value:function(){this.rtcStatsNew.start()}},{key:"_netStatusCheck",value:function(e,t){if(this.adapterRef){var r=this.adapterRef.statsReportHelper;e&&(t%this.processStatsCount==0&&(this.processStats(e),r&&r._uploadFormatDataStats(!1,e,t/5)),this.processStuck(e),t%this.checkStuckReportCount==0&&(this.checkStuckReport(),r&&r._uploadRawDataStats(e)))}}},{key:"processStats",value:function(e){var t=this,r={};Object.keys(e).forEach(function(i){if(i.search("ssrc_")>-1){var a=p.exec(i),n=void 0;a&&(a[2],n=a[3],a[4]);var o=e[i];if(0===o.packetsSentPerSecond)return;if(0===o.packetsReceivedPerSecond)return;var s=t.lostRateMemo.packetsLost,c=t.lostRateMemo.packetsSent;if(s.push(parseInt(o.packetsLost,10)),c.push(parseInt(o.packetsSent||o.packetsReceived,10)),s.length>6)for(var u=s.length;u-6>0;)s.shift(),c.shift(),--u;var l=void 0;if(s.length<3)l=Math.round(parseInt(o.packetsLost,10)/parseInt(o.packetsSent|o.packetsReceived,10)*100);else{var f=s[s.length-1]-s[0],h=c[c.length-1]-c[0];l=Math.round(f/h*100)}l!=l&&(l=0);var m=null;if(void 0!==o.googRtt&&(m=+o.googRtt),"Firefox"===d.default.name&&(m=1e3*o.roundTripTime),null==m||m!=m)return;var g=t.rttMemo[n];if(void 0===g&&(t.rttMemo[n]=g=[]),g.push(m),g.length>30)for(var v=g.length;v-30>0;)g.shift(),--v;var R=g.reduce(function(e,t){return e+t})/g.length,_=g.reduce(function(e,t){return e+Math.abs(t-R)})/g.length,y=l/20*.5+R/1200*.25+_/150*.25;window.__SHOW_NETSTATS_PARAMS__,"0"===n&&(r.quality=y<=.2625?0:y<=.55?1:y<=1?2:3)}}),Object.keys(r).length>0&&this.adapterRef.instance&&this.adapterRef.instance.emit("netStatus",r)}},{key:"processStuck",value:function(e){var t=this,r=[];"Chrome"!==d.default.name&&"Electron"!==d.default.name||Object.keys(e).forEach(function(i){var a=f.exec(i);if(a){var n=a[2],o=a[3],s=function(e,t){return void 0===e[t]?e[t]={}:e[t]}(t.stuckReports,n),d=s.queueAudio;void 0===d&&(d=s.queueAudio=[]);var c=s.queueVideo;void 0===c&&(c=s.queueVideo=[]);var u=e[i];if(t.firstData.recvFirstData[n]||(t.firstData.recvFirstData[n]={recvFirstAudioFrame:!1,recvFirstVideoFrame:!1,recvFirstAudioPackage:!1,recvFirstVideoPackage:!1}),"audio"==o){var l=n,p=Math.ceil(100*u.audioOutputLevel/32678);r.push({account:t.adapterRef.instance._getAccountByUid(l),volume:p});var m=parseInt(u.googDecodingCNG,10)+parseInt(u.googDecodingPLC,10),g=m-(s.lastTotalCaches||0);s.lastTotalCaches=m,d.push(g),!t.firstData.recvFirstData[n].recvFirstAudioFrame&&u.googDecodingNormal>0&&(t.firstData.recvFirstData[n].recvFirstAudioFrame=!0,t.reportEvent(a[1],n,"recvFirstAudioFrame")),!t.firstData.recvFirstData[n].recvFirstAudioPackage&&u.packetsReceived>0&&(t.firstData.recvFirstData[n].recvFirstAudioPackage=!0,t.reportEvent(a[1],n,"recvFirstAudioPackage"))}else"video"===o&&(u.bitsReceivedPerSecond>0&&c.push(+u.framesDecoded),!t.firstData.recvFirstData[n].recvFirstVideoFrame&&u.framesDecoded>0&&(t.firstData.recvFirstData[n].recvFirstVideoFrame=!0,t.reportEvent(a[1],n,"recvFirstVideoFrame")),!t.firstData.recvFirstData[n].recvFirstVideoPackage&&u.packetsReceived>0&&(t.firstData.recvFirstData[n].recvFirstVideoPackage=!0,t.reportEvent(a[1],n,"recvFirstVideoPackage")))}if((!t.firstData.sendFirstAudioPackage||!t.firstData.sendFirstVideoPackage)&&(a=h.exec(i))){var v=a[1];"audio"==a[3]?!t.firstData.sendFirstAudioPackage&&e[i].packetsSent>0&&(t.firstData.sendFirstAudioPackage=!0,t.reportEvent(v,0,"sendFirstAudioPackage")):"video"==a[3]&&!t.firstData.sendFirstVideoPackage&&e[i].packetsSent>0&&(t.firstData.sendFirstVideoPackage=!0,t.reportEvent(v,0,"sendFirstVideoPackage"))}}),this.volumeIndicator=r,this.volumeIndicator.length&&this.adapterRef.instance.emit("speaker",this.volumeIndicator)}},{key:"checkStuckReport",value:function(){var e=this;if("Chrome"==d.default.name){var t=Object.keys(this.stuckReports);if(t.length){var r={},i={};t.forEach(function(t){var a=e.stuckReports[t];if(a){var n=a.queueAudio;if(n&&n.length){for(var o=0,s=0;s<n.length;s++)o+=60*parseInt(n[s]);n.length=0,r[t]=o>0?o:0}else r[t]=0;var d=a.queueVideo;if(d&&d.length){for(var c=0,u=0,l=d.length-3;u<l;u++){d[u+3]-d[u]<=2&&(c++,u+=3)}d.length=0,i[t]=c}else i[t]=0}});var a=this.adapterRef.statsReportHelper;a&&a.formatDataFromStats&&(a.formatDataFromStats.updateAudioStuckData(r),a.formatDataFromStats.updateVideoStuckData(i))}}}},{key:"reportEvent",value:function(e,t,r){var i=new u.CommonDataReport({adapterRef:this.adapterRef,sdkRef:this.sdkRef}),a={uid:""+e,cid:(this.adapterRef.imInfo&&this.adapterRef.imInfo.cid)+"",time:Date.now(),type:r.indexOf("Audio")>0?0:1};switch(r){case"recvFirstAudioFrame":case"recvFirstVideoFrame":a.pull_uid=t,i.setRecvFirstFrame(a);break;case"recvFirstAudioPackage":case"recvFirstVideoPackage":a.pull_uid=t,i.setRecvFirstPackage(a);break;case"sendFirstAudioPackage":case"sendFirstVideoPackage":i.setSendFirstPackage(a)}i.send(),i=null}},{key:"destroy",value:function(){this.rtcBusiness=null,this.adapterRef=null,this.sdkRef=null,this.off(),this.rttMemo={},this.stuckReports={},this.rtcStatsNew.off(),this.rtcStatsNew.stop(),this.rtcStatsNew=null}}]),t}(c.EventEmitter);t.default=m,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCBuilder=void 0;var i=c(r(1)),a=c(r(2)),n=r(261),o=r(260),s=r(258),d=r(257);function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,i.default)(this,e);var r=t.imInfo,a=t.targetUid,n=t.platformName,o=t.platformVersion,s=t.adapterRef;this.webrtcInstance=null,this.adapterRef=s,this.imInfo=r,this.targetUid=a,this.platformName=n,this.platformVersion=o,this.devices=t.devices}return(0,a.default)(e,[{key:"getVersion4User",value:function(){return this.platformVersion.split(".")[0]}},{key:"build",value:function(){var e=this.platformName.toLowerCase(),t=this.getVersion4User(),r=(0,n.isMatchVersion)(e,t),i=(0,n.maxVersion)(e);switch(this.platformName){case"Chrome":this.webrtcInstance=this.buildChrome4DefinedVersion(r?t:i);break;case"Firefox":this.webrtcInstance=this.buildFirefox4DefinedVersion(r?t:i);break;case"Safari":this.webrtcInstance=this.buildSafari4DefinedVersion(r?t:i);break;default:this.webrtcInstance=this.buildChrome4DefinedVersion("69")}return this.webrtcInstance}},{key:"buildChrome4DefinedVersion",value:function(e){var t=null;switch(e){case"65":default:t=this.createChromeReleaseInstance()}return t}},{key:"buildFirefox4DefinedVersion",value:function(e){var t=null;switch(e){case"59":default:t=this.createFirefoxReleaseInstance()}return t}},{key:"buildSafari4DefinedVersion",value:function(e){var t=null;switch(e){case"11":default:t=this.createSafariReleaseInstance()}return t}},{key:"createChromeReleaseInstance",value:function(){return new o.WebRTC4ChromeRelease({adapterRef:this.adapterRef,imInfo:this.imInfo,targetUid:this.targetUid,devices:this.devices})}},{key:"createFirefoxReleaseInstance",value:function(){return new s.WebRTC4FirefoxRelease({adapterRef:this.adapterRef,imInfo:this.imInfo,targetUid:this.targetUid,devices:this.devices})}},{key:"createSafariReleaseInstance",value:function(){return new d.WebRTC4SafariRelease({adapterRef:this.adapterRef,imInfo:this.imInfo,targetUid:this.targetUid,devices:this.devices})}}]),e}();t.WebRTCBuilder=u},function(e,t,r){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},i.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){var t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},i.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1],r.usernameFragment=t[i+1];break;default:r[t[i]]=t[i+1]}return r},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},i.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,r={},i=e.substr(e.indexOf(" ")+1).split(";"),a=0;a<i.length;a++)r[(t=i[a].trim().split("="))[0].trim()]=t[1];return r},i.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substr(t+1,i-t-1),r.value=e.substr(i+1)):r.attribute=e.substr(t+1),r},i.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},i.getIceParameters=function(e,t){var r=i.splitLines(e);return{usernameFragment:(r=r.concat(i.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=i.splitLines(e)[0].split(" "),a=3;a<r.length;a++){var n=r[a],o=i.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(o){var s=i.parseRtpMap(o),d=i.matchPrefix(e,"a=fmtp:"+n+" ");switch(s.parameters=d.length?i.parseFmtp(d[0]):{},s.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(i.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=i.writeRtpMap(e),r+=i.writeFmtp(e),r+=i.writeRtcpFb(e)});var a=0;return t.codecs.forEach(function(e){e.maxptime>a&&(a=e.maxptime)}),a>0&&(r+="a=maxptime:"+a+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=i.writeExtmap(e)}),r},i.parseRtpEncodingParameters=function(e){var t,r=[],a=i.parseRtpParameters(e),n=-1!==a.fecMechanisms.indexOf("RED"),o=-1!==a.fecMechanisms.indexOf("ULPFEC"),s=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),d=s.length>0&&s[0].ssrc,c=i.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});c.length>0&&c[0].length>1&&c[0][0]===d&&(t=c[0][1]),a.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:d,codecPayloadType:parseInt(e.parameters.apt,10)};d&&t&&(i.rtx={ssrc:t}),r.push(i),n&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:t,mechanism:o?"red+ulpfec":"red"},r.push(i))}}),0===r.length&&d&&r.push({ssrc:d});var u=i.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=u})),r},i.parseRtcpParameters=function(e){var t={},r=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var a=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=a.length>0,t.compound=0===a.length;var n=i.matchPrefix(e,"a=rtcp-mux");return t.mux=n.length>0,t},i.parseMsid=function(e){var t,r=i.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var a=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return a.length>0?{stream:(t=a[0].value.split(" "))[0],track:t[1]}:void 0},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t){var r=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||i.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,r,a){var n=i.writeRtpDescription(e.kind,t);if(n+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",e.direction?n+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender){var o="msid:"+a.id+" "+e.rtpSender.track.id+"\r\n";n+="a="+o,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),n},i.getDirection=function(e,t){for(var r=i.splitLines(e),a=0;a<r.length;a++)switch(r[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[a].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},i.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=i.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},e.exports=i},function(e,t,r){"use strict";var i=r(438),a=r(89);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2));var r=new t(e),a=i.parseCandidate(e.candidate),n=Object.assign(r,a);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n},function(e,t,r){if(e.RTCPeerConnection){var i=e.RTCPeerConnection.prototype,a=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return a.apply(this,arguments);var n=function(e){i(r(e))};return this._eventMap=this._eventMap||{},this._eventMap[i]=n,a.apply(this,[e,n])};var n=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return n.apply(this,arguments);var i=this._eventMap[r];return delete this._eventMap[r],n.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),i=t.revokeObjectURL.bind(t),n=new Map,o=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++o;return n.set(t,e),a.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){i(e),n.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=n.get(e)||null,s.set.apply(this,[e])}});var d=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=n.get(arguments[1])||null),d.apply(this,arguments)}}}}},function(e,t,r){"use strict";var i=r(89),a={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(i){t.call(r,i,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,i=e.getTracks();this.getSenders().forEach(function(e){-1!==i.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var r=new Event("addstream");r.stream=e.streams[0],this.dispatchEvent(r)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,a=t.setLocalDescription,n=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],a=r.apply(this,[i]);return t?(a.then(e,t),Promise.resolve()):a},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],a=i.apply(this,[r]);return t?(a.then(e,t),Promise.resolve()):a};var s=function(e,t,r){var i=a.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,r){var i=n.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,r){var i=o.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var a=[],n=0;n<e.iceServers.length;n++){var o=e.iceServers[n];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,a.push(o)):a.push(e.iceServers[n])}e.iceServers=a}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){var i=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveAudio||i||r.addTransceiver("audio");var a=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&a?"sendrecv"===a.direction?a.setDirection("sendonly"):"recvonly"===a.direction&&a.setDirection("inactive"):!0!==e.offerToReceiveVideo||a||r.addTransceiver("video")}return t.apply(r,arguments)}}};e.exports={shimCallbacksAPI:a.shimCallbacksAPI,shimLocalStreamsAPI:a.shimLocalStreamsAPI,shimRemoteStreamsAPI:a.shimRemoteStreamsAPI,shimGetUserMedia:a.shimGetUserMedia,shimRTCIceServerUrls:a.shimRTCIceServerUrls,shimTrackEventTransceiver:a.shimTrackEventTransceiver,shimCreateOfferLegacy:a.shimCreateOfferLegacy}},function(e,t,r){"use strict";var i=r(89),a=i.log;e.exports=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack,o=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,i,n){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(r),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[r]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var a={};"number"==typeof i.ideal?a[r]={min:i.ideal,max:i.ideal}:a[r]=i.ideal,e.advanced.push(a),delete i.ideal,Object.keys(i).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(a("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),a("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,i,function(e){n(o(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,r){s(e,t,r)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var d=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var c=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return c(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(o(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var u=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),u(e.audio,"autoGainControl","mozAutoGainControl"),u(e.audio,"noiseSuppression","mozNoiseSuppression")),l(e)},n&&n.prototype.getSettings){var p=n.prototype.getSettings;n.prototype.getSettings=function(){var e=p.apply(this,arguments);return u(e,"mozAutoGainControl","autoGainControl"),u(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var f=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),u(e,"autoGainControl","mozAutoGainControl"),u(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}r.getUserMedia=function(e,a,n){if(t.version<44)return s(e,a,n);i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(a,n)}}},function(e,t,r){"use strict";var i=r(89),a={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=i.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,i){if(t.version<38&&r&&r.iceServers){for(var a=[],n=0;n<r.iceServers.length;n++){var o=r.iceServers[n];if(o.hasOwnProperty("urls"))for(var s=0;s<o.urls.length;s++){var d={url:o.urls[s]};0===o.urls[s].indexOf("turn")&&(d.username=o.username,d.credential=o.credential),a.push(d)}else a.push(r.iceServers[n])}r.iceServers=a}return new e.mozRTCPeerConnection(r,i)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,i){return n.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t}(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=a[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:a[t.type]||t.type}))})}return e}).then(r,i)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;i.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})}};e.exports={shimOnTrack:a.shimOnTrack,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimRemoveStream:a.shimRemoveStream,shimGetUserMedia:r(441)}},function(e,t,r){"use strict";e.exports=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},function(e,t,r){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},i.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){var t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},i.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1],r.usernameFragment=t[i+1];break;default:r[t[i]]=t[i+1]}return r},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.numChannels=3===t.length?parseInt(t[2],10):1,r},i.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,r={},i=e.substr(e.indexOf(" ")+1).split(";"),a=0;a<i.length;a++)r[(t=i[a].trim().split("="))[0].trim()]=t[1];return r},i.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){i.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substr(t+1,i-t-1),r.value=e.substr(i+1)):r.attribute=e.substr(t+1),r},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},i.getIceParameters=function(e,t){var r=i.splitLines(e);return{usernameFragment:(r=r.concat(i.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=i.splitLines(e)[0].split(" "),a=3;a<r.length;a++){var n=r[a],o=i.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(o){var s=i.parseRtpMap(o),d=i.matchPrefix(e,"a=fmtp:"+n+" ");switch(s.parameters=d.length?i.parseFmtp(d[0]):{},s.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(i.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=i.writeRtpMap(e),r+=i.writeFmtp(e),r+=i.writeRtcpFb(e)});var a=0;return t.codecs.forEach(function(e){e.maxptime>a&&(a=e.maxptime)}),a>0&&(r+="a=maxptime:"+a+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){r+=i.writeExtmap(e)}),r},i.parseRtpEncodingParameters=function(e){var t,r=[],a=i.parseRtpParameters(e),n=-1!==a.fecMechanisms.indexOf("RED"),o=-1!==a.fecMechanisms.indexOf("ULPFEC"),s=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),d=s.length>0&&s[0].ssrc,c=i.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});c.length>0&&c[0].length>1&&c[0][0]===d&&(t=c[0][1]),a.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:d,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};r.push(i),n&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:t,mechanism:o?"red+ulpfec":"red"},r.push(i))}}),0===r.length&&d&&r.push({ssrc:d});var u=i.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=u})),r},i.parseRtcpParameters=function(e){var t={},r=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var a=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=a.length>0,t.compound=0===a.length;var n=i.matchPrefix(e,"a=rtcp-mux");return t.mux=n.length>0,t},i.parseMsid=function(e){var t,r=i.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var a=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return a.length>0?{stream:(t=a[0].value.split(" "))[0],track:t[1]}:void 0},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t){var r=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||i.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,r,a){var n=i.writeRtpDescription(e.kind,t);if(n+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",e.direction?n+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender){var o="msid:"+a.id+" "+e.rtpSender.track.id+"\r\n";n+="a="+o,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),n},i.getDirection=function(e,t){for(var r=i.splitLines(e),a=0;a<r.length;a++)switch(r[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[a].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},e.exports=i},function(e,t,r){"use strict";var i=r(444);function a(e,t,r,a,n){var o=i.writeRtpDescription(e.kind,t);if(o+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":n||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var d="msid:"+(a?a.id:"-")+" "+s+"\r\n";o+="a="+d,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+d,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+d,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),o}function n(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},a=function(e,t,r,a){var n=i(e.parameters.apt,r),o=i(t.parameters.apt,a);return n&&o&&n.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach(function(i){for(var n=0;n<t.codecs.length;n++){var o=t.codecs[n];if(i.name.toLowerCase()===o.name.toLowerCase()&&i.clockRate===o.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&o.parameters.apt&&!a(i,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(i.numChannels,o.numChannels),r.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var a=t.headerExtensions[i];if(e.uri===a.uri){r.headerExtensions.push(a);break}}}),r}function o(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function s(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function d(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}e.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function c(t,r,i,a){var n=new Event("track");n.track=r,n.receiver=i,n.transceiver={receiver:i},n.streams=a,e.setTimeout(function(){t._dispatchEvent("track",n)})}var u=function(r){var a=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){a[e]=n[e].bind(n)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw d("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var a="string"==typeof i;return a&&(i=[i]),i=i.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=a?i[0]:i,!!i.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var o=r.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=i.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport;else{var a=this._createIceAndDtlsTransports();i.iceTransport=a.iceTransport,i.dtlsTransport=a.dtlsTransport}return t||this.transceivers.push(i),i},u.prototype.addTrack=function(t,r){if(this._isClosed)throw d("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find(function(e){return e.track===t}))throw d("InvalidAccessError","Track already exists.");for(var a=0;a<this.transceivers.length;a++)this.transceivers[a].track||this.transceivers[a].kind!==t.kind||(i=this.transceivers[a]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),i.track=t,i.stream=r,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},u.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var i=e.clone();e.getTracks().forEach(function(e,t){var r=i.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),i.getTracks().forEach(function(e){r.addTrack(e,i)})}},u.prototype.removeTrack=function(t){if(this._isClosed)throw d("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw d("InvalidAccessError","Sender was not created by this connection.");var i=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},u.prototype._createIceGatherer=function(t,r){var i=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var a=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(a,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;a.state=r?"completed":"gathering",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},a.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),a},u.prototype._gather=function(t,r){var a=this,n=this.transceivers[r].iceGatherer;if(!n.onlocalcandidate){var o=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,n.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),n.onlocalcandidate=function(e){if(!(a.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,d=!s||0===Object.keys(s).length;if(d)"new"!==n.state&&"gathering"!==n.state||(n.state="completed");else{"new"===n.state&&(n.state="gathering"),s.component=1,s.ufrag=n.getLocalParameters().usernameFragment;var c=i.writeCandidate(s);o.candidate=Object.assign(o.candidate,i.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=i.getMediaSections(a._localDescription.sdp);u[o.candidate.sdpMLineIndex]+=d?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",a._localDescription.sdp=i.getDescription(a._localDescription.sdp)+u.join("");var l=a.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==a.iceGatheringState&&(a.iceGatheringState="gathering",a._emitGatheringStateChange()),d||a._dispatchEvent("icecandidate",o),l&&(a._dispatchEvent("icecandidate",new Event("icecandidate")),a.iceGatheringState="complete",a._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){n.onlocalcandidate(e)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new e.RTCDtlsTransport(r);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:i}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,r,a){var o=n(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:i.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),a&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},u.prototype.setLocalDescription=function(e){var t,r,a=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(d("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,a.signalingState)||a._isClosed)return Promise.reject(d("InvalidStateError","Can not set local "+e.type+" in state "+a.signalingState));if("offer"===e.type)t=i.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=i.parseRtpParameters(e);a.transceivers[t].localCapabilities=r}),a.transceivers.forEach(function(e,t){a._gather(e.mid,t)});else if("answer"===e.type){t=i.splitSections(a._remoteDescription.sdp),r=t.shift();var s=i.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var o=a.transceivers[t],d=o.iceGatherer,c=o.iceTransport,u=o.dtlsTransport,l=o.localCapabilities,p=o.remoteCapabilities;if(!(i.isRejected(e)&&0===i.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var f=i.getIceParameters(e,r),h=i.getDtlsParameters(e,r);s&&(h.role="server"),a.usingBundle&&0!==t||(a._gather(o.mid,t),"new"===c.state&&c.start(d,f,s?"controlling":"controlled"),"new"===u.state&&u.start(h));var m=n(l,p);a._transceive(o,m.codecs.length>0,!1)}})}return a._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?a._updateSignalingState("have-local-offer"):a._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(a){var n=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(d("TypeError",'Unsupported type "'+a.type+'"'));if(!o("setRemoteDescription",a.type,n.signalingState)||n._isClosed)return Promise.reject(d("InvalidStateError","Can not set remote "+a.type+" in state "+n.signalingState));var u={};n.remoteStreams.forEach(function(e){u[e.id]=e});var l=[],p=i.splitSections(a.sdp),f=p.shift(),h=i.matchPrefix(f,"a=ice-lite").length>0,m=i.matchPrefix(f,"a=group:BUNDLE ").length>0;n.usingBundle=m;var g=i.matchPrefix(f,"a=ice-options:")[0];return n.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,p.forEach(function(o,d){var c=i.splitLines(o),p=i.getKind(o),g=i.isRejected(o)&&0===i.matchPrefix(o,"a=bundle-only").length,v=c[0].substr(2).split(" ")[2],R=i.getDirection(o,f),_=i.parseMsid(o),y=i.getMid(o)||i.generateIdentifier();if(g||"application"===p&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v))n.transceivers[d]={mid:y,kind:p,protocol:v,rejected:!0};else{var C,b,E,S,T,A,O,k,P;!g&&n.transceivers[d]&&n.transceivers[d].rejected&&(n.transceivers[d]=n._createTransceiver(p,!0));var I,D,w=i.parseRtpParameters(o);g||(I=i.getIceParameters(o,f),(D=i.getDtlsParameters(o,f)).role="client"),O=i.parseRtpEncodingParameters(o);var M=i.parseRtcpParameters(o),W=i.matchPrefix(o,"a=end-of-candidates",f).length>0,x=i.matchPrefix(o,"a=candidate:").map(function(e){return i.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===a.type||"answer"===a.type)&&!g&&m&&d>0&&n.transceivers[d]&&(n._disposeIceAndDtlsTransports(d),n.transceivers[d].iceGatherer=n.transceivers[0].iceGatherer,n.transceivers[d].iceTransport=n.transceivers[0].iceTransport,n.transceivers[d].dtlsTransport=n.transceivers[0].dtlsTransport,n.transceivers[d].rtpSender&&n.transceivers[d].rtpSender.setTransport(n.transceivers[0].dtlsTransport),n.transceivers[d].rtpReceiver&&n.transceivers[d].rtpReceiver.setTransport(n.transceivers[0].dtlsTransport)),"offer"!==a.type||g)"answer"!==a.type||g||(b=(C=n.transceivers[d]).iceGatherer,E=C.iceTransport,S=C.dtlsTransport,T=C.rtpReceiver,A=C.sendEncodingParameters,k=C.localCapabilities,n.transceivers[d].recvEncodingParameters=O,n.transceivers[d].remoteCapabilities=w,n.transceivers[d].rtcpParameters=M,x.length&&"new"===E.state&&(!h&&!W||m&&0!==d?x.forEach(function(e){s(C.iceTransport,e)}):E.setRemoteCandidates(x)),m&&0!==d||("new"===E.state&&E.start(b,I,"controlling"),"new"===S.state&&S.start(D)),n._transceive(C,"sendrecv"===R||"recvonly"===R,"sendrecv"===R||"sendonly"===R),!T||"sendrecv"!==R&&"sendonly"!==R?delete C.rtpReceiver:(P=T.track,_?(u[_.stream]||(u[_.stream]=new e.MediaStream),r(P,u[_.stream]),l.push([P,T,u[_.stream]])):(u.default||(u.default=new e.MediaStream),r(P,u.default),l.push([P,T,u.default]))));else{(C=n.transceivers[d]||n._createTransceiver(p)).mid=y,C.iceGatherer||(C.iceGatherer=n._createIceGatherer(d,m)),x.length&&"new"===C.iceTransport.state&&(!W||m&&0!==d?x.forEach(function(e){s(C.iceTransport,e)}):C.iceTransport.setRemoteCandidates(x)),k=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(k.codecs=k.codecs.filter(function(e){return"rtx"!==e.name})),A=C.sendEncodingParameters||[{ssrc:1001*(2*d+2)}];var N,L=!1;if("sendrecv"===R||"sendonly"===R){if(L=!C.rtpReceiver,T=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,p),L)P=T.track,_&&"-"===_.stream||(_?(u[_.stream]||(u[_.stream]=new e.MediaStream,Object.defineProperty(u[_.stream],"id",{get:function(){return _.stream}})),Object.defineProperty(P,"id",{get:function(){return _.track}}),N=u[_.stream]):(u.default||(u.default=new e.MediaStream),N=u.default)),N&&(r(P,N),C.associatedRemoteMediaStreams.push(N)),l.push([P,T,N])}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(t){var r,i,a=t.getTracks().find(function(e){return e.id===C.rtpReceiver.track.id});a&&(r=a,(i=t).removeTrack(r),i.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:r})))}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=k,C.remoteCapabilities=w,C.rtpReceiver=T,C.rtcpParameters=M,C.sendEncodingParameters=A,C.recvEncodingParameters=O,n._transceive(n.transceivers[d],!1,L)}}}),void 0===n._dtlsRole&&(n._dtlsRole="offer"===a.type?"active":"passive"),n._remoteDescription={type:a.type,sdp:a.sdp},"offer"===a.type?n._updateSignalingState("have-remote-offer"):n._updateSignalingState("stable"),Object.keys(u).forEach(function(t){var r=u[t];if(r.getTracks().length){if(-1===n.remoteStreams.indexOf(r)){n.remoteStreams.push(r);var i=new Event("addstream");i.stream=r,e.setTimeout(function(){n._dispatchEvent("addstream",i)})}l.forEach(function(e){var t=e[0],i=e[1];r.id===e[2].id&&c(n,t,i,[r])})}}),l.forEach(function(e){e[2]||c(n,e[0],e[1],[])}),e.setTimeout(function(){n&&n.transceivers&&n.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},u.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(d("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter(function(e){return"audio"===e.kind}).length,o=r.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(n=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(o=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)});n>0||o>0;)n>0&&(r._createTransceiver("audio"),n--),o>0&&(r._createTransceiver("video"),o--);var c=i.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(a,n){var o=a.track,s=a.kind,d=a.mid||i.generateIdentifier();a.mid=d,a.iceGatherer||(a.iceGatherer=r._createIceGatherer(n,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(s);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),a.remoteCapabilities&&a.remoteCapabilities.codecs&&a.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){(a.remoteCapabilities&&a.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var u=a.sendEncodingParameters||[{ssrc:1001*(2*n+1)}];o&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),a.wantReceive&&(a.rtpReceiver=new e.RTCRtpReceiver(a.dtlsTransport,s)),a.localCapabilities=c,a.sendEncodingParameters=u}),"max-compat"!==r._config.bundlePolicy&&(c+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){c+=a(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),c+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,c+="a="+i.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(c+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(u)},u.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(d("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(d("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var o=i.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(o+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=i.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,i){if(!(i+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var d;if(e.stream)"audio"===e.kind?d=e.stream.getAudioTracks()[0]:"video"===e.kind&&(d=e.stream.getVideoTracks()[0]),d&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var c=n(e.localCapabilities,e.remoteCapabilities);!c.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=a(e,c,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}});var c=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(c)},u.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(a,n){if(!r._remoteDescription)return n(d("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var c=0;c<r.transceivers.length;c++)if(r.transceivers[c].mid===e.sdpMid){o=c;break}var u=r.transceivers[o];if(!u)return n(d("OperationError","Can not add ICE candidate"));if(u.rejected)return a();var l=Object.keys(e.candidate).length>0?i.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return a();if(l.component&&1!==l.component)return a();if((0===o||o>0&&u.iceTransport!==r.transceivers[0].iceTransport)&&!s(u.iceTransport,l))return n(d("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=i.getMediaSections(r._remoteDescription.sdp))[o]+="a="+(l.type?p:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=i.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var f=0;f<r.transceivers.length&&(r.transceivers[f].rejected||(r.transceivers[f].iceTransport.addRemoteCandidate({}),(t=i.getMediaSections(r._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=i.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));f++);a()})},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw d("InvalidAccessError","Invalid selector.");return r.getStats()}var i=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&i.push(e[t].getStats())})}),Promise.all(i).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var i=r.prototype.getStats;r.prototype.getStats=function(){return i.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){var i;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(i=e[r]).type]||i.type,t.set(r,e[r])}),t})}}});var l=["createOffer","createAnswer"];return l.forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),u}},function(e,t,r){"use strict";var i=r(89),a=r(445);e.exports={shimGetUserMedia:r(443),shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=a(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,r){"use strict";var i=r(89),a=i.log;e.exports=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var a=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var n={};"number"==typeof i.ideal?(n[a("min",r)]=i.ideal,t.optional.push(n),(n={})[a("max",r)]=i.ideal,t.optional.push(n)):(n[a("",r)]=i.ideal,t.optional.push(n))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[a("",r)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[a(e,r)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var d,c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?d=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(d=["front"]),d)return r.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return d.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==d.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),a("chrome: "+JSON.stringify(e)),i(e)});e.video=n(e.video)}return a("chrome: "+JSON.stringify(e)),i(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,i){o(e,function(e){r.webkitGetUserMedia(e,t,function(e){i&&i(s(e))})})};var d=function(e){return new Promise(function(t,i){r.getUserMedia(e,t,i)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var c=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return o(e,function(e){return c(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else r.mediaDevices.getUserMedia=function(e){return d(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){a("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){a("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,r){"use strict";var i=r(89),a=i.log,n={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(i){var a;a=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===i.track.id}):{track:i.track};var n=new Event("track");n.track=i.track,n.receiver=a,n.transceiver={receiver:a},n.streams=[t.stream],r.dispatchEvent(n)}),t.stream.getTracks().forEach(function(i){var a;a=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===i.id}):{track:i};var n=new Event("track");n.track=i,n.receiver=a,n.transceiver={receiver:a},n.streams=[t.stream],r.dispatchEvent(n)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var a=r.apply(this,arguments);return a||(a=t(this,e),this._senders.push(a)),a};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],a.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],n.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrack:function(e){var t=i.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&t.version>=64)){var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());r._streams[t.id]=i,r._reverseStreams[i.id]=t,t=i}a.apply(r,[t])};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},n.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var a=[].slice.call(arguments,1);if(1!==a.length||!a[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(i.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var n=i._streams[r.id];if(n)n.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var o=new e.MediaStream([t]);i._streams[r.id]=o,i._reverseStreams[o.id]=r,i.addStream(o)}return i.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var i=d(e,r);t[0].apply(null,[i])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(t){return d(e,t)})}});var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],a=e._streams[i.id];r=r.replace(new RegExp(i.id,"g"),a.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:d(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===r))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");r._streams=r._streams||{},Object.keys(r._streams).forEach(function(i){r._streams[i].getTracks().find(function(t){return e.track===t})&&(t=r._streams[i])}),t&&(1===t.getTracks().length?r.removeStream(r._reverseStreams[t.id]):t.removeTrack(e.track),r.dispatchEvent(new Event("negotiationneeded")))}}function d(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],a=e._streams[i.id];r=r.replace(new RegExp(a.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}},shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCPeerConnection){var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var a=[],n=0;n<e.iceServers.length;n++){var o=e.iceServers[n];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,a.push(o)):a.push(e.iceServers[n])}e.iceServers=a}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}else e.RTCPeerConnection=function(t,r){return a("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var i=this,a=arguments;if(arguments.length>0&&"function"==typeof e)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof arguments[0]))return n.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return n.apply(this,[function(e){a[1](s(o(e)))},arguments[0]])}return new Promise(function(e,t){n.apply(i,[function(t){e(s(o(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,i=new Promise(function(i,a){r.apply(t,[e[0],i,a])});return e.length<2?i:i.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(i,a){r.apply(e,[i,a,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:n.shimMediaStream,shimOnTrack:n.shimOnTrack,shimAddTrackRemoveTrack:n.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:n.shimGetSendersWithDtmf,shimSourceObject:n.shimSourceObject,shimPeerConnection:n.shimPeerConnection,shimGetUserMedia:r(447)}},function(e,t,r){"use strict";var i=r(89);e.exports=function(e,t){var a=e&&e.window,n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var o in t)hasOwnProperty.call(t,o)&&(n[o]=t[o]);var s=i.log,d=i.detectBrowser(a),c={browserDetails:d,extractVersion:i.extractVersion,disableLog:i.disableLog,disableWarnings:i.disableWarnings},u=r(448)||null,l=r(446)||null,p=r(442)||null,f=r(440)||null,h=r(439)||null;switch(d.browser){case"chrome":if(!u||!u.shimPeerConnection||!n.shimChrome)return s("Chrome shim is not included in this adapter release."),c;s("adapter.js shimming chrome."),c.browserShim=u,h.shimCreateObjectURL(a),u.shimGetUserMedia(a),u.shimMediaStream(a),u.shimSourceObject(a),u.shimPeerConnection(a),u.shimOnTrack(a),u.shimAddTrackRemoveTrack(a),u.shimGetSendersWithDtmf(a),h.shimRTCIceCandidate(a);break;case"firefox":if(!p||!p.shimPeerConnection||!n.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=p,h.shimCreateObjectURL(a),p.shimGetUserMedia(a),p.shimSourceObject(a),p.shimPeerConnection(a),p.shimOnTrack(a),p.shimRemoveStream(a),h.shimRTCIceCandidate(a);break;case"edge":if(!l||!l.shimPeerConnection||!n.shimEdge)return s("MS edge shim is not included in this adapter release."),c;s("adapter.js shimming edge."),c.browserShim=l,h.shimCreateObjectURL(a),l.shimGetUserMedia(a),l.shimPeerConnection(a),l.shimReplaceTrack(a);break;case"safari":if(!f||!n.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=f,h.shimCreateObjectURL(a),f.shimRTCIceServerUrls(a),f.shimCallbacksAPI(a),f.shimLocalStreamsAPI(a),f.shimRemoteStreamsAPI(a),f.shimTrackEventTransceiver(a),f.shimGetUserMedia(a),f.shimCreateOfferLegacy(a),h.shimRTCIceCandidate(a);break;default:s("Unsupported browser!")}return c}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCBusiness=void 0;var i=f(r(1)),a=f(r(2)),n=f(r(4)),o=f(r(3)),s=r(110),d=f(r(19)),c=r(262),u=(r(51),function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e}(r(111)),r(11)),l=r(28),p=f(r(436));function f(e){return e&&e.__esModule?e:{default:e}}var h=r(5),m=h.info.nrtcSdkVersion,g=h.info.version,v=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r.rtcWathcher=new p.default({rtcBusiness:r,adapterRef:e.adapterRef,sdkRef:e.sdkRef}),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null,this.selfWebRtcInstance=null,this.remoteWebRtcInstanceMap={}}},{key:"_createWebRTCInstance",value:function(e){return this.rtcWathcher.startStats(),new c.WebRTCBuilder({imInfo:this.adapterRef.imInfo,adapterRef:this.adapterRef,targetUid:e,platformName:d.default.name,platformVersion:d.default.version}).build()}},{key:"createSelfWebRTCInstance",value:function(){var e=this._createWebRTCInstance(this.adapterRef.imInfo.uid);return this.selfWebRtcInstance=e,this._bindWebRTCEvent(e),e}},{key:"_destroyRtcSelf",value:function(){var e=this.selfWebRtcInstance;this.adapterRef.logger.log("WebRTCBusiness: _destroyRtcSelf: local rtc"),e&&(e.close(),this.selfWebRtcInstance=null)}},{key:"_destroyRtcByUid",value:function(e){var t=this.remoteWebRtcInstanceMap[e];this.adapterRef.logger.log("WebRTCBusiness: _destroyRtcByUid: remote rtc "+e),t&&(t.close(),clearInterval(t.reConnectTimer),delete this.remoteWebRtcInstanceMap[e])}},{key:"createRemoteWebRTCInstance",value:function(e){var t=this._createWebRTCInstance(e);return this.remoteWebRtcInstanceMap[e]=t,this._bindWebRTCEvent(t),t}},{key:"_bindWebRTCEvent",value:function(e){e.on("ready",this._handleReadyEvent4WebRTC.bind(this)),e.on("iceCandidate",this._handleIceCandidateEvent4WebRTC.bind(this)),e.on("iceCompleted",this._handleIceCompletedEvent4WebRTC.bind(this)),e.on("negotiationNeeded",this._handleNegotiationNeededEvent4WebRTC.bind(this)),e.on("iceStateChange",this._handleIceStateChangeEvent4WebRTC.bind(this)),e.on("iceCandidateTimeOut",this._handleIceCandidateTimeOutEvent4WebRTC.bind(this)),e.on("getRemoteStream",this._handleGetRemoteStreamEvent4WebRTC.bind(this))}},{key:"_unbindWebRTCEvent",value:function(e){e.removeListener("ready",this._handleReadyEvent4WebRTC.bind(this)),e.removeListener("iceCandidate",this._handleIceCandidateEvent4WebRTC.bind(this)),e.removeListener("iceCompleted",this._handleIceCompletedEvent4WebRTC.bind(this)),e.removeListener("negotiationNeeded",this._handleNegotiationNeededEvent4WebRTC.bind(this)),e.removeListener("iceStateChange",this._handleIceStateChangeEvent4WebRTC.bind(this)),e.removeListener("iceCandidateTimeOut",this._handleIceCandidateTimeOutEvent4WebRTC.bind(this)),e.removeListener("getRemoteStream",this._handleGetRemoteStreamEvent4WebRTC.bind(this))}},{key:"_handleReadyEvent4WebRTC",value:function(e){}},{key:"_handleIceCandidateEvent4WebRTC",value:function(e){this.adapterRef.logger.log("WebRTCBusiness:_handleIceCandidateEvent4WebRTC event: %o",JSON.stringify(e,null," "));var t=e.uid,r=e.ice;r&&/\d tcp \d/gi.test(r.candidate)?this.adapterRef.logger.warn("tcp candidate 忽略 "):this.adapterRef.instance._getWebRTCGateWayManager().doSendIceOffer({params:{dst_id:t,content:r}})}},{key:"_handleIceCompletedEvent4WebRTC",value:function(e){this.adapterRef.logger.log("WebRTCBusiness:_handleIceCompletedEvent4WebRTC event: ",e);var t=e,r=this.getRtcObject(t);if(t!==this.adapterRef.imInfo.uid&&l.WebrtcUtil.isSupportGetRecvivers/*!this.adapterRef.instance._isFirefox() && rtc && rtc.getReceivers*/){this.adapterRef.logger.log("remote stream (uid): %d, streams num: %d",t,r.getReceivers().length);var i=void 0,a=void 0;return r.getReceivers().forEach(function(e){e&&"audio"===e.track.kind?i=e.track:e&&"video"===e.track.kind&&(a=e.track)}),i&&this.adapterRef.instance._getAudioHelperByUid(t).setIsRemote(!0).composeTrack(t,i),void(a&&this.adapterRef.instance._getVideoHelperByUid(t).setIsRemote(!0).composeTrack(t,a))}var n=this.adapterRef.instance._getVideoHelperByUid(t);if(n&&r&&r.rtcConnection&&r.rtcConnection.remoteDescription&&r.rtcConnection.remoteDescription.sdp){this.adapterRef.logger.log("确保是拉流的updata sdp 触发的");var o=r.rtcConnection.remoteDescription.sdp;if(n.checkRemoteTrack(t,o,r.rtcConnection)&&(this.adapterRef.logger.log("视频需要检查远程轨道"),n.delayVideoShow(t,!0),n.remoteVideoStream)){var s=n.remoteVideoStream.getVideoTracks()[0];this.adapterRef.instance.emit(u.EVENT_OBJ.remoteTrack.key,{account:this.adapterRef.instance._getAccountByUid(t),uid:t,track:s});var d=this.adapterRef.instance._getAudioHelperByUid(t);this.adapterRef.instance._isChrome72()&&d&&d.remoteAudioStream&&this.adapterRef.instance.emit(u.EVENT_OBJ.remoteTrack.key,{account:this.adapterRef.instance._getAccountByUid(t),uid:t,track:d.remoteAudioStream.getAudioTracks()[0]})}this._handleUpdateLog(t,"completed",r)}}},{key:"_handleNegotiationNeededEvent4WebRTC",value:function(e){this.adapterRef.logger.log("WebRTCBusiness:_handleNegotiationNeededEvent4WebRTC event: %o",e)}},{key:"_handleIceStateChangeEvent4WebRTC",value:function(e){var t=this;if(this.adapterRef.webrtcBusiness){this.adapterRef.logger.log("WebRTCBusiness: _handleIceStateChange4WebRTC event: ",e.state);var r=e.rtc,i=e.state,a=r.targetUid;if(this.adapterRef.imInfo.netDetect&&(this.adapterRef.logger.log("WebRTCBusiness: _handleIceStateChange4WebRTC 重新赋值remoteWebRtcInstanceMap"),this.adapterRef.webrtcBusiness.remoteWebRtcInstanceMap=this.remoteWebRtcInstanceMap),"failed"!==i&&"connected"!==i||!this.adapterRef.logReportHelper||this._handleUpdateLog(a,i,r),"connected"===i)if(a==this.adapterRef.imInfo.uid)this.adapterRef.instance.emit(u.EVENT_OBJ.sessionConnected.key);else if(/*!this.adapterRef.instance._isFirefox() && rtc.getReceivers*/l.WebrtcUtil.isSupportGetRecvivers){this.adapterRef.logger.log("remote stream (uid): %s, streams num: %d",a,r.getReceivers().length);var n=void 0,o=void 0;r.getReceivers().forEach(function(e){e&&"audio"===e.track.kind?n=e.track:e&&"video"===e.track.kind&&(o=e.track)}),n&&this.adapterRef.instance._getAudioHelperByUid(a).setIsRemote(!0).composeTrack(a,n),o&&this.adapterRef.instance._getVideoHelperByUid(a).setIsRemote(!0).composeTrack(a,o)}if("connected"===i||"completed"===i?(r.disTimer&&(clearTimeout(r.disTimer),r.disTimer=null),r&&r.reConnectTimer&&(this.adapterRef.logger.warn("下行重连成功: ",a),clearInterval(r.reConnectTimer),r.reConnectTimer=null),this._doSdpUpdata(r)):"disconnected"===i&&(r.disTimer&&(clearTimeout(r.disTimer),r.disTimer=null),r.disTimer=setTimeout(function(){t.adapterRef.logger.warn("超时触发，ICE 连接失败: ",a),t._doIceFail4Self()},15e3)),"failed"===i){if(this.adapterRef.logger.warn("ICE 连接失败: ",a),r.disTimer&&(clearTimeout(r.disTimer),r.disTimer=null),a==this.adapterRef.imInfo.uid||this.adapterRef.instance._isFirefox())return void this._doIceFail4Self();this._doIceFail4Remote(a)}}}},{key:"_handleIceCandidateTimeOutEvent4WebRTC",value:function(e){var t=e.rtc,r=e.state;"completed"!==r&&"connected"!==r&&"closed"!==r&&t&&(this.adapterRef.logger.log("WebRTCBusiness: _handleGetRemoteStreamEvent4WebRTC event: %o","中继连接失败开始直连"),"WebRTC"===u.CONFIG_MAP.SDK_NAME[u.CONFIG_MAP.CURRENT.SDK_TYPE]?this.adapterRef.imInfo.serverMap.relayaddrs=null:"NRTC"===u.CONFIG_MAP.SDK_NAME[u.CONFIG_MAP.CURRENT.SDK_TYPE]&&(this.adapterRef.imInfo.relayaddrs=null),t.close(),t._resetPeerTimeOut(),t._init(),t.targetUid==this.adapterRef.imInfo.uid?this.adapterRef.instance._judgeSendSdpOfferOrUpdate():this.adapterRef.webrtcBusiness._createOffer({rtc:t}))}},{key:"_handleUpdateLog",value:function(e,t,r){if(this.adapterRef.logReportHelper){var i=function(e){var t={audioId:"",videoId:"",ext:""};return e&&e.length&&e.map(function(e){e.track&&"audio"==e.track.kind?t.audioId=e.track.id:e.track&&"video"==e.track.kind&&(t.videoId=e.track.id)}),t.ext="",t},a={};a.uid=this.adapterRef.imInfo&&this.adapterRef.imInfo.uid||"",a.remoteUid=e,a.ext="",a.iceConnection=t,a.localSdp=r&&r.rtcConnection.localDescription.sdp,a.remoteSdp=r&&r.rtcConnection.remoteDescription.sdp,a.locallCECandidates=[],a.remoteICECandidates=[],r&&r.rtcConnection&&r.rtcConnection.getSenders&&(a.upStream=i(r.rtcConnection.getSenders())),r&&r.rtcConnection&&r.rtcConnection.getReceivers&&(a.downStream=i(r.rtcConnection.getReceivers())),this.adapterRef.logReportHelper.uploadData("peerConnections",a)}}},{key:"_handleGetRemoteStreamEvent4WebRTC",value:function(e){this.adapterRef.logger.log("WebRTCBusiness:_handleGetRemoteStreamEvent4WebRTC event: %o",e);var t=e.uid,r=e.stream,i=e.track;t?this.adapterRef.instance._doRemoteStream(r,t,i):this.adapterRef.logger.error("未找到远程流的UID...")}},{key:"_doSdpUpdata",value:function(e){var t=e.rtcConnection;this.adapterRef.logger.log("WebRTCBusiness: _doSdpUpdata");var r=t.getSenders();if(e.targetUid==this.adapterRef.imInfo.uid&&r&&r.length>0)if(r.length>1&&r[0].track&&r[1]&&r[1].track)this.adapterRef.logger.log(" --\x3e media type: %s %s",r[0].track.kind,r[1].track.kind);else{if(!this.adapterRef.instance._isPlayer())return;var i=[],a=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.uid),n=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.uid),o=a.getLocalAudioStream(!0),s=n.getLocalVideoStream(!0);o&&i.push(o),s&&i.push(s);var d=!1;"WebRTC"===u.CONFIG_MAP.SDK_NAME[u.CONFIG_MAP.CURRENT.SDK_TYPE]?d=2==i.length:"NRTC"===u.CONFIG_MAP.SDK_NAME[u.CONFIG_MAP.CURRENT.SDK_TYPE]&&(d=2==i.length&&!this.adapterRef.tempInfo.localVideoMuted&&!this.adapterRef.tempInfo.localAudioMuted),d&&(this.adapterRef.logger.log("WebRTCBusiness: _doSdpUpdata 上行需要进行sdp协商!"),this.selfWebRtcInstance.updateStream(i),this._createOffer({rtc:e}))}else e.isNeedUpdataSdp&&(this.adapterRef.logger.log("WebRTCBusiness: _doSdpUpdata 下行(%s)需要进行sdp协商!",e.targetUid),e.isNeedUpdataSdp=!1,this._createOffer({rtc:e}));e.targetUid,this.adapterRef.imInfo.uid}},{key:"_doIceFail4Self",value:function(){this.adapterRef.logger.log("WebRTCBusiness: _doIceFail4Self 自己断开，_onSignalTimeout 开始重连!"),this.adapterRef.instance.commondDatareport("setDisconnect",{uid:this.adapterRef.instance.getUid()+"",cid:(this.adapterRef.imInfo&&this.adapterRef.imInfo.cid)+"",reason:"8",time:Date.now()}),this.adapterRef.reconnectState.isReconnect=!0,this.adapterRef.instance._onSignalTimeout()}},{key:"_doIceFail4Remote",value:function(e){var t=this;this.adapterRef.logger.log("WebRTCBusiness:_doIceFail4Remote (%s）断开连接了，现在开始进行下行第一次重连...",e);var r=this.getRtcObject(e);r?this.adapterRef&&this.adapterRef.reconnectState&&this.adapterRef.reconnectState.isStoped||this.adapterRef&&this.adapterRef.reconnectState&&this.adapterRef.reconnectState.startReconnect||(this.adapterRef.instance.commondDatareport("setDisconnect",{uid:this.adapterRef.instance.getUid()+"",cid:(this.adapterRef.imInfo&&this.adapterRef.imInfo.cid)+"",reason:"8",time:Date.now()}),r.reConnectTimer=setInterval(function(){r&&!r.rtcConnection&&t.adapterRef&&t.adapterRef.webrtcBusiness?r.rtcConnection.iceConnectionState||"connected"==r.rtcConnection.iceConnectionState||"completed"==r.rtcConnection.iceConnectionState||"closed"==r.rtcConnection.iceConnectionState?clearInterval(r.reConnectTimer):(t.adapterRef.logger.warn("WebRTCBusiness:_doIceFail4Remote (%s)下行第%s重连结束, state: ",e,r.count,r.rtcConnection.iceConnectionState),r.count>2&&(clearInterval(r.reConnectTimer),t.adapterRef.logger.warn("(%s)连接失败，现在清除该下行重连...",e),t.adapterRef.instance.emit(u.EVENT_OBJ.remoteSignalClosed.key,e),t.adapterRef.instance.doClearAfterRemoteLeave(e)),r.count++,t._createOffer({rtc:r})):clearInterval(r.reConnectTimer)},15e3),r.count=0,r.count++,this._createOffer({rtc:r})):this.adapterRef.logger.error("WebRTCBusiness:_doIceFail4Remote 不存在的远程rtc对象")}},{key:"getRtcObject",value:function(e){var t=null;return t=e==this.adapterRef.imInfo.uid?this._getSelfWebRtcInstance():this._getRemoteWebRtcInstance(e),this.adapterRef.logger.log("WebRTCBusiness:getRtcObject %s, uid=%s",e==this.adapterRef.imInfo.uid?"上行":"下行",e),t}},{key:"_hasAudio",value:function(){if(!this.adapterRef.deviceBusiness)return this.adapterRef.logger.log("WebRTCBusiness:_hasAudio no deviceBusiness"),!1;var e=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.uid),t=!1;e&&(t=e.isMixAuido());var r=this.adapterRef.state.audioDeviceHasOpened||t;return this.adapterRef.deviceBusiness.hasAudio(this.adapterRef.deviceBusiness.mediaDeviceHelper.getDeviceStatus(),r,this.adapterRef.imInfo.role)}},{key:"_hasVideo",value:function(){if(!this.adapterRef.deviceBusiness)return this.adapterRef.logger.log("WebRTCBusiness:_hasVideo no deviceBusiness"),!1;if("NRTC"===u.CONFIG_MAP.SDK_NAME[u.CONFIG_MAP.CURRENT.SDK_TYPE]){var e=this.adapterRef.instance._getVideoHelperByUid("local");return!(!e||!e.pushVideoStream||this.adapterRef.imInfo.role!==u.ROLE_FOR_MEETING.ROLE_PLAYER)}return"WebRTC"===u.CONFIG_MAP.SDK_NAME[u.CONFIG_MAP.CURRENT.SDK_TYPE]?this.adapterRef.deviceBusiness.hasVideo(this.adapterRef.deviceBusiness.mediaDeviceHelper.getDeviceStatus(),this.adapterRef.state.videoDeviceHasOpened,this.adapterRef.state.chromeScreenShareOpened,this.adapterRef.imInfo.role):void 0}},{key:"_getSelfWebRtcInstance",value:function(){return this.selfWebRtcInstance}},{key:"_getRemoteWebRtcInstance",value:function(e){return this.remoteWebRtcInstanceMap[e]}},{key:"_getWebRtcInstance",value:function(e){return e===this.adapterRef.imInfo.uid?this.selfWebRtcInstance:this.remoteWebRtcInstanceMap[e]}},{key:"_startRTCIfHasDeviceOpened",value:function(){this.adapterRef.logger.log("WebRTCBusiness:_startRTCIfHasDeviceOpened 如果有本地设备启用则初始化rtc"),this.adapterRef.imInfo.netDetect||this._hasAudio()||this._hasVideo()?this._initWebRTCInstance4Self(!1,!0):this.adapterRef.logger.log("WebRTCBusiness:_startRTCIfHasDeviceOpened 重连之后，不需要推流")}},{key:"_initWebRTCInstance4Self",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.adapterRef.logger.log("WebRTCBusiness:_initWebRTCInstance4Self 初始化WebRTC流程管理器 ..."),this.selfWebRtcInstance)return this.adapterRef.logger.log("WebRTCBusiness:_initWebRTCInstance4Self 已初始流程管理器，只更新流"),void(e&&(this._updateRtcStream(),this._startRtc(!0)));this.createSelfWebRTCInstance(),e&&(this._updateRtcStream(),this._startRtc(!0))}},{key:"_updateRtcStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.selfWebRtcInstance){this.adapterRef.logger.log("WebRTCBusiness:_updateRtcStream 更新流到RTC中");var t=[];if(this.adapterRef.instance._isPlayer()){var r=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.uid),i=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.uid),a=r.getLocalAudioStream(!0),n=i.getLocalVideoStream(!0);a||(r.setLocalAuioStreamToPushStream(),a=r.getLocalAudioStream(!0)),n||(i.setLocalVideoStreamToPushStream(),n=i.getLocalVideoStream(!0)),a&&!1===this.adapterRef.tempInfo.localAudioMuted&&t.push(a),!e||"chrome"!=l.RtcSystem.browser.ua&&"safari"!=l.RtcSystem.browser.ua||r&&r.enableDevice(),n&&!1===this.adapterRef.tempInfo.localVideoMuted&&t.push(n)}else if(e&&"chrome"==l.RtcSystem.browser.ua){var o=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.uid),s=o.getLocalAudioStream(!0);s||(o.setLocalAuioStreamToPushStream(),s=o.getLocalAudioStream(!0)),s&&!1===this.adapterRef.tempInfo.localAudioMuted&&(o&&o.disableDevice(),t.push(s))}this.selfWebRtcInstance.updateStream(t)}else this.adapterRef.logger.error("WebRTCBusiness:_updateRtcStream 自己的上行webrtc流程管理器实例未创建，无法更新流")}},{key:"_startRtc",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._createOffer({isUpdate:t}).then(function(){return new Promise(function(t,r){e.once("sessionConnected",function(r){e.adapterRef.logger.log("WebRTCBusiness:_startRtc ===== RTC连接成功...."),e.adapterRef.state.rtcConnected=!0,e.adapterRef.instance._setSessionConfig({rtcEndTime:Date.now()}),t(r)}),e.once("rtcConnectError",function(t){e.adapterRef.logger.error("WebRTCBusiness:_startRtc ===== RTC连接失败...");var i=Object.assign({event:t},u.GateWayErrorCode.GateWayRTCConnectFail);r(i)})})}).catch(function(t){e.adapterRef.logger.error("WebRTCBusiness:_startRtc 发起上行流失败 error=%o",t);var r=Object.assign({event:t},u.GateWayErrorCode.GateWayRTCConnectFail);return Promise.reject(r)})}},{key:"_createOffer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.isUpdate,i=void 0!==r&&r,a=t.rtc,n=void 0===a?this.selfWebRtcInstance:a;return this.adapterRef.logger.log("WebRTCBusiness:_createOffer uid %o",n.targetUid),n.targetUid==this.adapterRef.imInfo.uid&&"p2p"===this.adapterRef.imInfo.sessionMode&&(n.vp8Only=this.adapterRef.instance._getWebRTCGateWayManager().isVp8Only),n.createOffer().then(function(t){return e.adapterRef.logger.log("WebRTCBusiness:_createOffer, 开始设置本地描述..."),n.setLocalDescription(t,i)}).then(function(t){e.adapterRef.logger.log("WebRTCBusiness:_createOffer 本地描述设置成功, targetUid: ",n.targetUid),e._sendOffer({isUpdate:i,rtc:n,offer:t})}).catch(function(r){e.adapterRef.logger.warn("测测：",r),setTimeout(function(){e._createOffer(t)},100)})}},{key:"_sendOffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.isUpdate,r=void 0!==t&&t,i=e.rtc,a=void 0===i?this.selfWebRtcInstance:i,n=e.offer;this.adapterRef.logger.log("WebRTCBusiness:_sendOffer ");var o=a.targetUid==this.adapterRef.imInfo.uid,s=this.adapterRef.imInfo,d=this.adapterRef.imInfo.videoConfig,c=this.adapterRef.imInfo.sessionConfig,l={params:{version:+m,token:s.token||s.cid+"",user_type:s.token?3:2,user_token_type:0,content:n,dst_id:o?s.uid:a.targetUid,is_multi_peerconnection:!0,sdk_version:g}};if(o){var p=!!this.adapterRef.imInfo.netDetect||this._hasAudio(),f=!!this.adapterRef.imInfo.netDetect||this._hasVideo();this.adapterRef.logger.log("WebRTCBusiness:_sendOffer  hasAudio: %s, hasVideo: %s ",p,f),l.hasAudio=p,l.hasVideo=f,l.params.streamSetting={video:{width:this.adapterRef.state.chromeScreenShareOpened?1280:d.width,height:this.adapterRef.state.chromeScreenShareOpened?720:d.height,frameRate:this.adapterRef.state.chromeScreenShareOpened?5:c.liveEnable&&d.frameRate>15?15:d.frameRate}}}var h=this.adapterRef.instance._getWebRTCGateWayManager();return h?(r?h.doSendSdpUpdate(l):h.doSendSdpOffer(l),Promise.resolve()):Promise.reject(u.GateWayErrorCode.GateWayRTCConnectFail)}},{key:"selfUpdate",value:function(e){this.adapterRef.logger.log("WebRTCBusiness: selfUpdate: ===== 对方只支持vp8: ",e),this.adapterRef.imInfo.sessionMode===u.SESSION_MODE.P2P&&e&&this.adapterRef.instance._getWebRTCGateWayManager().codecState.vp8&&(this.adapterRef.logger.log("WebRTCBusiness: selfUpdate: ===== 需要重新协商推流为vp8..."),this.adapterRef.instance._getWebRTCGateWayManager().isVp8Only=!0,this.selfWebRtcInstance&&(this.selfWebRtcInstance.vp8Only=!0,this.selfWebRtcInstance.rtcConnection&&this.selfWebRtcInstance.rtcConnection.localDescription&&(this.adapterRef.logger.log("重新协商，sdp改成vp8"),this._createOffer({rtc:this.selfWebRtcInstance}))))}},{key:"doClientJoin",value:function(e,t){if(this.adapterRef.logger.log("WebRTCBusiness: doClientJoin: ===== 人员加入，创建下行流..."),this.adapterRef.webrtcBusiness._getRemoteWebRtcInstance(e))return this.adapterRef.logger.log("WebRTCBusiness: doClientJoin: 已存在远程rtc实例，即将执行_onclient_update"),this.doClientUpdate(e,!0);var r=this.adapterRef.webrtcBusiness.createRemoteWebRTCInstance(e);if("p2p"===this.adapterRef.imInfo.sessionMode){var i=this.adapterRef.instance._getWebRTCGateWayManager();t&&i.codecState.vp8&&(r.vp8Only=!0)}if(!this.adapterRef.imInfo.netDetect){var a=this.adapterRef.instance._getAudioHelperByUid(e),n=this.adapterRef.instance._getVideoHelperByUid(e);n.isJoined=!0,n.setRTC(r),a.setRTC(r)}this._createOffer({rtc:r})}},{key:"doClientUpdate",value:function(e,t){if(this.adapterRef.logger.log("WebRTCBusiness:doClientUpdate uid=%o, hasVideo=%o",e,t),!this.adapterRef.webrtcBusiness._getRemoteWebRtcInstance(e))return this.adapterRef.logger.log("WebRTCBusiness: doClientUpdate: 不存在远程rtc实例，即将执行doClientJoin"),this.doClientJoin(e);var r=this.getRtcObject(e);r?1==t?r.rtcConnection&&r.rtcConnection.localDescription&&r.rtcConnection.iceConnectionState&&"connected"!==r.rtcConnection.iceConnectionState&&"completed"!==r.rtcConnection.iceConnectionState?(this.adapterRef.logger.warn("create rtc later"),r.isNeedUpdataSdp=!0):this._createOffer({rtc:r}):this.adapterRef.instance._getVideoHelperByUid(e).delayVideoShow(e,t):this.adapterRef.logger.error("WebRTCBusiness:doClientUpdate 不存在的远程rtc对象")}},{key:"switchTrackEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stream,r=e.uid,i=e.bindTrackEvent,a=void 0===i||i;t&&r?(this.adapterRef.logger.log("WebRTCBusiness:switchTrackEvent stream=%o, uid=%o, bindTrackEvent=%o",t,r,a),a?this._doBindTrackEvent(e):this._doUnBindTrackEvent(e)):this.adapterRef.logger.error("WebRTCBusiness:switchTrackEvent 不存在的流或uid")}},{key:"_doUnBindTrackEvent",value:function(e){var t=e.stream,r=e.uid;this.adapterRef.logger.log("WebRTCBusiness:_doUnBindTrackEvent 解绑轨道事件 stream=%o, uid=%o",t&&t.id,r),t.onaddtrack=null,t.onremovetrack=null}},{key:"_doBindTrackEvent",value:function(e){var t=e.stream,r=e.uid;this.adapterRef.logger.log("WebRTCBusiness:_doBindTrackEvent 绑定轨道事件 stream=%o, uid=%o",t,r),t&&r?(t.onaddtrack||this._doRegisterAddTrackEvent(t,r),t.onremovetrack||this._doRegisterRemoveTrackEvent(t,r)):this.adapterRef.logger.error("WebRTCBusiness:_doBindTrackEvent 不存在的流对象或uid")}},{key:"_doRegisterAddTrackEvent",value:function(e,t){var r=this;this.adapterRef.logger.log("WebRTCBusiness:_doRegisterAddTrackEvent 添加轨道添加事件 stream=%o, uid=%o",e,t),e.onaddtrack=function(e){if(r.adapterRef.imInfo.netDetect)r.adapterRef.logger.log("audioHelper:_composeTrack 网络探测直接忽略");else{r.adapterRef.instance.emit(u.EVENT_OBJ.addTrack.key,e),r.adapterRef.logger.log("stream 添加轨道添加事件: ",e);var i=e.track;if("audio"==i.kind)return r.adapterRef.instance._getAudioHelperByUid(t).composeTrack(t,i),void r.adapterRef.logger.warn("WebRTCBusiness:_doRegisterAddTrackEvent 非video直接返回...");var a=r.adapterRef.instance._getVideoHelperByUid(t);a.composeTrack(t,i),a.setIsRemote(!0);var n=r.getRtcObject(t);if(r.adapterRef.instance.emit(u.EVENT_OBJ.remoteTrack.key,{account:r.adapterRef.instance._getAccountByUid(t),uid:t,track:i}),n.rtcConnection&&n.rtcConnection.remoteDescription&&n.rtcConnection.remoteDescription.sdp){var o=n.rtcConnection.remoteDescription.sdp;a.checkRemoteTrack(t,o)}a.delayVideoShow(t)}}}},{key:"_doRegisterRemoveTrackEvent",value:function(e,t){var r=this;this.adapterRef.logger.log("WebRTCBusiness:_doRegisterRemoveTrackEvent 删除轨道事件 stream=%o, uid=%o",e,t),e.onremovetrack=function(e){var i=e.track.kind;if(r.adapterRef.instance.emit(u.EVENT_OBJ.removeTrack.key,e),"audio"!==i){var a=r.adapterRef.instance._getVideoHelperByUid(t);a.remoteVideoStream&&a.hide()}else r.adapterRef.logger.warn("WebRTCBusiness:_doRegisterRemoveTrackEvent 非video直接返回...")}}},{key:"_switchRole",value:function(){this.adapterRef.logger.log("WebRTCBusiness:_switchRole ");var e=this.adapterRef.instance._getWebRTCGateWayManager();return e&&e.state.hasLogined?this.adapterRef.instance._updateRtc(!0,!0):Promise.resolve()}},{key:"_enableDevice",value:function(e){return this.adapterRef.logger.log("WebRTCBusiness:_enableDevice 设备解禁"),this._switchDeviceTrackStatus(e,!0),Promise.resolve()}},{key:"_disableDevice",value:function(e){return this.adapterRef.logger.log("WebRTCBusiness:_disableDevice 设备禁用"),this._switchDeviceTrackStatus(e,!1),Promise.resolve()}},{key:"_switchDeviceTrackStatus",value:function(e,t){var r=[];if(e===u.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN){var i=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.uid);i.localAudioStream&&(r=i.localAudioStream.getTracks())}else{var a=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.uid);a.localVideoStream&&(r=a.localVideoStream.getTracks())}r.map(function(e){e.enabled=t})}},{key:"destroy",value:function(){this.adapterRef.logger.log("WebRTCBusiness:destroy"),this.selfWebRtcInstance&&(this._unbindWebRTCEvent(this.selfWebRtcInstance),this.selfWebRtcInstance.destroy(),this.selfWebRtcInstance=null),this.rtcWathcher&&(this.rtcWathcher.destroy(),this.rtcWathcher=null);var e=this.remoteWebRtcInstanceMap;for(var t in e){var r=e[t];r&&(this._unbindWebRTCEvent(r),r.destroy(),r=null)}}}]),t}(s.AbstractBusiness);t.WebRTCBusiness=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceBusiness=void 0;var i=c(r(1)),a=c(r(2)),n=c(r(4)),o=c(r(3)),s=r(51),d=r(11);function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r._initMediaDeviceHelper(),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null,this.mediaDeviceHelper=null}},{key:"_initMediaDeviceHelper",value:function(){this.mediaDeviceHelper?this.adapterRef.logger.log("DeviceBusiness:_initMediaDeviceHelper: 已存在的MediaDeviceHelper实例，不重复创建!"):(this.adapterRef.logger.log("DeviceBusiness: _initMediaDeviceHelper: 初始化mediaDeviceHelper"),this.mediaDeviceHelper=new s.MediaDeviceHelper({adapterRef:this.adapterRef,sdkRef:this.sdkRef}),this._bindDeviceEvent())}},{key:"_bindDeviceEvent",value:function(){this.mediaDeviceHelper.on(d.EVENT_OBJ.deviceAdd.key,this._onDeviceAdd.bind(this)),this.mediaDeviceHelper.on(d.EVENT_OBJ.deviceRemove.key,this._onDeviceRemove.bind(this)),this.mediaDeviceHelper.on(d.EVENT_OBJ.deviceStatus.key,this._onDeviceStatus.bind(this))}},{key:"_unbindDeviceEvent",value:function(){this.mediaDeviceHelper.removeListener(d.EVENT_OBJ.deviceAdd.key,this._onDeviceAdd.bind(this)),this.mediaDeviceHelper.removeListener(d.EVENT_OBJ.deviceRemove.key,this._onDeviceRemove.bind(this)),this.mediaDeviceHelper.removeListener(d.EVENT_OBJ.deviceStatus.key,this._onDeviceStatus.bind(this))}},{key:"_onDeviceAdd",value:function(e){this.adapterRef.logger.log("DeviceBusiness: _onDeviceAdd: ",e),this.adapterRef.instance.emit(d.EVENT_OBJ.deviceAdd.key,e)}},{key:"_onDeviceRemove",value:function(e){this.adapterRef.logger.log("DeviceBusiness: _onDeviceRemove: ",e),this.adapterRef.instance.emit(d.EVENT_OBJ.deviceRemove.key,e)}},{key:"_onDeviceStatus",value:function(e){this.adapterRef.logger.log("DeviceBusiness: _onDeviceStatus: ",e),this.adapterRef.instance.emit(d.EVENT_OBJ.deviceStatus.key,e)}},{key:"hasAudio",value:function(e,t,r){return this.adapterRef.logger.log("DeviceBusiness: hasAudio: 检测是否有音频, deviceStatus=%s, audioDeviceHasOpened=%o, role=%o",JSON.stringify(e,null," "),t,r),(t=r===d.ROLE_FOR_MEETING.ROLE_PLAYER)&&r===d.ROLE_FOR_MEETING.ROLE_PLAYER}},{key:"hasVideo",value:function(e,t,r,i){return this.adapterRef.logger.log("DeviceBusiness: hasVideo: 检测是否有视频, videoDeviceHasOpened=%o, chromeScreenShareOpened=%o, role=%o",t,r,i),r||t&&i===d.ROLE_FOR_MEETING.ROLE_PLAYER}},{key:"destroy",value:function(){this.adapterRef.logger.log("DeviceBusiness: destroy "),this.mediaDeviceHelper&&(this._unbindDeviceEvent(),this.mediaDeviceHelper.destroy(),this.mediaDeviceHelper=null)}}]),t}(r(110).AbstractBusiness);t.DeviceBusiness=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC2GateWayBusiness=void 0;var i=l(r(1)),a=l(r(2)),n=l(r(4)),o=l(r(3)),s=r(51),d=r(110),c=l(r(19)),u=r(11);r(28);function l(e){return e&&e.__esModule?e:{default:e}}var p=r(5),f=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null,this.webRTCGateWayManager=null}},{key:"doTryInit",value:function(){var e=this.adapterRef.imInfo,t=e.serverMap,r=void 0===t?{}:t,i=e.wssArr;this.adapterRef.logger.log("WebRTC2GateWayBusiness: doTryInit serverMap=%o, wssArr=%o",r,i);var a=null;if(!i)if(r)i=r.webrtcarray||[r.webrtc];else{var n=(this.adapterRef.imInfo.clientConfig&&JSON.parse(this.adapterRef.imInfo.clientConfig)||{}).custom||{};i=n.webrtcarray||[n.webrtc],this.adapterRef.imInfo.serverMap=n}return this.adapterRef.logger.log("WebRTC2GateWayBusiness: doTryInit: 合并后的wssArr=%o",i),i&&0!==i.length?(a=i[0],this.adapterRef.wssArrConf&&this.adapterRef.wssArrConf.isConf&&this.adapterRef.wssArrConf.wssArr&&(a=this.adapterRef.wssArrConf.wssArr),this.adapterRef.isPrivateDeployment&&this.adapterRef.privateDeploymentConf&&this.adapterRef.privateDeploymentConf.wssServer&&(a=this.adapterRef.privateDeploymentConf.wssServer+"/?"+a.split("/?")[1],p.wssServer=this.adapterRef.privateDeploymentConf.wssServer),this.adapterRef.logger.log("WebrtcGateWayBusiness: doTryInit: 使用的ssArr=%o",a),this._initWebRTCGateWayManager({url:a,context:this._transform2WebRTCGateWayContext(this.adapterRef.imInfo),keepAliveInterval4Second:5})):(this.adapterRef.logger.error("WebRTC2GateWayBusiness: doTryInit: ",u.GateWayErrorCode.GateWayAddressNotAvailable),Promise.reject(u.GateWayErrorCode.GateWayAddressNotAvailable))}},{key:"destroy",value:function(){this.adapterRef.logger.log("WebRTCGateWayBusiness: destroy");var e=this.webRTCGateWayManager;e&&(this._unbindWebRTCGateWayManagerEvent(e),e.state.hasLogined&&!this.adapterRef.reconnectState.startReconnect?e.doSendLogout({params:{content:{timestamp:Date.now()}}}):this.adapterRef.logger.warn("WebRTCGateWayBusiness: destroy, 没有login，无需logout"),e.destroy(),e=null)}},{key:"_initWebRTCGateWayManager",value:function(e){var t=this;this.adapterRef.logger.log("WebRTCGateWayBusiness: _initWebRTCGateWayManager 初始化网关管理器 ...");var r=e.url,i=e.context,a=e.keepAliveInterval4Second;return null!=this.webRTCGateWayManager?(this.adapterRef.logger.error("WebRTC2GateWayBusiness: _initWebRTCGateWayManager msg",u.GateWayErrorCode.GateWayLoginAlready),Promise.reject(u.GateWayErrorCode.GateWayLoginAlready)):null!=this.webRTCGateWayManager&&this.webRTCGateWayManager.state.hasLogined?(this.adapterRef.logger.error("WebRTC2GateWayBusiness: _initWebRTCGateWayManager msg",u.GateWayErrorCode.GateWayLoginAlready),Promise.reject(u.GateWayErrorCode.GateWayLoginAlready)):new Promise(function(e,n){t.webRTCGateWayManager=new s.WebRTC2GateWayManager({connectResolve:e,connectReject:n,url:r,context:i,keepAliveInterval4Second:a,adapterRef:t.adapterRef,sdkRef:t.sdkRef}),t._bindWebRTCGateWayManagerEvent(t.webRTCGateWayManager)})}},{key:"_bindWebRTCGateWayManagerEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _bindWebRTCGateWayManagerEvent: 网关管理器事件绑定 ..."),e.on("error",this._handleErrorEvent.bind(this)),e.on("close",this._handleCloseEvent.bind(this)),e.on("login",this._handleLoginEvent.bind(this)),e.on("userUpdate",this._userUpdateEvent.bind(this)),e.on("mediaUpdate",this._mediaUpdateEvent.bind(this)),e.on("subSource",this._subSourceEvent.bind(this)),e.on("ssrcUpdate",this._ssrcUpdateEvent.bind(this)),e.on("muteUpdate",this._muteUpdateEvent.bind(this)),e.on("userPubAck",this._userPubAckEvent.bind(this)),e.on("userSubAck",this._userSubAckEvent.bind(this)),e.on("userPub",this._userPubEvent.bind(this))}},{key:"_unbindWebRTCGateWayManagerEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _unbindWebRTCGateWayManagerEvent: 网关管理器事件解除绑定 ..."),e.removeListener("error",this._handleErrorEvent.bind(this)),e.removeListener("close",this._handleCloseEvent.bind(this)),e.removeListener("login",this._handleLoginEvent.bind(this)),e.removeListener("userUpdate",this._userUpdateEvent.bind(this)),e.removeListener("mediaUpdate",this._mediaUpdateEvent.bind(this)),e.removeListener("subSource",this._subSourceEvent.bind(this)),e.removeListener("ssrcUpdate",this._ssrcUpdateEvent.bind(this)),e.removeListener("muteUpdate",this._muteUpdateEvent.bind(this)),e.removeListener("userPubAck",this._userPubAckEvent.bind(this)),e.removeListener("userSubAck",this._userSubAckEvent.bind(this)),e.removeListener("userPub",this._userPubEvent.bind(this))}},{key:"_handleErrorEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleErrorEvent 网关发生错误，event=%o",e)}},{key:"_handleCloseEvent",value:function(e){this.adapterRef.logger.log("WebRTC2GateWayBusiness: _handleCloseEvent 网关关闭，event=%o",e)}},{key:"_handleLoginEvent",value:function(e){if(!e.success)return this.adapterRef.logger.warn("WebRTCGateWayBusiness: _handleLoginEvent: 登录失败，断开连接"),void this.emit(u.EVENT_OBJ.gatewayClosed.key,u.GateWayErrorCode.GateWayLoginFail);this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleLoginEvent 网关登录结果, event:",JSON.stringify(e,null," ")),this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleLoginEvent: startReconnect: ",this.adapterRef.reconnectState.startReconnect),1==this.adapterRef.reconnectState.startReconnect&&this.adapterRef.webrtcBusiness&&(this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleLoginEvent: 重连之后，重新推流"),this.adapterRef.reconnectState.startReconnect=!1,this.adapterRef.reconnectState.isReconnect=!1,this.adapterRef.reconnectState.count=0,this.adapterRef.reconnectState.connectTimer&&(clearTimeout(this.adapterRef.reconnectState.connectTimer),this.adapterRef.reconnectState.connectTimer=null),/Firefox/gi.test(navigator.userAgent)?this._handleReconnect(!0):this.adapterRef.webrtcBusiness._startRTCIfHasDeviceOpened())}},{key:"_userUpdateEvent",value:function(e){var t=this,r=e.cid,i=e.updatetype,a=e.users;this.adapterRef.logger.log("WebRTC2GateWayBusiness: _userUpdateEvent 成员更新: ",e);var n={uid:"",account:"",channelId:r};a&&a.map(function(e){n.uid=e.externalid,"add"==i?t.emit(u.EVENT_OBJ.userJoined.key,n):"remove"==i&&t.emit(u.EVENT_OBJ.userLeft.key,n)})}},{key:"_mediaUpdateEvent",value:function(e){var t=this,r=(e.cid,e.users);this.adapterRef.logger.log("WebRTC2GateWayBusiness: _mediaUpdateEvent 成员更新: ",e),r&&r.map(function(e){var r=!1,i=!1,a=null;e.devices.map(function(n){"audio"==n.mediatype?(r=!0,t.adapterRef.instance._getAudioHelperByUid(e.userid)):"video"==n.mediatype&&(i=!0,a=t.adapterRef.instance._getVideoHelperByUid(e.userid))}),t.emit(u.EVENT_OBJ.userStateUpdated.key,{uid:e.externalid,audio:r,video:i}),1==a.isJoined?r&&i?t.adapterRef.webrtcBusiness.doClientUpdate(e.userid,i,e.devices):t.adapterRef.instance.doClearAfterRemoteLeave(e.userid):r||i?t.adapterRef.webrtcBusiness.doClientJoin(e.userid,e.devices):t.adapterRef.instance.doClearAfterRemoteLeave(e.userid)})}},{key:"_subSourceEvent",value:function(e){e.cid,e.userid,e.mediatype,e.deviceid,e.quality,e.maxbitrate;this.adapterRef.logger.log("WebRTC2GateWayBusiness: _subSourceEvent 成员更新: ",e)}},{key:"_ssrcUpdateEvent",value:function(e){e.cid,e.cmd_type;var t=e.cname,r=(e.deviceid,e.label),i=(e.mediatype,e.mslabel),a=e.nackssrc,n=(e.sid,e.ssrc),o=e.userid;this.adapterRef.logger.log("WebRTC2GateWayBusiness: _ssrcUpdateEvent 成员更新: ",e);var s=this.adapterRef.webrtcBusiness.getRtcObject(o);console.warn("peerConnection状态: ",s.rtcConnection.signalingState);var d=s.rtcConnection.localDescription,c=s.rtcConnection.remoteDescription,u="a=ssrc-group:FID "+n+" "+a+"\r\na=ssrc:"+n+" cname:"+t+"\r\na=ssrc:"+n+" msid:"+i+" "+r+"\r\na=ssrc:"+n+" mslabel:"+i+"\r\na=ssrc:"+n+" label:"+r+"\r\na=ssrc:"+a+" cname:"+t+"\r\na=ssrc:"+a+" msid:"+i+" "+r+"\r\na=ssrc:"+a+" mslabel:"+i+"\r\na=ssrc:"+a+" label:"+r+"\r\n";console.warn("ssrcGroup: ",u),c.sdp=c.sdp.replace(/a=ssrc-group:FID ([a-zA-Z0-9 -:=\r\n]*)/g,u),s.setLocalDescription(d).then(function(e){console.warn("offer 成功了: ",e),s.setRemoteDescription(c,"answer").then(function(e){console.warn("answer 成功了：",e)})})}},{key:"_muteUpdateEvent",value:function(e){e.cid;var t=e.userid,r=(e.sid,e.mediatype),i=(e.deviceid,e.status);this.adapterRef.logger.log("WebRTC2GateWayBusiness: _muteUpdateEvent 成员更新: ",e);var a=!0,n=!0,o=this.adapterRef.instance._getVideoHelperByUid(t);"audio"==r?(a=0==i,n=!!o.videoDomHelper):"video"==r&&(n=0==i),this.emit(u.EVENT_OBJ.userStateUpdated.key,{uid:t,audio:a,video:n}),a||n?this.adapterRef.webrtcBusiness.doClientUpdate(t,n):this.adapterRef.instance.doClearAfterRemoteLeave(client_id)}},{key:"_userPubAckEvent",value:function(e){e.cid;var t=e.sid,r=e.sdp;this.adapterRef.logger.log("WebRTC2GateWayBusiness: _userPubAckEvent 收到pub回包 sid %s",t),this.adapterRef.webrtcBusiness.getRtcObject(this.adapterRef.imInfo.userid).setRemoteDescription({type:"answer",sdp:r},"answer")}},{key:"_userSubAckEvent",value:function(e){e.cid,e.userid;var t=e.sid,r=(e.deviceid,e.sdp);this.adapterRef.logger.log("WebRTC2GateWayBusiness: _userSubAckEvent 收到pub回包 sid %s",t),this.adapterRef.webrtcBusiness.getRtcObject(t).setRemoteDescription({type:"answer",sdp:r},"answer")}},{key:"_userPubEvent",value:function(e){e.cid;var t=e.userid,r=e.negotype,i=e.devices;e.sdp;this.adapterRef.logger.log("WebRTC2GateWayBusiness: _userPubEvent 收到pub消息 userid: %s",t);var a=!1,n=!1,o=(this.adapterRef.instance._getAudioHelperByUid(t),this.adapterRef.instance._getVideoHelperByUid(t));i&&i.map(function(e){"audio"==e.mediatype?a="open"==e.status:"video"==e.mediatype&&(n="open"==e.status)}),this.adapterRef.logger.log("WebRTC2GateWayBusiness: _userPubEvent has_audio: %s, has_video: %s",a,n),this.emit(u.EVENT_OBJ.userStateUpdated.key,{uid:t,audio:a,video:n}),o&&1==o.isJoined?a||n?this.adapterRef.webrtcBusiness.doClientUpdate(t,n,i,r):this.adapterRef.instance.doClearAfterRemoteLeave(t):a||n?this.adapterRef.webrtcBusiness.doClientJoin(t,i):this.adapterRef.instance.doClearAfterRemoteLeave(t)}},{key:"_transform2WebRTCGateWayContext",value:function(e){var t=Object.assign({},e);return new s.WebRTC2GateWayContext({externalid:t.uid,cid:t.cid,subtype:t.subtype,role:t.role,username:t.username,token:t.token,version:t.version,roomname:t.roomname,session_mode:t.sessionMode,engineversion:t.engineversion,aslmode:t.aslmode,rtmp:{host:!!t.sessionConfig.rtmpUrl||"0",support:t.sessionConfig.liveEnable||"0",needrecord:t.sessionConfig.rtmpRecord||"0",rtmpurl:t.sessionConfig.rtmpUrl||"",Participantmode:t.sessionConfig.layout||"",layout:"M-"+t.sessionConfig.splitMode},record:{startcaller:t.sessionConfig.recordAudio||"0",host:t.sessionConfig.host||"0",support_auido:t.sessionConfig.recordAudio||"0",support_video:t.sessionConfig.recordVideo||"0",layout:t.sessionConfig.layout||"",recordtype:t.sessionConfig.recordType||"0"},browser:{name:c.default.name,version:c.default.version}})}}]),t}(d.AbstractBusiness);t.WebRTC2GateWayBusiness=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCGateWayBusiness=void 0;var i=p(r(1)),a=p(r(2)),n=p(r(4)),o=p(r(3)),s=r(51),d=r(110),c=p(r(19)),u=r(11),l=r(28);function p(e){return e&&e.__esModule?e:{default:e}}var f=r(5),h=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.adapterRef=e.adapterRef,r.sdkRef=e.sdkRef,r.detectNetworkResult=null,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.adapterRef=null,this.sdkRef=null,this.webRTCGateWayManager=null}},{key:"_onWaitForWssocket",value:function(){var e=this;return this.adapterRef.logger.log("WebrtcGateWayBusiness： _onWaitForWssocket 等待连接"),new Promise(function(t,r){if(e.adapterRef.logger.log("WebrtcGateWayBusiness: _onWaitForWssocket startReconnect: ",e.adapterRef.reconnectState.startReconnect),!e.adapterRef.reconnectState.startReconnect)if(e.adapterRef.webrtcGateWayBusiness&&e.adapterRef.webrtcGateWayBusiness.webRTCGateWayManager.state.hasLogined)e.adapterRef.logger.log("WebrtcGateWayBusiness:  _onWaitForWssocket wss已经连接成功");else{var i=0;e.adapterRef.reconnectState.wssTime&&(clearInterval(e.adapterRef.reconnectState.wssTime),e.adapterRef.reconnectState.wssTime=null),e.adapterRef.reconnectState.wssTime=setInterval(function(){i++>450&&(clearInterval(e.adapterRef.reconnectState.wssTime),e.adapterRef.logger.log("WebrtcGateWayBusiness: _onWaitForWssocket wss连接超时"),i=0,e.adapterRef.instance.commondDatareport("setDisconnect",{uid:e.adapterRef.instance.getUid()+"",cid:(e.adapterRef.imInfo&&e.adapterRef.imInfo.cid)+"",reason:"1",time:Date.now()}),e.emit(u.EVENT_OBJ.gatewayClosed.key,u.GateWayErrorCode.GateWayConnectionTimeout),r(u.GateWayErrorCode.GateWayConnectionTimeout)),e.adapterRef.webrtcGateWayBusiness&&e.adapterRef.webrtcGateWayBusiness.webRTCGateWayManager.state.hasLogined?(e.adapterRef.logger.log("WebrtcGateWayBusiness: _onWaitForWssocket 连接成功, wssTime: ",e.adapterRef.reconnectState.wssTime),clearInterval(e.adapterRef.reconnectState.wssTime),e.adapterRef.reconnectState.wssTime=null,t(e.adapterRef.webrtcGateWayBusiness.webRTCGateWayManager)):e.adapterRef.reconnectState.isStoped&&(e.adapterRef.logger.log("WebrtcGateWayBusiness: _onWaitForWssocket 连接失败, wssTime: ",e.adapterRef.reconnectState.wssTime),clearInterval(e.adapterRef.reconnectState.wssTime),e.adapterRef.reconnectState.wssTime=null,e.adapterRef.reconnectState.isStoped=!1,e.emit(u.EVENT_OBJ.gatewayClosed.key,u.GateWayErrorCode.GateWayConnectionTimeout),r(u.GateWayErrorCode.GateWayConnectionTimeout))},360)}})}},{key:"doTryInit",value:function(){var e=this.adapterRef.imInfo,t=e.serverMap,r=void 0===t?{}:t,i=e.wssArr;this.adapterRef.logger.log("WebrtcGateWayBusiness: doTryInit serverMap=%o, wssArr=%o",r,i);var a=null;if(!i)if(r)i=r.webrtcarray||[r.webrtc];else{var n=(this.adapterRef.imInfo.clientConfig&&JSON.parse(this.adapterRef.imInfo.clientConfig)||{}).custom||{};i=n.webrtcarray||[n.webrtc],this.adapterRef.imInfo.serverMap=n}return this.adapterRef.logger.log("WebrtcGateWayBusiness: doTryInit: 合并后的wssArr=%o",i),i&&0!==i.length?(a=i[0],this.adapterRef.wssArrConf&&this.adapterRef.wssArrConf.isConf&&this.adapterRef.wssArrConf.wssArr&&(a=this.adapterRef.wssArrConf.wssArr),this.adapterRef.isPrivateDeployment&&this.adapterRef.privateDeploymentConf&&this.adapterRef.privateDeploymentConf.wssServer&&(a=this.adapterRef.privateDeploymentConf.wssServer+"/?"+a.split("/?")[1],f.wssServer=this.adapterRef.privateDeploymentConf.wssServer),this.adapterRef.logger.log("WebrtcGateWayBusiness: doTryInit: 使用的ssArr=%o",i),this._initWebRTCGateWayManager({url:a,context:this._transform2WebRTCGateWayContext(this.adapterRef.imInfo),keepAliveInterval4Second:5}),this._onWaitForWssocket()):(this.adapterRef.logger.error("WebRTCGateWayBusiness: doTryInit: ",u.GateWayErrorCode.GateWayAddressNotAvailable),Promise.reject(u.GateWayErrorCode.GateWayAddressNotAvailable))}},{key:"destroy",value:function(){this.adapterRef.logger.log("WebRTCGateWayBusiness: destroy");var e=this.webRTCGateWayManager;e&&(this._unbindWebRTCGateWayManagerEvent(e),e.state.hasLogined&&!this.adapterRef.reconnectState.startReconnect?e.doSendLogout({params:{content:{timestamp:Date.now()}}}):this.adapterRef.logger.warn("WebRTCGateWayBusiness: destroy, 没有login，无需logout"),e.destroy(),e=null)}},{key:"_initWebRTCGateWayManager",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _initWebRTCGateWayManager 初始化网关管理器 ...");var t=e.url,r=e.context,i=e.keepAliveInterval4Second;return null!=this.webRTCGateWayManager?(this.adapterRef.logger.error("WebRTCGateWayBusiness: _initWebRTCGateWayManager msg",u.GateWayErrorCode.GateWayLoginAlready),Promise.reject(u.GateWayErrorCode.GateWayLoginAlready)):null!=this.webRTCGateWayManager&&this.webRTCGateWayManager.state.hasLogined?(this.adapterRef.logger.error("WebRTCGateWayBusiness: _initWebRTCGateWayManager msg",u.GateWayErrorCode.GateWayLoginAlready),Promise.reject(u.GateWayErrorCode.GateWayLoginAlready)):(this.webRTCGateWayManager=new s.WebRTCGateWayManager({url:t,context:r,keepAliveInterval4Second:i,adapterRef:this.adapterRef,sdkRef:this.sdkRef}),void this._bindWebRTCGateWayManagerEvent(this.webRTCGateWayManager))}},{key:"_bindWebRTCGateWayManagerEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _bindWebRTCGateWayManagerEvent: 网关管理器事件绑定 ..."),e.on("error",this._handleErrorEvent.bind(this)),e.on("close",this._handleCloseEvent.bind(this)),e.on("login",this._handleLoginEvent.bind(this)),e.on("sdpAnswer",this._handleSdpAnswerEvent.bind(this)),e.on("iceAnswer",this._handleIceAnswerEvent.bind(this)),e.on("userJoin",this._handleUserJoinEvent.bind(this)),e.on("userUpdate",this._handleUserUpdateEvent.bind(this)),e.on("userLeave",this._handleUserLeaveEvent.bind(this)),e.on("clientError",this._handleClentErrorEvent.bind(this)),e.on("detectNetwork",this._handleDetectNetworkEvent.bind(this))}},{key:"_unbindWebRTCGateWayManagerEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _unbindWebRTCGateWayManagerEvent: 网关管理器事件解除绑定 ..."),e.removeListener("error",this._handleErrorEvent.bind(this)),e.removeListener("close",this._handleCloseEvent.bind(this)),e.removeListener("login",this._handleLoginEvent.bind(this)),e.removeListener("sdpAnswer",this._handleSdpAnswerEvent.bind(this)),e.removeListener("iceAnswer",this._handleIceAnswerEvent.bind(this)),e.removeListener("userJoin",this._handleUserJoinEvent.bind(this)),e.removeListener("userUpdate",this._handleUserUpdateEvent.bind(this)),e.removeListener("userLeave",this._handleUserLeaveEvent.bind(this)),e.removeListener("clientError",this._handleClentErrorEvent.bind(this)),e.removeListener("detectNetwork",this._handleDetectNetworkEvent.bind(this))}},{key:"_onSignalTimeout",value:function(){var e=this;if(!this.adapterRef.reconnectState.isStoped)if(this.adapterRef.reconnectState.startReconnect)this.adapterRef.logger.log("WebRTCGateWayBusiness: _onSignalTimeout 正在重连中 ...");else if(0==this.adapterRef.reconnectState.count&&this.adapterRef.logger.warn("WebRTCGateWayBusiness: _onSignalTimeout 网络断开了，现在开始重连"),this.adapterRef.reconnectState.isReconnect){if(this.adapterRef.reconnectState.count>6&&this.adapterRef.webrtcGateWayBusiness&&0==this.adapterRef.webrtcGateWayBusiness.webRTCGateWayManager.state.hasLogined)return this.adapterRef.reconnectState.isStoped=!0,this.adapterRef.logger.log("WebRTCGateWayBusiness: _onSignalTimeout 重连次数(%s)超限，不再重连",this.adapterRef.reconnectState.count),this.adapterRef.instance.commondDatareport("setDisconnect",{uid:this.adapterRef.instance.getUid()+"",cid:(this.adapterRef.imInfo&&this.adapterRef.imInfo.cid)+"",reason:"1",time:Date.now()}),void(this.adapterRef.imInfo&&"p2p"===this.adapterRef.imInfo.sessionMode?this.adapterRef.instance.hangup?(this.adapterRef.instance.emit("hangup",{channelId:this.adapterRef.imInfo&&this.adapterRef.imInfo.cid,account:this.adapterRef.instance.getAccount(),desc:"Network error",type:-1}),this.adapterRef.instance.hangup()):this.adapterRef.instance.leaveChannel&&(this.adapterRef.instance.emit("leaveChannel",{channelId:this.adapterRef.imInfo&&this.adapterRef.imInfo.cid,account:this.adapterRef.instance.getAccount(),desc:"Network error",type:-1}),this.adapterRef.instance.leaveChannel()):(this.adapterRef.instance.emit("leaveChannel",{channelId:this.adapterRef.imInfo&&this.adapterRef.imInfo.cid,account:this.adapterRef.instance.getAccount(),desc:"Network error",type:-1}),this.adapterRef.instance.leaveChannel()));this.adapterRef.instance._stopAllDataUpload(),this.adapterRef.reconnectState.count++,this.adapterRef.logger.log("WebRTCGateWayBusiness: _onSignalTimeout 第 %s 次重连中",this.adapterRef.reconnectState.count),this.adapterRef.reconnectState.startReconnect=!0,this.adapterRef.instance._resetParamNeededByReConnect(),this.adapterRef.instance._startSession(),this.adapterRef.reconnectState.connectTimer&&(clearTimeout(this.adapterRef.reconnectState.connectTimer),this.adapterRef.reconnectState.connectTimer=null),this.adapterRef.reconnectState.connectTimer=setTimeout(function(){e.adapterRef.logger.log("WebRTCGateWayBusiness: _onSignalTimeout webrtcGateWayBusiness: ",!!e.adapterRef.webrtcGateWayBusiness),e.adapterRef.reconnectState.startReconnect=!1;(e.adapterRef.webrtcBusiness&&e.adapterRef.webrtcBusiness.selfWebRtcInstance&&e.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection?"completed"!=e.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection.iceConnectionState&&"connected"!=e.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection.iceConnectionState:e.adapterRef.webrtcGateWayBusiness&&0==e.adapterRef.webrtcGateWayBusiness.webRTCGateWayManager.state.hasLogined)?(e.adapterRef.logger.log("WebRTCGateWayBusiness: _onSignalTimeout 第 %s 次重连不成功",e.adapterRef.reconnectState.count),e.adapterRef.reconnectState.isReconnect=!0,e._onSignalTimeout()):(e.adapterRef.reconnectState.isReconnect=!1,e.adapterRef.reconnectState.count=0)},2e3*this.adapterRef.reconnectState.count)}}},{key:"_handleErrorEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleErrorEvent 网关发生错误，event=%o",e)}},{key:"_handleCloseEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleCloseEvent 网关关闭，event=%o",e),this.adapterRef.instance.commondDatareport("setDisconnect",{uid:this.adapterRef.instance.getUid()+"",cid:(this.adapterRef.imInfo&&this.adapterRef.imInfo.cid)+"",reason:"9",time:Date.now()}),this.adapterRef&&this.adapterRef.webrtcGateWayBusiness&&(this.adapterRef.reconnectState.isReconnect=!0,this._onSignalTimeout())}},{key:"_handleLoginEvent",value:function(e){this.adapterRef.logger.log("登录回包结果对象: ",e);var t=e.success,r=e.serverCode;if(t)this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleLoginEvent 网关登录结果, event:",JSON.stringify(e,null," ")),this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleLoginEvent: startReconnect: ",this.adapterRef.reconnectState.startReconnect),1==this.adapterRef.reconnectState.startReconnect&&this.adapterRef.webrtcBusiness&&(this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleLoginEvent: 重连之后，重新推流"),this.adapterRef.reconnectState.startReconnect=!1,this.adapterRef.reconnectState.isReconnect=!1,this.adapterRef.reconnectState.count=0,this.adapterRef.reconnectState.connectTimer&&(clearTimeout(this.adapterRef.reconnectState.connectTimer),this.adapterRef.reconnectState.connectTimer=null),/Firefox/gi.test(navigator.userAgent)?this._handleReconnect(!0):this.adapterRef.webrtcBusiness._startRTCIfHasDeviceOpened());else{this.adapterRef.logger.warn("WebRTCGateWayBusiness: _handleLoginEvent: 登录失败，断开连接");var i=Object.assign({serverCode:r},u.GateWayErrorCode.GateWayLoginFail);this.emit(u.EVENT_OBJ.gatewayClosed.key,i)}}},{key:"_handleSdpAnswerEvent",value:function(e){var t=e.success,r=e.code,i=e.dst_id,a=e.type,n=e.sdp;if(this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleSdpAnswerEvent 收到SDP ANSWER uid %s",i),!t)return this.adapterRef.logger.error("WebRTCGateWayBusiness: _handleSdpAnswerEvent: SDP ANSWER 非200，断开"),void this.emit(u.EVENT_OBJ.gatewayClosed.key,Object.assign(u.GateWayErrorCode.GateWaySdpAnswerError,{serverCode:r}));this.adapterRef.webrtcBusiness.getRtcObject(i).setRemoteDescription({type:a,sdp:n},"answer")}},{key:"_handleIceAnswerEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleIceAnswerEvent 收到ICE ANSWER (网关） event=%o",JSON.stringify(e,null," "));var t=e.dst_id,r={candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex},i=this.adapterRef.webrtcBusiness.getRtcObject(t);i?i.addRemoteIceCandidate(r):this.adapterRef.logger.error("WebRTCGateWayBusiness: _handleIceAnswerEvent 不存在rtc对象")}},{key:"_handleUserJoinEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness:_handleUserJoinEvent 信令网关有人加入通知 event=%o",JSON.stringify(e,null," "));var t=e.client_id,r=e.vp8_only,i={uid:t,account:this.adapterRef.instance._getAccountByUid(t),channelId:this.adapterRef.imInfo.cid};"NRTC"===u.CONFIG_MAP.SDK_NAME[u.CONFIG_MAP.CURRENT.SDK_TYPE]&&"p2p"===this.adapterRef.imInfo.sessionMode&&this.adapterRef.instance.setStartSessionTime(),this.emit(u.EVENT_OBJ.userJoined.key,i),"p2p"===this.adapterRef.imInfo.sessionMode&&this.adapterRef.webrtcBusiness.selfUpdate(r)}},{key:"_handleUserUpdateEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness:_handleUserUpdateEvent 信令网关有人更新通知 event= ",JSON.stringify(e,null,""));var t=e.client_id,r=e.has_audio,i=e.has_video,a=e.vp8_only;this.emit(u.EVENT_OBJ.userStateUpdated.key,{uid:t,audio:r,video:i}),1==this.adapterRef.instance._getVideoHelperByUid(t).isJoined?r&&i?"safari"===l.RtcSystem.browser.ua?(this.adapterRef.instance.doClearAfterRemoteLeave(t),this.adapterRef.webrtcBusiness.doClientJoin(t,a)):this.adapterRef.webrtcBusiness.doClientUpdate(t,i):r||i?this.adapterRef.webrtcBusiness.doClientUpdate(t,i):this.adapterRef.instance.doClearAfterRemoteLeave(t):r||i?/Firefox/gi.test(navigator.userAgent)&&this.adapterRef.reconnectState?this._handleReconnect(!1,t):this.adapterRef.webrtcBusiness.doClientJoin(t,a):this.adapterRef.instance.doClearAfterRemoteLeave(t)}},{key:"_handleUserLeaveEvent",value:function(e){if(this.adapterRef&&this.adapterRef.imInfo){this.adapterRef.logger.log("WebRTCGateWayBusiness 离开事件: %s",JSON.stringify(e,null," "));var t=e.uid,r=e.logout_type,i={uid:e.uid,account:this.adapterRef.instance._getAccountByUid(e.uid),channelId:this.adapterRef.imInfo.cid};"normal"===r?Object.assign(i,u.EVENT_CODE.USER_LEFT_REASON.quit):Object.assign(i,u.EVENT_CODE.USER_LEFT_REASON.timeout),"p2p"===this.adapterRef.imInfo.sessionMode?this.emit(u.EVENT_OBJ.hangup.key,i):this.emit(u.EVENT_OBJ.userLeft.key,i),this.adapterRef.instance.doClearAfterRemoteLeave(t)}}},{key:"_handleClentErrorEvent",value:function(e){this.adapterRef.logger.log("WebRTCGateWayBusiness:_handleClientErrorEvent 网关反馈错误: ",e);var t=e.error_code;509!==t&&510!==t&&102!==t&&103!==t&&104!==t&&105!==t&&106!==t&&109!==t&&110!==t&&120!==t||(509!==t&&510!==t||this.adapterRef.instance.commondDatareport("setDisconnect",{uid:this.adapterRef.instance.getUid()+"",cid:(this.adapterRef.imInfo&&this.adapterRef.imInfo.cid)+"",reason:509===t?"3":"2",time:Date.now()}),this.emit(u.EVENT_OBJ.error.key,Object.assign(u.GateWayErrorCode.GateWayServerError,{serverCode:t})),this.adapterRef.imInfo&&"p2p"===this.adapterRef.imInfo.sessionMode?this.emit(u.EVENT_OBJ.hangup.key,u.EVENT_CODE.USER_LEFT_REASON.timeout):this.emit(u.EVENT_OBJ.leaveChannel.key,u.EVENT_CODE.USER_LEFT_REASON.timeout))}},{key:"_handleDetectNetworkEvent",value:function(e){if(e){this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleClientErrorEvent 网关反馈网络探测结果: ",JSON.stringify(e,null," "));var t=e.uid,r=e.content;this.detectNetworkResult||(this.detectNetworkResult={}),this.detectNetworkResult.user_ip=r.params.ip,t==r.params.dst_id?(this.detectNetworkResult.upload_network_status||(this.detectNetworkResult.upload_network_status={}),this.detectNetworkResult.upload_network_status.up_rtt=parseInt(r.params.rtt),this.detectNetworkResult.upload_network_status.up_loss=parseInt(r.params.loss)):(this.detectNetworkResult.download_network_status||(this.detectNetworkResult.download_network_status={}),this.detectNetworkResult.download_network_status.down_rtt=parseInt(r.params.rtt),this.detectNetworkResult.download_network_status.down_loss=parseInt(r.params.loss))}}},{key:"_handleReconnect",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleReconnect isPush: ",e),this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleReconnect clientId: ",r);try{if(e)this.adapterRef.webrtcBusiness._startRTCIfHasDeviceOpened();else{if(!r)return void this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleReconnect: invalid argument");this.adapterRef.webrtcBusiness.doClientJoin(r)}}catch(i){e?this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleReconnect 重连之后，重新推流 err: ",i):this.adapterRef.logger.log("WebRTCGateWayBusiness: _handleReconnect 重连之后，重新拉流 err: ",i),setTimeout(function(){t._handleReconnect(e,r)},1e3)}}},{key:"_transform2WebRTCGateWayContext",value:function(e){var t=Object.assign({},e);return new s.WebRTCGateWayContext({uid:t.uid,cid:t.cid,hasAudio:!1,hasVideo:!1,netDetect:t.netDetect,session_mode:t.sessionMode,params:{content:"",dst_id:t.uid,user_token_type:0,token:t.token,user_type:this.adapterRef.instance.SDK_TYPE===u.CONFIG_MAP.SDK_TYPE.NRTC?3:2,version:1,is_multi_peerconnection:!0,sdk_version:f.info.version,streamSetting:{video:t.videoConfig}},browser:{name:c.default.name,version:c.default.version},bypass_rtmp:{is_host:!!t.sessionConfig.rtmpUrl,support_bypass_rtmp:t.sessionConfig.liveEnable||!1,support_bypass_rtmp_record:t.sessionConfig.rtmpRecord||!1,bypass_rtmp_url:t.sessionConfig.rtmpUrl||"",layout:t.sessionConfig.layout||"",participant_mode:"M-"+t.sessionConfig.splitMode},record:{support_audio_record:t.sessionConfig.recordAudio||!1,support_video_record:t.sessionConfig.recordVideo||!1,single_record_in_meeting:t.sessionConfig.singleRecord||!1,is_host_speaker:t.sessionConfig.isHostSpeaker||!1,record_type:t.sessionConfig.recordType||"0"}})}}]),t}(d.AbstractBusiness);t.WebRTCGateWayBusiness=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(453);Object.defineProperty(t,"WebRTCGateWayBusiness",{enumerable:!0,get:function(){return i.WebRTCGateWayBusiness}});var a=r(452);Object.defineProperty(t,"WebRTC2GateWayBusiness",{enumerable:!0,get:function(){return a.WebRTC2GateWayBusiness}});var n=r(451);Object.defineProperty(t,"DeviceBusiness",{enumerable:!0,get:function(){return n.DeviceBusiness}});var o=r(450);Object.defineProperty(t,"WebRTCBusiness",{enumerable:!0,get:function(){return o.WebRTCBusiness}});var s=r(435);Object.defineProperty(t,"WebRTC2Business",{enumerable:!0,get:function(){return s.WebRTC2Business}});var d=r(434);Object.defineProperty(t,"IMBusiness",{enumerable:!0,get:function(){return d.IMBusiness}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(84)),s=u(r(3)),d=u(r(263)),c=r(27);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.function=[],r._timmer=setInterval(r.send.bind(r),6e4),r}return(0,s.default)(t,e),(0,a.default)(t,[{key:"triggerFunction",value:function(e){c.tool.verifyOptions(e,"name oper");var t=e.name,r=e.oper,i=e.value;this.addEvent("function"),this.function.push({name:t,oper:r,value:i,time:Date.now()})}},{key:"destroy",value:function(){clearInterval(this._timmer)}},{key:"reset",value:function(){(0,o.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this.function=[]}}]),t}(d.default);t.default=l,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(11),c=(r(28),r(143));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._reset(),r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.appKey=r.adapterRef.instance._params.appkey||r.adapterRef.nim&&r.adapterRef.nim.options&&r.adapterRef.nim.options.appKey||r.adapterRef.imInfo.appkey,r.formatDataFromStats=new c.FormatDataFromStats({appkey:r.appKey,adapterRef:r.adapterRef}),r.rawDataFromStats=new c.RawDataFromStats({appkey:r.appKey}),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.formatDataFromStats=null,this.rawDataFromStats=null}},{key:"stopStats",value:function(){this.formatDataFromStats&&this.formatDataFromStats.stop(),this.rawDataFromStats&&this.rawDataFromStats.stop()}},{key:"startStats",value:function(){this._uploadRawDataStatsStart(),this._uploadFormatDataStatsStart()}},{key:"_uploadRawDataStatsStart",value:function(){d.CONFIG_MAP.STATS_RTC[d.CONFIG_MAP.CURRENT.SDK_TYPE]&&this.rawDataFromStats&&this.rawDataFromStats.start({info:this.adapterRef.imInfo,cid:this.adapterRef.imInfo.cid,uid:this.adapterRef.imInfo.uid})}},{key:"_uploadRawDataStats",value:function(e){d.CONFIG_MAP.STATS_RTC[d.CONFIG_MAP.CURRENT.SDK_TYPE]&&this.rawDataFromStats&&this.rawDataFromStats.update(e)}},{key:"_uploadFormatDataStatsStart",value:function(){this.appKey?d.CONFIG_MAP.STATS_FUN[d.CONFIG_MAP.CURRENT.SDK_TYPE]&&this.formatDataFromStats&&this.formatDataFromStats.start({controller:this,imInfo:this.adapterRef.imInfo,sessionConfig:this.adapterRef.imInfo.sessionConfig,videoConfig:this.adapterRef.imInfo.videoConfig}):this.adapterRef.logger.warn("DataReportHelper: _uploadFormatDataStatsStart: 不存在appkey， 本次format debug数据未能上报")}},{key:"_uploadFormatDataStats",value:function(e,t,r){if(d.CONFIG_MAP.STATS_RTC[d.CONFIG_MAP.CURRENT.SDK_TYPE])if(this.appKey){if(this.formatDataFromStats)if("volume"!==e){if(this.adapterRef&&this.adapterRef.imInfo){var i=this.adapterRef.instance._getAudioHelperByUid(this.adapterRef.imInfo.uid),a=!1,n=!1;i&&i.webAudio&&(this.formatDataFromStats.updateLocalVolume(i.webAudio.getVolumeData()),a=i.pushAudioStream&&i.pushAudioStream.active);var o=this.adapterRef.instance._getVideoHelperByUid(this.adapterRef.imInfo.uid);o&&(n=o.pushVideoStream&&o.pushVideoStream.active),this.formatDataFromStats.updateRemoteMap(this.adapterRef.audioHelperMap),this.formatDataFromStats.updateLocalStreamEnable(a,n)}this.formatDataFromStats.update(t,r)}else this.formatDataFromStats.updateLocalVolume(t)}else this.adapterRef.logger.warn("DataReportHelper: _uploadFormatDataStats: 不存在appkey， 本次format debug数据未能上报")}},{key:"uploadFormatDataStatsOnce",value:function(e){d.CONFIG_MAP.STATS_RTC[d.CONFIG_MAP.CURRENT.SDK_TYPE]&&this.formatDataFromStats&&this.formatDataFromStats.updateOnce({imInfo:e,sessionConfig:this.adapterRef.imInfo.sessionConfig})}}]),t}(s.EventEmitter);t.default=l,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(143),c=r(11);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.info={},r.logData=new d.LogData(e),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"uploadData",value:function(e,t){c.CONFIG_MAP.STATS_FUN[c.CONFIG_MAP.CURRENT.SDK_TYPE]&&("sessionInfo"==e&&t&&this.info?(2==c.CONFIG_MAP.CURRENT.SDK_TYPE?this.info.sessionInfo={role:t.role,uid:t.uid,cid:t.cid,sessionMode:t.sessionMode,appkey:"",token:t.serverMap&&t.serverMap.token,turnToken:"",wssArr:t.serverMap&&t.serverMap.webrtcarray,relayaddrs:null,relaytoken:null,liveEnable:t.sessionConfig&&t.sessionConfig.liveEnable,rtmpRecord:t.sessionConfig&&t.sessionConfig.rtmpRecord,sessionConfig:{maxVideoQuality:t.sessionConfig.maxVideoQuality,videoQuality:t.sessionConfig.videoQuality,videoFrameRate:t.sessionConfig.videoFrameRate,highAudio:t.sessionConfig.highAudio,liveEnable:t.sessionConfig.liveEnable,recordVideo:t.sessionConfig.recordVideo,recordAudio:t.sessionConfig.recordAudio,singleRecord:t.sessionConfig.singleRecord,rtmpUrl:t.sessionConfig.rtmpUrl,layout:t.sessionConfig.layout,splitMode:t.sessionConfig.splitMode,isHostSpeaker:t.sessionConfig.isHostSpeaker,recordType:t.sessionConfig.recordType,roomServerUrl:t.sessionConfig.roomServerUrl,rtmpRecord:t.sessionConfig.rtmpRecord},videoConfig:t.videoConfig}:this.info.sessionInfo=t,this.info.account=t.accountUidMap?Object.keys(t.accountUidMap)[0]:"",this.info.uid=t.uid||t.accountUidMap&&t.accountUidMap[this.info.account],this.info.cid=t.cid||t.channelId):"deviceList"==e&&this.info?(this.info.deviceList||(this.info.deviceList={}),this.info.deviceList[Object.keys(t)[0]]=Object.values(t)[0]):"mediaConstraint"==e&&this.info?(this.info.mediaConstraint||(this.info.mediaConstraint={},this.info.mediaConstraint.audio=[],this.info.mediaConstraint.video=[]),t.audio&&this.info.mediaConstraint.audio.push(t.audio),t.video&&this.info.mediaConstraint.video.push(t.video)):"mediaPlay"==e&&this.info?(this.info.mediaPlay||(this.info.mediaPlay={},this.info.mediaPlay.audio=[],this.info.mediaPlay.video=[]),t.audio&&this.info.mediaPlay.audio.push(t.audio),t.video&&this.info.mediaPlay.video.push(t.video)):"peerConnections"==e&&this.info?(this.info.peerConnections||(this.info.peerConnections=[]),t.localSdp="",t.remoteSdp="",this.info.peerConnections.push(t)):"send"==e&&this.info&&(this.logData.send(this.info),this.info=null))}},{key:"trimSdp",value:function(e){if(e){var t="",r=e.match(/a=rtpmap:(\d+) opus/g)[0].match(/a=rtpmap:(\d+)/)[1],i=e.match(/a=rtpmap:(\d+) H264/g)[0].match(/a=rtpmap:(\d+)/)[1],a=e.match(/a=msid-semantic:([0-9- \/A-Za-z:]*)/g),n=e.match(/a=candidate:([0-9- \/A-Za-z:]*)/g),o=e.match(/a=extmap:([0-9- \.\/A-Za-z:]*)/g),s=e.match(/a=rtpmap:([0-9- \.\/A-Za-z:]*)/g),d=e.match(/a=rtcp-fb:([0-9- \.\/A-Za-z:]*)/g),c=e.match(/a=fmtp:([0-9- =;\.\/A-Za-z:]*)/g),u=e.match(/a=ssrc:(\d)+/g);return t+=this.handleList(a)+this.handleList(n)+this.handleList(o)+this.handleList(s,r,i)+this.handleList(d,r,i)+this.handleList(c,r,i)+this.handleList(u)}}},{key:"handleList",value:function(e,t,r){if(!e||0==e.length)return"";if(e&&e.length&&!t)return e.join("\n");for(var i=0;i<e.length;i++)-1==e[i].indexOf(t)&&-1==e[i].indexOf(r)&&(e.splice(i,1),i--);return e.length?e.join("\n"):""}}]),t}(s.EventEmitter);t.default=l,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(143),c=r(11);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.adapterRef.instance._params.appkey?r.appkey=r.adapterRef.instance._params.appkey:r.appkey=r.adapterRef.nim&&r.adapterRef.nim.options&&r.adapterRef.nim.options.appKey||r.adapterRef.imInfo.appkey,r.dataApi=new d.ApiInvokeData({appkey:r.appkey,platform:e.platform}),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"uploadDataApi",value:function(e,t){c.CONFIG_MAP.STATS_FUN[c.CONFIG_MAP.CURRENT.SDK_TYPE]&&this.appkey&&("start"===e&&(t.appkey=this.appkey),this.dataApi[e]&&this.dataApi[e](t))}}]),t}(s.EventEmitter);t.default=l,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(458);Object.defineProperty(t,"ApiReportHelper",{enumerable:!0,get:function(){return d(i).default}});var a=r(457);Object.defineProperty(t,"LogReportHelper",{enumerable:!0,get:function(){return d(a).default}});var n=r(456);Object.defineProperty(t,"StatsReportHelper",{enumerable:!0,get:function(){return d(n).default}});var o=r(263);Object.defineProperty(t,"CommonDataReport",{enumerable:!0,get:function(){return d(o).default}});var s=r(455);function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"IntervalCommonDataReport",{enumerable:!0,get:function(){return d(s).default}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(r(1)),a=s(r(2)),n=s(r(4)),o=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.uid=e.uid||0,r.adapterRef=e.adapterRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.index=0,this.uid=null,this.adapterRef=null}},{key:"takeSnapshot",value:function(e){var t=this,r=e.account,i=e.uid,a=e.name,n=void 0===a?"":a,o=e.videoDom;return n||(n=(r||i)+"-"+this.index++),new Promise(function(e,r){var i=document.createElement("canvas"),a=i.getContext("2d");a.fillStyle="#ffffff",a.fillRect(0,0,o.videoWidth,o.videoHeight),i.width=o.videoWidth,i.height=o.videoHeight,a.drawImage(o,0,0,o.videoWidth,o.videoHeight,0,0,o.videoWidth,o.videoHeight),i.toBlob(function(r){t.adapterRef.logger.log("takeSnapshot, 获取到截图的blob: ",r);var i=URL.createObjectURL(r);t.adapterRef.logger.log("截图的url: ",i);var a=document.createElement("a");return document.body.appendChild(a),a.style="display: none",a.href=i,a.download=n+".png",a.click(),window.URL.revokeObjectURL(i),e()})})}},{key:"destory",value:function(){this._reset()}}]),t}(r(12).EventEmitter);t.default=d,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(r(1)),a=s(r(2)),n=s(r(4)),o=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.uid=e.uid||0,r.adapterRef=e.adapterRef,r._initNode(),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.videoContainerDom=null,this.videoDom=null,this.uid=null,this.containerSize={width:0,height:0}}},{key:"_initNode",value:function(){var e=this._initVideoContainer();this.videoContainerDom=e;var t=this._initVideo();this.videoDom=t,e.appendChild(t)}},{key:"_initVideoContainer",value:function(){var e=document.createElement("div");return e.style.overflow="hidden",e.style.position="relative",e.style.width=this.containerSize.width+"px",e.style.height=this.containerSize.height+"px",e.style.display="inline-block",e}},{key:"_initVideo",value:function(){var e=document.createElement("video");return e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.transform="translate(-50%,-50%)",e.setAttribute("x-webkit-airplay","x-webkit-airplay"),e.setAttribute("playsinline","playsinline"),e.setAttribute("webkit-playsinline","webkit-playsinline"),e.preload="auto",e.dataset.uid=this.uid,e.autoplay="autoplay",e.muted=!0,e}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:100,height:100,cut:!0};if(this.adapterRef.logger.log("resize: uid %s, options: %s",this.uid,JSON.stringify(e,null," ")),e.cut&&this.adapterRef.apiReportHelper&&(this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_crop"}),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"set_video_cut",ext:e.width+"/"+e.height})),this.containerSize=e,this.videoContainerDom.style.width=e.width+"px",this.videoContainerDom.style.height=e.height+"px",!e.cut)return this.videoDom.style.height="100%",void(this.videoDom.style.width="100%");this.videoDom.videoWidth/this.videoDom.videoHeight>e.width/e.height?(this.videoDom.style.width="auto",this.videoDom.style.height="100%"):(this.videoDom.style.width="100%",this.videoDom.style.height="auto")}},{key:"destory",value:function(){this.videoContainerDom&&this.videoDom&&this.videoContainerDom.removeChild(this.videoDom),this._reset()}}]),t}(r(12).EventEmitter);t.default=d,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoHelper=void 0;var i=g(r(1)),a=g(r(2)),n=g(r(4)),o=g(r(3)),s=r(12),d=r(27),c=m(r(111)),u=m(r(264)),l=g(r(461)),p=g(r(460)),f=r(11),h=r(28);function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function g(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.uid=e.uid,r.poster=e.poster||"",r.videoContainer=e.videoContainer||document.body,r.videoDomHelper=null,r.canvasHelper=null,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"setUid",value:function(e){this.uid=e}},{key:"_reset",value:function(){this.sdkRef=null,this.adapterRef=null,this._resetStateParam(),this._resetMixParam(),this.mcuConfig={videoSecWinType:f.DEVICE_TYPE.DEVICE_TYPE_VIDEO,coordinatesX:0,coordinatesY:0}}},{key:"_resetStateParam",value:function(){this.isPlaying=!1,this.system=d.RtcSupport.checkVersion(),this.uid=null,this.poster="",this.rtc=null,this.constraint={},this.videoContainer=null,this.videoDomHelper&&this.videoDomHelper.destory(),this.videoDomHelper=null,this.canvasHelper&&this.canvasHelper.destory(),this.canvasHelper=null,this.webAudio=null,this.localVideoStream=null,this.remoteVideoStream=null,this.pushVideoStream=null,this.videoViewConfig={}}},{key:"_resetMixParam",value:function(){this.mcuDom&&(clearInterval(this.mcuDom.canvasTimer),this.mcuDom.smallDom&&(this.mcuDom.smallDom.onresize=function(){},this.mcuDom.smallDom.src=""),this.mcuDom.largeDom&&(this.mcuDom.largeDom.onresize=function(){},this.mcuDom.largeDom.src="")),this.mcuDom={largeDom:null,smallDom:null,canvas:null,canvasTimer:null}}},{key:"startPushLocalVideoStream",value:function(){var e=this;return Promise.resolve().then(function(){return e.localVideoStream?(e.pushVideoStream=e.localVideoStream,e.adapterRef.instance._judgeSendSdpOfferOrUpdate()):Promise.reject(f.VideoErrorCode.VideoStreamFetchError)})}},{key:"stopPushLocalVideoStream",value:function(){var e=this;return Promise.resolve().then(function(){return e.pushVideoStream=null,e.adapterRef.instance._updateRtc(!0)})}},{key:"setIsRemote",value:function(e){return this.isRemote=e,this}},{key:"setRemoteVideoStream",value:function(e){this.remoteVideoStream=e,this.adapterRef.logger.warn("更新远端stream: %s, 并且清除之前的video dom, uid: %s",e.id,this.uid),this.hide()}},{key:"setRTC",value:function(e){this.rtc=e}},{key:"setVideoContainer",value:function(e){e?(this.videoDomHelper||this._createVideoDomHelper(),this.videoContainer=e,this._mountVideoToDom(),this.play()):this.adapterRef.logger.log("VideoHelper: setVideoContainer: 不存在dom")}},{key:"setVideoViewConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this.videoViewConfig,e),this.videoDomHelper&&this.videoDomHelper.resize({width:this.videoViewConfig.width||0,height:this.videoViewConfig.height||0,cut:this.videoViewConfig.cut||!1})}},{key:"updateStream",value:function(e){var t=null;this.isRemote?(t=this.remoteVideoStream,this.remoteVideoStream=e):(t=this.localVideoStream,this.localVideoStream=e),u.removeTrackFromMediaStream(t,this.adapterRef.logger)}},{key:"composeTrack",value:function(e,t){if(e&&e!==this.adapterRef.imInfo.uid)if(this.remoteVideoStream&&this.remoteVideoStream.getVideoTracks&&this.remoteVideoStream.getVideoTracks()>0&&this.remoteVideoStream.getVideoTracks()[0].id==t.id)this.adapterRef.logger.log("VideoHelper:_composeTrack 相同的track直接忽略");else if(this.adapterRef.imInfo.netDetect)this.adapterRef.logger.log("VideoHelper:_composeTrack 网络探测直接忽略");else{if(this.rtc&&this.rtc.sdpAnswer&&this.adapterRef.instance._isChrome()&&!this.rtc.checkMeidaExistent({sdp:this.rtc.sdpAnswer.sdp,type:"video"}))return this.adapterRef.logger.log("VideoHelper:_composeTrack 对端不发送视频流直接忽略, 清除可能残留的视频"),void this.hide();this.adapterRef.logger.log("VideoHelper:_composeTrack uid %s",e);var r=new MediaStream;r.addTrack(t),this.setRemoteVideoStream(r),this.adapterRef.instance.emit("remoteTrack",{uid:e,account:this.adapterRef.instance._getAccountByUid(e),track:t})}else this.adapterRef.logger.log("VideoHelper:_composeTrack 自己的轨道直接忽略")}},{key:"delayVideoShow",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.adapterRef.logger.log("VideoHelper:delayVideoShow uid=%o, has_video=%o",e,r),setTimeout(function(){t._doDelayVideoShow(e,r)},100)}},{key:"_doDelayVideoShow",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&e!==this.adapterRef.imInfo.uid)if(this.remoteVideoStream){if(this.adapterRef.logger.log("VideoHelper:_doDelayVideoShow uid=%s, has_video=%s",e,t),!this.adapterRef.instance._isFirefox()){var r={};t&&(r=this.checkRemoteTrack(e,this.rtc.sdpAnswer.sdp)),t=r.video}!0===t?(this.adapterRef.logger.log("VideoHelper:_doDelayVideoShow: show..."),this.show()):(this.adapterRef.logger.log("VideoHelper:_doDelayVideoShow: hide..."),this.hide())}else this.adapterRef.logger.log("VideoHelper:_doDelayVideoShow 不存在的远程视频流， 不显示");else this.adapterRef.logger.log("VideoHelper:_doDelayVideoShow 自己直接返回,不显示")}},{key:"checkRemoteTrack",value:function(e,t,r){if(!this.remoteVideoStream)return this.adapterRef.logger.log("VideoHelper:checkRemoteTrack: 不存在远端的对象..."),{};if(!this.remoteVideoStream||!this.rtc)return this.adapterRef.logger.log("VideoHelper:checkRemoteTrack: 远程视频流均不存在，或者流程管理器不存在"),{};var i=this.remoteVideoStream.getVideoTracks()[0];if(i&&"ended"==i.readyState&&r&&r.getReceivers&&r.getReceivers().length>1){i=r.getReceivers()[1].track;var a=new MediaStream;a.addTrack(i),this.setRemoteVideoStream(a),this.adapterRef.logger.log("VideoHelper:checkRemoteTrack new videoTrack ----\x3e %o",i)}else this.adapterRef.logger.log("VideoHelper:checkRemoteTrack videoTrack ----\x3e %o",i);var n=this.rtc.checkMediaStatus({videoTrack:i,sdp:t,uid:e});return(h.RtcSystem.browser.greaterThanOrEqualToSafari_12_1_1()||this.adapterRef.instance._isChrome72())&&(n.video=!0),n.video=this.rtc.checkMeidaExistent({sdp:t,type:"video"}),this.adapterRef.logger.log("result: ",n.video),n.video||(this.adapterRef.logger.warn("远程视频不存在了，则隐藏节点"),this.hide()),n}},{key:"handleStreamFromMp4File",value:function(e){if(e&&e.getVideoTracks().length){var t=new MediaStream,r=e.getVideoTracks()[0];this.adapterRef.logger.log("VideoHelper: handleStreamFromMp4File: 处理制造的stream track: ",r),t.addTrack(e.getVideoTracks()[0]),this.pushVideoStream=this.localVideoStream=t,this.adapterRef.logger.log("VideoHelper: handleStreamFromMp4File: new localVideoStream ",this.localVideoStream)}else this.adapterRef.logger.warn("VideoHelper: handleStreamFromMp4File: Invalid Parameter")}},{key:"getCameraStream",value:function(e,t){var r=this;return this.clearMCUState(),new Promise(function(i,a){r._getCameraStream(e,t,i,a)})}},{key:"getScreenStreamCustom",value:function(e,t,r){return this.clearMCUState(),this._getScreenStreamCustom(e,t,r)}},{key:"getScreenStreamPlugin",value:function(e,t,r){return this.clearMCUState(),this._getScreenStreamPlugin(e,t,r)}},{key:"getScreenStreamNative",value:function(e,t,r){return this.clearMCUState(),this._getScreenStreamNative(e,t,r)}},{key:"enableDevice",value:function(e){this.adapterRef.logger.log("VideoHelper: enableDevice: 恢复设备");var t=[];if(this.localCameraStream&&(t=this.localCameraStream.getTracks()),t.map(function(e){e.enabled=!0}),e)return e()}},{key:"removeTrackFromMediaStream",value:function(e){u.removeTrackFromMediaStream(e,this.adapterRef.logger)}},{key:"destroy",value:function(e){this.adapterRef.logger.log("VideoHelper:destroy 移除本地流"),this.hide(),e&&u.removeTrackFromMediaStream(e,this.adapterRef.logger),e||(this.localScreenStream&&(this.adapterRef.logger.log("VideoHelper:destroy 移除本地screen流:",this.localScreenStream.id),u.removeTrackFromMediaStream(this.localScreenStream,this.adapterRef.logger),this.localScreenStream=null),this.localCameraStream&&(this.adapterRef.logger.log("VideoHelper:destroy 移除本地camera流:",this.localCameraStream.id),u.removeTrackFromMediaStream(this.localCameraStream,this.adapterRef.logger),this.localCameraStream=null),this._resetStateParam())}},{key:"_getCameraStream",value:function(e,t,r,i){var a=this,n={};n.deviceId=e&&e.deviceId;var o=this.adapterRef.imInfo.clientConfig&&JSON.parse(this.adapterRef.imInfo.clientConfig)||{},s=this.sdkRef.getVideoSessionConfig({maxQuality:o.quality_level_limit||this.adapterRef.imInfo.sessionConfig.maxVideoQuality,quality:this.adapterRef.imInfo.sessionConfig.videoQuality,frameRate:this.adapterRef.imInfo.sessionConfig.videoFrameRate});return n=Object.assign(n,s),this.constraint.video=n,this.adapterRef.imInfo.netDetect&&(this.constraint={audio:!1,video:{width:1280,height:720,frameRate:30,deviceId:{exact:e.deviceId}}}),u.getMediaStream(this.constraint,this.adapterRef.logger,t).then(function(e){return a.adapterRef.logger.log("VideoHelper:_getCameraStream: 获取到视频流 %s",e.id),a.adapterRef.state.videoDeviceHasOpened?(a.localCameraStream&&a.destroy(a.localCameraStream),a.localScreenStream&&!a.adapterRef.mixVideoConf&&(a.destroy(a.localScreenStream),a.localScreenStream=null),a.localCameraStream=e,a.adapterRef.mixVideoConf&&a.adapterRef.mixVideoConf.videoCompressSize&&a.localScreenStream?a.startMCU():(a.localVideoStream=e,Promise.resolve())):(a.adapterRef.logger.warn("用户已经关闭了摄像头，这里不返回"),a.destroy(e),Promise.resolve())}).then(function(){if(a.adapterRef.logReportHelper){var t={};Object.assign(t,a.constraint),t.streamId=a.localVideoStream.id,a.adapterRef.logReportHelper.uploadData("mediaConstraint",{video:t}),a.adapterRef.deviceBusiness&&a.adapterRef.deviceBusiness.mediaDeviceHelper.devicesCache&&a.adapterRef.deviceBusiness.mediaDeviceHelper.devicesCache.video?a.adapterRef.logReportHelper.uploadData("deviceList",{video:a.adapterRef.deviceBusiness.mediaDeviceHelper.devicesCache.video}):a.adapterRef.deviceApi.getDevicesOfType().then(function(e){a.adapterRef.logReportHelper.uploadData("deviceList",{video:e.video})})}r({device:e,stream:a.localVideoStream})}).catch(function(e){a.adapterRef.logger.log("VideoHelper:_getCameraStream: 获取视频流失败: ",e),a.localCameraStream?a.adapterRef.state.videoDeviceHasOpened=!0:a.adapterRef.state.videoDeviceHasOpened=!1,a.localScreenStream?a.adapterRef.state.chromeScreenShareOpened=!0:a.adapterRef.state.chromeScreenShareOpened=!1,e||(e=f.VideoErrorCode.VideoStreamFetchError),i(e)})}},{key:"_getScreenStreamCustom",value:function(e,t,r){var i=this;return e?new Promise(function(){i.adapterRef.logger.log("VideoHelper: _getScreenStreamCustom: chrome 屏幕共享: ",e);var r={video:{mandatory:{maxWidth:1280,maxHeight:720,maxFrameRate:5,minFrameRate:1,chromeMediaSource:"desktop",chromeMediaSourceId:e}}};return u.getMediaStream(r,i.adapterRef.logger).then(function(e){return i.adapterRef.logger.log("VideoHelper:_getScreenStreamCustom: 获取到演示流:",e.id),i.localScreenStream&&i.destroy(i.localScreenStream),i.localCameraStream&&!i.adapterRef.mixVideoConf&&(i.destroy(i.localCameraStream),i.localCameraStream=null),i.localScreenStream=e,i.adapterRef.mixVideoConf&&i.adapterRef.mixVideoConf.videoCompressSize&&i.localCameraStream?i.startMCU():(i.localVideoStream=e,Promise.resolve())}).then(function(){t({stream:i.localVideoStream})}).catch(function(e){i.adapterRef.logger.error("VideoHelper:_getScreenStreamPlugin: 获取到演示流失败，请检查chromeSourceId:",e),i.localVideoStream?i.adapterRef.state.chromeScreenShareOpened=!0:i.adapterRef.state.chromeScreenShareOpened=!1;var t=Object.assign({event:e},f.VideoErrorCode.VideoStreamFetchError);return Promise.reject(t)})}):(this.adapterRef.logger.warn("VideoHelper: _getScreenStreamCustom: chromeSourceId未设置"),t("chrome屏幕共享chromeSourceId未设置"))}},{key:"_getScreenStreamPlugin",value:function(e,t,r){var i=this,a=this.adapterRef.chromeId;if(!a)return this.adapterRef.logger.warn("VideoHelper: _getScreenStreamPlugin: chrome屏幕共享id未设置"),t("chrome屏幕共享id未设置");var n={sources:["window","screen","tab"]};return new Promise(function(){chrome.runtime.sendMessage(a,n,{},function(e){if(i.adapterRef.logger.log("VideoHelper: _getScreenStreamPlugin: chrome 屏幕共享",e),e&&"success"===e.type){var a={video:{mandatory:{maxWidth:1280,maxHeight:720,maxFrameRate:5,minFrameRate:1,chromeMediaSource:"desktop",chromeMediaSourceId:e.streamId}}};return i.adapterRef.logger.log("VideoHelper:_getScreenStreamPlugin"),u.getMediaStream(a,i.adapterRef.logger).then(function(e){return i.adapterRef.logger.log("VideoHelper:_getScreenStreamPlugin: 获取到演示流:",e.id),i.localScreenStream&&i.destroy(i.localScreenStream),i.localCameraStream&&!i.adapterRef.mixVideoConf&&(i.destroy(i.localCameraStream),i.localCameraStream=null),i.localScreenStream=e,i.adapterRef.mixVideoConf&&i.adapterRef.mixVideoConf.videoCompressSize&&i.localCameraStream?i.startMCU():(i.localVideoStream=e,Promise.resolve())}).then(function(){t({stream:i.localVideoStream})}).catch(function(e){i.localVideoStream?i.adapterRef.state.chromeScreenShareOpened=!0:i.adapterRef.state.chromeScreenShareOpened=!1;var t=Object.assign({event:e},f.VideoErrorCode.VideoStreamFetchError);return Promise.reject(t)})}e?(i.adapterRef.logger.error("VideoHelper:_getScreenStreamPlugin: 获取流失败"),i.localCameraStream?i.adapterRef.state.videoDeviceHasOpened=!0:i.adapterRef.state.videoDeviceHasOpened=!1,i.localScreenStream?i.adapterRef.state.chromeScreenShareOpened=!0:i.adapterRef.state.chromeScreenShareOpened=!1,r(f.VideoErrorCode.VideoStreamFetchError)):(i.adapterRef.logger.error("VideoHelper:_getScreenStreamPlugin: 未安装插件"),i.localCameraStream?i.adapterRef.state.videoDeviceHasOpened=!0:i.adapterRef.state.videoDeviceHasOpened=!1,i.localScreenStream?i.adapterRef.state.chromeScreenShareOpened=!0:i.adapterRef.state.chromeScreenShareOpened=!1,r(f.DeviceErrorCode.DevicePluginNotInstalled))})})}},{key:"_getScreenStreamNative",value:function(e,t,r){var i=this;return u.getScreenStream({video:!0},this.adapterRef.logger).then(function(e){return i.adapterRef.logger.log("VideoHelper:_getScreenStreamNative: 获取到演示流:",e.id),i.localScreenStream&&i.destroy(i.localScreenStream),i.localCameraStream&&!i.adapterRef.mixVideoConf&&(i.destroy(i.localCameraStream),i.localCameraStream=null),i.localScreenStream=e,i.adapterRef.mixVideoConf&&i.adapterRef.mixVideoConf.videoCompressSize&&i.localCameraStream?i.startMCU():(i.localVideoStream=e,Promise.resolve())}).then(function(){t({stream:i.localVideoStream})}).catch(function(e){i.localCameraStream?i.adapterRef.state.videoDeviceHasOpened=!0:i.adapterRef.state.videoDeviceHasOpened=!1,i.localScreenStream?i.adapterRef.state.chromeScreenShareOpened=!0:i.adapterRef.state.chromeScreenShareOpened=!1,e||(e=f.VideoErrorCode.VideoStreamFetchError),r(e)})}},{key:"setMixCoordinates",value:function(){if(this.adapterRef.logger.warn("VideoHelper:setMixCoordinates: mcuDom.smallDom.videoWidth: ",this.mcuDom.smallDom.videoWidth),this.mcuConfig.coordinatesX=0,this.mcuConfig.coordinatesY=0,this.adapterRef&&this.adapterRef.mixVideoConf&&this.adapterRef.mixVideoConf.videoLayout)switch(this.adapterRef.mixVideoConf.videoLayout){case f.MIX_VIDEO_MODE.LAYOUT_TOP_LEFT:break;case f.MIX_VIDEO_MODE.LAYOUT_BOTTOM_LEFT:this.mcuConfig.coordinatesY=this.mcuDom.canvas.height-this.mcuDom.smallDom.videoHeight,this.adapterRef.logger.log("VideoHelper:setMixCoordinates: 左下角 coordinatesY: ",this.coordinatesY);break;case f.MIX_VIDEO_MODE.LAYOUT_BOTTOM_RIGHT:this.mcuConfig.coordinatesX=this.mcuDom.canvas.width-this.mcuDom.smallDom.videoWidth,this.mcuConfig.coordinatesY=this.mcuDom.canvas.height-this.mcuDom.smallDom.videoHeight,this.adapterRef.logger.log("VideoHelper:setMixCoordinates: 右下角 coordinatesX: ",this.mcuConfig.coordinatesX),this.adapterRef.logger.log("VideoHelper:setMixCoordinates: 右下角 coordinatesY: ",this.mcuConfig.coordinatesY);break;case f.MIX_VIDEO_MODE.LAYOUT_TOP_RIGHT:default:this.mcuConfig.coordinatesX=this.mcuDom.canvas.width-this.mcuDom.smallDom.videoWidth,this.adapterRef.logger.log("右上角 coordinatesY: ",this.mcuConfig.coordinatesY)}else this.mcuConfig.coordinatesX=this.mcuDom.canvas.width-this.mcuDom.smallDom.videoWidth;this.adapterRef.logger.log("VideoHelper:setMixCoordinates: coordinatesX: ",this.mcuConfig.coordinatesX),this.adapterRef.logger.log("VideoHelper:setMixCoordinates: coordinatesY: ",this.mcuConfig.coordinatesY)}},{key:"setMixConf",value:function(){var e=this;if(!(this.mcuDom.canvasTimer&&this.mcuDom.smallDom&&this.mcuDom.largeDom&&this.localCameraStream&&this.localScreenStream))return this.adapterRef.logger.log("VideoHelper:setMixConf: 当前没有在进行视频和演示的混流，先记录配置信息，后续使用"),Promise.resolve();if(this.mcuConfig.videoSecWinType&&this.mcuConfig.videoSecWinType!==this.adapterRef.mixVideoConf.videoSecWinType)return this._setupMCUStream().then(function(t){var r=t.largeStream,i=t.smallStream;e.mcuConfig.videoSecWinType=e.adapterRef.mixVideoConf.videoSecWinType;var a=null,n=null,o=e.sdkRef.getVideoSessionConfig({quality:e.adapterRef.imInfo.sessionConfig.videoQuality,frameRate:e.adapterRef.imInfo.sessionConfig.videoFrameRate});return e.mcuConfig.videoSecWinType===f.DEVICE_TYPE.DEVICE_TYPE_VIDEO?(a={width:1280,height:720},n={width:1280*e.adapterRef.mixVideoConf.videoMixRatio,height:1280*e.adapterRef.mixVideoConf.videoMixRatio*o.height/o.width}):(a=o,n={width:o.width*e.adapterRef.mixVideoConf.videoMixRatio,height:o.width*e.adapterRef.mixVideoConf.videoMixRatio*720/1080}),e.mcuDom.canvas.width=a.width,e.mcuDom.canvas.height=a.height,Promise.all([e._applyStreamConstrait(r,a),e._applyStreamConstrait(i,n)])}).then(function(){e.mcuDom.smallDom&&(e.mcuDom.smallDom.onresize=function(){e.setMixCoordinates()})});var t=this._getMCUStreamConstrait();return t.width===this.mcuDom.smallDom.videoWidth?this.setMixCoordinates():(this._applyStreamConstrait(this.mcuDom.smallDom.srcObject,t),this.mcuDom.smallDom&&(this.mcuDom.smallDom.onresize=function(){e.setMixCoordinates()})),Promise.resolve()}},{key:"startMCU",value:function(){var e=this;return this.localCameraStream&&this.localScreenStream?this._setupMCUStream().then(function(t){var r=t.smallStream,i=(t.largeStream,e._getMCUStreamConstrait());return Promise.all([e._applyStreamConstrait(r,i)])}).then(function(){e.adapterRef.logger.log("VideoHelper: startMCU: ready: start mix ...");var t=e.mcuConfig;return e.mcuDom.canvas=document.createElement("canvas"),e.mcuDom.canvas.width=e.mcuDom.largeDom.videoWidth,e.mcuDom.canvas.height=e.mcuDom.largeDom.videoHeight,e.setMixCoordinates(),clearInterval(e.mcuDom.canvasTimer),e.mcuDom.canvasTimer=setInterval(function(){e.mcuDom.canvas.getContext("2d").drawImage(e.mcuDom.largeDom,0,0,e.mcuDom.canvas.width,e.mcuDom.canvas.height),e.mcuDom.canvas.getContext("2d").drawImage(e.mcuDom.smallDom,t.coordinatesX,t.coordinatesY)},200),e.pushVideoStream=e.localVideoStream=e.mcuDom.canvas.captureStream(),e.videoDomHelper||e._createVideoDomHelper(),e.videoDomHelper.videoDom.srcObject=e.localVideoStream,e.videoDomHelper.videoDom.play(),e.mcuDom.smallDom.onresize=function(){e.setMixCoordinates()},Promise.resolve()}):(this.adapterRef.logger.warn("VideoHelper:startMCU: stream is null"),Promise.reject(f.VideoErrorCode.VideoStreamFetchError))}},{key:"_getMCUStreamConstrait",value:function(){var e=null;if(this.adapterRef.mixVideoConf.videoMixRatio){var t=Math.min(this.adapterRef.mixVideoConf.videoMixRatio,.7),r=this.mcuDom.largeDom.videoWidth*t;e={width:r,height:r*this.mcuDom.smallDom.videoHeight/this.mcuDom.smallDom.videoWidth}}else{var i=this.sdkRef.getVideoSessionConfig({quality:this.adapterRef.mixVideoConf.videoCompressSize,frameRate:this.adapterRef.imInfo.sessionConfig.videoFrameRate});e={width:i.width,height:i.height}}return e}},{key:"_setupMCUStream",value:function(){var e=null,t=null;return this.adapterRef.mixVideoConf.videoSecWinType===f.DEVICE_TYPE.DEVICE_TYPE_VIDEO?(e=this.localScreenStream,t=this.localCameraStream):(e=this.localCameraStream,t=this.localScreenStream),this.mcuConfig.videoSecWinType=this.adapterRef.mixVideoConf.videoSecWinType,e&&t?Promise.all([this._loadStreamForMCU("smallDom",t),this._loadStreamForMCU("largeDom",e)]).then(function(){return Promise.resolve({smallStream:t,largeStream:e})}):Promise.resolve()}},{key:"_applyStreamConstrait",value:function(e,t){return Promise.resolve().then(function(){var r=e.getVideoTracks();return r.length>0?r[0].applyConstraints(t):Promise.resolve()})}},{key:"_loadStreamForMCU",value:function(e,t){var r=this.mcuDom[e];return r||(this.mcuDom[e]=r=document.createElement("video")),new Promise(function(e,i){r.oncanplay=function(){e()},r.autoplay="autoplay",r.srcObject=t})}},{key:"isInMCUState",value:function(){return!(!this.localCameraStream||!this.localScreenStream)&&(this.localCameraStream!==this.localVideoStream&&this.localScreenStream!==this.localVideoStream)}},{key:"clearMCUState",value:function(){if(!this.adapterRef.mixVideoConf&&(this._resetMixParam(),this.isInMCUState())){var e=function(){};this.stopScreenShare(e),this.stopVideoDevice(e),this.hide()}}},{key:"clearOneStreamFormMixture",value:function(e){var t=this;if(this._resetMixParam(),e)this.adapterRef.logger.log("VideoHelper: clearOneStreamFormMixture: 清除 camera stream: ",this.localCameraStream.id),this._applyStreamConstrait(this.localScreenStream,{width:1280,height:720}).finally(function(e){t.adapterRef.logger.log("VideoHelper: clearOneStreamFormMixture: 恢复 screen stream: ",t.localScreenStream&&t.localScreenStream.id),t.pushVideoStream=t.localVideoStream=t.localScreenStream,t.adapterRef.instance._updateRtc(!0),t.videoDomHelper&&t.videoDomHelper.videoDom&&(t.videoDomHelper.videoDom.srcObject=t.localScreenStream,t.videoDomHelper.videoDom.play())}),u.removeTrackFromMediaStream(this.localCameraStream,this.adapterRef.logger),this.localCameraStream=null;else{this.adapterRef.logger.log("VideoHelper: clearOneStreamFormMixture: 清除 screen stream: ",this.localScreenStream&&this.localScreenStream.id);var r=this.sdkRef.getVideoSessionConfig({quality:this.adapterRef.imInfo.sessionConfig.videoQuality,frameRate:this.adapterRef.imInfo.sessionConfig.videoFrameRate});this._applyStreamConstrait(this.localCameraStream,r).finally(function(e){t.adapterRef.logger.log("VideoHelper: clearOneStreamFormMixture: 清除 camera stream: ",t.localVideoStream.id),t.pushVideoStream=t.localVideoStream=t.localCameraStream,t.adapterRef.instance._updateRtc(!0),t.videoDomHelper&&t.videoDomHelper.videoDom&&(t.videoDomHelper.videoDom.srcObject=t.localCameraStream,t.videoDomHelper.videoDom.play())}),u.removeTrackFromMediaStream(this.localScreenStream,this.adapterRef.logger),this.localScreenStream=null}}},{key:"takeSnapshot",value:function(e){return this.adapterRef.logger.log("VideoHelper: takeSnapshot: 视频截图功能"),this.localVideoStream||this.videoDomHelper.videoDom?(this.canvasHelper||(this.canvasHelper=new p.default({adapterRef:this.adapterRef,uid:this.uid})),e.videoDom=this.videoDomHelper.videoDom,this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"snap_shot"}),this.canvasHelper.takeSnapshot(e)):(this.adapterRef.logger.warn("takeSnapshot: 获取不到视频流，无法进行截图"),Promise.reject(f.VideoErrorCode.VideoStreamFetchError))}},{key:"startVideoDevice",value:function(e,t,r,i){return this.adapterRef.logger.log("VideoHelper: startVideoDevice: 开始启动摄像头"),this.localCameraStream&&h.RtcSystem.browser.safari_12_1()?this.enableDevice(r):this.getCameraStream(e,t).then(function(e){r(e)}).catch(function(e){i(e)})}},{key:"stopVideoDevice",value:function(e){return this.adapterRef.logger.log("VideoHelper: stopVideoDevice: 开始关闭摄像头"),h.RtcSystem.browser.safari_12_1()?this.disableDevice(e):this.stopStream(!0,e)}},{key:"startScreenShare",value:function(e,t,r){return this.adapterRef.logger.log("VideoHelper: startScreenShare: 开始屏幕共享: ",e),e?this.getScreenStreamCustom(e,t,r):this.adapterRef.chromeId?this.getScreenStreamPlugin(e,t,r):this.getScreenStreamNative(e,t,r)}},{key:"stopScreenShare",value:function(e){return this.adapterRef.logger.log("VideoHelper: stopScreenShare: 开始关闭屏幕共享"),this.stopStream(!1,e)}},{key:"disableDevice",value:function(e){this.adapterRef.logger.log("VideoHelper: stopScreenShare: 设备禁用 ",this.uid);var t=[];if(this.localCameraStream&&(t=this.localCameraStream.getTracks()),t.map(function(e){e.enabled=!1}),e)return e()}},{key:"stopStream",value:function(e,t){return this.adapterRef.logger.log("清除stream,startSessionTime: ",this.adapterRef.state.startSessionTime),0===this.adapterRef.state.startSessionTime&&(u.removeTrackFromMediaStream(this.localCameraStream,this.adapterRef.logger),u.removeTrackFromMediaStream(this.localScreenStream,this.adapterRef.logger)),this.isInMCUState()?(this.clearOneStreamFormMixture(e),t()):this.localVideoStream?(e?this.localCameraStream&&(this.destroy(this.localCameraStream),this.localCameraStream=null):this.localScreenStream&&(this.destroy(this.localScreenStream),this.localScreenStream=null),this.localVideoStream=null,t()):t("VideoHelper: stopStream: 视频采集未开启")}},{key:"hide",value:function(){if(this.isPlaying=!1,this.videoDomHelper){var e=this.videoDomHelper.videoContainerDom;e?(this.mcuDom.canvasTimer&&0!==this.adapterRef.state.startSessionTime&&this.adapterRef.logger.log("VideoHelper:hide 当前正在混频中"),this.adapterRef.logger.log("VideoHelper:hide 隐藏video并清理DOM节点, uid  ",this.uid),e.parentNode&&this.videoContainer.removeChild(e),this.videoDomHelper.destory(),this.videoDomHelper=null):this.adapterRef.logger.log("VideoHelper:hide videoContainerDom不存在")}else this.adapterRef.logger.log("VideoHelper:hide videoDomHelper不存在")}},{key:"_createVideoDomHelper",value:function(){this.videoDomHelper=new l.default({adapterRef:this.adapterRef,uid:this.uid})}},{key:"show",value:function(e){this.adapterRef.logger.log("show 播放视频 uid "+this.uid),!1!==this._checkHasVideoStream()?this.videoContainer||e?(e?this.setVideoContainer(e):this.videoDomHelper&&!this.videoDomHelper.videoContainerDom||this.setVideoContainer(this.videoContainer),this._mountVideoToDom(),this.setVideoViewConfig(),this.play()):this.adapterRef.logger.log("show: ",f.VideoErrorCode.VideoContainerNotExist):this.adapterRef.logger.log("show: ",f.VideoErrorCode.VideoStreamFetchError)}},{key:"_mountVideoToDom",value:function(){var e=this.videoDomHelper.videoContainerDom,t=this.videoContainer;e&&t?t!=e.parentNode?(this.adapterRef.logger.log("VideoHelper: _mountVideoToDom: videoContainerDom: ",e.outerHTML),t.appendChild(e)):this.adapterRef.logger.log("VideoHelper: _mountVideoToDom: 节点已挂载，请勿重复挂载"):this.adapterRef.logger.error("VideoHelper: _mountVideoToDom: 未设置渲染根节点或子节点为空")}},{key:"play",value:function(){var e=this;if(1!=this.isPlaying){var t=this.videoDomHelper.videoDom;if(!1!==t.paused){if(this.adapterRef.logger.log("VideoHelper: play, uid %s, isRemote %s",this.uid,this.isRemote),this.poster&&(t.poster=this.poster),t.srcObject||(this.adapterRef.logger.log("VideoHelper: play 设置播放对象"),t.srcObject=this.isRemote?this.remoteVideoStream:this.localVideoStream),t.srcObject){this.adapterRef.logger.log("VideoHelper: play, uid %s, video %s",this.uid,t.srcObject.id),4!==t.readyState&&t.load();var r=t.play();void 0!==r&&r.catch(function(t){e.adapterRef.logger.log("VideoHelper: play, 播放 uid: "+e.uid+" 视频错误 \nerror.code: "+t.code+"\nerror.name: "+t.name+"\nerror.message: "+t.message)}).then(function(){if(e.isPlaying=!0,e.adapterRef.logger.log("VideoHelper: play video 成功, uid: %s, streamid: %s, isPlayed: %s",e.uid,t.srcObject.id,t.played.length),e.adapterRef.logger.log("VideoHelper: play video 成功, div: ",t.parentNode&&t.parentNode.outerHTML),t.parentNode&&0==t.played.length&&setTimeout(function(){t&&0==t.played.length&&(e.adapterRef.logger.log("VideoHelper: play: 再次播放"),t.play())},500),e.adapterRef.logReportHelper&&t&&t.parentNode){var r={};r.uid=e.adapterRef.imInfo&&e.adapterRef.imInfo.uid||"",r.remoteUid=e.uid||"",r.streamId=t.srcObject.id||"",r.playEvent=t.parentNode.outerHTML||"",r.videoSize=t.videoWidth+"x"+t.videoHeight||"",r.windowsSize=t.parentNode.clientWidth+"x"+t.parentNode.clientHeight||"",e.adapterRef.logReportHelper.uploadData("mediaPlay",{video:r})}})}}else this.adapterRef.logger.log("VideoHelper: play 已经播放，请勿重复播放")}else this.adapterRef.logger.log("VideoHelper: play 正在播放，请勿重复播放")}},{key:"getLocalVideoStream",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.pushVideoStream:this.localVideoStream}},{key:"setLocalVideoStreamToPushStream",value:function(){this.pushVideoStream=this.localVideoStream}},{key:"getLocalCameraStream",value:function(){return this.localCameraStream}},{key:"getLocalScreenStream",value:function(){return this.localScreenStream}},{key:"resumeLocalStream",value:function(){this.videoDomHelper&&this.videoDomHelper.videoDom.play()}},{key:"suspendLocalStream",value:function(){this.videoDomHelper&&this.videoDomHelper.videoDom.pause()}},{key:"resumeRemoteStream",value:function(){this.videoDomHelper&&this.videoDomHelper.videoDom.play()}},{key:"suspendRemoteStream",value:function(){this.videoDomHelper&&this.videoDomHelper.videoDom.pause()}},{key:"hasStartVideoDeviceRepeat",value:function(e){return this.localCameraStream&&this.constraint.video&&this.constraint.video.deviceId===e.deviceId?(this.enableDevice(),this.adapterRef.logger.log("重复开启视频设备"),Promise.resolve()):Promise.resolve()}},{key:"hasStartScreenShareRepeat",value:function(){return this.localScreenStream&&this.adapterRef.mixVideoConf?Promise.reject(f.DeviceErrorCode.DeviceAlreadyOpen):Promise.resolve()}},{key:"checkMediaTrackBySDP",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.video,r=e.sdp,i=e.uid,a={video:!1},n=c.parse(r),o=t&&t.getVideoTracks()[0];return this.adapterRef.logger.log("VideoHelper: "+i+" checkMediaTrackBySDP ----\x3e track status",n),o&&this.adapterRef.logger.log("VideoHelper: checkMediaTrackBySDP videoTrack ----\x3e ",o),a.video=o&&"ended"!==o.readyState&&new RegExp(o.id).test(r),a}},{key:"_checkHasVideoStream",value:function(){return Boolean(this.localVideoStream)||Boolean(this.remoteVideoStream)}},{key:"getPlayState",value:function(e){var t={isPlaying:!1,playErrorReason:""};return this._checkHasVideoStream()?this.videoDomHelper&&this.videoDomHelper.videoDom&&this.videoDomHelper.videoDom.srcObject&&this.videoDomHelper.videoDom.srcObject.getVideoTracks()[0].enabled?this.videoDomHelper.containerSize&&this.videoDomHelper.containerSize.height&&this.videoDomHelper.containerSize.width?this.videoDomHelper.videoDom.srcObject&&this.videoDomHelper.videoDom.videoHeight>100?this.videoDomHelper.videoDom.parsed?t.isPlaying="当前视频被暂停了":e&&e.decode&&e.recvStream?t.isPlaying="当前视频播放正常":(t.isPlaying="当前视频播放失败",t.playErrorReason="糟糕的网络引起的",t.netState=e):(t.isPlaying="当前视频播放失败",t.playErrorReason="糟糕的网络引起的",t.netState=e):(t.isPlaying="当前视频播放失败",t.playErrorReason="父节点div的宽高属性错误"):t.isPlaying="视频被手动关闭了":t.isPlaying="当前没有播放视频",t}}]),t}(s.EventEmitter);t.VideoHelper=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(r(1)),a=s(r(2)),n=s(r(4)),o=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r._initNode(),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_reset",value:function(){this.audioDom=null}},{key:"_initNode",value:function(){this.audioDom=document.createElement("audio")}},{key:"destroy",value:function(){this._reset()}}]),t}(r(12).EventEmitter);t.default=d,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioHelper=void 0;var i=g(r(1)),a=g(r(2)),n=g(r(4)),o=g(r(3)),s=r(12),d=r(159),c=m(r(264)),u=g(r(463)),l=m(r(111)),p=r(11),f=r(28),h=r(27);function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function g(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._reset(),r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.uid=e.uid,r.isRemote=e.isRemote,r.palyError=null,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"setUid",value:function(e){this.uid=e}},{key:"_reset",value:function(){this.sdkRef=null,this.adapterRef=null,this._resetStateParam()}},{key:"_resetStateParam",value:function(){this.constraint={},this.system=null,this.uid=null,this.isRemote=!1,this.rtc=null,this.audioDomHelper=new u.default,this.localAudioStream=null,this.remoteAudioStream=null,this.localAudioStreamFromMIC=null,this.pushAudioStream=null,this.mixAudioConf={audioMixingStream:null,audioBuffer:{}},this.webAudio&&this.webAudio.context&&this.webAudio.destroy&&this.webAudio.destroy(),this.webAudio=null,this.muted=!1,this.volume=100,this.gainVolume=.5,this.gainOff=!1,this.isFirstOpenMic=!1}},{key:"_getMediaStream",value:function(){var e=this;!1===this.isRemote&&c.getMediaStream({video:!1,audio:!0},this.adapterRef.logger).then(function(t){e.localAudioStream=t})}},{key:"playAudio",value:function(){(this.localAudioStream||this.remoteAudioStream)&&(this.audioDomHelper.audioDom=null,this.audioDomHelper.audioDom=document.createElement("audio"),!1===this.isRemote?this.audioDomHelper.audioDom.srcObject=this.localAudioStream:!0===this.isRemote&&(this.audioDomHelper.audioDom.srcObject=this.remoteAudioStream),this.play())}},{key:"stopAudio",value:function(){this.setMuted(!0)}},{key:"setIsRemote",value:function(e){return this.isRemote=e,this}},{key:"setRTC",value:function(e){this.rtc=e}},{key:"setMuted",value:function(e){this.muted=!!e,this.audioDomHelper.audioDom&&(this.audioDomHelper.audioDom.muted=!!e,this.setPlayVolume())}},{key:"play",value:function(){var e=this,t=this.audioDomHelper.audioDom;console.error("播放 readyState:  ",t.readyState),t.readyState,this.adapterRef.logger.log("播放声音, uid: ",this.uid," , : ",t.srcObject&&t.srcObject.id);var r=t.play();void 0!==r&&r.then(function(){e.adapterRef.logger.log("AudioHelper: play, audio 成功, muted "+t.muted+" , uid: "+e.uid+" , streamId: "+(t.srcObject&&t.srcObject.id)+", played:"+t.played.length),e.adapterRef.logReportHelper&&e.adapterRef.logReportHelper.uploadData("mediaPlay",{audio:{uid:e.adapterRef.imInfo&&e.adapterRef.imInfo.uid||"",remoteUid:e.uid,streamId:t.srcObject.id,playEvent:t.innerHTML}})}).catch(function(t){e.adapterRef.logger.log("AudioHelper: play, 播放声音错误 \nerror.code: "+t.code+"\nerror.name: "+t.name+"\nerror.message: "+t.message)})}},{key:"setPlayVolume",value:function(e){var t=void 0;t=e||0==e?e<0?0:e>255?255:e:this.volume,this.volume=t,this.getMuted()||this.audioDomHelper.audioDom&&(this.audioDomHelper.audioDom.volume=t/255)}},{key:"getPlayVolume",value:function(){return this.getMuted()?0:this.audioDomHelper.audioDom?this.audioDomHelper.audioDom.volume:0}},{key:"setGain",value:function(e){var t=0===e||0!==e&&e?e:1;this.gainVolume=t,this.localAudioStream&&!this.isRemote?this.gainOff?this.adapterRef.logger.log("AudioHelper: setGain: 本地音频被禁止采集"):this.webAudio&&(this.webAudio.setGain(t),this.adapterRef.logger.log("AudioHelper: setGain: webAudio: 设置音量",t)):this.adapterRef.logger.log("AudioHelper: setGain: 缺失本地音频")}},{key:"getGain",value:function(){return this.webAudio&&this.webAudio.getGain(),this.gainVolume||1}},{key:"setGainOff",value:function(){this.localAudioStream&&!this.isRemote?(this.webAudio&&this.webAudio.setGain(0),this.gainOff=!0):this.adapterRef.logger.log("AudioHelper: setGainOff: 缺失本地音频")}},{key:"setGainOn",value:function(){this.localAudioStream&&!this.isRemote?(this.webAudio&&this.webAudio.setGain(this.gainVolume),this.gainOff=!1):this.adapterRef.logger.log("AudioHelper: setGainOn: 缺失本地音频")}},{key:"getMuted",value:function(){return!!this.muted}},{key:"composeTrack",value:function(e,t){if(e&&e!==this.adapterRef.imInfo.uid)if(this.adapterRef.imInfo.netDetect)this.adapterRef.logger.log("AudioHelper:_composeTrack 网络探测直接忽略");else if(this.rtc&&this.rtc.sdpAnswer&&this.adapterRef.instance._isChrome()&&!this.rtc.checkMeidaExistent({sdp:this.rtc.sdpAnswer.sdp,type:"audio"}))this.adapterRef.logger.log("VideoHelper:_composeTrack 对端不发送音频流直接忽略");else if((this.audioDomHelper.audioDom&&this.audioDomHelper.audioDom.srcObject&&this.audioDomHelper.audioDom.srcObject.active&&this.audioDomHelper.audioDom.srcObject.getAudioTracks()[0])!=t||"safari"==f.RtcSystem.browser.ua){this.adapterRef.logger.log("AudioHelper:_composeTrack uid %s",e);var r=new MediaStream;r.addTrack(t),this.updateStream(r),this.adapterRef.instance.emit("remoteTrack",{uid:e,account:this.adapterRef.instance._getAccountByUid(e),track:t})}else this.adapterRef.logger.log("AudioHelper:_composeTrack 相同的track直接忽略");else this.adapterRef.logger.warn("AudioHelper:_composeTrack 自己的轨道直接忽略")}},{key:"startAudioDevice",value:function(e,t,r,i,a){if(this.adapterRef.logger.log("AudioHelper: startAudioDevice: 开始启动麦克风"),this.pushAudioStream&&(this.isFirstOpenMic=!1),this.localAudioStreamFromMIC&&("safari"===f.RtcSystem.browser.ua||f.RtcSystem.h5()))return this.enableDevice(),i();if(r){this.localAudioStreamFromMIC&&this.destroyMedia();var n=new MediaStream;return n.addTrack(r),this._initAudioStream(null,n),Promise.resolve()}return this.getAudioStream(e,t).then(function(e){i(e)}).catch(function(e){a(e)})}},{key:"stopAudioDevice",value:function(){this.localAudioStreamFromMIC&&c.removeTrackFromMediaStream(this.localAudioStreamFromMIC,this.adapterRef.logger)}},{key:"getAudioStream",value:function(e,t,r,i){var a=this;return new Promise(function(r,i){a._getAudioStream(e,t,r,i)})}},{key:"_getAudioStream",value:function(e,t,r,i){var a=this,n=e&&e.deviceId;return this.constraint.audio=!n||{deviceId:n},"chrome"===f.RtcSystem.browser.ua&&n&&(this.constraint.audio.echoCancellation=t,this.constraint.audio.echoCancellationType="aec3"),this.adapterRef.logger.log("AudioHelper::_getAudioStream:"),c.getMediaStream(this.constraint,this.adapterRef.logger).then(function(t){a.stopAudioDevice(),a.adapterRef.logger.log("AudioHelper: _getAudioStream: 获取到音频流:",t.id),a.adapterRef.webrtcGateWayBusiness||(c.removeTrackFromMediaStream(t,a.adapterRef.logger),i(p.AudioErrorCode.AudioUserHasBeenLeft)),a.adapterRef.logReportHelper&&(a.adapterRef.logReportHelper.uploadData("AudioHelper: _getAudioStream: mediaConstraint",{audio:{deviceId:a.constraint.audio.deviceId||"",streamId:t.id||""}}),a.adapterRef.deviceBusiness&&a.adapterRef.deviceBusiness.mediaDeviceHelper.devicesCache&&a.adapterRef.deviceBusiness.mediaDeviceHelper.devicesCache.audioIn?a.adapterRef.logReportHelper.uploadData("deviceList",{audio:a.adapterRef.deviceBusiness.mediaDeviceHelper.devicesCache.audioIn}):a.adapterRef.deviceApi.getDevicesOfType().then(function(e){a.adapterRef.logReportHelper.uploadData("deviceList",{audio:e.audioIn})})),a._initAudioStream(a.constraint,t),r({device:e,stream:t})}).catch(function(e){a.adapterRef.state.audioDeviceHasOpened=!1;var t=Object.assign({event:e},p.DeviceErrorCode.DeviceOpenError);i(t)})}},{key:"handleStreamFromMp4File",value:function(e){if(!e||!e.getAudioTracks().length)return p.AudioErrorCode.AudioStreamFetchError;(new MediaStream).addTrack(e.getAudioTracks()[0]),this.pushAudioStream=this.localAudioStream=this.webAudio.outputStream}},{key:"_initAudioStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new MediaStream;this.localAudioStreamFromMIC=t,this.localAudioStream||this.webAudio?(this.updateStream(t),this.isFirstOpenMic=!1):(this.adapterRef.logger.log("初次开启mic，实例化音频对象"),this.localAudioStream=t,this.isFirstOpenMic=!0,"safari"===f.RtcSystem.browser.ua||f.RtcSystem.h5()||(this.webAudio=new d.WebAudio({logger:this.adapterRef.logger,adapterRef:this.adapterRef,stream:t,uid:this.uid,isAnalyze:!0,isRemote:this.isRemote}),1==this.isRemote?this.remoteAudioStream=this.webAudio.outputStream:(this.localAudioStream=this.webAudio.outputStream,this.adapterRef.logger.log("AudioHelper: _initAudioStream, 本地音频 %s",this.localAudioStream.id))))}},{key:"disableDevice",value:function(){this.adapterRef.logger.log("AudioHelper: disableDevice: 暂停设备 Audio");var e=[];return this.localAudioStream&&(e=this.localAudioStream.getTracks()),e.map(function(e){e.enabled=!1}),Promise.resolve()}},{key:"enableDevice",value:function(){this.adapterRef.logger.log("AudioHelper: enableDevice: 恢复设备 Audio");var e=[];return this.localAudioStream&&(e=this.localAudioStream.getTracks()),e.map(function(e){e.enabled=!0}),Promise.resolve()}},{key:"updateStream",value:function(e){this.audioDomHelper.audioDom&&e&&(this.adapterRef.logger.log("AudioHelper: updateStream ",e.id),1==this.isRemote?(this.remoteAudioStream=e,this.adapterRef.logger.log("AudioHelper: updaStream, remoteAudioStream:",this.remoteAudioStream&&this.remoteAudioStream.id)):this.webAudio?(this.webAudio.updateStream(e),this.localAudioStream=this.webAudio.outputStream,this.adapterRef.logger.log("AudioHelper: updaStream, localAudioStream:",this.localAudioStream&&this.localAudioStream.id)):(this.localAudioStream=e,this.adapterRef.logger.log("AudioHelper: updaStream, localAudioStream:",this.localAudioStream&&this.localAudioStream.id)))}},{key:"getAudioVolume",value:function(){return this.adapterRef.detectNetState.inDetecting?p.CommonErrorCode.NetworkInDetecting:this.adapterRef.instance._isPlayer()?this.localAudioStreamFromMIC?{volume:this.webAudio&&this.webAudio.getVolumeData()||0}:p.AudioErrorCode.AudioDisabled:p.CommonErrorCode.RoleNoPermission}},{key:"removeTrackFromMediaStream",value:function(e){c.removeTrackFromMediaStream(e,this.adapterRef.logger)}},{key:"destroyMedia",value:function(){this.adapterRef.logger.log("AudioHelper: destroyMedia: 销毁音频流 "+this.uid+", localAudioStream:\n",this.localAudioStreamFromMIC&&this.localAudioStreamFromMIC.id),f.RtcSystem.h5()||"safari"===f.RtcSystem.browser.ua?this.disableDevice():(c.removeTrackFromMediaStream(this.localAudioStreamFromMIC,this.adapterRef.logger),this.localAudioStreamFromMIC=null)}},{key:"getLocalAudioStream",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.pushAudioStream:this.localAudioStream}},{key:"setLocalAuioStreamToPushStream",value:function(){this.pushAudioStream=this.localAudioStream}},{key:"startPushLocalAudioStream",value:function(){return this.localAudioStream?(this.pushAudioStream=this.localAudioStream,this.adapterRef.instance._judgeSendSdpOfferOrUpdate()):Promise.reject(p.AudioErrorCode.AudioStreamFetchError)}},{key:"stopPushLocalAudioStream",value:function(){var e=this;return Promise.resolve().then(function(){return e.localAudioStream&&e.pushAudioStream?(e.pushAudioStream=null,e.adapterRef.instance._updateRtc(!0)):Promise.reject(p.AudioErrorCode.AudioStreamFetchError)})}},{key:"hasStartAudioDeviceRepeat",value:function(e){return this.localAudioStreamFromMIC&&this.constraint.audio.deviceId==e.deviceId?(this.enableDevice(),Promise.resolve()):Promise.resolve()}},{key:"checkMediaTrackBySDP",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audio,r=e.sdp,i=e.uid,a={audio:!1},n=l.parse(r),o=t&&t.getAudioTracks()[0];return this.adapterRef.logger.log("AudioHelper: "+i+" checkMediaTrackBySDP ----\x3e track status",n),o&&this.adapterRef.logger.log("AudioHelper:checkMediaTrackBySDP audioTrack ----\x3e ",o),a.audio=o&&"ended"!==o.readyState&&new RegExp(o.id).test(r),a}},{key:"getPlayState",value:function(e){var t={isPlaying:!1,playErrorReason:""};return(this.localAudioStreamFromMIC||this.remoteAudioStream)&&this.audioDomHelper&&this.audioDomHelper.audioDom&&this.audioDomHelper.audioDom&&this.audioDomHelper.audioDom.srcObject&&this.audioDomHelper.audioDom.srcObject.getAudioTracks()[0].enabled?this.audioDomHelper.audioDom.played.length>0?this.audioDomHelper.audioDom.muted?t.isPlaying="当前音频被暂停了":!1===e.beSelf&&0==e.remoteAudioVolume?(t.isPlaying="当前音频没有音量",t.playErrorReason="可能是对端关闭了自己的麦克风"):e&&e.decode&&e.recvStream?t.isPlaying="当前音频播放正常":(t.isPlaying="当前音频播放失败",t.playErrorReason="糟糕的网络引起的",t.netState=e):(t.isPlaying="当前音频播放失败",this.palyError&&(t.playErrorReason="可能是浏览器的自动播放策略导致的，解决方法参考开发手册")):t.isPlaying="当前没有播放音频",t}},{key:"startAudioMixing",value:function(){return this.adapterRef.instance._isChrome()?this.adapterRef&&this.adapterRef.mixAudioConf&&this.adapterRef.mixAudioConf.audioFilePath?this.localAudioStreamFromMIC?this.pushAudioStream?this.webAudio&&this.webAudio.context?(this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource&&this.webAudio.mixAudioConf.state===p.AuidoMixingState.PLAYED&&(this.adapterRef.logger.log("startAudioMixing: 当前已经开启伴音，先关闭之前的伴音"),this.stopAudioMixing()),this.webAudio.mixAudioConf.state,p.AuidoMixingState.STARTING,this.mixAudioConf.audioBuffer.length&&this.mixAudioConf.audioBuffer[this.adapterRef.mixAudioConf.audioFilePath]?(this.adapterRef.logger.log("开始伴音, 已经加载过云端音乐"),this.startMix(this.adapterRef.mixAudioConf.index)):(this.adapterRef.logger.log("开始伴音, 先加载云端音乐"),this.loadRemoteAudioFile(this.adapterRef.mixAudioConf.index))):(this.adapterRef.logger.log("startAudioMixing: 没有webAudio，不支持伴音功能"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport)):(this.adapterRef.logger.log("startAudioMixing: 当前没有推音频流，音频功能已被禁用"),Promise.reject(p.AudioErrorCode.AudioDisabled)):(this.adapterRef.logger.log("startAudioMixing: 当前没有开启mic"),Promise.reject(p.AudioErrorCode.AudioStreamFetchError)):(this.adapterRef.logger.log("没有找到云端文件路径"),Promise.reject(p.AudioErrorCode.AudioFileDownloadError)):(this.adapterRef.logger.log("startAudioMixing: 请使用chrome内核浏览器"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport))}},{key:"loadRemoteAudioFile",value:function(e){var t=this;return(0,h.ajax)({url:this.adapterRef.mixAudioConf.audioFilePath,type:"GET",dataType:"arraybuffer"}).then(function(r){return t.adapterRef.logger.log("loadRemoteAudioFile 加载云端音乐成功"),new Promise(function(i,a){t.webAudio.context.decodeAudioData(r,function(r){t.adapterRef.logger.log("loadRemoteAudioFile 云端音乐解码成功"),t.mixAudioConf.audioBuffer[t.adapterRef.mixAudioConf.audioFilePath]=r,t.startMix(e).then(function(e){i()})},function(e){t.adapterRef.logger.log("loadRemoteAudioFile 云端音乐解码失败：",e),a(p.AudioErrorCode.MusicalAccompanimentError)})})}).catch(function(e){return t.adapterRef.logger.log("loadRemoteAudioFile 加载云端音乐失败: ",e),Promise.reject(p.AudioErrorCode.AudioFileDownloadError)})}},{key:"startMix",value:function(e){if(this.adapterRef.logger.log("startMix conf: ",this.adapterRef.mixAudioConf),e!==this.adapterRef.mixAudioConf.index)return this.adapterRef.logger.log("startMix: 该次伴音已经取消"),Promise.resolve();var t=this.adapterRef.mixAudioConf,r=t.audioFilePath,i=void 0===r?"":r,a=t.loopback,n=void 0!==a&&a,o=t.replace,s=void 0!==o&&o,d=t.cycle,c=void 0===d?0:d,u=t.playStartTime,l=void 0===u?0:u,p=t.auidoMixingEnd,f=void 0===p?null:p;return this.webAudio.startMix({buffer:this.mixAudioConf.audioBuffer[i],loopback:n,replace:s,cycle:c,playStartTime:l,auidoMixingEnd:f})}},{key:"pauseAudioMixing",value:function(){return this.adapterRef.instance._isChrome()?this.webAudio&&this.webAudio.context?this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource&&this.webAudio.mixAudioConf.state!==p.AuidoMixingState.PAUSED?this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource&&this.webAudio.mixAudioConf.state===p.AuidoMixingState.PLAYED?this.webAudio.pauseAudioMixing():(this.adapterRef.logger.log("pauseAudioMixing: 当前没有开启伴音"),Promise.reject(p.AudioErrorCode.UnstartMusicalAccompaniment)):(this.adapterRef.logger.log("pauseAudioMixing: 已经暂停"),Promise.reject(p.AudioErrorCode.pausedMusicalAccompaniment)):(this.adapterRef.logger.log("pauseAudioMixing: 不支持伴音功能"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport)):(this.adapterRef.logger.log("pauseAudioMixing: 请使用chrome内核浏览器"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport))}},{key:"resumeAudioMixing",value:function(){if(!this.adapterRef.instance._isChrome())return this.adapterRef.logger.log("resumeAudioMixing: 请使用chrome内核浏览器"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport);if(!this.webAudio||!this.webAudio.context)return this.adapterRef.logger.log("resumeAudioMixing: 不支持伴音功能"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport);if(!this.webAudio.mixAudioConf||!this.webAudio.mixAudioConf.audioSource)return this.adapterRef.logger.log("resumeAudioMixing: 当前没有开启伴音"),Promise.reject(p.AudioErrorCode.UnstartMusicalAccompaniment);if(this.webAudio.mixAudioConf.state!==p.AuidoMixingState.PAUSED)return this.adapterRef.logger.log("resumeAudioMixing: 当前没有暂停伴音"),Promise.reject(p.AudioErrorCode.UnpauseMusicalAccompaniment);var e=this.adapterRef.mixAudioConf,t=e.audioFilePath,r=void 0===t?"":t,i=e.loopback,a=void 0!==i&&i,n=e.replace,o=void 0!==n&&n,s=e.cycle,d=void 0===s?0:s,c=e.playStartTime,u=void 0===c?0:c,l=e.auidoMixingEnd,f=void 0===l?null:l,h=(this.webAudio.mixAudioConf.pauseTime-this.webAudio.mixAudioConf.startTime)/1e3+this.webAudio.mixAudioConf.playStartTime;return h>this.webAudio.mixAudioConf.totalTime&&(this.adapterRef.logger.log("播发过的圈数 playedCycle: ",parseInt(h/this.webAudio.mixAudioConf.totalTime)),d-=parseInt(h/this.webAudio.mixAudioConf.totalTime),this.adapterRef.mixAudioConf.cycle=d),this.webAudio.mixAudioConf.setPlayStartTime?(this.adapterRef.logger.log("暂停期间，用户设置混音播发时间: ",this.webAudio.mixAudioConf.setPlayStartTime),u=this.webAudio.mixAudioConf.setPlayStartTime,this.webAudio.mixAudioConf.setPlayStartTime=0):(this.adapterRef.logger.log("恢复混音:",this.webAudio.mixAudioConf),this.adapterRef.logger.log("已经播放的时间: ",h),h>this.webAudio.mixAudioConf.totalTime&&(h%=this.webAudio.mixAudioConf.totalTime),u=h),this.adapterRef.logger.log("回复重置的时间点：",u),this.webAudio.resumeAudioMixing({buffer:this.mixAudioConf.audioBuffer[r],loopback:a,replace:o,cycle:d,playStartTime:u,auidoMixingEnd:f})}},{key:"stopAudioMixing",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isRemote)return this.adapterRef.instance._isChrome()?this.webAudio&&this.webAudio.context?this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource?this.webAudio.stopAudioMixing(e):(this.adapterRef.logger.log("stopAudioMixing: 当前没有开启伴音"),Promise.reject(p.AudioErrorCode.UnstartMusicalAccompaniment)):(this.adapterRef.logger.log("stopAudioMixing: 不支持伴音功能"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport)):(this.adapterRef.logger.log("stopAudioMixing: 请使用chrome内核浏览器"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport))}},{key:"setAudioMixingVolume",value:function(e){return this.adapterRef.instance._isChrome()?this.webAudio&&this.webAudio.context?this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource?Number.isInteger(e)?e<0?(this.adapterRef.logger.log("setAudioMixingVolume: volume小于0"),Promise.reject(p.CommonErrorCode.ParamError)):e>255?(this.adapterRef.logger.log("setAudioMixingVolume: volume大于255"),Promise.reject(p.CommonErrorCode.ParamError)):this.webAudio.setAudioMixingVolume(e):(this.adapterRef.logger.log("setAudioMixingVolume: volume不是整数"),Promise.reject(p.CommonErrorCode.ParamError)):(this.adapterRef.logger.log("setAudioMixingVolume: 当前没有开启伴音"),Promise.reject(p.AudioErrorCode.UnstartMusicalAccompaniment)):(this.adapterRef.logger.log("setAudioMixingVolume: 不支持伴音功能"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport)):(this.adapterRef.logger.log("setAudioMixingVolume: 请使用chrome内核浏览器"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport))}},{key:"setAudioMixingPlayTime",value:function(e){var t=this;return this.adapterRef.instance._isChrome()?this.webAudio&&this.webAudio.context?this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource?e<0?(this.adapterRef.logger.log("setAudioMixingPlayTime: playStartTime小于0"),Promise.reject(p.CommonErrorCode.ParamError)):e>=this.webAudio.mixAudioConf.totalTime?(this.adapterRef.logger.log("setAudioMixingPlayTime: playStartTime大于音频文件总时长了"),Promise.reject(p.CommonErrorCode.ParamError)):this.webAudio.mixAudioConf.state===p.AuidoMixingState.PAUSED?(this.webAudio.mixAudioConf.setPlayStartTime=e,this.adapterRef.logger.log("setAudioMixingPlayTime: 当前正在暂停，记录设置的播发位置，在恢复伴音时，跳转到此次设置的播放位置"),Promise.resolve()):new Promise(function(r,i){t.stopAudioMixing(!1).then(function(a){t.adapterRef.mixAudioConf.playStartTime=e;var n=t.adapterRef.mixAudioConf,o=n.audioFilePath,s=void 0===o?"":o,d=n.loopback,c=void 0!==d&&d,u=n.replace,l=void 0!==u&&u,p=n.cycle,f=void 0===p?0:p,h=n.playStartTime,m=void 0===h?0:h,g=n.auidoMixingEnd,v=void 0===g?null:g;t.adapterRef.logger.log("设置混音的播放位置:",t.webAudio.mixAudioConf);var R=(Date.now()-t.webAudio.mixAudioConf.startTime)/1e3+t.webAudio.mixAudioConf.playStartTime;t.adapterRef.logger.log("已经播放的时间: ",R),R>t.webAudio.mixAudioConf.totalTime&&(t.adapterRef.logger.log("播发过的圈数 playedCycle: ",parseInt(R/t.webAudio.mixAudioConf.totalTime)),f-=parseInt(R/t.webAudio.mixAudioConf.totalTime),t.adapterRef.mixAudioConf.cycle=f),t.adapterRef.logger.log("setAudioMixingPlayTime, playTime: ",e),t.adapterRef.logger.log("setAudioMixingPlayTime, cycle: ",f),t.webAudio.setAudioMixingPlayTime({buffer:t.mixAudioConf.audioBuffer[s],loopback:c,replace:l,cycle:f,playStartTime:m,auidoMixingEnd:v}).then(function(e){r()}).catch(function(e){i(e)})}).catch(function(e){return Promise.reject(e)})}):(this.adapterRef.logger.log("setAudioMixingPlayTime: 当前没有开启伴音"),Promise.reject(p.AudioErrorCode.UnstartMusicalAccompaniment)):(this.adapterRef.logger.log("setAudioMixingPlayTime: 不支持伴音功能"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport)):(this.adapterRef.logger.log("setAudioMixingPlayTime: 请使用chrome内核浏览器"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport))}},{key:"getAudioMixingPlayedTime",value:function(){return this.adapterRef.instance._isChrome()?this.webAudio&&this.webAudio.context?this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource?this.webAudio.getAudioMixingPlayedTime():(this.adapterRef.logger.log("getAudioMixingPlayedTime: 当前没有开启伴音"),p.AudioErrorCode.UnstartMusicalAccompaniment):(this.adapterRef.logger.log("getAudioMixingPlayedTime: 不支持伴音功能"),p.AudioErrorCode.MusicalAccompanimentUnsupport):(this.adapterRef.logger.log("getAudioMixingPlayedTime: 请使用chrome内核浏览器"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport))}},{key:"getAudioMixingTotalTime",value:function(){return this.adapterRef.instance._isChrome()?this.webAudio&&this.webAudio.context?this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource?this.webAudio.getAudioMixingTotalTime():(this.adapterRef.logger.log("getAudioMixingTotalTime: 当前没有开启伴音"),p.AudioErrorCode.UnstartMusicalAccompaniment):(this.adapterRef.logger.log("startAudioMixing: 不支持伴音功能"),p.AudioErrorCode.MusicalAccompanimentUnsupport):(this.adapterRef.logger.log("getAudioMixingTotalTime: 请使用chrome内核浏览器"),Promise.reject(p.AudioErrorCode.MusicalAccompanimentUnsupport))}},{key:"isMixAuido",value:function(){return!!(this.webAudio&&this.webAudio.mixAudioConf&&this.webAudio.mixAudioConf.audioSource)}},{key:"destroy",value:function(){this.adapterRef.logger.log("AudioHelper:destroy "),this.audioDomHelper&&(this.audioDomHelper.destroy(),this.audioDomHelper=null),this.stopAudioMixing(),this._resetStateParam()}}]),t}(s.EventEmitter);t.AudioHelper=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaRecordHelper=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(159),c=r(11);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._status={},r._reset(),r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{uid:0,account:"",type:"video",reset:!1};if(!r.uid&&!r.account)return Promise.reject(c.VideoRecordErrorCode.RecordLackAccount);if(!t)return Promise.reject(c.VideoRecordErrorCode.RecordNoStream);if(!window.MediaRecorder||!MediaRecorder.isTypeSupported)return Promise.reject(c.VideoRecordErrorCode.RecordBrowserNotSupport);if(this._status.isRecording)return Promise.reject(c.VideoRecordErrorCode.RecordInRecording);if(this._status.recordUrl){if(!r.reset)return this.adapterRef.logger.log("MediaRecordHelper: start : 请先下载或重置上一段录制文件"),Promise.reject(c.VideoRecordErrorCode.VideoRecordExsit);this.adapterRef.logger.warn("MediaRecordHelper: start: 存在未下载视频，强制清除..."),this.clean()}this._status.stream=t,this._status.option=r,this._status.fileName=(this._status.option.uid||this._status.option.account)+"--"+this._getTimeStamp()+"--"+(this._status.option.type||"video"),this._status.startTime=this._getTimeStamp();var i=["video/mp4;codecs=opus","video/webm","video/webm;codecs=h264","video/x-matroska;codecs=opus","video/invalid"];return"audio"===r.type&&(i=["audio/wav","audio/ogg","audio/pcm","audio/webm"]),(this._status.mimeType=this._validation(i)[0])?this._format().then(function(){return e._start()}).catch(function(e){var t=Object.assign({event:e},c.VideoRecordErrorCode.RecordFormatError);return Promise.reject(t)}):Promise.reject(c.VideoRecordErrorCode.RecordBrowserNotSupportFormat)}},{key:"stop",value:function(e){var t=this;return this._status.isRecording&&this._recorder?"started"!==this._status.state?(this.adapterRef.logger.warn("MediaRecordHelper: record stopping when "+this._recorder.state),Promise.resolve()):(this._status.state="stopped",this._status.recordStatus="stopping",new Promise(function(r,i){t._status.fileName=e||t._status.fileName,t._recorder.onstop=function(){t._onStop(r)},t._recorder.stop()})):Promise.reject(c.VideoRecordErrorCode.RecordNotExist)}},{key:"play",value:function(e){return"stopped"!==this._status.state?(this.adapterRef.logger.warn("MediaRecordHelper: record stopping when "+this._recorder.state),Promise.resolve()):this._play(e)}},{key:"download",value:function(e){var t=this;return Promise.resolve().then(function(){return t._status.isRecording?(t.adapterRef.logger.warn("MediaRecordHelper: download: 正在录制中，立即停止..."),t.stop()):Promise.resolve()}).then(function(){if(t._status.recordUrl){var r=document.createElement("a");document.body.appendChild(r),r.style="display: none",r.href=t._status.recordUrl,r.download=(e||t._status.fileName||t._getTimeStamp())+".webm",r.click(),window.URL.revokeObjectURL(t._status.recordUrl),t._status.recordUrl=null,t._status.recordStatus="downloaded"}else t.adapterRef.logger.warn("MediaRecordHelper: download: cannot download media without url ...");return Promise.resolve(t._status)})}},{key:"clean",value:function(){var e=this;return Promise.resolve().then(function(){return e._status.isRecording&&e._recorder?e.stop():Promise.resolve()}).then(function(){return e._status.recordUrl&&(window.URL.revokeObjectURL(e._status.recordUrl),e._status.recordUrl=null),e._destroy(),e._status.recordStatus="init",Promise.resolve()})}},{key:"leave",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{uid:0};if(!this._status.isRecording||!this._recorder)return Promise.resolve();var t=e.uid;return t&&this._status.option?t===+this._status.option.uid?this.stop():void 0:Promise.resolve()}},{key:"pause",value:function(){this._recorder&&this._recorder.pause()}},{key:"resume",value:function(){this._recorder&&this._recorder.resume()}},{key:"_reset",value:function(){this._recorder=null,Object.assign(this._status,{recordedChunks:[],isRecording:!1,stream:null,option:null,contentTypes:[],mimeType:"",audioController:null,opStream:null,state:"init",timer:null,fileName:null,recordId:0,recordStatus:"init",recordUrl:null,startTime:null,endTime:null})}},{key:"_getTimeStamp",value:function(){return parseInt(Date.now()/1e3)}},{key:"_validation",value:function(e){return e.filter(function(e){return MediaRecorder.isTypeSupported(e)})}},{key:"_format",value:function(){var e=this,t=this._status.stream,r=this._status.option;return new Promise(function(i,a){var n=new MediaStream;return e._matchLocalStreamConstructor(t.constructor)&&(t=[t]),Array.isArray(t)?"audio"===r.type?(e._status.audioController=new d.WebAudio({stream:t,uid:r.uid}),e._status.opStream=e._status.audioController.outputStream,i()):(t.forEach(function(t){t&&e._matchLocalStreamConstructor(t.constructor)&&t.getTracks().forEach(function(e){n.addTrack(e)})}),0===n.getTracks().length?a(c.VideoRecordErrorCode.RecordNoStream):(e._status.opStream=n,void i())):a(c.CommonErrorCode.ParamError)})}},{key:"_matchLocalStreamConstructor",value:function(e){return/(LocalMediaStream|MediaStream)/.test(e)}},{key:"_start",value:function(){var e=this,t={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:this._status.mimeType},r=this._recorder=new MediaRecorder(this._status.opStream,t);return r.ondataavailable=this._onDataAvailable.bind(this),r.onstop=function(){e.adapterRef.logger.log("MediaRecordHelper: _start: record stop automatically ..."),e._onStop()},this._status.isRecording=!0,this._status.state="started",this._status.recordId+=1,this._status.recordStatus="starting",this._recorder.start(),this._clearTimer(),this._startTimer(),Promise.resolve(this._status.option)}},{key:"_startTimer",value:function(){var e=this;this._status.timer||(this._status.timer=setInterval(function(){e.adapterRef.logger.log("MediaRecordHelper: startTimer: "+(new Date).toLocaleString()+" --\x3e MediaRecorder status: "+e._recorder.state)},5e3))}},{key:"_onStop",value:function(e){this.adapterRef.logger.log("MediaRecordHelper: _onStop: record stoped !!!"),this._clearTimer(),this._status.recordStatus="stopped",this._status.endTime=this._getTimeStamp();var t=new Blob(this._status.recordedChunks,{type:this._status.mimeType});this._status.recordUrl=URL.createObjectURL(t),this.emit("stop",this.getRecordStatus()),this._destroy(),e&&e()}},{key:"_play",value:function(e){var t=null;return-1!=this._status.mimeType.indexOf("audio")?t=document.createElement("audio"):-1!=this._status.mimeType.indexOf("audio")&&(t=document.createElement("video"),videoDom.autoplay="autoplay"),e.appendChild(t),t.src=null,t.srcObject=null,t.src=this._status.recordUrl,t.controls=!1,t.play(),Promise.resolve(this._status.option)}},{key:"_destroy",value:function(){this._status.audioController&&this._status.audioController.destroy(),this._clearTimer(),this._recorder=null,Object.assign(this._status,{stream:null,recordedChunks:[],isRecording:!1,audioController:null,status:"init"})}},{key:"_clearTimer",value:function(){clearInterval(this._status.timer),this._status.timer=null}},{key:"_onDataAvailable",value:function(e){if(this._status.recordStatus="recording",this.adapterRef.logger.log("MediaRecordHelper: ondataavailable: data received"),!(e.data.size>0))return this.stop(),Promise.reject(c.VideoErrorCode.RecordStreamInvalid);this._status.recordedChunks.push(e.data)}},{key:"checkIsRecording",value:function(){return this._status.isRecording}},{key:"getRecordStatus",value:function(){return Object.assign({id:this._status.recordId,type:this._status.mimeType,name:this._status.fileName,status:this._status.recordStatus,isRecording:this._status.isRecording,startTime:this._status.startTime,endTime:this._status.endTime},this._status.option)}}]),t}(s.EventEmitter);t.MediaRecordHelper=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaDeviceHelper=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(17),c=r(11);function u(e){return e&&e.__esModule?e:{default:e}}var l=(0,d.getGlobal)(),p=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.devicesCache={},r.deviceChangeCheckTimer=null,r._init(),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"_init",value:function(){var e=this;this.adapterRef.logger.log("MediaDeviceHelper:_init"),this._getDevices(function(t){e.devicesCache=e._transformDeviceData(t),e._registerDeviceChangeEvent()},function(t){e.adapterRef.logger.error("MediaDeviceHelper:_init 获取可用设备列表失败：",t)})}},{key:"_registerDeviceChangeEvent",value:function(){this.adapterRef.logger.log("MediaDeviceHelper:_registerDeviceChangeEvent"),navigator.mediaDevices.ondevicechange=this._onDeviceChangeHandler.bind(this)}},{key:"_onDeviceChangeHandler",value:function(e){var t=this;this.adapterRef.logger.log("MediaDeviceHelper:_onDeviceChangeHandler"),this.deviceChangeCheckTimer&&(l.clearTimeout(this.deviceChangeCheckTimer),this.deviceChangeCheckTimer=null);var r=Object.assign({},this.devicesCache);this.deviceChangeCheckTimer=l.setTimeout(function(){t._getDevices(function(e){t.devicesCache=t._transformDeviceData(e),t.emit("deviceStatus",t.devicesCache),t._filterDeviceChange(t.devicesCache,r)},function(e){t.adapterRef.logger.error("MediaDeviceHelper:_onDeviceChangeHandler 获取可用设备列表失败：",e)})},500)}},{key:"_filterDeviceChange",value:function(e,t){var r=function(e){var t={};return Object.keys(e).forEach(function(r){e[r].forEach(function(e){t[r+e.deviceId]=Object.assign({},e,{type:r})})}),t},i=r(e),a=r(t),n=Object.keys(i),o=Object.keys(a);if(n.length>o.length){var s=[];n.forEach(function(e){-1===o.indexOf(e)&&s.push(i[e])}),s.length&&this.emit("deviceAdd",s)}else{var d=[];o.forEach(function(e){-1===n.indexOf(e)&&d.push(a[e])}),d.length&&this.emit("deviceRemove",d)}}},{key:"_getDevices",value:function(e,t){if(this.adapterRef.logger.log("MediaDeviceHelper:_getDevices 开始获取设备列表"),!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){return this.adapterRef.logger.warn("enumerateDevices 接口不支持"),void t("enumerateDevices 接口不支持")}navigator.mediaDevices.enumerateDevices().then(e).catch(t)}},{key:"_transformDeviceData",value:function(e){this.adapterRef.logger.log("MediaDeviceHelper:_transformDeviceData 转换设备列表");var t={video:[],audioIn:[],audioOut:[]};return 0===e.length?t:(e.forEach(function(e){var r=void 0;switch(e.kind){case"videoinput":r={deviceId:e.deviceId,label:e.label?e.label:"camera "+(t.video.length+1)},t.video.push(r);break;case"audioinput":r={deviceId:e.deviceId,label:e.label?e.label:"microphone "+(t.audioIn.length+1)},t.audioIn.push(r);break;case"audiooutput":r={deviceId:e.deviceId,label:e.label?e.label:"speaker "+(t.audioOut.length+1)},t.audioOut.push(r)}}),t)}},{key:"getDevicesOfType",value:function(e){var t=this;return new Promise(function(r,i){t._getDevices(function(i){var a=t._transformDeviceData(i);void 0===e&&r(a),r(a[e])},function(e){var r=Object.assign({event:e},c.DeviceErrorCode.DeviceNotAvailable);t.adapterRef.logger.error("MediaDeviceHelper:getDevicesOfType 获取可用设备列表失败：",r),i(r)})})}},{key:"getDeviceStatus",value:function(){var e={hasAudioDevice:!1,hasVideoDevice:!1};return this.devicesCache&&(this.devicesCache.audioIn&&this.devicesCache.audioIn.length>0&&(e.hasAudioDevice=!0),this.devicesCache.video&&this.devicesCache.video.length>0&&(e.hasVideoDevice=!0)),e}},{key:"destroy",value:function(){this.adapterRef.logger.log("MediaDeviceHelper:destory"),this.devicesCache&&(this.devicesCache={}),this.deviceChangeCheckTimer&&(l.clearTimeout(this.deviceChangeCheckTimer),this.deviceChangeCheckTimer=null)}}]),t}(s.EventEmitter);t.MediaDeviceHelper=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC2GateWayProtocolHandler=void 0;var i=o(r(1)),a=o(r(2)),n=r(11);function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){(0,i.default)(this,e)}return(0,a.default)(e,[{key:"pack",value:function(e,t){switch(e){case n.WEBRTC2_GATE_WAY_API.login_req.key:return Object.assign(n.CLIENT_LOGIN_OF_WEBRTC2,t);case n.WEBRTC2_GATE_WAY_API.keep_alive.key:return Object.assign(n.KEEP_ALIVE_OF_WEBRTC2,t);case n.WEBRTC2_GATE_WAY_API.user_pub.key:return Object.assign(n.USER_PUB_WEBRTC2,t);case n.WEBRTC2_GATE_WAY_API.user_sub.key:return Object.assign(n.USER_SUB_WEBRTC2,t);case n.WEBRTC2_GATE_WAY_API.logout.key:return Object.assign(n.LOGOUT_OF_WEBRTC2,t);default:return null}}},{key:"unpack",value:function(e){try{e=JSON.parse(e)}catch(e){return console.warn(e),null}switch(e.cmd_type){case n.WEBRTC2_GATE_WAY_API.login_ack.key:return Object.assign(n.LOGIN_ACK_OF_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.keep_alive_ack.key:return Object.assign(n.KEEP_ALIVE_ACK_OF_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.pub_ack.key:return Object.assign(n.PUB_ACK_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.sub_ack.key:return Object.assign(n.SUB_ACK_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.user_asl_sub_ack.key:return Object.assign(n.USER_ASL_SUB_ACK_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.user_update.key:return Object.assign(n.USER_UPDATE_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.media_update.key:return Object.assign(n.MEDIA_UPDATE_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.sub_source.key:return Object.assign(n.SUB_SOURCE_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.ssrc_update.key:return Object.assign(n.SSRC_UPDATE_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.mute_update.key:return Object.assign(n.MUTE_UPDATE_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.user_pub.key:return Object.assign(n.USER_PUB_WEBRTC2,e);case n.WEBRTC2_GATE_WAY_API.channel_state.key:return Object.assign(n.CHANNEL_STATE_WEBRTC2,e);default:return null}}}]),e}();t.WebRTC2GateWayProtocolHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(467);Object.defineProperty(t,"WebRTC2GateWayProtocolHandler",{enumerable:!0,get:function(){return i.WebRTC2GateWayProtocolHandler}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractGateWayManager=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(17),c=r(220);function u(e){return e&&e.__esModule?e:{default:e}}var l=(0,d.getGlobal)(),p=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=e.url,o=e.context,s=e.keepAliveInterval4Second;return r.reset(),r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.gateway=new c.WebRTC2GateWay({url:a,protocolHandler:new c.WebRTC2GateWayProtocolHandler,adapterRef:r.adapterRef,sdkRef:r.sdkRef}),r.context=o,r.keepAliveInterval4Second=s||5,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"reset",value:function(){this.gateway=null,this.context=null,this.state={hasLogined:!1},this.cmd={lastCmd:null},this.keepAliveInterval4Second=5,this.keepAliveTimer=null,this.keepAliveTimer&&(l.clearTimeout(this.keepAliveTimer),this.keepAliveTimer=null)}},{key:"setState",value:function(e){var t=e.hasLogined,r=e.waiting4Message;void 0!==t&&(this.state.hasLogined=t),void 0!==r&&(this.state.waiting4Message=r)}},{key:"startKeepAliveTimer",value:function(){this.adapterRef.logger.log("AbstractGateWayManager:startKeepAliveTimer "),this.keepAliveTimer&&this.stopKeepAliveTimer(),this.doSendKeepAliveTask()}},{key:"stopKeepAliveTimer",value:function(){this.adapterRef.logger.log("AbstractGateWayManager:stopKeepAliveTimer "),this.keepAliveTimer&&(l.clearTimeout(this.keepAliveTimer),this.keepAliveTimer=null)}},{key:"doSendKeepAliveTask",value:function(){this.adapterRef.logger.error("AbstractGateWayManager: 心跳包发送逻辑未在子类实现")}},{key:"destroy",value:function(){this.adapterRef.logger.log("AbstractGateWayManager:destroy"),this.gateway&&(this.gateway.destroy(),this.reset())}}]),t}(s.EventEmitter);t.AbstractGateWayManager=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC2GateWayManager=void 0;var i=f(r(1)),a=f(r(2)),n=f(r(4)),o=f(r(84)),s=f(r(3)),d=r(469),c=r(11),u=r(265),l=r(17),p=r(28);function f(e){return e&&e.__esModule?e:{default:e}}var h=(0,l.getGlobal)(),m=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.sdkRef=e.sdkRef,r.connectResolve=e.connectResolve,r.connectReject=e.connectReject,r.adapterRef=e.adapterRef,r.codecState={},r._bindGateWayEvent(),r}return(0,s.default)(t,e),(0,a.default)(t,[{key:"_bindGateWayEvent",value:function(){this.gateway.on("open",this.doSendClientLogin.bind(this)),this.gateway.on("message",this._handleMessage.bind(this)),this.gateway.on("close",this._handleClose.bind(this)),this.gateway.on("error",this._handleError.bind(this))}},{key:"_unbindGateWayEvent",value:function(){this.gateway.removeListener("open",this.doSendClientLogin.bind(this)),this.gateway.removeListener("message",this._handleMessage.bind(this)),this.gateway.removeListener("close",this._handleClose.bind(this)),this.gateway.removeListener("error",this._handleError.bind(this))}},{key:"_handleMessage",value:function(e){e.cmd_type,c.WEBRTC2_GATE_WAY_API.keep_alive_ack.key;switch(e.cmd_type){case c.WEBRTC2_GATE_WAY_API.login_ack.key:if(this.adapterRef.logger.log("网关登录回包: ",JSON.stringify(e,null," ")),this.adapterRef.imInfo&&this.adapterRef.imInfo.uid&&this.adapterRef.imInfo.uid!=e.externalid)return;if(0!=e.result)return this.setState({hasLogined:!1}),void this.emit("login",{success:!1});this.adapterRef.logger.log("WebRTC2GateWayManager: _handleMessage: 登录成功，设置状态"),this.context.cid=this.adapterRef.imInfo.cid=e.cid,this.context.userid=this.adapterRef.imInfo.userid=e.userid,this.context.record=this.adapterRef.imInfo.record=e.record,this.context.aslmode=this.adapterRef.imInfo.aslmode=e.aslmode,this.setState({hasLogined:!0}),this.startKeepAliveTimer(),this.emit("login",{success:!0}),this.connectResolve&&(this.connectResolve(),this.connectResolve=null);break;case c.WEBRTC2_GATE_WAY_API.user_update.key:this.adapterRef.logger.log("成员更新消息: ",JSON.stringify(e,null," ")),this.emit("userUpdate",{cid:e.cid,updatetype:e.updatetype,users:e.users});break;case c.WEBRTC2_GATE_WAY_API.media_update.key:this.adapterRef.logger.log("成员媒体更新消息: ",JSON.stringify(e,null," ")),this.emit("mediaUpdate",{cid:e.cid,users:e.users});break;case c.WEBRTC2_GATE_WAY_API.sub_source.key:this.adapterRef.logger.log("订阅指定质量视频更新消息: ",JSON.stringify(e,null," ")),this.emit("subSource",e);break;case c.WEBRTC2_GATE_WAY_API.ssrc_update.key:this.adapterRef.logger.log("接收者分辨率切换更新消息: ",JSON.stringify(e,null," ")),this.emit("ssrcUpdate",e);break;case c.WEBRTC2_GATE_WAY_API.mute_update.key:this.adapterRef.logger.log("接收者分辨率切换更新消息: ",JSON.stringify(e,null," ")),this.emit("muteUpdate",e);break;case c.WEBRTC2_GATE_WAY_API.pub_ack.key:this.adapterRef.logger.log("pub_ack消息: ",JSON.stringify(e,null," ")),this.emit("userPubAck",{cid:e.cid,sid:e.sid,sdp:e.sdp});break;case c.WEBRTC2_GATE_WAY_API.sub_ack.key:this.adapterRef.logger.log("sub_ack消息回包: ",JSON.stringify(e,null," ")),this.emit("userSubAck",{cid:e.cid,userid:e.userid,sid:e.sid,deviceid:e.deviceid,sdp:e.sdp});break;case c.WEBRTC2_GATE_WAY_API.user_pub.key:this.adapterRef.logger.log("收到user_pub 消息包: ",JSON.stringify(e,null," ")),this.emit("userPub",{cid:e.cid,userid:e.userid,negotype:e.negotype,devices:e.devices,sdp:e.sdp})}}},{key:"_handleClose",value:function(e){this.emit("close",e)}},{key:"_handleError",value:function(e){this.emit("error",e)}},{key:"doSendKeepAliveTask",value:function(){var e=this;this.context&&this.context.userid&&this.context.cid?this.keepAliveTimer=h.setTimeout(function(){e.state&&e.state.hasLogined&&e.doSendKeepAlive()},1e3*this.keepAliveInterval4Second):this.adapterRef.logger.error("WebRTC2GateWayManager:doSendKeepAliveTask 上下文字段不存在")}},{key:"doSendClientLogin",value:function(){if(!this.state||!this.state.hasLogined){this.cmd.lastCmd=c.WEBRTC2_GATE_WAY_API.login_req.key,p.WebrtcUtil.isSupportVp8Only().then(function(){});var e={externalid:this.adapterRef.imInfo.uid,cid:h.channelName,subtype:"select",role:"presenter",username:this.context.username,token:"a1266611da6dfb6fc59bc03df11ebdbd",version:this.context.version,roomname:this.context.roomname,sessionmode:this.context.sessionmode,engineversion:this.context.engineversion,usertype:this.context.usertype,aslmode:this.context.aslmode,rtmp:this.context.rtmp,record:this.context.record,browser:this.context.browser},t=new u.WebRTC2GateWayContext(e),r=this.gateway.protocolHandler.pack(c.WEBRTC2_GATE_WAY_API.login_req.key,t),i=this.gateway.send(r);if(i.code!==c.GATE_WAY_RESPONSE_CODE.OK)return this.adapterRef.logger.error("WebRTC2GateWayManager:doSendClientLogin:send fail, code=%s",i.code),void this.setState({hasLogined:!1});this.adapterRef.logger.log("WebRTC2GateWayManager:doSendClientLogin:send success")}}},{key:"doSendUserPub",value:function(e){if(this.state&&this.state.hasLogined){this.cmd.lastCmd=c.WEBRTC2_GATE_WAY_API.user_pub.key;var t={cid:this.context.cid,userid:this.context.userid,negotype:e.negotype||"0",sdp:e.sdp,devices:e.devices},r=this.gateway.protocolHandler.pack(c.WEBRTC2_GATE_WAY_API.user_pub.key,t);this.adapterRef.logger.log("WebRTC2GateWayManager:doSendUserPub -> ",r);var i=this.gateway.send(r);if(i.code!==c.GATE_WAY_RESPONSE_CODE.OK)return this.adapterRef.logger.error("WebRTC2GateWayManager:doSendUserPub:send fail, code=%s",i.code),void this.setState({hasLogined:!1});this.adapterRef.logger.log("WebRTC2GateWayManager:doSendUserPub:send success")}}},{key:"doSendUserSub",value:function(e){if(this.state&&this.state.hasLogined){this.cmd.lastCmd=c.WEBRTC2_GATE_WAY_API.user_sub.key;var t={cid:this.context.cid,userid:this.context.userid,sid:e.sid,negotype:e.negotype||"0",sdp:e.sdp,devices:e.devices},r=this.gateway.protocolHandler.pack(c.WEBRTC2_GATE_WAY_API.user_sub.key,t);this.adapterRef.logger.log("WebRTC2GateWayManager:doSendUserSub -> ",r);var i=this.gateway.send(r);if(i.code!==c.GATE_WAY_RESPONSE_CODE.OK)return this.adapterRef.logger.error("WebRTC2GateWayManager:doSendUserSub:send fail, code=%s",i.code),void this.setState({hasLogined:!1});this.adapterRef.logger.log("WebRTC2GateWayManager:doSendUserSub:send success")}}},{key:"subResolution",value:function(e){if(this.state&&this.state.hasLogined){this.cmd.lastCmd=c.WEBRTC2_GATE_WAY_API.user_sub.key;var t={cid:this.context.cid,userid:this.context.userid,sid:data.sid,negotype:data.negotype||"0",sdp:data.sdp,devices:data.devices},r=this.gateway.protocolHandler.pack(c.WEBRTC2_GATE_WAY_API.user_sub.key,t);this.adapterRef.logger.log("WebRTC2GateWayManager:doSendUserSub -> ",r);var i=this.gateway.send(r);if(i.code!==c.GATE_WAY_RESPONSE_CODE.OK)return this.adapterRef.logger.error("WebRTC2GateWayManager:doSendUserSub:send fail, code=%s",i.code),void this.setState({hasLogined:!1});this.adapterRef.logger.log("WebRTC2GateWayManager:doSendUserSub:send success")}}},{key:"doSendKeepAlive",value:function(){var e={userid:this.context.userid,cid:this.context.cid},t=this.gateway.protocolHandler.pack(c.WEBRTC2_GATE_WAY_API.keep_alive.key,e),r=this.gateway.send(t);r.code!==c.GATE_WAY_RESPONSE_CODE.OK&&this.adapterRef.logger.warn("WebRTC2GateWayManager:doSendKeepAlive:send fail, code=%s",r.code)}},{key:"doSendLogout",value:function(){var e={userid:this.context.userid,cid:this.context.cid,reason:"0"},t=this.gateway.protocolHandler.pack(c.WEBRTC2_GATE_WAY_API.logout.key,e),r=this.gateway.send(t);return r.code!==c.GATE_WAY_RESPONSE_CODE.OK?(this.adapterRef.logger.error("WebRTC2GateWayManager:doSendLogout:send fail, code=%s",r.code),Promise.resolve()):(this.adapterRef.logger.warn("WebRTC2GateWayManager:doSendLogout:send success"),this.setState({hasLogined:!1}),this.stopKeepAliveTimer(),Promise.resolve())}},{key:"destroy",value:function(){this.adapterRef.logger.log("WebRTC2GateWayManager:destroy"),this._unbindGateWayEvent(),(0,o.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(d.AbstractGateWayManager);t.WebRTC2GateWayManager=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC2GateWay=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(11),c=r(220);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.reset();var a=e.url,o=e.protocolHandler;return r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.protocolHandler=o,r.initSocket(a),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"reset",value:function(){this.protocolHandler=null,this.url="",this.ws=null,this.inited=!1}},{key:"initSocket",value:function(e){/^wss:\/\//.test(e),this.url=e,this.ws=new WebSocket(e);var t=this.ws;t.onopen=this.onOpen.bind(this),t.onmessage=this.onMessage.bind(this),t.onclose=this.onClose.bind(this),t.onerror=this.onError.bind(this)}},{key:"onOpen",value:function(e){this.adapterRef.logger.log("WebRTC2GateWay:onOpen"),this.inited=!0,this.emit("open",e)}},{key:"onMessage",value:function(e){var t=e.data;this.protocolHandler.constructor===c.WebRTC2GateWayProtocolHandler&&t.indexOf("sdp")>0&&(window.event=e,t=e.data.replace(/([\w ":,\.\*=]*)([\r\n]+)/g,"$1\\n"));var r=this.protocolHandler.unpack(t);null!=r?this.emit("message",r):this.adapterRef.logger.error("WebRTC2GateWay:解包数据为空")}},{key:"onClose",value:function(e){this.adapterRef.logger.log("WebRTC2GateWay:onClose <- ",e),this.emit("close",e)}},{key:"onError",value:function(e){this.adapterRef.logger.log("WebRTC2GateWay:onError <- ",e),this.emit("error",e)}},{key:"send",value:function(e){var t=JSON.stringify(e);return this.protocolHandler.constructor===c.WebRTC2GateWayProtocolHandler&&e.type!==d.WEBRTC_GATE_WAY_API.keep_alive.key&&t.indexOf("sdp")>0&&(window.message=t,t=t.replace(/([\w ":,\.\*=]*)\\r\\n/g,"$1\n")),this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ws.send(t),{code:d.GATE_WAY_RESPONSE_CODE.OK}):(this.adapterRef.logger.log("WebRTC2GateWay:send: 当前不能发送，等待ws连接成功之后发送"),{code:d.GATE_WAY_RESPONSE_CODE.NO_CONNECTION})}},{key:"close",value:function(){this.adapterRef.logger.log("WebRTC2GateWay:close"),this.ws&&this.ws.close()}},{key:"destroy",value:function(){this.adapterRef.logger.log("WebRTC2GateWay:destroy"),this.protocolHandler=null,this.url=null,this.ws.onopen=null,this.ws.onmessage=null,this.ws.onclose=null,this.ws.onerror=null,this.ws=null}}]),t}(s.EventEmitter);t.WebRTC2GateWay=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCGateWayProtocolHandler=void 0;var i=c(r(1)),a=c(r(2)),n=c(r(4)),o=c(r(3)),s=r(266),d=r(11);function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){return(0,i.default)(this,t),(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,o.default)(t,e),(0,a.default)(t,[{key:"pack",value:function(e,t){switch(e){case d.WEBRTC_GATE_WAY_API.client_login.key:return this.generateClientLoginPackData(t);case d.WEBRTC_GATE_WAY_API.sdp_offer.key:return this.generateSdpOfferPackData(t);case d.WEBRTC_GATE_WAY_API.ice_offer.key:return this.generateIceOfferPackData(t);case d.WEBRTC_GATE_WAY_API.keep_alive.key:return this.generateKeepAlivePackData(t);case d.WEBRTC_GATE_WAY_API.sdp_update.key:return this.genearateSdkUpdatePackData(t);case d.WEBRTC_GATE_WAY_API.logout.key:return this.generateLogoutPackData(t);default:return null}}},{key:"unpack",value:function(e){try{e=JSON.parse(e)}catch(e){return console.warn(e),null}switch(e.type){case d.WEBRTC_GATE_WAY_API.login_ack.key:return this.parseLoginAckPackData(e);case d.WEBRTC_GATE_WAY_API.sdp_answer.key:return this.parseSdpAnswerPackData(e);case d.WEBRTC_GATE_WAY_API.ice_answer.key:return this.parseIceAnswerPackData(e);case d.WEBRTC_GATE_WAY_API.keep_alive_ack.key:return this.parseKeepAliveAckPackData(e);case d.WEBRTC_GATE_WAY_API.client_join.key:return this.parseClientJoinPackData(e);case d.WEBRTC_GATE_WAY_API.client_update.key:return this.parseClientUpdatePackData(e);case d.WEBRTC_GATE_WAY_API.client_logout.key:return this.parseClientLogoutPackData(e);case d.WEBRTC_GATE_WAY_API.client_error.key:return this.parseClientErrorPackData(e);case d.WEBRTC_GATE_WAY_API.detect_network.key:return this.parseDetectNetworkResultPackData(e);default:return null}}},{key:"generateClientLoginPackData",value:function(e){return Object.assign(d.CLIENT_LOGIN_OF_WEBRTC,e)}},{key:"generateSdpOfferPackData",value:function(e){return Object.assign(d.SDP_OFFER_OF_WEBRTC,e)}},{key:"generateIceOfferPackData",value:function(e){return Object.assign(d.ICE_OFFER_OF_WEBRTC,e)}},{key:"generateKeepAlivePackData",value:function(e){return Object.assign(d.KEEP_ALIVE_OF_WEBRTC,e)}},{key:"genearateSdkUpdatePackData",value:function(e){return Object.assign(d.SDP_UPDATE_OF_WEBRTC,e)}},{key:"generateLogoutPackData",value:function(e){return Object.assign(d.LOGOUT_OF_WEBRTC,e)}},{key:"parseLoginAckPackData",value:function(e){return Object.assign(d.LOGIN_ACK_OF_WEBRTC,e)}},{key:"parseClientJoinPackData",value:function(e){return Object.assign(d.CLIENT_JOIN_OF_WEBRTC,e)}},{key:"parseClientUpdatePackData",value:function(e){return Object.assign(d.CLIENT_UPDATE_OF_WEBRTC,e)}},{key:"parseKeepAliveAckPackData",value:function(e){return Object.assign(d.KEEP_ALIVE_ACK_OF_WEBRTC,e)}},{key:"parseSdpAnswerPackData",value:function(e){return Object.assign(d.SDP_ANSWER_OF_WEBRTC,e)}},{key:"parseIceAnswerPackData",value:function(e){return Object.assign(d.ICE_ANSWER_OF_WEBRTC,e)}},{key:"parseClientLogoutPackData",value:function(e){return Object.assign(d.CLIENT_LOGOUT_OF_WEBRTC,e)}},{key:"parseClientErrorPackData",value:function(e){return Object.assign(d.CLIENT_ERROR_OF_WEBRTC,e)}},{key:"parseDetectNetworkResultPackData",value:function(e){return Object.assign(d.CLIENT_DETECT_NETWORK_RESULT_WEBRTC,e)}}]),t}(s.AbstractProtocolHandler);t.WebRTCGateWayProtocolHandler=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(266);Object.defineProperty(t,"AbstractProtocolHandler",{enumerable:!0,get:function(){return i.AbstractProtocolHandler}});var a=r(472);Object.defineProperty(t,"WebRTCGateWayProtocolHandler",{enumerable:!0,get:function(){return a.WebRTCGateWayProtocolHandler}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractGateWayManager=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(17),c=r(221);function u(e){return e&&e.__esModule?e:{default:e}}var l=(0,d.getGlobal)(),p=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=e.url,o=e.context,s=e.keepAliveInterval4Second;return r.reset(),r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.gateway=new c.WebRTCGateWay({url:a,protocolHandler:new c.WebRTCGateWayProtocolHandler,adapterRef:r.adapterRef,sdkRef:r.sdkRef}),r.context=o,r.keepAliveInterval4Second=s||5,r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"reset",value:function(){this.gateway=null,this.context=null,this.state={hasLogined:!1},this.cmd={lastCmd:null},this.keepAliveInterval4Second=5,this.keepAliveTimer=null,this.keepAliveTimer&&(l.clearTimeout(this.keepAliveTimer),this.keepAliveTimer=null)}},{key:"setState",value:function(e){var t=e.hasLogined,r=e.waiting4Message;void 0!==t&&(this.state.hasLogined=t),void 0!==r&&(this.state.waiting4Message=r)}},{key:"startKeepAliveTimer",value:function(){this.adapterRef.logger.log("AbstractGateWayManager:startKeepAliveTimer "),this.keepAliveTimer&&this.stopKeepAliveTimer(),this.doSendKeepAliveTask()}},{key:"stopKeepAliveTimer",value:function(){this.adapterRef.logger.log("AbstractGateWayManager:stopKeepAliveTimer "),this.keepAliveTimer&&(l.clearTimeout(this.keepAliveTimer),this.keepAliveTimer=null)}},{key:"doSendKeepAliveTask",value:function(){this.adapterRef.logger.error("AbstractGateWayManager: 心跳包发送逻辑未在子类实现")}},{key:"destroy",value:function(){this.adapterRef.logger.log("AbstractGateWayManager:destroy"),this.gateway&&(this.gateway.destroy(),this.reset())}}]),t}(s.EventEmitter);t.AbstractGateWayManager=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCGateWayManager=void 0;var i=f(r(1)),a=f(r(2)),n=f(r(4)),o=f(r(84)),s=f(r(3)),d=r(474),c=r(11),u=r(267),l=r(17),p=r(28);function f(e){return e&&e.__esModule?e:{default:e}}var h=(0,l.getGlobal)(),m=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.isVp8Only=null,r.codecState={},r._bindGateWayEvent(),r}return(0,s.default)(t,e),(0,a.default)(t,[{key:"_bindGateWayEvent",value:function(){this.gateway.on("open",this.doSendClientLogin.bind(this)),this.gateway.on("message",this._handleMessage.bind(this)),this.gateway.on("close",this._handleClose.bind(this)),this.gateway.on("error",this._handleError.bind(this))}},{key:"_unbindGateWayEvent",value:function(){this.gateway.removeListener("open",this.doSendClientLogin.bind(this)),this.gateway.removeListener("message",this._handleMessage.bind(this)),this.gateway.removeListener("close",this._handleClose.bind(this)),this.gateway.removeListener("error",this._handleError.bind(this))}},{key:"_handleMessage",value:function(e){var t=0,r=null,i=null;switch(e.type){case c.WEBRTC_GATE_WAY_API.login_ack.key:if(this.adapterRef.imInfo&&this.adapterRef.imInfo.uid&&"local"!=this.adapterRef.imInfo.uid&&this.adapterRef.imInfo.uid!=e.uid)return;if(this.adapterRef.logger.log("网关登录回包: ",JSON.stringify(e,null," ")),200!=(t=e.params.auth_res)){this.setState({hasLogined:!1}),this.emit("login",{success:!1,serverCode:t});try{var a=this.adapterRef.imInfo,n=a.cid,o=a.uid,s=a.sessionConfig,d=a.sessionMode,u=a.serverMap,l=a.wssArr,p="",f=function(e){return e.split("?ip=")[1].split(":")[0]};if(l&&l[0]&&l[0].indexOf&&l[0].indexOf("?ip=")&&(p+=f(l[0])),u){var h="string"==typeof u?JSON.parse(u):u;h.webrtcarray&&h.webrtcarray[0]&&h.webrtcarray[0].indexOf("?ip=")>0&&(p=f(h.webrtcarray[0]))}this.adapterRef.instance.commondDatareport("setLogin",{uid:""+o,cid:""+n,meeting_mode:d===c.SESSION_MODE.MEETING?1:0,a_record:s.recordAudio,v_record:s.recordVideo,record_type:s.recordType,host_speaker:s.isHostSpeaker,server_ip:p,time:Date.now(),network:"UNKNOWN",result:t})}catch(e){this.adapterRef.logger.error(e)}return}try{var m=this.adapterRef.imInfo,g=m.cid,v=m.uid,R=m.sessionConfig,_=m.sessionMode,y=m.serverMap,C=m.wssArr,b="",E=function(e){return e.split("?ip=")[1].split(":")[0]};if(C&&C[0]&&C[0].indexOf&&C[0].indexOf("?ip=")&&(b+=E(C[0])),y){var S="string"==typeof y?JSON.parse(y):y;S.webrtcarray&&S.webrtcarray[0]&&S.webrtcarray[0].indexOf("?ip=")>0&&(b=E(S.webrtcarray[0]))}var T=1==this.adapterRef.reconnectState.startReconnect&&this.adapterRef.webrtcBusiness;this.adapterRef.instance.commondDatareport("setLogin",{uid:""+v,cid:""+g,meeting_mode:_===c.SESSION_MODE.MEETING?1:0,a_record:R.recordAudio,v_record:R.recordVideo,record_type:R.recordType,host_speaker:R.isHostSpeaker,server_ip:b,time:Date.now(),network:"UNKNOWN",result:T?3:0})}catch(e){this.adapterRef.logger.error(e)}this.adapterRef.logger.log("WebRTCGateWayManager: _handleMessage: 登录成功，设置状态"),this.setState({hasLogined:!0}),this.startKeepAliveTimer(),this.emit("login",{success:!0});break;case c.WEBRTC_GATE_WAY_API.sdp_answer.key:if(200!=(t=e.params.auth_res))return void this.emit("sdpAnswer",{success:!1});r=e.params.content,this.emit("sdpAnswer",{success:!0,code:t,dst_id:e.params.dst_id,type:r.type,sdp:r.sdp});break;case c.WEBRTC_GATE_WAY_API.ice_answer.key:r=e.params.content,this.emit("iceAnswer",{dst_id:e.params.dst_id,candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex});break;case c.WEBRTC_GATE_WAY_API.keep_alive_ack.key:this.doSendKeepAliveTask();break;case c.WEBRTC_GATE_WAY_API.client_join.key:i=e.params,this.emit("userJoin",{client_id:i.client_id,has_audio:i.has_audio,has_video:i.has_video,vp8_only:i.vp8_only});break;case c.WEBRTC_GATE_WAY_API.client_update.key:i=e.params,this.emit("userUpdate",{client_id:i.client_id,has_audio:i.has_audio,has_video:i.has_video,vp8_only:i.vp8_only});break;case c.WEBRTC_GATE_WAY_API.client_logout.key:r=e.params.content,this.emit("userLeave",{uid:e.uid,logout_type:r.logout_type,timestamp:r.timestamp});break;case c.WEBRTC_GATE_WAY_API.client_error.key:r=e.params.content,this.emit("clientError",{uid:e.uid,error_code:r.error_code,timestamp:r.timestamp});break;case c.WEBRTC_GATE_WAY_API.detect_network.key:r=e,this.adapterRef.logger.warn("网关反馈网络探测结果, content: ",r),this.emit("detectNetwork",{uid:e.uid,content:r})}}},{key:"_handleClose",value:function(e){this.emit("close",e)}},{key:"_handleError",value:function(e){this.emit("error",e)}},{key:"doSendKeepAliveTask",value:function(){var e=this;this.context&&this.context.browser&&this.context.browser.name&&this.context.browser.version?this.keepAliveTimer=h.setTimeout(function(){e.state&&e.state.hasLogined&&e.doSendKeepAlive({browser:{name:e.context.browser.name,version:e.context.browser.version},params:{content:{timestamp:""+Date.now()}}})},1e3*this.keepAliveInterval4Second):this.adapterRef.logger.error("WebRTCGateWayManager:doSendKeepAliveTask 上下文字段不存在")}},{key:"doSendClientLogin",value:function(){var e=this;if(!this.state||!this.state.hasLogined){this.cmd.lastCmd=c.WEBRTC_GATE_WAY_API.client_login.key;var t={uid:this.context.uid,cid:this.context.cid,hasAudio:this.context.hasAudio,hasVideo:this.context.hasVideo,netDetect:this.context.netDetect,session_mode:this.context.session_mode,params:this.context.params,browser:this.context.browser,bypass_rtmp:this.context.bypass_rtmp,record:this.context.record,et:this.adapterRef.mediaEncryption.algorithm,ek:this.adapterRef.mediaEncryption.secretKey};null===this.isVp8Only?p.WebrtcUtil.isSupportVp8Only().then(function(r){e.adapterRef.logger.log("浏览器支持的codec: ",JSON.stringify(r,null," ")),e.codecState=r,r&&r.vp8&&!r.h264?t.vp8_only=e.isVp8Only=!0:t.vp8_only=e.isVp8Only=!1,e.sendLogin(t)}):(t.vp8_only=this.isVp8Only,this.sendLogin(t))}}},{key:"sendLogin",value:function(e){var t=new u.WebRTCGateWayContext(e),r=this.gateway.protocolHandler.pack(c.WEBRTC_GATE_WAY_API.client_login.key,t),i=this.gateway.send(r);if(i.code!==c.GATE_WAY_RESPONSE_CODE.OK)return this.adapterRef.logger.error("WebRTCGateWayManager:doSendClientLogin:send fail, code=%s",i.code),void this.setState({hasLogined:!1});this.adapterRef.logger.log("WebRTCGateWayManager:doSendClientLogin:send success")}},{key:"doSendSdpOffer",value:function(e){this.cmd.lastCmd=c.WEBRTC_GATE_WAY_API.sdp_offer.key;var t=e.hasAudio,r=e.hasVideo,i=e.session_mode,a=e.params,n=e.browser,o=e.bypass_rtmp,s=e.record,d={uid:this.context.uid,cid:this.context.cid,hasAudio:t||this.context.hasAudio,hasVideo:r||this.context.hasVideo,session_mode:i||this.context.session_mode,params:a,browser:n||this.context.browser,bypass_rtmp:o||this.context.bypass_rtmp,record:s||this.context.record,vp8_only:this.isVp8Only},l=new u.WebRTCGateWayContext(d),p=this.gateway.protocolHandler.pack(c.WEBRTC_GATE_WAY_API.sdp_offer.key,l);this.adapterRef.logger.log("WebRTCGateWayManager:doSendSdpOffer");var f=this.gateway.send(p);f.code===c.GATE_WAY_RESPONSE_CODE.OK?this.adapterRef.logger.log("WebRTCGateWayManager:doSendSdpOffer:send success"):this.adapterRef.logger.error("WebRTCGateWayManager:doSendSdpOffer:send fail, code=%s",f.code)}},{key:"doSendIceOffer",value:function(e){this.cmd.lastCmd=c.WEBRTC_GATE_WAY_API.ice_offer.key;var t=e.params,r={uid:this.context.uid,cid:this.context.cid,params:t},i=new u.WebRTCGateWayContext(r),a=this.gateway.protocolHandler.pack(c.WEBRTC_GATE_WAY_API.ice_offer.key,i),n=this.gateway.send(a);n.code===c.GATE_WAY_RESPONSE_CODE.OK?this.adapterRef.logger.log("WebRTCGateWayManager:doSendIceOffer:send success"):this.adapterRef.logger.error("WebRTCGateWayManager:doSendIceOffer:send fail, code=%s",n.code)}},{key:"doSendSdpUpdate",value:function(e){this.cmd.lastCmd=c.WEBRTC_GATE_WAY_API.sdp_update.key;var t=e.hasAudio,r=e.hasVideo,i=e.session_mode,a=e.params,n=e.browser,o=e.bypass_rtmp,s=e.record,d={uid:this.context.uid,cid:this.context.cid,hasAudio:t||this.context.hasAudio,hasVideo:r||this.context.hasVideo,session_mode:i||this.context.session_mode,params:a,browser:n||this.context.browser,bypass_rtmp:o||this.context.bypass_rtmp,record:s||this.context.record,vp8_only:this.isVp8Only},l=new u.WebRTCGateWayContext(d),p=this.gateway.protocolHandler.pack(c.WEBRTC_GATE_WAY_API.sdp_update.key,l),f=this.gateway.send(p);f.code===c.GATE_WAY_RESPONSE_CODE.OK?this.adapterRef.logger.log("WebRTCGateWayManager:doSendSdpUpdate:send success"):this.adapterRef.logger.error("WebRTCGateWayManager:doSendSdpUpdate:send fail, code=%s",f.code)}},{key:"doSendKeepAlive",value:function(e){var t=e.browser,r=e.params,i={uid:this.context.uid,cid:this.context.cid,browser:t||this.context.browser,params:r},a=new u.WebRTCGateWayContext(i),n=this.gateway.protocolHandler.pack(c.WEBRTC_GATE_WAY_API.keep_alive.key,a),o=this.gateway.send(n);o.code!==c.GATE_WAY_RESPONSE_CODE.OK&&this.adapterRef.logger.warn("WebRTCGateWayManager:doSendKeepAlive:send fail, code=%s",o.code)}},{key:"doSendLogout",value:function(e){var t=e.browser,r=e.params,i={uid:this.context.uid,cid:this.context.cid,browser:t||this.context.browser,params:r},a=new u.WebRTCGateWayContext(i),n=this.gateway.protocolHandler.pack(c.WEBRTC_GATE_WAY_API.logout.key,a),o=this.gateway.send(n);o.code===c.GATE_WAY_RESPONSE_CODE.OK?(this.adapterRef.logger.log("WebRTCGateWayManager:doSendLogout:send success"),this.setState({hasLogined:!1}),this.stopKeepAliveTimer()):this.adapterRef.logger.error("WebRTCGateWayManager:doSendLogout:send fail, code=%s",o.code)}},{key:"destroy",value:function(){this.adapterRef.logger.log("WebRTCGateWayManager:destroy"),this._unbindGateWayEvent(),(0,o.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(d.AbstractGateWayManager);t.WebRTCGateWayManager=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractGateWayContext=void 0;var i,a=r(1),n=(i=a)&&i.__esModule?i:{default:i};t.AbstractGateWayContext=function e(t){(0,n.default)(this,e);var r=t.uid,i=t.cid;this.uid=r,this.cid=i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractGateWay=void 0;var i=u(r(1)),a=u(r(2)),n=u(r(4)),o=u(r(3)),s=r(12),d=r(11),c=r(221);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,i.default)(this,t);var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.reset();var a=e.url,o=e.protocolHandler;return r.sdkRef=e.sdkRef,r.adapterRef=e.adapterRef,r.protocolHandler=o,r.initSocket(a),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"reset",value:function(){this.protocolHandler=null,this.url="",this.ws=null,this.inited=!1}},{key:"initSocket",value:function(e){/^wss:\/\//.test(e)||(e="wss://"+e),this.url=e,this.ws=new WebSocket(e);var t=this.ws;t.onopen=this.onOpen.bind(this),t.onmessage=this.onMessage.bind(this),t.onclose=this.onClose.bind(this),t.onerror=this.onError.bind(this)}},{key:"onOpen",value:function(e){this.adapterRef.logger.log("AbstractGateWay:onOpen"),this.inited=!0,this.emit("open",e)}},{key:"onMessage",value:function(e){var t=this.protocolHandler.unpack(e.data);null!=t?(this.protocolHandler.constructor===c.WebRTCGateWayProtocolHandler&&(t.type,d.WEBRTC_GATE_WAY_API.keep_alive_ack.key),this.emit("message",t)):this.adapterRef.logger.error("AbstractGateWay:解包数据为空")}},{key:"onClose",value:function(e){this.adapterRef.logger.log("AbstractGateWay:onClose <- ",e),this.emit("close",e)}},{key:"onError",value:function(e){this.adapterRef.logger.log("AbstractGateWay:onError <- ",e),this.emit("error",e)}},{key:"send",value:function(e){return this.protocolHandler.constructor===c.WebRTCGateWayProtocolHandler&&(e.type,d.WEBRTC_GATE_WAY_API.keep_alive.key),this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ws.send(JSON.stringify(e)),{code:d.GATE_WAY_RESPONSE_CODE.OK}):(this.adapterRef.logger.log("AbstractGateWay:send: 当前不能发送，等待ws连接成功之后发送"),{code:d.GATE_WAY_RESPONSE_CODE.NO_CONNECTION})}},{key:"close",value:function(){this.adapterRef.logger.log("AbstractGateWay:close"),this.ws&&this.ws.close()}},{key:"destroy",value:function(){this.adapterRef.logger.log("AbstractGateWay:destroy"),this.protocolHandler=null,this.url=null,this.ws.onopen=null,this.ws.onmessage=null,this.ws.onclose=null,this.ws.onerror=null,this.ws=null}}]),t}(s.EventEmitter);t.AbstractGateWay=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCGateWay=void 0;var i=o(r(1)),a=o(r(4)),n=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,n.default)(t,e),t}(r(477).AbstractGateWay);t.WebRTCGateWay=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractAdapter=void 0;var i=h(r(1)),a=h(r(4)),n=h(r(2)),o=h(r(3)),s=r(12),d=r(51),c=r(11),u=r(28),l=r(27),p=r(454),f=r(433);function h(e){return e&&e.__esModule?e:{default:e}}var m=r(423),g=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r._state={system:u.RtcSupport.checkVersion()},r._params={appkey:""},r._reset(),Object.assign(r.adapterRef.tempInfo,{localContainer:e.container||null,remoteContainer:e.remoteContainer||null});var n=e.saveLogs||{};return r.adapterRef.logger=new m({debug:e.debug,prefix:"WEBRTC",isSavedLogs:n.isSavedLogs||!1,useLocalStorage:n.useLocalStorage||!1,maxLogsLines:n.maxLogsLines||5e3,logFilename:n.logFilename||""}),r.adapterRef.chromeId=e.chromeId,r.adapterRef.isPrivateDeployment=!1,r.adapterRef.privateDeploymentConf=null,r.adapterRef.wssArrConf=null,r.adapterRef.debug=e.debug,r.adapterRef.mixAudioConf={index:0},r.adapterRef.mixVideoConf=null,r.adapterRef.mediaEncryption={secretKey:"",algorithm:0},r.adapterRef.nim=e.nim,r.apiList=e.apiList,r.sdkRef=e.ref,r.channelId=null,r.localIP="",r._init(),r}return(0,o.default)(t,e),(0,n.default)(t,null,[{key:"getVideoSessionConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.quality,r=void 0===t?c.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL:t,i=e.frameRate,a=void 0===i?c.VIDEO_QUALITY.CHAT_VIDEO_FRAME_RATE_NORMAL:i,n={},o=null;return o=c.CONFIG_MAP.CURRENT.SDK_TYPE===c.CONFIG_MAP.SDK_TYPE.WEBRTC2?this.videoMap.frame2[r]:this.videoMap.frame[r],n.frameRate=this.videoMap.frameRate[a],n.width=+o.split("x")[0],n.height=+o.split("x")[1],n}},{key:"getDeviceTypeMap",value:function(e){return this.deviceTypeMap[e]}}]),(0,n.default)(t,[{key:"_reset",value:function(){this.apiList=[],this.sdkRef=null,this.adapterRef={},this._resetTempInfo(),this._resetSDK(),this._resetBusiness(),this._resetHelper(),this._resetApi(),this._resetState(),this._resetParams()}},{key:"_resetSDK",value:function(){this.adapterRef.chromeId=null,this.adapterRef.debug=!1,this.adapterRef.nim=null}},{key:"_resetTempInfo",value:function(){this.adapterRef.tempInfo||(this.adapterRef.tempInfo={}),Object.assign(this.adapterRef.tempInfo,{localContainer:null,remoteContainer:null,localViewParams:null,localVideoDisabled:!1,localAudioDisabled:!1,localVideoMuted:!1,localAudioMuted:!1,remoteVideoMuteMap:{},remoteAudioMuteMap:{},joinChannelLiveConfig:{}})}},{key:"_resetBusiness",value:function(){this.adapterRef.webrtcGateWayBusiness=null,this.adapterRef.deviceBusiness=null,this.adapterRef.webrtcBusiness=null}},{key:"_resetHelper",value:function(){this.adapterRef.mediaRecordHelper={}}},{key:"_resetApi",value:function(){this.adapterRef.deviceApi=null,this.adapterRef.playApi=null,this.adapterRef.recordApi=null,this.adapterRef.commonApi=null,this.adapterRef.meeting4NRTCApi=null,this.adapterRef.meeting4WebRTC2Api=null,this.adapterRef.meeting4WebRTCApi=null,this.adapterRef.captureApi=null,this.adapterRef.p2p4WebRTCApi=null}},{key:"_resetState",value:function(){var e=this;this.adapterRef.imInfo={role:c.ROLE_FOR_MEETING.ROLE_PLAYER},this.channelId=null,this.adapterRef.audioHelperMap={},this.adapterRef.audioHelperLocal=null,this.adapterRef.videoHelperMap={},this.adapterRef.localStream=null,this.adapterRef.remoteStreamMap={},this.adapterRef.videoHelperLocal=null,this.adapterRef.signalInited=!1,this.adapterRef.needQueryAccountMap={},this.adapterRef.account4UidMap={},this.adapterRef.uid4AccountMap={},this.adapterRef.isRemoteLeavedWithP2PSessionMode=!1,this.adapterRef.externalid4UseridMap={},this.adapterRef.userid4ExternalidMap={},this.adapterRef.remoteUserSubMap={},this.adapterRef.isCaller=!1,this.adapterRef.calling=!1,this.adapterRef.callee=null,this.adapterRef.channelId=null,this.adapterRef.beCalledUid=null,this.adapterRef.type=null,this.adapterRef.beCalledInfo=null,this.adapterRef.callerInfo=null,this.adapterRef.target={account:null,uid:null},this.adapterRef.callAccepted=!1,this.adapterRef.sessionMode=null,this.adapterRef.state={lastDeviceStatus:{audio:{type:null,device:null},video:{type:null,device:null}},audioDeviceHasOpened:!1,videoDeviceHasOpened:!1,chromeScreenShareOpened:!1,isFirstOpenMediaDevice:!0,rtcConnected:!1,startSessionTime:null,endSessionTime:null},this.adapterRef.detectNetState={inDetecting:!1,stream:null,detectTimer:null,detectDom:null,canvasTimer:null,canvasContainer:null,outTimer:null},this.adapterRef.reconnectState?(this.adapterRef.reconnectState.count=0,this.adapterRef.reconnectState.isReconnect=!1,setTimeout(function(){e.adapterRef.reconnectState&&e.adapterRef.reconnectState.wssTime&&clearInterval(e.adapterRef.reconnectState.wssTime),e.adapterRef.reconnectState.isStoped=!1},300)):this.adapterRef.reconnectState={count:0,isReconnect:!1,startReconnect:!1,isStoped:!1,wssTime:null},this._setSessionConfig()}},{key:"_resetParams",value:function(){Object.assign(this._params,c.ApiParams)}},{key:"_resetParamNeededByReConnect",value:function(){this.adapterRef.webrtcBusiness._destroyRtcSelf(),this._doDestroyRemoteResourceByUid(),this.apiList=[],this.adapterRef.debug=!1,this.adapterRef.webrtcGateWayBusiness.destroy(),this.adapterRef.webrtcGateWayBusiness=null,this.adapterRef.deviceBusiness=null,this.adapterRef.webrtcBusiness=null,this.adapterRef.playApi=null,this.adapterRef.recordApi=null,this.adapterRef.commonApi=null,this.adapterRef.meeting4NRTCApi=null,this.adapterRef.meeting4WebRTC2Api=null,this.adapterRef.meeting4WebRTCApi=null,this.adapterRef.captureApi=null,this.adapterRef.p2p4WebRTCApi=null,this.adapterRef.reconnectState.isReconnect=!1,this.adapterRef.statsReportHelper=null,this.adapterRef.logReportHelper=null}},{key:"_init",value:function(){this._initBindEvents(),this._initBusiness(),this._initHelper(),this._initApi()}},{key:"_initBindEvents",value:function(){var e=this;this.on(c.EVENT_OBJ.leaveChannel.key,function(t){e.adapterRef.logger.log("AbstractAdapter: _initBindEvents: leaveChannel事件");var r=t.account,i=t.uid;i||(i=e._getUidByAccount(r));var a=e.adapterRef.mediaRecordHelper[i];a&&a.checkIsRecording()&&(e.adapterRef.logger.log("AbstractAdapter: _initBindEvents: 对端"+r+"/"+i+"离开：正在录制远端视频，即将停止"),a.stop())}),window.addEventListener("beforeunload",function(t){e.adapterRef.logger.log("AbstractAdapter: _initBindEvents: beforeunload事件");var r=e.adapterRef.mediaRecordHelper;Object.values(r).forEach(function(e){e&&e.checkIsRecording()&&e.download()})})}},{key:"_initBusiness",value:function(){this._initWebRTCGateWayBusiness(),this._initDeviceBusiness(),this._initWebRTCBusiness()}},{key:"_initHelper",value:function(){}},{key:"_initApi",value:function(){this._initDeviceApi(),this._initPlayApi(),this._initRecordApi(),this._initCommonApi(),this._initMeeting4NRTCApi(),this._initMeeting4WebRTC2Api(),this._initCaptureApi(),this._initMeeting4WebRTCApi(),this._initP2P4WebRTCApi()}},{key:"_initWebRTCGateWayBusiness",value:function(){var e=this;if(this.adapterRef.webrtcGateWayBusiness)this.adapterRef.logger.log("AbstractAdapter: _initWebRTCGateWayBusiness: 已存在webrtcGateWayBusiness，不重复创建!");else{this.adapterRef.logger.log("AbstractAdapter:_initWebRTCGateWayBusiness: 初始化webrtcGateWayBusiness");var t=null;c.CONFIG_MAP.CURRENT.SDK_TYPE===c.CONFIG_MAP.SDK_TYPE.WEBRTC2?this.adapterRef.webrtcGateWayBusiness=new p.WebRTC2GateWayBusiness({adapterRef:this.adapterRef,sdkRef:this.sdkRef}):this.adapterRef.webrtcGateWayBusiness=new p.WebRTCGateWayBusiness({adapterRef:this.adapterRef,sdkRef:this.sdkRef}),(t=this.adapterRef.webrtcGateWayBusiness).on(c.EVENT_OBJ.userJoined.key,function(t){e.emit(c.EVENT_OBJ.userJoined.key,Object.assign(c.EVENT_OBJ.userJoined,t)),e.emit("joinChannel",t)}),t.on(c.EVENT_OBJ.userLeft.key,function(t){e.adapterRef.recordApi.stopMediaRecordingByUid(t.uid),e.emit(c.EVENT_OBJ.userLeft.key,Object.assign(c.EVENT_OBJ.userLeft,t)),e.emit("leaveChannel",t)}),t.on(c.EVENT_OBJ.userStateUpdated.key,function(t){e.emit(c.EVENT_OBJ.userStateUpdated.key,Object.assign(c.EVENT_OBJ.userStateUpdated,t)),e.emit("remoteStreamUpdate",t)}),t.on(c.EVENT_OBJ.hangup.key,function(t){t&&t.account?e.emit(c.EVENT_OBJ.hangup.key,t):e.emit(c.EVENT_OBJ.hangup.key,Object.assign(c.EVENT_OBJ.hangup,t,e.getChannelInfo())),e.hangup?e.hangup():e.leaveChannel&&e.leaveChannel()}),t.on(c.EVENT_OBJ.leaveChannel.key,function(t){e.emit(c.EVENT_OBJ.leaveChannel.key,Object.assign(c.EVENT_OBJ.leaveChannel,t,e.getChannelInfo())),e.leaveChannel()}),t.on(c.EVENT_OBJ.gatewayClosed.key,function(t){e.emit(c.EVENT_OBJ.gatewayClosed.key,Object.assign(c.EVENT_OBJ.gatewayClosed,t))}),t.on(c.EVENT_OBJ.error.key,function(t){e.emit(c.EVENT_OBJ.error.key,Object.assign(c.EVENT_OBJ.error,t))})}}},{key:"_initDeviceBusiness",value:function(){this._isWeixinBrowser()&&this.adapterRef.logger.log("是微信浏览器"),this.adapterRef.deviceBusiness?this.adapterRef.logger.log("AbstractAdapter: _initDeviceBusiness: deviceBusiness已存在，不重复创建！"):(this.adapterRef.logger.log("AbstractAdapter: _initDeviceBusiness: 初始化deviceBusiness"),this.adapterRef.deviceBusiness=new p.DeviceBusiness({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_startDevicesByMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.video,r=void 0!==t&&t,i=e.audio,a=void 0!==i&&i,n=e.videoDeviceId,o=e.audioDeviceId,s=e.screen,d=void 0!==s&&s,u=[],l=this.adapterRef.deviceApi;return d&&u.push(l.startDevice({type:c.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN})),r&&u.push(l.startDevice({type:c.DEVICE_TYPE.DEVICE_TYPE_VIDEO,device:{deviceId:n}})),a&&u.push(l.startDevice({type:c.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN,device:{deviceId:o}})),Promise.all(u)}},{key:"_checkDevicePermissionEnabled",value:function(e){return!this.adapterRef.tempInfo.localVideoDisabled||e.type!==c.DEVICE_TYPE.DEVICE_TYPE_VIDEO&&e.type!==c.DEVICE_TYPE.DEVICE_TYPE_DESKTOP_CHROME_SCREEN&&e.type!==c.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_VIDEO?e.type!==c.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN&&e.type!==c.DEVICE_TYPE.DEVICE_TYPE_CUSTOM_AUDIO||!this.adapterRef.tempInfo.localAudioDisabled?Promise.resolve():Promise.reject(c.AudioErrorCode.AudioDisabled):Promise.reject(c.VideoErrorCode.VideoDisabled)}},{key:"_initWebRTCBusiness",value:function(){this.adapterRef.webrtcBusiness?this.adapterRef.logger.log("AbstractAdapter: _initWebRTCBusiness: 已存在的webrtcBusiness对象，不需要重复创建..."):(this.adapterRef.logger.log("AbstractAdapter: _initWebRTCBusiness: 创建webrtcBusiness对象"),c.CONFIG_MAP.CURRENT.SDK_TYPE===c.CONFIG_MAP.SDK_TYPE.WEBRTC2?this.adapterRef.webrtcBusiness=new p.WebRTC2Business({adapterRef:this.adapterRef,sdkRef:this.sdkRef}):this.adapterRef.webrtcBusiness=new p.WebRTCBusiness({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initIMBusiness",value:function(){this.adapterRef.imBusiness?this.adapterRef.logger.log("AbstractAdapter: _initIMBusiness: 已存在的imBusiness, 不重复创建!"):(this.adapterRef.logger.log("AbstractAdapter: _initIMBusiness: 初始化imBusiness"),this.adapterRef.imBusiness=new p.IMBusiness({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_getWebRTCGateWayManager",value:function(){return this.adapterRef.webrtcGateWayBusiness.webRTCGateWayManager}},{key:"_getAudioHelperByUid",value:function(e){e=""+e;var t=""+this.adapterRef.imInfo.uid,r="local"===e||e===t,i=null;return(i=r?this.adapterRef.audioHelperLocal:this.adapterRef.audioHelperMap[e])||(i=new d.AudioHelper({uid:e,isRemote:!r,sdkRef:this.sdkRef,adapterRef:this.adapterRef}),r?this.adapterRef.audioHelperLocal=i:this.adapterRef.audioHelperMap[e]=i),r&&"local"!==e&&this.adapterRef.audioHelperLocal.setUid(e),i}},{key:"_getVideoHelperByUid",value:function(e){e=""+e;var t=""+this.adapterRef.imInfo.uid,r="local"===e||e===t,i=null;return(i=r?this.adapterRef.videoHelperLocal:this.adapterRef.videoHelperMap[e])||(i=new d.VideoHelper({uid:e,sdkRef:this.sdkRef,adapterRef:this.adapterRef}),r?this.adapterRef.videoHelperLocal=i:this.adapterRef.videoHelperMap[e]=i),r&&"local"!==e&&this.adapterRef.videoHelperLocal.setUid(e),i}},{key:"_getVideoHelperByUidWithoutCreate",value:function(e){e=""+e;var t=""+this.adapterRef.imInfo.uid,r="local"===e||e===t,i=null;return i=r?this.adapterRef.videoHelperLocal:this.adapterRef.videoHelperMap[e],r&&"local"!==e&&this.adapterRef.videoHelperLocal.setUid(e),i}},{key:"_startPushVideoStream",value:function(){var e=this._getVideoHelperByUid("local");return e&&e.getLocalVideoStream(!1)?e.startPushLocalVideoStream():Promise.resolve()}},{key:"_stopPushVideoStream",value:function(){var e=this._getVideoHelperByUid("local");return e&&e.getLocalVideoStream(!0)&&e.stopPushLocalVideoStream(),Promise.resolve()}},{key:"_startPushAudioStream",value:function(){var e=this._getAudioHelperByUid("local");return e&&e.getLocalAudioStream(!1)?e.startPushLocalAudioStream():Promise.resolve()}},{key:"_stopPushAudioStream",value:function(){var e=this._getAudioHelperByUid("local");return e&&e.getLocalAudioStream(!0)&&e.stopPushLocalAudioStream(),Promise.resolve()}},{key:"_updateRtc",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.adapterRef.instance._isPlayer();if(!r&&!this.adapterRef.webrtcBusiness.selfWebRtcInstance&&5!=this.adapterRef.instance.SDK_TYPE)return this.adapterRef.logger.warn("AbstractAdapter: _updateRtc: 非互动者并且自己的RTC实例不存在，直接返回..."),Promise.resolve();this.adapterRef.logger.log("AbstractAdapter: _updateRtc: isUpdate=%s ",e),this.selfWebRtcInstance||this.adapterRef.webrtcBusiness._initWebRTCInstance4Self(!0);var i=this.adapterRef.webrtcBusiness.selfWebRtcInstance,a=null,n=null,o=null;if(i&&i.rtcConnection&&i.rtcConnection.currentLocalDescription&&(a=i.rtcConnection.getSenders(),o=i.rtcConnection.videoSender,n=i.rtcConnection.iceConnectionState),a&&a.length>0&&"connected"!==n&&"completed"!==n)this.adapterRef.logger.warn("AbstractAdapter: _updateRtc: update rtc later");else if(u.RtcSystem.browser.safari_12_1()&&"completed"==n&&o&&i.sdpOffer){if(this.adapterRef.logger.log("Safari重新协商video"),t){var s=this._getAudioHelperByUid("local"),d=this._getVideoHelperByUid("local");r?(s&&s.enableDevice(),d&&d.enableDevice()):(s&&s.disableDevice(),d&&d.disableDevice())}var c=i.sdpOffer.sdp;this.adapterRef.state.videoDeviceHasOpened||(c=l.RtcUtil.formatOfferSdpForSafari({sdp:i.sdpOffer.sdp,direction:"recvonly"}));for(var p=c.toString().split("\r\n"),f=0;f<p.length;f++)this.adapterRef.logger.log(p[f]);return this.adapterRef.webrtcBusiness._sendOffer({isUpdate:e,offer:{type:"offer",sdp:c},rtc:i})}return this.adapterRef.logger.log("附加媒体流"),this.adapterRef.webrtcBusiness._updateRtcStream(t),this.adapterRef.webrtcBusiness._createOffer({isUpdate:e})}},{key:"_initDeviceApi",value:function(){this.adapterRef.deviceApi?this.adapterRef.logger.log("AbstractAdapter: _initDeviceApi: deviceApi已初始化，不重复创建!"):(this.adapterRef.logger.log("AbstractAdapter: _initDeviceApi: 初始化deviceApi"),this.adapterRef.deviceApi=new f.DeviceApi({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initPlayApi",value:function(){this.adapterRef.playApi?this.adapterRef.logger.log("AbstractAdapter: _initPlayApi: playApi已初始化，不用重复创建!"):(this.adapterRef.logger.log("AbstractAdapter: _initPlayApi: 初始化playAPI"),this.adapterRef.playApi=new f.PlayApi({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initRecordApi",value:function(){this.adapterRef.recordApi?this.adapterRef.logger.log("AbstractAdapter: _initRecordApi: recordApi已初始化，不用重复创建！"):(this.adapterRef.logger.log("AbstractAdapter: _initRecordApi: 初始化recordApi"),this.adapterRef.recordApi=new f.RecordApi({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initCommonApi",value:function(){this.adapterRef.commonApi?this.adapterRef.logger.log("AbstractAdapter: _initCommonApi: commonApi已初始化，不用重复创建！"):(this.adapterRef.logger.log("AbstractAdapter: _initCommonApi: 初始化commonApi"),this.adapterRef.commonApi=new f.CommonApi({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initMeeting4NRTCApi",value:function(){this.adapterRef.meeting4NRTCApi?this.adapterRef.logger.log("AbstractAdapter: _initMeeting4NRTCApi: meeting4NRTCApi已初始化，不用重复创建！"):(this.adapterRef.logger.log("AbstractAdapter: _initMeeting4NRTCApi: 初始化meeting4NRTCApi"),this.adapterRef.meeting4NRTCApi=new f.Meeting4NRTCApi({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initMeeting4WebRTC2Api",value:function(){this.adapterRef.meeting4WebRTC2Api?this.adapterRef.logger.log("AbstractAdapter: _initMeeting4WebRTC2Api: meeting4WebRTC2Api已初始化，不用重复创建！"):(this.adapterRef.logger.log("AbstractAdapter: _initMeeting4WebRTC2Api: 初始化meeting4WebRTC2Api"),this.adapterRef.meeting4WebRTC2Api=new f.Meeting4WebRTC2Api({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initCaptureApi",value:function(){this.adapterRef.captureApi?this.adapterRef.logger.log("AbstractAdapter: _initCaptureApi: captureApi已初始化，不用重复创建!"):(this.adapterRef.logger.log("AbstractAdapter: _initCaptureApi: 初始化captureApi"),this.adapterRef.captureApi=new f.CaptureApi({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initMeeting4WebRTCApi",value:function(){this.adapterRef.meeting4WebRTCApi?this.adapterRef.logger.log("AbstractAdapter: _initMeeting4WebRTCApi: meeting4WebRTCApi已初始化，不用重复创建！"):(this.adapterRef.logger.log("AbstractAdapter: _initMeeting4WebRTCApi: 初始化meeting4WebRTCApi"),this.adapterRef.meeting4WebRTCApi=new f.Meeting4WebRTCApi({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initP2P4WebRTCApi",value:function(){this.adapterRef.p2p4WebRTCApi?this.adapterRef.logger.log("AbstractAdapter: _initP2P4WebRTCApi: p2p4WebRTCApi已初始化，不用重复创建！"):(this.adapterRef.logger.log("AbstractAdapter: _initP2P4WebRTCApi: 初始化p2p4WebRTCApi"),this.adapterRef.p2p4WebRTCApi=new f.P2P4WebRTCApi({adapterRef:this.adapterRef,sdkRef:this.sdkRef}))}},{key:"_initApiReportHelper",value:function(){this.adapterRef.logger.log("AbstractAdapter: _initApiReportHelper"),this.adapterRef.apiReportHelper||(this.adapterRef.apiReportHelper=new d.ApiReportHelper({sdkRef:this.sdkRef,adapterRef:this.adapterRef,platform:c.CONFIG_MAP.SDK_NAME[c.CONFIG_MAP.CURRENT.SDK_TYPE]}))}},{key:"_initCommonReportHelper",value:function(){this.adapterRef.logger.log("AbstractAdapter: _initCommonReportHelper"),this.adapterRef.intervalCommonDataReport||(this.adapterRef.intervalCommonDataReport=new d.IntervalCommonDataReport({sdkRef:this.sdkRef,adapterRef:this.adapterRef}))}},{key:"_initLogReportHelper",value:function(){this.adapterRef.logger.log("AbstractAdapter: _initLogReportHelper"),this.adapterRef.logReportHelper||(this.adapterRef.logReportHelper=new d.LogReportHelper(this.adapterRef))}},{key:"_initStatsReportHelper",value:function(){this.adapterRef.logger.log("AbstractAdapter: _initStatsReportHelper"),this.adapterRef.statsReportHelper||(this.adapterRef.statsReportHelper=new d.StatsReportHelper({sdkRef:this.sdkRef,adapterRef:this.adapterRef}))}},{key:"doClearAfterRemoteLeave",value:function(e){this._doDestroyRemoteResourceByUid(e),delete this.adapterRef.remoteStreamMap[e]}},{key:"_doDestroyRemoteResourceByUid",value:function(e){var t=this;if(this.adapterRef.logger&&this.adapterRef.logger.log("AbstractAdapter: _doDestroyRemoteResourceByUid: uid=%o",e),this.adapterRef.webrtcBusiness&&this.adapterRef.webrtcBusiness.rtcWathcher&&delete this.adapterRef.webrtcBusiness.rtcWathcher.firstData.recvFirstData[e],e)return this._doDestroyRemoteRtcByUid(e),this._doDestroyRemoteMediaStreamByUid(e),void this._doDestroyMediaHelperByUid(e);var r=[],i=Object.keys(this.adapterRef.videoHelperMap),a=Object.keys(this.adapterRef.audioHelperMap);0!=i.length?r=i:0!=a.length&&(r=a),r.map(function(e){t._doDestroyRemoteRtcByUid(e),t._doDestroyRemoteMediaStreamByUid(e),t._doDestroyMediaHelperByUid(e)})}},{key:"_doDestroyRemoteRtcByUid",value:function(e){e?this.adapterRef.webrtcBusiness?(this.adapterRef.logger.log("AbstractAdapter: _doDestroyRemoteRtcByUid: uid=%o",e),this.adapterRef.webrtcBusiness._destroyRtcByUid(e)):this.adapterRef.logger.warn("AbstractAdapter: _doDestroyRemoteRtcByUid: 不存在的webrtcBusiness对象!"):this.adapterRef.logger.warn("AbstractAdapter: _doDestroyRemoteRtcByUid: 未传入UID！")}},{key:"_doDestroyRemoteMediaStreamByUid",value:function(e){if(e){this.adapterRef.logger.log("AbstractAdapter:_doDestroyRemoteMediaStreamByUid uid=%o",e);var t=this._getAudioHelperByUid(e);t&&t.remoteAudioStream&&(t.removeTrackFromMediaStream(t.remoteAudioStream,this.adapterRef.logger),this.adapterRef.webrtcBusiness.switchTrackEvent({stream:t.remoteAudioStream,uid:e,bindTrackEvent:!1}),t.remoteAudioStream=null);var r=this._getVideoHelperByUid(e);r&&r.remoteVideoStream&&(r.removeTrackFromMediaStream(r.remoteVideoStream,this.adapterRef.logger),this.adapterRef.webrtcBusiness.switchTrackEvent({stream:r.remoteVideoStream,uid:e,bindTrackEvent:!1}),r.remoteVideoStream=null)}else this.adapterRef.logger.error("AbstractAdapter: _doDestroyRemoteMediaStreamByUid: 未传入UID！")}},{key:"_exit",value:function(e){this.adapterRef.iminfo?"p2p"===this.adapterRef.imInfo.sessionMode?(this.adapterRef.logger.log("_exit: 挂断通话"),this.hangup&&this.hangup(),this.emit(c.EVENT_OBJ.hangup.key,Object.assign(EVENT_CODE.USER_LEFT_REASON.timeout,{channelId:this.imInfo.cid,account:this._getAccountByUid(e)}))):(this.adapterRef.logger.log("_exit: 离开房间"),this.leaveChannel&&this.leaveChannel(),this.emit(c.EVENT_OBJ.leaveChannel.key,Object.assign(EVENT_CODE.USER_LEFT_REASON.timeout,{channelId:this.imInfo.cid,account:this._getAccountByUid(e)}))):this.adapterRef.logger.warn("_exit: imInfo undefined")}},{key:"_isSupportWebrtc",value:function(){return u.RtcSupport.checkWebRtc()}},{key:"_extractVersion",value:function(e,t,r){var i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}},{key:"_isFirefox",value:function(){return/Firefox/gi.test(navigator.userAgent)}},{key:"_isChrome",value:function(){return/Chrome/gi.test(navigator.userAgent)}},{key:"_isChrome72",value:function(){var e=this._extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);return!!(e&&e>=72)}},{key:"_isSafari",value:function(){return/^((?!chrome).)*safari((?!chrome).)*$/gi.test(navigator.userAgent)}},{key:"_isMobileSafari",value:function(){return this._isSafari()&&/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)}},{key:"_isWeixinBrowser",value:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())}},{key:"_isFirefoxMoreThan59",value:function(){return this._isFirefox()&&this._status.system.version>=59}},{key:"_isFirefoxLessThan59",value:function(){return this._isFirefox()&&this._status.system.version<59}},{key:"_doRemoteStream",value:function(e,t,r){this._isFirefox()?this._doRemoteStream4Firefox(e,t,r):this._doRemoteStream4Other(e,t,r)}},{key:"_doRemoteStream4Firefox",value:function(e,t,r){if(e)if(this.adapterRef.imInfo.netDetect)this.adapterRef.logger.log("AbstractAdapter: _doRemoteStream4Firefox: 网络探测,%s",this.adapterRef.imInfo.netDetect);else{var i=this._getAudioHelperByUid(t),a=this._getVideoHelperByUid(t);if(this.adapterRef.webrtcBusiness.getRtcObject(t))if(r){this.adapterRef.logger.log("AbstractAdapter:_doRemoteStream4Firefox: remote stream uid: %s, track num: %d "+t+" "+e.getTracks().length);var n=e.getAudioTracks()[0],o=e.getVideoTracks()[0];n&&i.setIsRemote(!0).composeTrack(t,n),o&&a.setIsRemote(!0).composeTrack(t,o),this.emit(c.EVENT_OBJ.remoteTrack.key,{uid:t,account:this._getAccountByUid(t),track:r})}else this.adapterRef.logger.warn("AbstractAdapter: _doRemoteStream4Firefox: 不存在的轨道...");else this.adapterRef.logger.error("AbstractAdapter: _doRemoteStream4Firefox: 不存在的远程rtc对象 , track")}else this.adapterRef.logger.error("AbstractAdapter: _doRemoteStream4Firefox: 远程流不存在!")}},{key:"_doRemoteStream4Other",value:function(e,t,r){var i=this;if(e)if(this.adapterRef.imInfo.netDetect)this.adapterRef.logger.log("AbstractAdapter: _doRemoteStream4Other 网络探测...");else{this.adapterRef.logger.log("AbstractAdapter:_doRemoteStream4Other remote stream uid: %s, track num: %d",t,e.getTracks().length),e.getTracks().forEach(function(e){i.adapterRef.logger.log("AbstractAdapter: _doRemoteStream4Other: track kind=%s, id=%s",e.kind,e.id)});var a=e.getAudioTracks()[0],n=e.getVideoTracks()[0];a&&this._getAudioHelperByUid(t).setIsRemote(!0).composeTrack(t,a),n&&this._getVideoHelperByUid(t).setIsRemote(!0).composeTrack(t,n),this.adapterRef.webrtcBusiness.switchTrackEvent({stream:e,uid:t}),a&&this.emit(c.EVENT_OBJ.remoteTrack.key,{uid:t,account:this._getAccountByUid(t),track:a}),n&&this.emit(c.EVENT_OBJ.remoteTrack.key,{uid:t,account:this._getAccountByUid(t),track:n}),this.adapterRef.logger.warn("通知上层，可以播放对端视频了"),this.adapterRef.instance.emit("stream-subscribed",{stream:this.adapterRef.remoteStreamMap[t]})}else this.adapterRef.logger.error("AbstractAdapter: _doRemoteStream4Other 远程流不存在...")}},{key:"_setSessionConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.adapterRef.imInfo||(this.adapterRef.imInfo={}),this.adapterRef.imInfo.sessionConfig||(this.adapterRef.imInfo.sessionConfig=c.DEFAULT_SESSION_CONFIG),this.adapterRef.imInfo.sessionConfig=Object.assign(this.adapterRef.imInfo.sessionConfig,e)}},{key:"_startSessionInit",value:function(){this.adapterRef.imInfo.sessionStart=Date.now(),this.adapterRef.imInfo.cid=this.adapterRef.imInfo.cid||this.adapterRef.imInfo.channelId,this.channelId=this.adapterRef.imInfo.cid,this.adapterRef.imInfo.sessionMode=this.adapterRef.imInfo.sessionMode||c.SESSION_MODE.P2P,this.adapterRef.imInfo.serverMap&&this.adapterRef.imInfo.serverMap.constructor===String&&(this.adapterRef.imInfo.serverMap=JSON.parse(this.adapterRef.imInfo.serverMap)),this.SDK_TYPE===c.CONFIG_MAP.SDK_TYPE.NRTC||this.adapterRef.imInfo.netDetect?(this.adapterRef.logger.log("AbstractAdapter: _startSessionInit: NRTCAdapter实例 额外校验字段..."),l.tool.verifyOptions(this.adapterRef.imInfo,"cid uid token sessionMode wssArr")):this.SDK_TYPE===c.CONFIG_MAP.SDK_TYPE.WEBRTC2||(this.adapterRef.imInfo.token=this.adapterRef.imInfo.cid),this.adapterRef.imInfo.sessionConfig.videoQuality===c.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_NORMAL&&this._setSessionConfig({videoQuality:c.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_480P});var e=(this.adapterRef.imInfo.clientConfig&&JSON.parse(this.adapterRef.imInfo.clientConfig)||{}).quality_level_limit||this.adapterRef.imInfo.sessionConfig.maxVideoQuality;this.adapterRef.imInfo.sessionConfig.videoQuality>e&&this._setSessionConfig({videoQuality:e}),this.adapterRef.logger.log("quality:",this.adapterRef.imInfo.sessionConfig.videoQuality),this.SDK_TYPE===c.CONFIG_MAP.SDK_TYPE.WEBRTC2&&(this.adapterRef.imInfo.sessionConfig.maxVideoQuality=16,this.adapterRef.imInfo.sessionConfig.videoQuality=4);var t=this.sdkRef.getVideoSessionConfig({quality:this.adapterRef.imInfo.sessionConfig.videoQuality,frameRate:this.adapterRef.imInfo.sessionConfig.videoFrameRate});if(this.adapterRef.apiReportHelper&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"set_v_fps",ext:t.frameRate}),this.adapterRef.apiReportHelper&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"set_video_quality",ext:this.adapterRef.imInfo.sessionConfig.videoQuality}),this.adapterRef.imInfo=Object.assign(this.adapterRef.imInfo,{videoConfig:t}),this.adapterRef.logger.log("AbstractAdapter: _startSessionInit: 启动会话后的imInfo: ",JSON.stringify(this.adapterRef.imInfo,null," ")),this._init(),this._initStatsReportHelper(),this._initApiReportHelper(),this._initCommonReportHelper(),this._initLogReportHelper(),this.adapterRef.state.rtcConnected=!0,this.adapterRef.instance._setSessionConfig({rtcEndTime:Date.now()}),this.adapterRef.statsReportHelper.startStats(),this.adapterRef.logReportHelper.uploadData("sessionInfo",this.adapterRef.imInfo),this.adapterRef.apiReportHelper.uploadDataApi("start",{uid:this.adapterRef.imInfo.uid}),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"meeting"}),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:this.adapterRef.imInfo.sessionMode}),this.adapterRef.imInfo.sessionConfig.recordAudio&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"server_record_audio"}),this.adapterRef.imInfo.sessionConfig.recordVideo&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"server_record_video"}),this.adapterRef.imInfo.sessionConfig.singleRecord&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"server_record_single_user"}),this.adapterRef.imInfo.sessionConfig.recordType&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"record_module",value:this.adapterRef.imInfo.sessionConfig.recordType}),this.adapterRef.imInfo.sessionConfig.isHostSpeaker&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"record_speaker"}),this.adapterRef.imInfo.sessionConfig.highAudio&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"hd_audio"}),void 0!==this.adapterRef.imInfo.sessionConfig.videoFrameRate&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"fps",ext:0==+this.adapterRef.imInfo.sessionConfig.videoFrameRate?0:+this.adapterRef.imInfo.sessionConfig.videoFrameRate+1}),this.adapterRef.imInfo.sessionConfig.liveEnable&&this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"bypass",ext:void 0!==this.adapterRef.imInfo.sessionConfig.splitMode?+this.adapterRef.imInfo.sessionConfig.splitMode+1:0}),void 0!==this.adapterRef.imInfo.sessionConfig.videoQuality){var r=+this.adapterRef.imInfo.sessionConfig.videoQuality;r===c.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_540P?r=c.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_720P:r===c.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_720P&&(r=c.VIDEO_QUALITY.CHAT_VIDEO_QUALITY_540P),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"video_quality",ext:r||0})}}},{key:"_startSession",value:function(){return this._startSessionInit(),this.adapterRef.webrtcGateWayBusiness.doTryInit()}},{key:"_stopSession",value:function(){var e=this;return this._stopAllDataUpload(),this._stopIfInRecording().then(function(){return e._resetStatus(),Promise.resolve()})}},{key:"_stopAllDataUpload",value:function(){this.adapterRef.statsReportHelper?this.adapterRef.statsReportHelper.stopStats():this.adapterRef.logger.log("AbstractAdapter: _stopSession: 已停止stats统计，请勿重复！"),this.adapterRef.apiReportHelper?this.adapterRef.apiReportHelper.uploadDataApi("send"):this.adapterRef.logger.log("AbstractAdapter: _stopSession: 已停止api统计，请勿重复！"),this.adapterRef.logReportHelper?this.adapterRef.logReportHelper.uploadData("send"):this.adapterRef.logger.log("AbstractAdapter: _stopSession: 已停止log统计，请勿重复！")}},{key:"_doDestroyLocalMediaStream",value:function(){this._doDestroyLocalMediaStream4Audio(),this._doDestroyLocalMediaStream4Video()}},{key:"_doDestroyLocalMediaStream4Audio",value:function(){var e=this._getAudioHelperByUid("local");e&&e.localAudioStream&&(e.localAudioStream=null,e.destroyMedia()),e&&e.webAudio&&e.webAudio.mixAudioConf&&e.webAudio.mixAudioConf.audioSource&&e.stopAudioMixing()}},{key:"_doDestroyLocalMediaStream4Video",value:function(){var e=this._getVideoHelperByUid("local");e&&e.localVideoStream&&(e.localVideoStream=null)}},{key:"_stopIfInRecording",value:function(){var e=[],t=this.adapterRef.mediaRecordHelper;return Object.values(t).forEach(function(t){t&&t.checkIsRecording()&&(e.push(t.stop()),e.push(t.clean()))}),Promise.all(e)}},{key:"_isDetectNetworkOfselfWebRtcConnected",value:function(){if(this.adapterRef&&this.adapterRef.webrtcBusiness&&this.adapterRef.webrtcBusiness.selfWebRtcInstance&&this.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection&&this.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection)return this.adapterRef&&this.adapterRef.webrtcBusiness&&this.adapterRef.webrtcBusiness.selfWebRtcInstance&&this.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection&&this.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection.iceConnectionState&&("completed"==this.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection.iceConnectionState||"connected"==this.adapterRef.webrtcBusiness.selfWebRtcInstance.rtcConnection.iceConnectionState)}},{key:"_isDetectNetworkOfremoteWebRtcConnected",value:function(){if(this.adapterRef&&this.adapterRef.webrtcBusiness&&this.adapterRef.webrtcBusiness.remoteWebRtcInstanceMap){var e=this.adapterRef.webrtcBusiness._getRemoteWebRtcInstance(this.adapterRef.imInfo.remoteUid);if(e&&e.rtcConnection)return e.rtcConnection&&("completed"==e.rtcConnection.iceConnectionState||"connected"==e.rtcConnection.iceConnectionState)}return!1}},{key:"_isDetectNetwork",value:function(){return this._isDetectNetworkOfselfWebRtcConnected()&&this._isDetectNetworkOfremoteWebRtcConnected()}},{key:"_resetStatus",value:function(){this.adapterRef.logger&&this.adapterRef.logger.log("AbstractAdapter:_resetStatus"),this.adapterRef.imInfo&&(this.adapterRef.imInfo.uid||this.adapterRef.imInfo.userid)&&(this._getVideoHelperByUid("local").destroy(),this.adapterRef.deviceApi.stopDevice(c.DEVICE_TYPE.DEVICE_TYPE_AUDIO_IN),this.adapterRef.deviceApi.stopDevice(c.DEVICE_TYPE.DEVICE_TYPE_VIDEO),this._doDestroyLocalMediaStream()),this._doDestroyRemoteResourceByUid(),this._doDestroyBusinessObjects(),this._doDestroyApiObjects(),this._doDestroyHelperObjects(),this._resetState()}},{key:"_doDestroyBusinessObjects",value:function(){this.adapterRef.logger&&this.adapterRef.logger.log("AbstractAdapter: _doDestroyBusinessObjects: 销毁Business类子对象 "),this.adapterRef.webrtcGateWayBusiness&&(this.adapterRef.webrtcGateWayBusiness.destroy(),this.adapterRef.webrtcGateWayBusiness=null),this.adapterRef.deviceBusiness&&(this.adapterRef.deviceBusiness.destroy(),this.adapterRef.deviceBusiness=null),this.adapterRef.webrtcBusiness&&(this.adapterRef.webrtcBusiness.destroy(),this.adapterRef.webrtcBusiness=null)}},{key:"_doDestroyApiObjects",value:function(){}},{key:"_doDestroyHelperObjects",value:function(){this.adapterRef.logger&&this.adapterRef.logger.log("AsbtractAdapter: _doDestroyHelperObjects: 销毁helper类子对象"),this.adapterRef.statsReportHelper&&(this.adapterRef.statsReportHelper=null),this.adapterRef.intervalCommonDataReport&&(this.adapterRef.intervalCommonDataReport.destroy(),this.adapterRef.intervalCommonDataReport=null),this.adapterRef.logReportHelper&&(this.adapterRef.logReportHelper=null)}},{key:"_doDestroyMediaHelperByUid",value:function(e){this.adapterRef.logger.log("AbstractAdapter: _doDestroyMediaHelperByUid: uid=%o",e),delete this.adapterRef.audioHelperMap[e],this._doDestroyAudioHelperByUid(e),this._doDestroyVideoHelperByUid(e)}},{key:"_doDestroyAudioHelperByUid",value:function(e){if(this.adapterRef.logger.log("AbstractAdapter: _doDestroyAudioHelperByUid: uid=%o",e),"local"===e||e===this.adapterRef.imInfo.uid){var t=this._getAudioHelperByUid("local");return t.destroy(),void(t=null)}var r=this.adapterRef.audioHelperMap[e];r&&(r.destroy(),r=null),delete this.adapterRef.audioHelperMap[e]}},{key:"_doDestroyVideoHelperByUid",value:function(e){if(this.adapterRef.logger.log("AbstractAdapter: _doDestroyVideoHelperByUid: uid=%o",e),"local"===e||e===this.adapterRef.imInfo.uid){var t=this._getVideoHelperByUid("local");return t.destroy(),void(t=null)}var r=this.adapterRef.videoHelperMap[e];r&&(r.destroy(),r=null),delete this.adapterRef.videoHelperMap[e]}},{key:"_isPlayer",value:function(){return this.adapterRef.imInfo.sessionMode===c.SESSION_MODE.MEETING&&this.adapterRef.imInfo.role===c.ROLE_FOR_MEETING.ROLE_PLAYER||this.adapterRef.imInfo.sessionMode===c.SESSION_MODE.P2P}},{key:"_getUidByAccount",value:function(e){var t=this.adapterRef.account4UidMap[e];return this.adapterRef.logger.log("AbstractAdapter: _getUidByAccount: "+e+" => "+t),t}},{key:"_getAccountByUid",value:function(e){return this.adapterRef.uid4AccountMap[e]}},{key:"_convertToUidIfAccout",value:function(e){var t=e;return c.CONFIG_MAP.SDK_NAME[c.CONFIG_MAP.CURRENT.SDK_TYPE]===c.CONFIG_MAP.SDK_TYPE.WEBRTC&&(t=this.adapterRef.instance._getUidByAccount(e)),t}},{key:"_validateVideoQuality",value:function(e){return(0,c.validateVideoQuality)(e)}},{key:"_validateVideoFrameRate",value:function(e){return(0,c.validateVideoFrameRate)(e)}},{key:"_onSignalTimeout",value:function(e){this.adapterRef.webrtcGateWayBusiness&&this.adapterRef.webrtcGateWayBusiness._onSignalTimeout?(this.adapterRef.logger.warn("AbstractAdapter: _onSignalTimeout: 即将执行_onSignalTimeout"),this.adapterRef.webrtcGateWayBusiness._onSignalTimeout()):this.adapterRef.logger.log("AbstractAdapter: _onSignalTimeout: _onSignalTimeout undefined！")}},{key:"_judgeSendSdpOfferOrUpdate",value:function(){this.adapterRef.logger.log("AbstractAdapter: _judgeSendSdpOfferOrUpdate: "+this.adapterRef.state.isFirstOpenMediaDevice);var e=!1;return 1==this.adapterRef.state.isFirstOpenMediaDevice?this.adapterRef.state.isFirstOpenMediaDevice=!1:e=!0,this.adapterRef.instance._updateRtc(e)}},{key:"checkExist",value:function(e){return!!this[e]}},{key:"setStartSessionTime",value:function(){this.adapterRef.state.startSessionTime=Date.now()}},{key:"setEndSessionTime",value:function(){if(this.adapterRef.state.startSessionTime){this.adapterRef.state.endSessionTime=Date.now();var e=this.adapterRef.state.endSessionTime-this.adapterRef.state.startSessionTime;this.emit(c.EVENT_OBJ.sessionDuration.key,e),this.adapterRef.state.startSessionTime=0,this.adapterRef.state.endSessionTime=0,this.adapterRef.instance.commondDatareport("setLogout",{uid:""+this.adapterRef.imInfo.uid,cid:""+this.adapterRef.imInfo.cid,time:Date.now()})}else this.adapterRef.logger.log("AbstractAdapter: setEndSessionTime: startSessionTime为空")}},{key:"rate",value:function(e){l.tool.verifyOptions(e,"cid uid rate");var t=e.rate;if(t=parseInt(t),t!=t)throw new Error("评分不正确");t>5&&(t=5),t<1&&(t=1),e.rate=t,new d.CommonDataReport({adapterRef:this.adapterRef,sdkRef:this.sdkRef}).setFeedback(e).send()}},{key:"commondDatareport",value:function(e,t){this.adapterRef.logger.log("上报 "+e+" 事件，参数: "+JSON.stringify(t,null,""));var r=new d.CommonDataReport({adapterRef:this.adapterRef,sdkRef:this.sdkRef});r[e](t),r.send(),r=null}},{key:"_startCamera",value:function(e){return this.adapterRef.deviceApi.startDevice(e)}},{key:"_stopCamera",value:function(){return this.adapterRef.deviceApi.stopDevice()}},{key:"_startMic",value:function(e){return this.adapterRef.deviceApi.startDevice(e)}},{key:"_stopMic",value:function(){return this.adapterRef.deviceApi.stopDevice()}},{key:"_startVoice",value:function(){this.adapterRef.commonApi.setAudioStart(-1)}},{key:"_stopVoice",value:function(){this.adapterRef.commonApi.setAudioBlack(-1)}},{key:"destroy",value:function(){this.adapterRef.logger.log("AbstractAdapter: destroy！"),this._doDestroyBusinessObjects(),this._doDestroyApiObjects(),this._doDestroyHelperObjects(),this._reset()}}]),t}(s.EventEmitter);t.AbstractAdapter=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC=void 0;var i=l(r(1)),a=l(r(2)),n=l(r(4)),o=l(r(3)),s=l(r(84)),d=r(222),c=r(11),u=l(r(19));function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,i.default)(this,t),e=Object.assign(c.DEFAULT_WEBRTC_OPTION,e),c.CONFIG_MAP.CURRENT.SDK_TYPE=c.CONFIG_MAP.SDK_TYPE.WEBRTC;var r=(0,n.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.SDK_TYPE=c.CONFIG_MAP.SDK_TYPE.WEBRTC,r.adapterRef.nim=e.nim,r._initApiReportHelper(),(0,s.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initIMBusiness",r).call(r),/safari/gi.test(u.default.name)?window.addEventListener("pagehide",r.beforeunload.bind(r)):window.addEventListener("beforeunload",r.beforeunload.bind(r)),r}return(0,o.default)(t,e),(0,a.default)(t,[{key:"beforeunload",value:function(){this.adapterRef.logger.log("WebRTC:beforeunload: event fire",this.adapterRef.imInfo),this.adapterRef.imInfo&&(this.adapterRef.instance._isFirefox()&&(this.adapterRef.logger.log("Firefox destroy first"),this.adapterRef.webrtcGateWayBusiness.destroy()),this.adapterRef.imInfo.sessionMode===c.SESSION_MODE.P2P?(this.adapterRef.logger.log("WebRTC:beforeunload: 即将执行SDK内部的hangup逻辑"),this.emit(c.EVENT_OBJ.hangup.key,Object.assign(c.EVENT_CODE.USER_LEFT_REASON.quit,{channelId:this.adapterRef.imInfo.cid,account:this._getAccountByUid(this.adapterRef.imInfo.uid)})),this.hangup()):this.adapterRef.imInfo.sessionMode===c.SESSION_MODE.MEETING?(this.emit(c.EVENT_OBJ.leaveChannel.key,Object.assign(c.EVENT_CODE.USER_LEFT_REASON.quit,{channelId:this.adapterRef.imInfo.cid,account:this._getAccountByUid(this.adapterRef.imInfo.uid)})),this.leaveChannel()):this.adapterRef.beCalledInfo&&(this.adapterRef.logger.log("WebRTC:beforeunload: 拒绝来电, beCalledInfo",this.adapterRef.beCalledInfo),this.control({channelId:this.adapterRef.beCalledInfo.channelId,command:c.CONTROL_TYPE.NETCALL_CONTROL_COMMAND_BUSY}),this.response({accepted:!1,beCalledInfo:this.adapterRef.beCalledInfo})))}},{key:"handleAccount",value:function(e,t){this.adapterRef.logger.log("%s: account %s",e,t);var r=null;return-1==t?-1:t&&!(r=this._getUidByAccount(t))?(this.adapterRef.logger.log("%s: 账号错误, 请输入正确的账号",e),-2):r}},{key:"startRecordMp4",value:function(e){var t=this.handleAccount("开启视频录制",e);if(-2!=t)return this.startMediaRecording({uid:t,type:"video"})}},{key:"stopRecordMp4",value:function(){var e=this;return Promise.resolve().then(function(){e.adapterRef.recordApi.stopMediaRecordingByUid()})}},{key:"startRecordAac",value:function(){return this.adapterRef.recordApi.startAudioRecording()}},{key:"stopRecordAac",value:function(){return this.adapterRef.recordApi.stopAudioRecording()}},{key:"isCurrentChannelId",value:function(e){return this.adapterRef.imBusiness._isCurrentChannelId(e.channelId)}},{key:"notCurrentChannelId",value:function(e){return!this.adapterRef.imBusiness._isCurrentChannelId(e.channelId)}},{key:"resetWhenHangup",value:function(){(0,s.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_stopSession",this).call(this),(0,s.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_resetStatus",this).call(this)}},{key:"setIsPrivateDeployment",value:function(e){this.adapterRef&&(this.adapterRef.isPrivateDeployment=e)}},{key:"setPrivateDeploymentConf",value:function(e){e&&e.turnServer||this.adapterRef.logger.log("WebRTC:setPrivateDeploymentConf: 无效的参数"),this.adapterRef&&(this.adapterRef.privateDeploymentConf=e)}},{key:"setPlayVolume",value:function(e,t){if(t&&0!==t.length){var r=this._getUidByAccount(t);return this.adapterRef.playApi.setPlayVolume({uid:r,volume:+e})}return this.adapterRef.playApi.setPlayVolume(+e)}},{key:"setAudioBlack",value:function(e){var t=this.handleAccount("设置指定用户静音: ",e);if(-2!=t){this.adapterRef.commonApi.setAudioBlack(t);try{this.adapterRef.intervalCommonDataReport&&this.adapterRef.intervalCommonDataReport.triggerFunction({name:"self_mute",oper:"1"})}catch(e){this.adapterRef.logger.error(e)}}}},{key:"setAudioStart",value:function(e){var t=this.handleAccount("开启音量: ",e);if(-2!=t){this.adapterRef.commonApi.setAudioStart(t);try{this.adapterRef.intervalCommonDataReport&&this.adapterRef.intervalCommonDataReport.triggerFunction({name:"self_mute",oper:"0"})}catch(e){this.adapterRef.logger.error(e)}}}},{key:"setVideoBlack",value:function(e){var t=this.adapterRef.account4UidMap[e];this.adapterRef.commonApi.setVideoBlack(t)}},{key:"setVideoShow",value:function(e){var t=this.adapterRef.account4UidMap[e];this.adapterRef.commonApi.setVideoShow(t)}},{key:"getDevicesOfType",value:function(e){return this.adapterRef.deviceApi.getDevicesOfType(e)}},{key:"startRtc",value:function(){return this.adapterRef.detectNetState.inDetecting?Promise.reject(c.CommonErrorCode.NetworkInDetecting):(this._getVideoHelperByUid(this.adapterRef.imInfo.uid),this._getAudioHelperByUid(this.adapterRef.imInfo.uid),this.adapterRef.commonApi.startRtc())}},{key:"initSignal",value:function(){return Promise.resolve()}},{key:"setNetcallSession",value:function(e){return this.adapterRef.p2p4WebRTCApi.setNetcallSession(e)}},{key:"call",value:function(e){return this.adapterRef.p2p4WebRTCApi.call(e)}},{key:"response",value:function(e){return this.setStartSessionTime(),this.adapterRef.p2p4WebRTCApi.response(e)}},{key:"hangup",value:function(){this.setEndSessionTime(),this.adapterRef.p2p4WebRTCApi.hangup()}},{key:"control",value:function(e){this.adapterRef.p2p4WebRTCApi.control(e)}},{key:"switchAudioToVideo",value:function(){this.adapterRef.p2p4WebRTCApi.switchAudioToVideo()}},{key:"switchVideoToAudio",value:function(){this.adapterRef.p2p4WebRTCApi.switchVideoToAudio()}},{key:"createChannel",value:function(e){return this.adapterRef.meeting4WebRTCApi.createChannel(e)}},{key:"joinChannel",value:function(e){return this.adapterRef.detectNetState.inDetecting?Promise.reject(c.CommonErrorCode.NetworkInDetecting):(this.setStartSessionTime(),this.adapterRef.meeting4WebRTCApi.joinChannel(e))}},{key:"leaveChannel",value:function(){return this.setEndSessionTime(),this.adapterRef.meeting4WebRTCApi.leaveChannel()}},{key:"changeRoleToPlayer",value:function(){return this._setClientRole(c.ROLE_FOR_MEETING.ROLE_PLAYER)}},{key:"changeRoleToAudience",value:function(){return this._setClientRole(c.ROLE_FOR_MEETING.ROLE_AUDIENCE)}},{key:"_setClientRole",value:function(e){if(this.adapterRef.imInfo.sessionMode===c.SESSION_MODE.P2P)return Promise.reject(c.CommonErrorCode.StageNotMatch);e=+e,void 0===this.adapterRef.imInfo.role&&(this.adapterRef.imInfo.role=c.ROLE_FOR_MEETING.ROLE_PLAYER);var t={role:e===c.ROLE_FOR_MEETING.ROLE_PLAYER?"normal":"audience"};return e===this.adapterRef.imInfo.role?Promise.resolve(t):(this.adapterRef.imInfo.role=e,this.adapterRef.webrtcBusiness._switchRole().then(function(){return Promise.resolve(t)}))}},{key:"startLocalStream",value:function(e){return this.adapterRef.playApi.startLocalStream(e)}},{key:"stopLocalStream",value:function(){this.adapterRef.playApi.stopLocalStream()}},{key:"startRemoteStream",value:function(e){var t=e.account,r=this.handleAccount("开启对方画面",t);if(-2!=r)return e.account=r,this.adapterRef.playApi.startRemoteStream(e)}},{key:"stopRemoteStream",value:function(e){var t=this.handleAccount("关闭对方画面",e);-2!=t&&(this.adapterRef.playApi.stopRemoteStream(t),this.adapterRef.apiReportHelper.uploadDataApi("update",{key:"mute_remote_video"}))}},{key:"setVideoViewSize",value:function(e){return this.adapterRef.playApi.setVideoViewSize(e)}},{key:"setVideoViewRemoteSize",value:function(e){var t=e.account,r=this.handleAccount("设置对端视频画面大小",t);if(-2!=r)return e.uid=r,this.adapterRef.playApi.setVideoViewRemoteSize(e)}},{key:"resumeLocalStream",value:function(){this.adapterRef.playApi.resumeLocalStream()}},{key:"suspendLocalStream",value:function(){this.adapterRef.playApi.suspendLocalStream()}},{key:"resumeRemoteStream",value:function(e){var t=this.handleAccount("恢复所有远程视频流",e);-2!=t&&this.adapterRef.playApi.resumeRemoteStream(t)}},{key:"suspendRemoteStream",value:function(e){var t=this.handleAccount("挂起所有远程视频流",e);-2!=t&&this.adapterRef.playApi.suspendRemoteStream(t)}},{key:"setMixConf",value:function(e){return this.setMediaMixConfig(e)}},{key:"updateRtmpHost",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).account,r=this.handleAccount("更新用户信息",e);if(-2!=r)return(0,s.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateRtmpHost",this).call(this,{uid:r})}},{key:"stopTrack",value:function(e){var t=this;if(e){var r=e.getTracks();r&&0!==r.length&&r.forEach(function(r){t.adapterRef.logger.log("WebRTC:stopTrack: stop track",e.id),r.stop(),e.removeTrack(r)})}}},{key:"destroy",value:function(){this.adapterRef&&this.adapterRef.sessionMode&&("meeting"===this.adapterRef.sessionMode?this.leaveChannel():"p2p"===this.adapterRef.sessionMode&&(this.hangup(),this.resetWhenHangup())),(0,s.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(d.BaseAPI);t.WebRTC=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(480);Object.defineProperty(t,"WebRTC",{enumerable:!0,get:function(){return i.WebRTC}});var a=r(421);Object.defineProperty(t,"WebRTC2",{enumerable:!0,get:function(){return a.WebRTC2}});var n=r(420);Object.defineProperty(t,"Stream",{enumerable:!0,get:function(){return n.Stream}});var o=r(419);Object.defineProperty(t,"NRTCAdapter",{enumerable:!0,get:function(){return o.NRTCAdapter}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=r(65),n=(i=a)&&i.__esModule?i:{default:i},o=r(11);var s=r(5);window.WEBRTCLOG=window.WEBRTCLOG?window.WEBRTCLOG:console,t.default=(0,n.default)({version:s.info.version,versionRtc:s.info.nrtcVersion},o.NETCALL_TYPE,o.SPLIT_MODE,o.MIX_VIDEO_MODE,o.ROLE_FOR_MEETING,o.HANGUP_TYPE,o.CONTROL_TYPE,o.VIDEO_QUALITY,o.VIDEO_FRAME_RATE,o.ENCRYPTION_ALGORITHM_MODE,o.DEVICE_TYPE,{videoMap:{frame:o.VIDEO_QUALITY_REV,frameRate:o.VIDEO_FRAME_RATE_REV},deviceTypeMap:o.DEVICE_TYPE_REV,CHAT_NET_STATUS_VERY_GOOD:0,CHAT_NET_STATUS_GOOD:1,CHAT_NET_STATUS_POOR:2,CHAT_NET_STATUS_BAD:3}),e.exports=t.default},function(e,t,r){"use strict";e.exports={pushConfig:{1:"enable",2:"needBadge",3:"needPushNick",4:"pushContent",5:"custom",6:"pushPayload",7:"sound",9:"forceKeepCalling",10:"webrtcEnable"},liveOption:{1:"liveEnable",2:"webrtcEnable"}}},function(e,t,r){"use strict";e.exports={pushConfig:{enable:1,needBadge:2,needPushNick:3,pushContent:4,custom:5,pushPayload:6,sound:7,forceKeepCalling:9,webrtcEnable:10},liveOption:{liveEnable:1,webrtcEnable:2}}},function(e,t,r){"use strict";var i=r(0),a=r(99),n=i.merge({},a.idMap,{netcall:{id:9,initNetcall:1,keepCalling:3,calleeAck:4,notifyCalleeAck:5,hangup:6,notifyHangup:7,netcallControl:8,notifyNetcallControl:9,verifyChannelId:10,createChannel:13,joinChannel:14,queryAccountUidMap:16}}),o={initNetcall:{sid:n.netcall.id,cid:n.netcall.initNetcall,params:[{type:"byte",name:"type"},{type:"StrArray",name:"accounts"},{type:"String",name:"pushContent"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"}]},keepCalling:{sid:n.netcall.id,cid:n.netcall.keepCalling,params:[{type:"byte",name:"type"},{type:"StrArray",name:"accounts"},{type:"long",name:"channelId"}]},calleeAck:{sid:n.netcall.id,cid:n.netcall.calleeAck,params:[{type:"string",name:"account"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"}]},hangup:{sid:n.netcall.id,cid:n.netcall.hangup,params:[{type:"long",name:"channelId"}]},netcallControl:{sid:n.netcall.id,cid:n.netcall.netcallControl,params:[{type:"long",name:"channelId"},{type:"byte",name:"type"}]},verifyChannelId:{sid:n.netcall.id,cid:n.netcall.verifyChannelId,params:[{type:"long",name:"channelId"},{type:"String",name:"account"}]},createChannel:{sid:n.netcall.id,cid:n.netcall.createChannel,params:[{type:"String",name:"channelName"},{type:"String",name:"custom"},{type:"Boolean",name:"webrtcEnable"},{type:"String",name:"rtmpConf"}]},joinChannel:{sid:n.netcall.id,cid:n.netcall.joinChannel,params:[{type:"String",name:"channelName"},{type:"Property",name:"liveOption"}]},queryAccountUidMap:{sid:n.netcall.id,cid:n.netcall.queryAccountUidMap,params:[{type:"String",name:"channelName"},{type:"LongArray",name:"uids"}]}};e.exports={idMap:n,cmdConfig:o,packetConfig:{"9_1":{service:"netcall",cmd:"initNetcall",response:[{type:"Number",name:"timetag"},{type:"Number",name:"uid"},{type:"Number",name:"channelId"},{type:"StrArray",name:"turnServerList"},{type:"StrArray",name:"sturnServerList"},{type:"StrArray",name:"proxyServerList"},{type:"StrArray",name:"keepCallingAccounts"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"clientConfig"},{type:"String",name:"serverMap"}]},"9_2":{service:"netcall",cmd:"beCalled",response:[{type:"Number",name:"timetag"},{type:"Number",name:"type"},{type:"Number",name:"channelId"},{type:"String",name:"account"},{type:"Number",name:"uid"},{type:"StrArray",name:"turnServerList"},{type:"StrArray",name:"sturnServerList"},{type:"StrArray",name:"proxyServerList"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"clientConfig"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"},{type:"String",name:"serverMap"}]},"9_3":{service:"netcall",cmd:"keepCalling",response:[{type:"StrArr",name:"accounts"}]},"9_4":{service:"netcall",cmd:"calleeAck",response:[]},"9_5":{service:"netcall",cmd:"notifyCalleeAck",response:[{type:"String",name:"account"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"}]},"9_6":{service:"netcall",cmd:"hangup",response:[]},"9_7":{service:"netcall",cmd:"notifyHangup",response:[{type:"long",name:"channelId"},{type:"String",name:"account"},{type:"long",name:"timetag"}]},"9_8":{service:"netcall",cmd:"netcallControl",response:[]},"9_9":{service:"netcall",cmd:"notifyNetcallControl",response:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"long",name:"channelId"}]},"9_10":{service:"netcall",cmd:"verifyChannelId",response:[]},"9_11":{service:"netcall",cmd:"notifyNetcallRecord",response:[{type:"Property",name:"msg"}]},"9_12":{service:"netcall",cmd:"notifyCalleeAckSync",response:[{type:"String",name:"timetag"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"},{type:"byte",name:"fromClientType"}]},"9_13":{service:"netcall",cmd:"createChannel",response:[{type:"long",name:"timetag"}]},"9_14":{service:"netcall",cmd:"joinChannel",response:[{type:"long",name:"timetag"},{type:"long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"serverMap"},{type:"String",name:"clientConfig"},{type:"String",name:"custom"}]},"9_15":{service:"netcall",cmd:"notifyJoin",response:[{type:"Long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"}]},"9_16":{service:"netcall",cmd:"queryAccountUidMap",response:[]}}}},function(e,t,r){"use strict";var i={install:function(e){var t=e.Protocol.fn;t.processNetcall=function(e){switch(e.cmd){case"initNetcall":this.onInitNetcall(e);break;case"beCalled":this.onBeCalled(e);break;case"keepCalling":this.onKeepCalling(e);break;case"calleeAck":break;case"notifyCalleeAck":this.onNotifyCalleeAck(e);break;case"hangup":break;case"notifyHangup":this.onNotifyHangup(e);break;case"notifyNetcallControl":this.onNetcallControl(e);break;case"notifyCalleeAckSync":this.onNotifyCalleeAckSync(e);break;case"notifyNetcallRecord":this.onMsg(e);break;case"createChannel":break;case"joinChannel":this.joinChannel(e);break;case"notifyJoin":this.notifyJoin(e)}},t.onInitNetcall=function(e){if(!e.error){var t=e.obj.type;e.obj=e.content,e.obj.type=t,e.obj.accounts=e.obj.keepCallingAccounts,this.setCurrentNetcall(e.obj.channelId),this.keepCalling(e)}},t.setCurrentNetcall=function(e){this.currentNetcallChannelId=e},t.onKeepCalling=function(e){e.error||e.content.accounts.length&&this.keepCalling(e)},t.keepCalling=function(e){var t=this,r=e.obj,i=r.type,a=r.accounts,n=r.channelId;a&&a.length&&setTimeout(function(){t.currentNetcallChannelId&&t.currentNetcallChannelId===n&&t.api.keepCalling({type:i,accounts:a,channelId:n}).catch(function(){})},3e3)},t.onBeCalled=function(e){e.error||this.emitAPI({type:"beCalled",obj:e.content})},t.onNotifyCalleeAck=function(e){e.error||this.emitAPI({type:"notifyCalleeAck",obj:e.content})},t.onNotifyHangup=function(e){e.error||this.emitAPI({type:"notifyHangup",obj:e.content})},t.onNetcallControl=function(e){e.error||this.emitAPI({type:"netcallControl",obj:e.content})},t.onNotifyCalleeAckSync=function(e){e.error||this.emitAPI({type:"notifyCalleeAckSync",obj:e.content})},t.notifyJoin=function(e){e.error||this.emitAPI({type:"notifyJoin",obj:e.content})},t.joinChannel=function(e){e.obj=e.content}}};e.exports=i},function(e,t,r){"use strict";var i=r(337),a={install:function(e){var t=e.fn,r=e.util,a=i({util:r});t.initNetcall=function(e){return r.verifyOptions(e,"type accounts","netcall::initNetcall"),e.pushContent="",e.custom="",e.pushConfig||(e.pushConfig={}),e.pushConfig.webrtcEnable=e.webrtcEnable,e.pushConfig=new a(e.pushConfig),this.cbAndSendCmd("initNetcall",e)},t.keepCalling=function(e){return r.verifyOptions(e,"type accounts channelId","netcall::keepCalling"),this.cbAndSendCmd("keepCalling",e)},t.calleeAck=function(e){return r.verifyOptions(e,"account channelId type accepted","netcall::calleeAck"),this.cbAndSendCmd("calleeAck",e)},t.hangup=function(e){return r.verifyOptions(e,"channelId","netcall::hangup"),this.cbAndSendCmd("hangup",e)},t.netcallControl=function(e){return r.verifyOptions(e,"channelId type","netcall::netcallControl"),this.cbAndSendCmd("netcallControl",e)},t.createChannel=function(e){return this.cbAndSendCmd("createChannel",e)},t.joinChannel=function(e){return r.verifyOptions(e,"channelName","netcall::joinChannel"),r.verifyBooleanWithDefault(e,"liveEnable",!1,"","netcall::joinChannel"),r.verifyBooleanWithDefault(e,"webrtcEnable",!1,"","netcall::joinChannel"),this.cbAndSendCmd("joinChannel",{channelName:e.channelName,liveOption:{liveEnable:e.liveEnable?1:0,webrtcEnable:e.webrtcEnable?1:0}})},t.queryAccountUidMap=function(e,t){return this.cbAndSendCmd("queryAccountUidMap",{channelName:e,uids:t})}}};e.exports=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(r(65));r(336);var a=s(r(482)),n=r(481),o=r(27);function s(e){return e&&e.__esModule?e:{default:e}}var d=r(487),c=r(486),u=r(485),l=r(484),p=r(483);t.default=Object.assign(n.WebRTC,a.default,(0,i.default)({},o.RtcSupport,{install:function(e,t){d.install(e,t),c.install(e,t),e.parser.mixin({configMap:u,serializeMap:l,unserializeMap:p})},getInstance:function(e){var t=e.container,r=e.remoteContainer,i=e.chromeId,a=e.debug,o=e.nim,s=e.saveLogs;return new n.WebRTC({container:t,remoteContainer:r,debug:a,nim:o,saveLogs:s,chromeId:i,apiList:[],ref:this})},destroy:function(e){e&&(e.destroy(),e=null)}})),e.exports=t.default}])});
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebRTC=t():e.WebRTC=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}({0:function(e,t,i){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=i(99),o=i(161),a=i(182),s=i(71),c=i(170),d=i(171),u=i(173),l=void 0,p=n({},s,{install:function(e,t){r.install(e,t),o.install(e,t),e.parser.mixin({configMap:c,serializeMap:d,unserializeMap:u}),a.install(e,t)},getInstance:function(e){return l||(l=new a(e)),l},destroy:function(){l&&(l.destroy(),l=null)}});e.exports=p},3:function(e,t,i){(function(t){"use strict";var i="'ff80495d22439d057d1c603288cd9270f8679dff",n="ff80495'",r="4.5.5",o="2.2.0.1013",a="3.5.0",s="40",c=1,d="https://lbs.netease.im/lbs/webconf.jsp",u="development"===t.env.NODE_ENV?6e3:42e3,l={info:{hash:i,shortHash:n,version:r,sdkVersion:s,nrtcVersion:a,protocolVersion:c},agentVersion:o,lbsUrl:d,connectTimeout:u,xhrTimeout:u,socketTimeout:u,reconnectionDelay:656.25,reconnectionDelayMax:u,reconnectionJitter:.1,heartbeatInterval:18e4,cmdTimeout:u};l.formatSocketUrl=function(e){var t=e.url,i=e.secure,n=i?"https":"http";return t.indexOf("http")===-1?n+"://"+t:t},l.fileServerUrl="https://nos.netease.com",l.replaceUrl="http://nos.netease.im",l.genUploadUrl=function(e){return l.uploadUrl?l.uploadUrl+"/"+e:l.fileServerUrl+"/"+e},l.genDownloadUrl=function(e,t){return l.downloadUrl?l.replaceUrl+"/"+e+"/"+t:l.fileServerUrl+"/"+e+"/"+t},e.exports=l}).call(t,i(7))},7:function(e,t){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(e){try{return u.call(null,e,0)}catch(e){return u.call(this,e,0)}}}function o(e){if(l===clearTimeout)return clearTimeout(e);if((l===n||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(e){try{return l.call(null,e)}catch(e){return l.call(this,e)}}}function a(){m&&h&&(m=!1,h.length?f=h.concat(f):v=-1,f.length&&s())}function s(){if(!m){var e=r(a);m=!0;for(var t=f.length;t;){for(h=f,f=[];++v<t;)h&&h[v].run();v=-1,t=f.length}h=null,m=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function d(){}var u,l,p=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(e){u=i}try{l="function"==typeof clearTimeout?clearTimeout:n}catch(e){l=n}}();var h,f=[],m=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];f.push(new c(e,t)),1!==f.length||m||r(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=d,p.addListener=d,p.once=d,p.off=d,p.removeListener=d,p.removeAllListeners=d,p.emit=d,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},8:function(e,t,i){"use strict";function n(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(){this._events=new n,this._eventsCount=0}var a=Object.prototype.hasOwnProperty,s="~";Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)a.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e,t){var i=s?s+e:e,n=this._events[i];if(t)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},o.prototype.emit=function(e,t,i,n,r,o){var a=s?s+e:e;if(!this._events[a])return!1;var c,d,u=this._events[a],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,n),!0;case 5:return u.fn.call(u.context,t,i,n,r),!0;case 6:return u.fn.call(u.context,t,i,n,r,o),!0}for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u.fn.apply(u.context,c)}else{var p,h=u.length;for(d=0;d<h;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),l){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,i);break;case 4:u[d].fn.call(u[d].context,t,i,n);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];u[d].fn.apply(u[d].context,c)}}return!0},o.prototype.on=function(e,t,i){var n=new r(t,i||this),o=s?s+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},o.prototype.once=function(e,t,i){var n=new r(t,i||this,!0),o=s?s+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},o.prototype.removeListener=function(e,t,i,r){var o=s?s+e:e;if(!this._events[o])return this;if(!t)return 0===--this._eventsCount?this._events=new n:delete this._events[o],this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||i&&a.context!==i||(0===--this._eventsCount?this._events=new n:delete this._events[o]);else{for(var c=0,d=[],u=a.length;c<u;c++)(a[c].fn!==t||r&&!a[c].once||i&&a[c].context!==i)&&d.push(a[c]);d.length?this._events[o]=1===d.length?d[0]:d:0===--this._eventsCount?this._events=new n:delete this._events[o]}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new n:delete this._events[t])):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=s,o.EventEmitter=o,e.exports=o},9:function(e,t,i){var n;(function(e,r){(function(){"use strict";function o(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function a(e,t,i){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&i&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&i&&(e=e.replace(RegExp(t,"i"),i)),e=c(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function s(e,t){var i=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=w)for(;++i<n;)t(e[i],i,e);else d(e,t)}function c(e){return e=f(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:o(e)}function d(e,t){for(var i in e)A.call(e,i)&&t(e[i],i,e)}function u(e){return null==e?o(e):E.call(e).slice(8,-1)}function l(e,t){var i=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(i)||"object"==i&&!e[t])}function p(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function h(e,t){var i=null;return s(e,function(n,r){i=t(i,n,r,e)}),i}function f(e){return String(e).replace(/^ +| +$/g,"")}function m(e){function t(t){return h(t,function(t,i){return t||RegExp("\\b"+(i.pattern||p(i))+"\\b","i").exec(e)&&(i.label||i)})}function i(t){return h(t,function(t,i,n){return t||(i[Q]||i[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Q)]||RegExp("\\b"+p(n)+"(?:\\b|\\w*\\d)","i").exec(e))&&n})}function n(t){return h(t,function(t,i){return t||RegExp("\\b"+(i.pattern||p(i))+"\\b","i").exec(e)&&(i.label||i)})}function r(t){return h(t,function(t,i){var n=i.pattern||p(i);return!t&&(t=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=a(t,n,i.label||i)),t})}function o(t){return h(t,function(t,i){var n=i.pattern||p(i);return!t&&(t=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(i.label&&!RegExp(n,"i").test(i.label)?i.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),i=i.label||i,t=c(t[0].replace(RegExp(n,"i"),i).replace(RegExp("; *(?:"+i+"[_-])?","i")," ").replace(RegExp("("+i+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function s(t){return h(t,function(t,i){return t||(RegExp(i+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}function v(){return this.description||""}var S=g,b=e&&"object"==typeof e&&"String"!=u(e);b&&(S=e,e=null);var C=S.navigator||{},w=C.userAgent||"";e||(e=w);var R,A,k=b||_==y,I=b?!!C.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(E.toString()),O="Object",P=b?O:"ScriptBridgingProxyObject",M=b?O:"Environment",x=b&&S.java?"JavaPackage":u(S.java),L=b?O:"RuntimeObject",D=/\bJava/.test(x)&&S.java,V=D&&u(S.environment)==M,U=D?"a":"α",N=D?"b":"β",j=S.document||{},B=S.operamini||S.opera,F=T.test(F=b&&B?B["[[Class]]"]:u(B))?F:B=null,H=e,G=[],W=null,z=e==w,Y=z&&B&&"function"==typeof B.version&&B.version(),J=t([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),q=n(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Q=o([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation 3","PlayStation 4","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),$=i({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),K=r(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(J&&(J=[J]),$&&!Q&&(Q=o([$])),(R=/\bGoogle TV\b/.exec(Q))&&(Q=R[0]),/\bSimulator\b/i.test(e)&&(Q=(Q?Q+" ":"")+"Simulator"),"Opera Mini"==q&&/\bOPiOS\b/.test(e)&&G.push("running in Turbo/Uncompressed mode"),"IE"==q&&/\blike iPhone OS\b/.test(e)?(R=m(e.replace(/like iPhone OS/,"")),$=R.manufacturer,Q=R.product):/^iP/.test(Q)?(q||(q="Safari"),K="iOS"+((R=/ OS ([\d_]+)/i.exec(e))?" "+R[1].replace(/_/g,"."):"")):"Konqueror"!=q||/buntu/i.test(K)?$&&"Google"!=$&&(/Chrome/.test(q)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(Q))||/\bAndroid\b/.test(K)&&/^Chrome/.test(q)&&/\bVersion\//i.test(e)?(q="Android Browser",K=/\bAndroid\b/.test(K)?K:"Android"):"Silk"==q?(/\bMobi/i.test(e)||(K="Android",G.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&G.unshift("accelerated")):"PaleMoon"==q&&(R=/\bFirefox\/([\d.]+)\b/.exec(e))?G.push("identifying as Firefox "+R[1]):"Firefox"==q&&(R=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(K||(K="Firefox OS"),Q||(Q=R[1])):q&&!(R=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(q))||(q&&!Q&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(R+"/")+8))&&(q=null),(R=Q||$||K)&&(Q||$||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(K))&&(q=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(K)?K:R)+" Browser")):K="Kubuntu",Y||(Y=s(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version",p(q),"(?:Firefox|Minefield|NetFront)"])),(R="iCab"==J&&parseFloat(Y)>3&&"WebKit"||/\bOpera\b/.test(q)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(J)&&"WebKit"||!J&&/\bMSIE\b/i.test(e)&&("Mac OS"==K?"Tasman":"Trident")||"WebKit"==J&&/\bPlayStation\b(?! Vita\b)/i.test(q)&&"NetFront")&&(J=[R]),"IE"==q&&(R=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(q+=" Mobile",K="Windows Phone "+(/\+$/.test(R)?R:R+".x"),G.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(q="IE Mobile",K="Windows Phone 8.x",G.unshift("desktop mode"),Y||(Y=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=q&&"Trident"==J&&(R=/\brv:([\d.]+)/.exec(e))&&(q&&G.push("identifying as "+q+(Y?" "+Y:"")),q="IE",Y=R[1]),z){if(l(S,"global"))if(D&&(R=D.lang.System,H=R.getProperty("os.arch"),K=K||R.getProperty("os.name")+" "+R.getProperty("os.version")),k&&l(S,"system")&&(R=[S.system])[0]){K||(K=R[0].os||null);try{R[1]=S.require("ringo/engine").version,Y=R[1].join("."),q="RingoJS"}catch(e){R[0].global.system==S.system&&(q="Narwhal")}}else"object"==typeof S.process&&!S.process.browser&&(R=S.process)?(q="Node.js",H=R.arch,K=R.platform,Y=/[\d.]+/.exec(R.version)[0]):V&&(q="Rhino");else u(R=S.runtime)==P?(q="Adobe AIR",K=R.flash.system.Capabilities.os):u(R=S.phantom)==L?(q="PhantomJS",Y=(R=R.version||null)&&R.major+"."+R.minor+"."+R.patch):"number"==typeof j.documentMode&&(R=/\bTrident\/(\d+)/i.exec(e))&&(Y=[Y,j.documentMode],(R=+R[1]+4)!=Y[1]&&(G.push("IE "+Y[1]+" mode"),J&&(J[1]=""),Y[1]=R),Y="IE"==q?String(Y[1].toFixed(1)):Y[0]);K=K&&c(K)}Y&&(R=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(Y)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(z&&C.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(W=/b/i.test(R)?"beta":"alpha",Y=Y.replace(RegExp(R+"\\+?$"),"")+("beta"==W?N:U)+(/\d+\+?/.exec(R)||"")),"Fennec"==q||"Firefox"==q&&/\b(?:Android|Firefox OS)\b/.test(K)?q="Firefox Mobile":"Maxthon"==q&&Y?Y=Y.replace(/\.[\d.]+/,".x"):/\bXbox\b/i.test(Q)?(K=null,"Xbox 360"==Q&&/\bIEMobile\b/.test(e)&&G.unshift("mobile mode")):!/^(?:Chrome|IE|Opera)$/.test(q)&&(!q||Q||/Browser|Mobi/.test(q))||"Windows CE"!=K&&!/Mobi/i.test(e)?"IE"==q&&z&&null===S.external?G.unshift("platform preview"):(/\bBlackBerry\b/.test(Q)||/\bBB10\b/.test(e))&&(R=(RegExp(Q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||Y)?(R=[R,/BB10/.test(e)],K=(R[1]?(Q=null,$="BlackBerry"):"Device Software")+" "+R[0],Y=null):this!=d&&"Wii"!=Q&&(z&&B||/Opera/.test(q)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==q&&/\bOS X (?:\d+\.){2,}/.test(K)||"IE"==q&&(K&&!/^Win/.test(K)&&Y>5.5||/\bWindows XP\b/.test(K)&&Y>8||8==Y&&!/\bTrident\b/.test(e)))&&!T.test(R=m.call(d,e.replace(T,"")+";"))&&R.name&&(R="ing as "+R.name+((R=R.version)?" "+R:""),T.test(q)?(/\bIE\b/.test(R)&&"Mac OS"==K&&(K=null),R="identify"+R):(R="mask"+R,q=F?c(F.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(R)&&(K=null),z||(Y=null)),J=["Presto"],G.push(R)):q+=" Mobile",(R=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(R=[parseFloat(R.replace(/\.(\d)$/,".0$1")),R],"Safari"==q&&"+"==R[1].slice(-1)?(q="WebKit Nightly",W="alpha",Y=R[1].slice(0,-1)):Y!=R[1]&&Y!=(R[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(Y=null),R[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==R[0]&&537.36==R[2]&&parseFloat(R[1])>=28&&"WebKit"==J&&(J=["Blink"]),z&&(I||R[1])?(J&&(J[1]="like Chrome"),R=R[1]||(R=R[0],R<530?1:R<532?2:R<532.05?3:R<533?4:R<534.03?5:R<534.07?6:R<534.1?7:R<534.13?8:R<534.16?9:R<534.24?10:R<534.3?11:R<535.01?12:R<535.02?"13+":R<535.07?15:R<535.11?16:R<535.19?17:R<536.05?18:R<536.1?19:R<537.01?20:R<537.11?"21+":R<537.13?23:R<537.18?24:R<537.24?25:R<537.36?26:"Blink"!=J?"27":"28")):(J&&(J[1]="like Safari"),R=R[0],R=R<400?1:R<500?2:R<526?3:R<533?4:R<534?"4+":R<535?5:R<537?6:R<538?7:R<601?8:"8"),J&&(J[1]+=" "+(R+="number"==typeof R?".x":/[.+]/.test(R)?"":"+")),"Safari"==q&&(!Y||parseInt(Y)>45)&&(Y=R)),"Opera"==q&&(R=/\bzbov|zvav$/.exec(K))?(q+=" ",G.unshift("desktop mode"),"zvav"==R?(q+="Mini",Y=null):q+="Mobile",K=K.replace(RegExp(" *"+R+"$"),"")):"Safari"==q&&/\bChrome\b/.exec(J&&J[1])&&(G.unshift("desktop mode"),q="Chrome Mobile",Y=null,/\bOS X\b/.test(K)?($="Apple",K="iOS 4.3+"):K=null),Y&&0==Y.indexOf(R=/[\d.]+$/.exec(K))&&e.indexOf("/"+R+"-")>-1&&(K=f(K.replace(R,""))),J&&!/\b(?:Avant|Nook)\b/.test(q)&&(/Browser|Lunascape|Maxthon/.test(q)||"Safari"!=q&&/^iOS/.test(K)&&/\bSafari\b/.test(J[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(q)&&J[1])&&(R=J[J.length-1])&&G.push(R),G.length&&(G=["("+G.join("; ")+")"]),$&&Q&&Q.indexOf($)<0&&G.push("on "+$),Q&&G.push((/^on /.test(G[G.length-1])?"":"on ")+Q),K&&(R=/ ([\d.+]+)$/.exec(K),A=R&&"/"==K.charAt(K.length-R[0].length-1),K={architecture:32,family:R&&!A?K.replace(R[0],""):K,version:R?R[1]:null,toString:function(){var e=this.version;return this.family+(e&&!A?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(R=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(H))&&!/\bi686\b/i.test(H)?(K&&(K.architecture=64,K.family=K.family.replace(RegExp(" *"+R),"")),q&&(/\bWOW64\b/i.test(e)||z&&/\w(?:86|32)$/.test(C.cpuClass||C.platform)&&!/\bWin64; x64\b/i.test(e))&&G.unshift("32-bit")):K&&/^OS X/.test(K.family)&&"Chrome"==q&&parseFloat(Y)>=39&&(K.architecture=64),e||(e=null);var X={};return X.description=e,X.layout=J&&J[0],X.manufacturer=$,X.name=q,X.prerelease=W,X.product=Q,X.ua=e,X.version=q&&Y,X.os=K||{architecture:null,family:null,version:null,toString:function(){return"null"}},X.parse=m,X.toString=v,X.version&&G.unshift(Y),X.name&&G.unshift(q),K&&q&&(K!=String(K).split(" ")[0]||K!=q.split(" ")[0]&&!Q)&&G.push(Q?"("+K+")":"on "+K),G.length&&(X.description=G.join(" ")),X}var v={"function":!0,object:!0},g=v[typeof window]&&window||this,y=g,S=v[typeof t]&&t,b=v[typeof e]&&e&&!e.nodeType&&e,C=S&&b&&"object"==typeof r&&r;!C||C.global!==C&&C.window!==C&&C.self!==C||(g=C);var w=Math.pow(2,53)-1,T=/\bOpera/,_=this,R=Object.prototype,A=R.hasOwnProperty,E=R.toString,k=m();g.platform=k,n=function(){return k}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}).call(this)}).call(t,i(14)(e),function(){return this}())},14:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},33:function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0,t["default"]=function(e){if(!e.url||!e.data)return Promise.reject("参数不完整，无法发起请求");var t={method:e.type||"get",url:e.url,responseType:e.dataType||"json"};return/^get$/gi.test(t.method)&&(t.params=e.data),/^post$/gi.test(t.method)&&(t.data=e.data),(0,o["default"])(t)};var r=i(72),o=n(r);e.exports=t["default"]},34:function(e,t){"use strict";var i=!0,n={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,i){var n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!navigator.mediaDevices||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return e},shimCreateObjectURL:function(){if("object"==typeof window&&window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){var e=URL.createObjectURL.bind(URL),t=URL.revokeObjectURL.bind(URL),i=new Map,n=0;URL.createObjectURL=function(t){if("getTracks"in t){var r="polyblob:"+ ++n;return i.set(r,t),console.log("URL.createObjectURL(stream) is deprecated! Use elem.srcObject = stream instead!"),r}return e(t)},URL.revokeObjectURL=function(e){t(e),i["delete"](e)};var r=Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,"src");Object.defineProperty(window.HTMLMediaElement.prototype,"src",{get:function(){return r.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,r.set.apply(this,[e])}});var o=HTMLMediaElement.prototype.setAttribute;HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),o.apply(this,arguments)}}}};e.exports={log:n.log,disableLog:n.disableLog,browserDetails:n.detectBrowser(),extractVersion:n.extractVersion,shimCreateObjectURL:n.shimCreateObjectURL,detectBrowser:n.detectBrowser.bind(n)}},55:function(e,t){"use strict";function i(e){n(e.enable)&&(this.enable=e.enable?1:0),n(e.needBadge)&&(this.needBadge=e.needBadge?1:0),n(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0),n(e.pushContent)&&(this.pushContent=""+e.pushContent),n(e.custom)&&(this.custom=""+e.custom),n(e.pushPayload)&&(this.pushPayload=""+e.pushPayload),n(e.sound)&&(this.sound=""+e.sound),n(e.webrtcEnable)&&(this.webrtcEnable=e.webrtcEnable?1:0)}t.__esModule=!0,t["default"]=function(e){var t=e.util;return n=t.notundef,i};var n=void 0;e.exports=t["default"]},67:function(e,t){"use strict";var i={};i.html2node=function(e){var t=document.createElement("div");t.innerHTML=e;var i,n,r=[];if(t.children)for(i=0,n=t.children.length;i<n;i++)r.push(t.children[i]);else for(i=0,n=t.childNodes.length;i<n;i++){var o=t.childNodes[i];1===o.nodeType&&r.push(o)}return r.length>1?t:r[0]},i.n2node=function(e){return e?/HTML.+Element/gi.test(e)?e:e[0]&&/HTML.+Element/gi.test(e[0])?e[0]:null:null},e.exports=i},71:function(e,t){"use strict";t.__esModule=!0;var i,n={NETCALL_TYPE_AUDIO:1,NETCALL_TYPE_VIDEO:2,NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_ON:1,NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_OFF:2,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_ON:3,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_OFF:4,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO:5,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_AGREE:6,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_REJECT:7,NETCALL_CONTROL_COMMAND_SWITCH_VIDEO_TO_AUDIO:8,NETCALL_CONTROL_COMMAND_BUSY:9,NETCALL_CONTROL_COMMAND_SELF_CAMERA_INVALID:10,NETCALL_CONTROL_COMMAND_SELF_AUDIO_INVALID:11,NETCALL_CONTROL_COMMAND_SELF_ON_BACKGROUND:12,NETCALL_CONTROL_COMMAND_START_NOTIFY_RECEIVED:13,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_START:14,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_STOP:15,DEVICE_TYPE_AUDIO_IN:0,DEVICE_TYPE_AUDIO_OUT_LOCAL:1,DEVICE_TYPE_AUDIO_OUT_CHAT:2,DEVICE_TYPE_VIDEO:3,DEVICE_TYPE_DESKTOP_SCREEN:4,DEVICE_TYPE_DESKTOP_WINDOW:5,CHAT_VIDEO_QUALITY_NORMAL:0,CHAT_VIDEO_QUALITY_LOW:1,CHAT_VIDEO_QUALITY_MEDIUM:2,CHAT_VIDEO_QUALITY_HIGH:3,CHAT_VIDEO_QUALITY_480P:4,CHAT_VIDEO_QUALITY_540P:5,CHAT_VIDEO_QUALITY_720P:6,CHAT_VIDEO_FRAME_RATE_NORMAL:0,CHAT_VIDEO_FRAME_RATE_5:1,CHAT_VIDEO_FRAME_RATE_10:2,CHAT_VIDEO_FRAME_RATE_15:3,CHAT_VIDEO_FRAME_RATE_20:4,CHAT_VIDEO_FRAME_RATE_25:5,LAYOUT_SPLITBOTTOMHORFLOATING:0,LAYOUT_SPLITTOPHORFLOATING:1,LAYOUT_SPLITLATTICETILE:2,LAYOUT_SPLITLATTICECUTTINGTILE:3,LAYOUT_SPLITCUSTOM:4,HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1};n.deviceTypeMap=(i={},i[n.DEVICE_TYPE_AUDIO_IN]="audioIn",i[n.DEVICE_TYPE_AUDIO_OUT_CHAT]="audioOut",i[n.DEVICE_TYPE_VIDEO]="video",i),n.getDeviceTypeStr=function(e){return n.deviceTypeMap[e]},t["default"]=n,e.exports=t["default"]},72:function(e,t,i){(function(t){!function(t,i){e.exports=i()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function n(e){var t=new a(e),i=o(a.prototype.request,t);return r.extend(i,a.prototype,t),r.extend(i,t),i}var r=i(2),o=i(3),a=i(4),s=i(5),c=n(s);c.Axios=a,c.create=function(e){return n(r.merge(s,e))},c.Cancel=i(22),c.CancelToken=i(23),c.isCancel=i(19),c.all=function(e){return Promise.all(e)},c.spread=i(24),e.exports=c,e.exports["default"]=c},function(e,t,i){"use strict";function n(e){return"[object Array]"===T.call(e)}function r(e){return"[object ArrayBuffer]"===T.call(e)}function o(e){return"undefined"!=typeof FormData&&e instanceof FormData}function a(e){var t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function s(e){return"string"==typeof e}function c(e){return"number"==typeof e}function d(e){return"undefined"==typeof e}function u(e){return null!==e&&"object"==typeof e}function l(e){return"[object Date]"===T.call(e)}function p(e){return"[object File]"===T.call(e)}function h(e){return"[object Blob]"===T.call(e)}function f(e){return"[object Function]"===T.call(e)}function m(e){return u(e)&&f(e.pipe)}function v(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function g(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function y(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement}function S(e,t){if(null!==e&&"undefined"!=typeof e)if("object"==typeof e||n(e)||(e=[e]),n(e))for(var i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function b(){function e(e,i){"object"==typeof t[i]&&"object"==typeof e?t[i]=b(t[i],e):t[i]=e}for(var t={},i=0,n=arguments.length;i<n;i++)S(arguments[i],e);return t}function C(e,t,i){return S(t,function(t,n){i&&"function"==typeof t?e[n]=w(t,i):e[n]=t}),e}var w=i(3),T=Object.prototype.toString;e.exports={isArray:n,isArrayBuffer:r,isFormData:o,isArrayBufferView:a,isString:s,isNumber:c,isObject:u,isUndefined:d,isDate:l,isFile:p,isBlob:h,isFunction:f,isStream:m,isURLSearchParams:v,isStandardBrowserEnv:y,forEach:S,merge:b,extend:C,trim:g}},function(e,t){"use strict";e.exports=function(e,t){return function(){for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];return e.apply(t,i)}}},function(e,t,i){"use strict";function n(e){this.defaults=e,this.interceptors={request:new a,response:new a}}var r=i(5),o=i(2),a=i(16),s=i(17),c=i(20),d=i(21);n.prototype.request=function(e){"string"==typeof e&&(e=o.merge({url:arguments[0]},arguments[1])),e=o.merge(r,this.defaults,{method:"get"},e),e.baseURL&&!c(e.url)&&(e.url=d(e.baseURL,e.url));var t=[s,void 0],i=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)i=i.then(t.shift(),t.shift());return i},o.forEach(["delete","get","head"],function(e){n.prototype[e]=function(t,i){return this.request(o.merge(i||{},{method:e,url:t}))}}),o.forEach(["post","put","patch"],function(e){n.prototype[e]=function(t,i,n){return this.request(o.merge(n||{},{method:e,url:t,data:i}))}}),e.exports=n},function(e,i,n){"use strict";function r(e,t){!a.isUndefined(e)&&a.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function o(){var e;return"undefined"!=typeof XMLHttpRequest?e=n(7):"undefined"!=typeof t&&(e=n(7)),e}var a=n(2),s=n(6),c=/^\)\]\}',?\n/,d={"Content-Type":"application/x-www-form-urlencoded"},u={adapter:o(),transformRequest:[function(e,t){return s(t,"Content-Type"),a.isFormData(e)||a.isArrayBuffer(e)||a.isStream(e)||a.isFile(e)||a.isBlob(e)?e:a.isArrayBufferView(e)?e.buffer:a.isURLSearchParams(e)?(r(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):a.isObject(e)?(r(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e){e=e.replace(c,"");try{e=JSON.parse(e)}catch(e){}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};u.headers={common:{Accept:"application/json, text/plain, */*"}},a.forEach(["delete","get","head"],function(e){u.headers[e]={}}),a.forEach(["post","put","patch"],function(e){u.headers[e]=a.merge(d)}),e.exports=u},function(e,t,i){"use strict";var n=i(2);e.exports=function(e,t){n.forEach(e,function(i,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[n])})}},function(e,t,i){"use strict";var n=i(2),r=i(8),o=i(11),a=i(12),s=i(13),c=i(9),d="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||i(14);e.exports=function(e){return new Promise(function(t,u){var l=e.data,p=e.headers;n.isFormData(l)&&delete p["Content-Type"];var h=new XMLHttpRequest,f="onreadystatechange",m=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in h||s(e.url)||(h=new window.XDomainRequest,f="onload",m=!0,h.onprogress=function(){},h.ontimeout=function(){}),e.auth){var v=e.auth.username||"",g=e.auth.password||"";p.Authorization="Basic "+d(v+":"+g)}if(h.open(e.method.toUpperCase(),o(e.url,e.params,e.paramsSerializer),!0),h.timeout=e.timeout,h[f]=function(){if(h&&(4===h.readyState||m)&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))){var i="getAllResponseHeaders"in h?a(h.getAllResponseHeaders()):null,n=e.responseType&&"text"!==e.responseType?h.response:h.responseText,o={data:n,status:1223===h.status?204:h.status,statusText:1223===h.status?"No Content":h.statusText,headers:i,config:e,request:h};r(t,u,o),h=null}},h.onerror=function(){u(c("Network Error",e)),h=null},h.ontimeout=function(){u(c("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED")),h=null},n.isStandardBrowserEnv()){var y=i(15),S=(e.withCredentials||s(e.url))&&e.xsrfCookieName?y.read(e.xsrfCookieName):void 0;S&&(p[e.xsrfHeaderName]=S)}if("setRequestHeader"in h&&n.forEach(p,function(e,t){"undefined"==typeof l&&"content-type"===t.toLowerCase()?delete p[t]:h.setRequestHeader(t,e)}),e.withCredentials&&(h.withCredentials=!0),e.responseType)try{h.responseType=e.responseType}catch(e){if("json"!==h.responseType)throw e}"function"==typeof e.onDownloadProgress&&h.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&h.upload&&h.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){h&&(h.abort(),
u(e),h=null)}),void 0===l&&(l=null),h.send(l)})}},function(e,t,i){"use strict";var n=i(9);e.exports=function(e,t,i){var r=i.config.validateStatus;i.status&&r&&!r(i.status)?t(n("Request failed with status code "+i.status,i.config,null,i)):e(i)}},function(e,t,i){"use strict";var n=i(10);e.exports=function(e,t,i,r){var o=new Error(e);return n(o,t,i,r)}},function(e,t){"use strict";e.exports=function(e,t,i,n){return e.config=t,i&&(e.code=i),e.response=n,e}},function(e,t,i){"use strict";function n(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var r=i(2);e.exports=function(e,t,i){if(!t)return e;var o;if(i)o=i(t);else if(r.isURLSearchParams(t))o=t.toString();else{var a=[];r.forEach(t,function(e,t){null!==e&&"undefined"!=typeof e&&(r.isArray(e)&&(t+="[]"),r.isArray(e)||(e=[e]),r.forEach(e,function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(n(t)+"="+n(e))}))}),o=a.join("&")}return o&&(e+=(e.indexOf("?")===-1?"?":"&")+o),e}},function(e,t,i){"use strict";var n=i(2);e.exports=function(e){var t,i,r,o={};return e?(n.forEach(e.split("\n"),function(e){r=e.indexOf(":"),t=n.trim(e.substr(0,r)).toLowerCase(),i=n.trim(e.substr(r+1)),t&&(o[t]=o[t]?o[t]+", "+i:i)}),o):o}},function(e,t,i){"use strict";var n=i(2);e.exports=n.isStandardBrowserEnv()?function(){function e(e){var t=e;return i&&(r.setAttribute("href",t),t=r.href),r.setAttribute("href",t),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}var t,i=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");return t=e(window.location.href),function(i){var r=n.isString(i)?e(i):i;return r.protocol===t.protocol&&r.host===t.host}}():function(){return function(){return!0}}()},function(e,t){"use strict";function i(){this.message="String contains an invalid character"}function n(e){for(var t,n,o=String(e),a="",s=0,c=r;o.charAt(0|s)||(c="=",s%1);a+=c.charAt(63&t>>8-s%1*8)){if(n=o.charCodeAt(s+=.75),n>255)throw new i;t=t<<8|n}return a}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.prototype=new Error,i.prototype.code=5,i.prototype.name="InvalidCharacterError",e.exports=n},function(e,t,i){"use strict";var n=i(2);e.exports=n.isStandardBrowserEnv()?function(){return{write:function(e,t,i,r,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),n.isNumber(i)&&s.push("expires="+new Date(i).toGMTString()),n.isString(r)&&s.push("path="+r),n.isString(o)&&s.push("domain="+o),a===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},function(e,t,i){"use strict";function n(){this.handlers=[]}var r=i(2);n.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(e){r.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=n},function(e,t,i){"use strict";function n(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var r=i(2),o=i(18),a=i(19),s=i(5);e.exports=function(e){n(e),e.headers=e.headers||{},e.data=o(e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),r.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]});var t=e.adapter||s.adapter;return t(e).then(function(t){return n(e),t.data=o(t.data,t.headers,e.transformResponse),t},function(t){return a(t)||(n(e),t&&t.response&&(t.response.data=o(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,i){"use strict";var n=i(2);e.exports=function(e,t,i){return n.forEach(i,function(i){e=i(e,t)}),e}},function(e,t){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t){"use strict";e.exports=function(e,t){return e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")}},function(e,t){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,i){"use strict";function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var i=this;e(function(e){i.reason||(i.reason=new r(e),t(i.reason))})}var r=i(22);n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var e,t=new n(function(t){e=t});return{token:t,cancel:e}},e.exports=n},function(e,t){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}}])})}).call(t,i(7))},86:function(e,t,i){"use strict";var n=i(146),r=i(147),o={};o.install=function(e){n.install(e),r.install(e)},o.init=function(e,t){this.dataApi=new n(e,t),this.dataRtc=new r(e)},e.exports=o},99:function(e,t,i){"use strict";var n=i(55),r={};r.install=function(e){var t=e.fn,i=e.util,r=n({util:i});t.initNetcall=function(e){return i.verifyOptions(e,"type accounts"),e.pushContent="",e.custom="",e.pushConfig||(e.pushConfig={}),e.pushConfig.webrtcEnable=e.webrtcEnable,e.pushConfig=new r(e.pushConfig),this.cbAndSendCmd("initNetcall",e)},t.keepCalling=function(e){return i.verifyOptions(e,"type accounts channelId"),this.cbAndSendCmd("keepCalling",e)},t.calleeAck=function(e){return i.verifyOptions(e,"account channelId type accepted"),this.cbAndSendCmd("calleeAck",e)},t.hangup=function(e){return i.verifyOptions(e,"channelId"),this.cbAndSendCmd("hangup",e)},t.netcallControl=function(e){return i.verifyOptions(e,"channelId type"),this.cbAndSendCmd("netcallControl",e)},t.createChannel=function(e){return this.cbAndSendCmd("createChannel",e)},t.joinChannel=function(e){return i.verifyOptions(e,"channelName"),i.verifyBooleanWithDefault(e,"liveEnable",!1),i.verifyBooleanWithDefault(e,"webrtcEnable",!1),this.cbAndSendCmd("joinChannel",{channelName:e.channelName,liveOption:{liveEnable:e.liveEnable?1:0,webrtcEnable:e.webrtcEnable?1:0}})},t.queryAccountUidMap=function(e,t){return this.cbAndSendCmd("queryAccountUidMap",{channelName:e,uids:t})}},e.exports=r},146:function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=i(33),a=n(o),s=i(3),c=s.info.nrtcVersion,d="https://statistic.live.126.net/statistic/realtime/sdkFunctioninfo",u=void 0,l=void 0,p=function f(e,t){r(this,f),this.apis={},this.isRtc=/WebRTC/.test(t),this.init(e,t),this.resetStatus()};p.install=function(e){u=u||e.Promise,l=e.util};var h=p.prototype;h.init=function(e,t){l.merge(this.apis,{ver:1,platform:t,sdk_ver:c||"v4.4.0",uid:null,appkey:e,time:null})},h.startInfo=function(e){l.merge(this.apis,e)},h.resetStatus=function(){this.calling=!1,l.merge(this.apis,{p2p:{value:0},meeting:{value:0},bypass:{value:0},call_control_type:{value:0},self_mute:{value:-1},self_mic_mute:{value:-1},switch_p2p_type:{value:0},set_speaker:{value:-1},net_detect:{value:this.isRtc?-1:0},beautify:{value:-1},water_mark:{value:-1},audio_samples:{value:-1},video_samples:{value:-1},pre_view_mirror:{value:-1},code_mirror:{value:-1},custom_audio:{value:-1},custom_video:{value:-1},audio_mix:{value:-1},snap_shot:{value:-1},record:{value:0},audio_record:{value:0},display:{value:0},android_compatibility:{value:-1},hd_audio:{value:0},video_quality:{value:0},fps:{value:0},prefered_video_encoder:{value:-1},prefered_video_decoder:{value:-1},video_max_encode_bitrate:{value:this.isRtc?-1:0},audio_scene:{value:-1},video_adaptive_strategy:{value:this.isRtc?-1:0},ans:{value:this.isRtc?-1:0},agc:{value:this.isRtc?-1:0},dtx:{value:this.isRtc?-1:0},aec:{value:this.isRtc?-1:0},awc:{value:this.isRtc?-1:0}})},h.updateApi=function(e,t){this.apis[e]&&(this.apis[e].value=1,void 0!==t&&(this.apis[e].ext=t),/(p2p|meeting)/.test(e)&&(this.calling=!0))},h.sendApi=function(){var e=this;this.calling&&(this.calling=!1,this.apis.time=Date.now(),console.log("----- send apiData ------",this.apis),(0,a["default"])({type:"post",url:d,data:this.apis}).then(function(t){e.resetStatus()})["catch"](function(t){console.log("err",t),e.resetStatus()}))},e.exports=p},147:function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=i(33),a=n(o),s=i(9),c=i(3),d=c.info.nrtcVersion,u="https://statistic.live.126.net/statistic/realtime/sdkinfo",l=void 0,p=void 0,h=function v(e){r(this,v),this.infos={},this.userlist=[],this.localVolumn=0,this.local={},this.remote={},this.init(e),this.resetStatus()};h.install=function(e){l=l||e.Promise,p=e.util};var f=h.prototype;f.init=function(e){p.merge(this.infos,{ver:1,device:-1,isp:-1,platform:m.convertPlatform(s.os.family)+"-"+s.os.version,browser:s.name+"-"+s.version,sdk_ver:d||"v4.2.0",appkey:e,interval:60,samples:30,time:null,qos_algorithm:-1,fec_algorithm:-1,qos_scene:-1,qos_strategy:-1})},f.resetStatus=function(){p.merge(this.infos,{uid:null,cid:null,push_url:null,turn_ip:null,proxy_ip:null,meeting:!1,live:!1}),this.clearInfoData(),this.uidSsrcMap={},this.userlist=[]},f.initInfoData=function(e){var t={uid:e,cid:this.imInfo&&this.imInfo.channelId||-1,push_url:this.sessionConfig&&this.sessionConfig.rtmpUrl||-1,turn_ip:this.imInfo&&this.imInfo.turnMap||-1,proxy_ip:this.imInfo&&this.imInfo.turnMap||-1,meeting:/^meeting$/gi.test(this.imInfo.sessionMode),live:this.sessionConfig&&this.sessionConfig.liveEnable||!1,p2p:!1,isp:-1,net:-1,connect_state:this.imInfo&&this.imInfo.code||200,signalling_time:(this.sessionConfig&&this.sessionConfig.signalEndTime||0)-(this.sessionConfig&&this.sessionConfig.signalStartTime||0),connect_time:(this.sessionConfig&&this.sessionConfig.rtcEndTime||0)-(this.sessionConfig&&this.sessionConfig.rtcStartTime||0)};p.merge(this.infos,t)},f.clearInfoData=function(){this.localVolumn=0,p.merge(this.infos,{rx:{audio:[],video:[]},tx:{a_lost:[],v_lost:[],rtt:[],rtt_mdev:[],set_v_fps:[],qos_v_fps:[],v_fps:[],set_v_quality:[],real_v_res:[],real_v_kbps:[],real_v_kbps_n:[],real_a_kbps:[],real_a_kbps_n:[],set_v_kbps:[],qos_v_kbps:[],tx_bw_kbps:[],a_volume:[]}})},f.startInfo=function(e){var t=this,i=e.imInfo,n=e.remoteUidMsidMap,r=e.sessionConfig,o=e.rtcConnection,a=e.uid;i&&n&&o&&(this.imInfo=i||{},this.remoteUidMsidMap=n||{},this.sessionConfig=r||{},this.rtcConnection=o,this.videoConfig=e.videoConfig||{},this.sdkInfoTimer||(this.getTurnMap(),this.initInfoData(a),this.format(),this.sdkInfoTimer=setInterval(function(){t.sendInfo()},1e3*this.infos.interval)))},f.stopInfo=function(){this.sdkInfoTimer&&this.resetStatus()},f.updateInfo=function(e){this.rtcStats=e,this.format(),this.updateRxMediaInfo(),this.updateTxMediaInfo()},f.updateInfoOnce=function(e){var t=e.imInfo,i=e.remoteUidMsidMap,n=e.sessionConfig,r=e.rtcConnection;t&&(this.imInfo=t||{},this.remoteUidMsidMap=i||{},this.sessionConfig=n||{},this.rtcConnection=r||{},this.videoConfig=e.videoConfig||{},this.getTurnMap(),this.initInfoData(),this.sendInfo())},f.updateLocalVolumn=function(e){this.localVolumn=e},f.updateRxMediaInfo=function(){var e=this,t={u:[],g:[],c:[],bn:[],bc:[]},i={u:[],i:[],bn:[],bc:[],r:[],f:[]};this.userlist.map(function(n){var r=e.getMediaStats(n);t.u.push(r.audio.u),t.g.push(-1),t.c.push(-1),t.bn.push(r.audio.bn),t.bc.push(r.audio.bc),i.u.push(r.video.u),i.i.push(r.video.i),i.bn.push(r.video.bn),i.bc.push(r.video.bc),i.r.push(r.video.r),i.f.push(r.video.f)}),this.infos.rx.audio.push(t),this.infos.rx.video.push(i)},f.getMediaStats=function(e){var t=this.rtcStats,i={audio:{u:+e,g:-1,c:-1,bn:0,bc:0},video:{u:+e,i:-1,bn:0,bc:0,r:-1,f:0}},n={},r=this.uidSsrcMap[e];if(!r)return i;r=r.join("|");var o=new RegExp("("+r+")");return t.results.filter(function(e){return o.test(e.ssrc)&&(n[e.mediaType]=e),o.test(e)}),n.audio&&(i.audio.bn=(n.audio.availableBandwidth||0)-0,i.audio.bc=-1),n.video&&(i.video.bn=(n.video.availableBandwidth||0)-0,i.video.bc=n.video.googFrameWidthReceived+"x"+n.video.googFrameHeightReceived,i.video.f=(n.video.googFrameRateDecoded||0)-0),i},f.getLocalMediaStats=function(){var e=this.rtcStats,t={a_lost:-1,v_lost:-1,rtt:0,rtt_mdev:-1,set_v_fps:this.videoConfig.frameRate||0,qos_v_fps:0,v_fps:0,set_v_quality:this.sessionConfig.videoQuality,real_v_res:0,real_v_kbps:0,real_v_kbps_n:0,real_a_kbps:-1,real_a_kbps_n:0,set_v_kbps:-1,qos_v_kbps:0,tx_bw_kbps:0,a_volume:0},i={},n=this.imInfo.uid,r=this.uidSsrcMap[n];if(!r)return t;r=r.join("|");var o=new RegExp("("+r+")");return e.results.filter(function(e){return e.localCandidateId?void(i.rtt=e):(o.test(e.ssrc)&&(i[e.mediaType]=e),o.test(e))}),i.audio&&(t.real_a_kbps_n=(i.audio.availableBandwidth||e.audio.send.availableBandwidth)-0,t.a_volume=this.localVolumn-0),i.video&&(t.qos_v_fps=i.video.googFrameRateInput-0,t.v_fps=i.video.googFrameRateSent-0,t.real_v_res=i.video.googFrameWidthSent+"x"+i.video.googFrameHeightSent,t.real_v_kbps=i.video.googEncodeUsagePercent-0,t.real_v_kbps_n=i.video.availableBandwidth-0),t.rtt=i.rtt.googRtt-0,t.tx_bw_kbps=(e.connectionType.bitsSentPerSecond||0)-0,t},f.updateTxMediaInfo=function(){var e=this.getLocalMediaStats(),t=this.infos.tx;for(var i in e)t[i].push(e[i]);this.infos.net=m.convertNetwork(this.rtcStats.connectionType.local.networkType[0])},f.getTurnMap=function(){var e=this.imInfo;e.serverMap&&(e.turnMap=JSON.parse(e.serverMap||null),e.turnMap=e.turnMap&&e.turnMap.turnaddrs,e.turnMap=e.turnMap&&e.turnMap[0],e.turnMap=e.turnMap.constructor===Array?e.turnMap[0]:e.turnMap,e.turnMap=e.turnMap&&e.turnMap.match(/\d+\.\d+.\d+\.\d+/),e.turnMap=e.turnMap[0])},f.getSsrc=function(e,t){var i=[],n={audio:this.getTypeSsrc("audio",e,t),video:this.getTypeSsrc("video",e,t)};return n.audio&&i.push(n.audio),n.video&&i.push(n.video),i},f.getTypeSsrc=function(e,t,i){var n=void 0,r="";if(n=new RegExp(e+"[.\\r\\n\\s\\S]*ssrc:(\\d+)\\smsid:"+t),r=i.match(n),r=r&&r[0])return n=new RegExp("ssrc:\\d+\\smsid:"+t),r=r.match(n),r=r.map(function(e){return n=new RegExp("ssrc:(\\d+)\\s"),e=e.match(n),e[1]})},f.format=function(){this.formatLocal(),this.formatRemote()},f.formatLocal=function(){this.localSdp=this.rtcConnection.localDescription,this.localStream=this.rtcConnection.getLocalStreams()[0],this.localStream&&(this.uidSsrcMap[this.imInfo.uid]=this.getSsrc(this.localStream.id,this.localSdp.sdp),this.local.ssrc=this.uidSsrcMap[this.imInfo.uid])},f.formatRemote=function(){this.remoteSdp=this.rtcConnection.remoteDescription,this.userlist=[];var e=this.remoteUidMsidMap;for(var t in e)this.userlist.push(t),this.remote[t]={},this.uidSsrcMap[t]=this.getSsrc(e[t],this.remoteSdp.sdp),this.remote[t].ssrc=this.uidSsrcMap[t]},f.sendInfo=function(){var e=this;this.infos.uid&&this.infos.cid&&(this.infos.time=Date.now(),this.infos.samples=this.infos.rx.audio.length,(0,a["default"])({type:"post",url:u,data:this.infos}).then(function(t){e.clearInfoData()})["catch"](function(t){e.clearInfoData()}))};var m={convertNetwork:function(e){var t={wlan:"wifi",lan:"ethernet"};return t[e]||"unknown"},convertPlatform:function(e){var t=/Windows/i,i=/OS X/i,n=void 0;return n=t.test(e)&&"Win"||e,n=i.test(n)&&"Mac"||n}};e.exports=h},161:function(e,t){"use strict";var i={};i.install=function(e){var t=e.Protocol.fn;t.processNetcall=function(e){switch(e.cmd){case"initNetcall":this.onInitNetcall(e);break;case"beCalled":this.onBeCalled(e);break;case"keepCalling":this.onKeepCalling(e);break;case"calleeAck":break;case"notifyCalleeAck":this.onNotifyCalleeAck(e);break;case"hangup":break;case"notifyHangup":this.onNotifyHangup(e);break;case"notifyNetcallControl":this.onNetcallControl(e);break;case"notifyCalleeAckSync":this.onNotifyCalleeAckSync(e);break;case"notifyNetcallRecord":this.onMsg(e);break;case"createChannel":break;case"joinChannel":this.joinChannel(e);break;case"notifyJoin":this.notifyJoin(e)}},t.onInitNetcall=function(e){if(!e.error){var t=e.obj.type;e.obj=e.content,e.obj.type=t,e.obj.accounts=e.obj.keepCallingAccounts,this.setCurrentNetcall(e.obj.channelId),this.keepCalling(e)}},t.setCurrentNetcall=function(e){this.currentNetcallChannelId=e},t.onKeepCalling=function(e){e.error||e.content.accounts.length&&this.keepCalling(e)},t.keepCalling=function(e){var t=this,i=e.obj,n=i.type,r=i.accounts,o=i.channelId;r&&r.length&&setTimeout(function(){t.currentNetcallChannelId&&t.currentNetcallChannelId===o&&t.api.keepCalling({type:n,accounts:r,channelId:o})["catch"](function(){})},3e3)},t.onBeCalled=function(e){e.error||this.emitAPI({type:"beCalled",obj:e.content})},t.onNotifyCalleeAck=function(e){e.error||this.emitAPI({type:"notifyCalleeAck",obj:e.content})},t.onNotifyHangup=function(e){e.error||this.emitAPI({type:"notifyHangup",obj:e.content})},t.onNetcallControl=function(e){e.error||this.emitAPI({type:"netcallControl",obj:e.content})},t.onNotifyCalleeAckSync=function(e){e.error||this.emitAPI({type:"notifyCalleeAckSync",obj:e.content})},t.notifyJoin=function(e){e.error||this.emitAPI({type:"notifyJoin",obj:e.content})},t.joinChannel=function(e){e.obj=e.content}},e.exports=i},170:function(e,t){"use strict";var i=9,n={netcall:{id:i,initNetcall:1,keepCalling:3,calleeAck:4,notifyCalleeAck:5,hangup:6,notifyHangup:7,netcallControl:8,notifyNetcallControl:9,verifyChannelId:10,createChannel:13,joinChannel:14,queryAccountUidMap:16}},r={initNetcall:{sid:i,cid:n.netcall.initNetcall,params:[{type:"byte",name:"type"},{type:"StrArray",name:"accounts"},{type:"String",name:"pushContent"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"}]},keepCalling:{sid:i,cid:n.netcall.keepCalling,params:[{type:"byte",name:"type"},{type:"StrArray",name:"accounts"},{type:"long",name:"channelId"}]},calleeAck:{sid:i,cid:n.netcall.calleeAck,params:[{type:"string",name:"account"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"}]},hangup:{sid:i,cid:n.netcall.hangup,params:[{type:"long",name:"channelId"}]},netcallControl:{sid:i,cid:n.netcall.netcallControl,params:[{type:"long",name:"channelId"},{type:"byte",name:"type"}]},verifyChannelId:{sid:i,cid:n.netcall.verifyChannelId,params:[{type:"long",name:"channelId"},{type:"String",name:"account"}]},createChannel:{sid:i,cid:n.netcall.createChannel,params:[{type:"String",name:"channelName"},{type:"String",name:"custom"},{type:"String",name:"webrtcEnable"}]},joinChannel:{sid:i,cid:n.netcall.joinChannel,params:[{type:"String",name:"channelName"},{type:"Property",name:"liveOption"}]},queryAccountUidMap:{sid:i,cid:n.netcall.queryAccountUidMap,params:[{type:"String",name:"channelName"},{type:"LongArray",name:"uids"}]}},o="netcall",a={"9_1":{service:o,cmd:"initNetcall",response:[{type:"Number",name:"timetag"},{type:"Number",name:"uid"},{type:"Number",name:"channelId"},{type:"StrArray",name:"turnServerList"},{type:"StrArray",name:"sturnServerList"},{type:"StrArray",name:"proxyServerList"},{type:"StrArray",name:"keepCallingAccounts"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"clientConfig"},{type:"String",name:"serverMap"}]},"9_2":{service:o,cmd:"beCalled",response:[{type:"Number",name:"timetag"},{type:"Number",name:"type"},{type:"Number",name:"channelId"},{type:"String",name:"account"},{type:"Number",name:"uid"},{type:"StrArray",name:"turnServerList"},{type:"StrArray",name:"sturnServerList"},{type:"StrArray",name:"proxyServerList"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"clientConfig"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"},{type:"String",name:"serverMap"}]},"9_3":{service:o,cmd:"keepCalling",response:[{type:"StrArr",name:"accounts"}]},"9_4":{service:o,cmd:"calleeAck",response:[]},"9_5":{service:o,cmd:"notifyCalleeAck",response:[{type:"String",name:"account"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"}]},"9_6":{service:o,cmd:"hangup",response:[]},"9_7":{service:o,cmd:"notifyHangup",response:[{type:"long",name:"channelId"},{type:"String",name:"account"},{type:"long",name:"timetag"}]},"9_8":{service:o,cmd:"netcallControl",response:[]},"9_9":{service:o,cmd:"notifyNetcallControl",response:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"long",name:"channelId"}]},"9_10":{service:o,cmd:"verifyChannelId",response:[]},"9_11":{service:o,cmd:"notifyNetcallRecord",response:[{type:"Property",name:"msg"}]},"9_12":{service:o,cmd:"notifyCalleeAckSync",response:[{type:"String",name:"timetag"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"},{type:"byte",name:"fromClientType"}]},"9_13":{service:o,cmd:"createChannel",response:[{type:"long",name:"timetag"}]},"9_14":{service:o,cmd:"joinChannel",response:[{type:"long",name:"timetag"},{type:"long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"serverMap"},{type:"String",name:"clientConfig"},{type:"String",name:"custom"}]},"9_15":{service:o,cmd:"notifyJoin",response:[{type:"Long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"}]},"9_16":{service:o,cmd:"queryAccountUidMap",response:[]}};e.exports={idMap:n,cmdConfig:r,packetConfig:a}},171:function(e,t){"use strict";e.exports={pushConfig:{enable:1,needBadge:2,needPushNick:3,pushContent:4,custom:5,pushPayload:6,sound:7,webrtcEnable:10},liveOption:{liveEnable:1,webrtcEnable:2}}},173:function(e,t){"use strict";e.exports={pushConfig:{1:"enable",2:"needBadge",3:"needPushNick",4:"pushContent",5:"custom",6:"pushPayload",7:"sound",10:"webrtcEnable"},liveOption:{1:"liveEnable",2:"webrtcEnable"}}},174:function(e,t,i){"use strict";!function(){var t=i(34),n=t.log,r=t.browserDetails;e.exports.browserDetails=r,e.exports.extractVersion=t.extractVersion,e.exports.disableLog=t.disableLog;var o=i(224)||null,a=i(226)||null,s=i(229)||null,c=i(231)||null;switch(r.browser){case"chrome":if(!o||!o.shimPeerConnection)return void n("Chrome shim is not included in this adapter release.");n("adapter.js shimming chrome."),e.exports.browserShim=o,o.shimGetUserMedia(),o.shimMediaStream(),t.shimCreateObjectURL(),o.shimSourceObject(),o.shimPeerConnection(),o.shimOnTrack(),o.shimGetSendersWithDtmf();break;case"firefox":if(!s||!s.shimPeerConnection)return void n("Firefox shim is not included in this adapter release.");n("adapter.js shimming firefox."),e.exports.browserShim=s,s.shimGetUserMedia(),t.shimCreateObjectURL(),s.shimSourceObject(),s.shimPeerConnection(),s.shimOnTrack();break;case"edge":if(!a||!a.shimPeerConnection)return void n("MS edge shim is not included in this adapter release.");n("adapter.js shimming edge."),e.exports.browserShim=a,a.shimGetUserMedia(),t.shimCreateObjectURL(),a.shimPeerConnection(),a.shimReplaceTrack();break;case"safari":if(!c)return void n("Safari shim is not included in this adapter release.");n("adapter.js shimming safari."),e.exports.browserShim=c,c.shimOnAddStream(),c.shimGetUserMedia();break;default:n("Unsupported browser!")}}()},181:function(e,t,i){"use strict";function n(e,t,i){this.support=r.WebAudio&&r.MediaStream,this.gain=1,this.stream=e,this.support&&(this.audioIn={},this.uid=t||0,this.isAnalyze=i,this.instant=0,this.slow=0,this.clip=0,this.init())}var r=i(215);n.ac=r.WebAudio&&r.MediaStream?new r.AudioContext:{},n.destination=n.ac.createMediaStreamDestination?n.ac.createMediaStreamDestination():{};var o=n.prototype;o.context=n.ac,o.init=function(){this.validateInput()&&(this.isAnalyze&&this.initMonitor(),this.formatStreams(),this.initWebAudio(),this.initAudioIn())},o.validateInput=function(){var e=this.stream;return/(Array|MediaStream|LocalMediaStream)/.test(e.constructor)},o.initMonitor=function(){var e=this,t=this.script=this.context.createScriptProcessor(0,1,1);t.onaudioprocess=function(t){var i,n=t.inputBuffer.getChannelData(0),r=0,o=0;for(i=0;i<n.length;++i)r+=Math.abs(n[i]),Math.abs(n[i])>.99&&(o+=1);e.instant=Math.sqrt(r/n.length),e.slow=.95*e.slow+.05*e.instant,e.clip=o/n.length}},o.initWebAudio=function(){var e=this.context;this.gainFilter=e.createGain(),this.destination=e.createMediaStreamDestination(),this.gainFilter.gain.value=this.gain,this.gainFilter.connect(this.destination)},o.initAudioIn=function(){function e(e){if(!/(MediaStream|LocalMediaStream)/.test(e.constructor))return null;if(0===e.getAudioTracks().length)return null;var t=r.createMediaStreamSource(e);return i.isAnalyze&&i.script&&(t.connect(i.script),i.script.connect(i.gainFilter)),t.connect(i.gainFilter),t}var t=this,i=this,n=this.stream,r=this.context,o=void 0;return/(MediaStream|LocalMediaStream)/.test(n.constructor)?(e(n),void(this.outputStream=this.destination.stream)):void(n.constructor===Array&&(n.forEach(function(i){o=e(i),o&&(t.audioIn[i.id]=o)}),this.outputStream=this.destination.stream))},o.formatStreams=function(){var e=this.stream,t=[];return/(MediaStream|LocalMediaStream)/.test(e.constructor)?(e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))}),void(this.stream=t)):void(e.constructor===Array&&(e.map(function(e){e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))})}),this.stream=t))},o.addStream=function(e){var t=this.context;if(0!==e.getAudioTracks().length){var i=t.createMediaStreamSource(e);this.isAnalyze&&this.script&&i.connect(this.script),i.connect(this.gainFilter),this.audioIn[e.id]=i,this.outputStream=this.destination.stream}},o.updateStream=function(e){if(this.audioIn)for(var t in this.audioIn)this.audioIn[t]&&this.audioIn[t].disconnect(0),this.audioIn[t]=null;this.audioIn={},this.stream=e,this.initAudioIn()},o.setGain=function(e){this.support&&(this.gainFilter.gain.value=e,this.gain=e)},o.getGain=function(){return this.gain},o.off=function(){return this.setGain(0)},o.on=function(){this.setGain(1)},o.destroy=function(){function e(e){e&&e.getTracks().forEach(function(t){e.removeTrack(t)})}if(this.instant=0,this.slow=0,this.clip=0,this.gainFilter&&this.gainFilter.disconnect(0),this.script&&this.script.disconnect(0),this.audioIn)for(var t in this.audioIn)this.audioIn[t]&&this.audioIn[t].disconnect(0);this.audioIn={};var i=this.stream;/(MediaStream|LocalMediaStream)/.test(i.constructor)&&e(i),i.constructor===Array&&i.forEach(function(t){e(t)}),this.stream=null,this.outputStream=null},o.getVolumeData=function(){return this.instant.toFixed(2)},e.exports=n},182:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=i(67),s=i(8),c=i(71),d=i(183),u=i(188),l=i(212),p=i(185),h=i(187),f=i(186),m=i(184),v=i(86),g=void 0,y=void 0,S=function(e){function t(i){n(this,t);var o=r(this,e.call(this));return i.container=a.n2node(i.container),i.remoteContainer=a.n2node(i.remoteContainer),o.setUtil(g),g.merge(o,i),g.rtcLog=o.rtcLog.bind(o),g.rtcWarn=o.rtcWarn.bind(o),g.rtcError=o.rtcError.bind(o),o.init(),o}return o(t,e),t}(s);S.install=function(e){g=e.util,y=y||e.Promise,d.install(e),u.install(e),l.install(e),p.install(e),h.install(e),f.install(e),m.install(e),v.install(e)};var b=S.prototype;b.rtcLog=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.debug){var e=this.nim.logger;e.log.apply(e,arguments)}},b.rtcError=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.debug){var e=this.nim.logger;e.error.apply(e,arguments)}},b.rtcWarn=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.debug){var e=this.nim.logger;e.warn.apply(e,arguments)}},b.init=function(){this.nim&&(this.resetStatus(),this.initProtocol(),this.initController(),this.devices={hasAudio:!1,hasVideo:!1})},b.initSignal=function(){return y.resolve()},b.initController=function(){var e=this;window.myContrl=this.controller=new l(this.container,this.remoteContainer,this),this.controller.on("userJoined",this.onUserJoin.bind(this)),this.controller.on("deviceStatus",function(t){e.emit("deviceStatus",t)}),this.controller.on("deviceAdd",function(t){e.emit("deviceAdd",t)}),this.controller.on("deviceRemove",function(t){e.emit("deviceRemove",t)}),this.controller.on("devices",function(t){e.emit("devices",t)}),this.controller.on("statistics",function(t){e.emit("statistics",t)}),this.controller.on("rtcConnectFailed",function(t){e.emit("rtcConnectFailed",t)}),this.controller.on("leaveChannel",function(t){"p2p"===e.imInfo.sessionMode?e.emit("hangup",t):e.emit("leaveChannel",t)}),this.controller.on("audioVolume",function(t){e.emit("audioVolume",t)}),window.addEventListener("beforeunload",this.beforeunload.bind(this))},b.resetStatus=function(){this.signalInited=!1,this.channelId=null,this.type=null,this.target=null,this.sessionConfig=null,this.sessionMode=null,this.isCaller=!1,this.callee=null,this.calling=!1,this.callAccepted=!1,this.callerInfo=null,this.beCalledInfo=null,this.nim.protocol&&this.nim.protocol.setCurrentNetcall(),this.needQueryAccountMap={}},b.beforeunload=function(){if(this.signalInited){if(this.controller.imInfo&&"meeting"===this.controller.imInfo.sessionMode)return void this.leaveChannel();this.hangup()}},b.initProtocol=function(){var e=this.nim;e.on("beCalled",this.onBeCalled.bind(this)),e.on("notifyCalleeAck",this.onCalleeAck.bind(this)),e.on("notifyHangup",this.onHangup.bind(this)),e.on("netcallControl",this.onNetcallControl.bind(this)),e.on("notifyCalleeAckSync",this.onCalleeAckSync.bind(this)),e.on("notifyJoin",this.onNotifyJoin.bind(this))},b.getAccount=function(){return this.nim.account},b.getUid=function(){return this.accountUidMap?this.accountUidMap[this.nim.account]||"-1":"-1"},b.isCurrentChannelId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.channelId&&this.channelId===e.channelId},b.notCurrentChannelId=function(e){return!this.isCurrentChannelId(e)},b.call=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.controller.sdkData.dataApi.updateApi("p2p"),this.calling)return y.reject({type:"statusNotMatch",error:"呼叫失败: 当前正在通话中"});var t=e.account,i=e.type,n=e.pushConfig,r=e.sessionConfig;if(this.calling=!0,this.isCaller=!0,this.callee=this.target=t,this.setSessionConfig(r),this.setSessionConfig({signalStartTime:Date.now()}),r.highAudio&&this.controller.sdkData.dataApi.updateApi("hd_audio"),void 0!==r.videoFrameRate&&this.controller.sdkData.dataApi.updateApi("fps",0===+r.videoFrameRate?0:+r.videoFrameRate+1),void 0!==r.videoQuality){var o=+r.videoQuality;o===c.CHAT_VIDEO_QUALITY_540P?o=c.CHAT_VIDEO_QUALITY_720P:o===c.CHAT_VIDEO_QUALITY_720P&&(o=c.CHAT_VIDEO_QUALITY_540P),this.controller.sdkData.dataApi.updateApi("video_quality",o||0)}return this.initNetcall({type:i,pushConfig:n})},b.initNetcall=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.type,n=t.pushConfig;return this.type=i,this.setSessionConfig({signalStartTime:Date.now()}),this.nim.initNetcall({type:i,accounts:[this.callee],pushConfig:n,webrtcEnable:!0}).then(function(t){e.rtcLog("initNetcall:",t),e.callerInfo=t,e.channelId=t.channelId},function(t){throw e.setSessionConfig({signalEndTime:Date.now()}),e.controller.updateInfoOnce({code:t.code}),e.resetWhenHangup(),t})},b.onBeCalled=function(e){this.log("beCalling",e),this.emit("beCalling",e)},b.onUserJoin=function(e){if(this.rtcLog("client on userJoined",e),
e.type=e.type||this.type,e.account=this.getAccountWithUid(e.uid),e.mode=this.sessionMode,e.account!==this.getAccount()){if(e.account)return void this.emit("joinChannel",e);this.needQueryAccountMap[e.uid]=e,this.nim.queryAccountUidMap(this.channelName,[e.uid])}},b.response=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.beCalledInfo,n=t.sessionConfig,r=void 0===n?{}:n,o=i.accepted=t.accepted!==!1;if(this.controller.sdkData.dataApi.updateApi("p2p"),r.highAudio&&this.controller.sdkData.dataApi.updateApi("hd_audio"),void 0!==r.videoFrameRate&&this.controller.sdkData.dataApi.updateApi("fps",0===+r.videoFrameRate?0:+r.videoFrameRate+1),void 0!==r.videoQuality){var a=+r.videoQuality;a===c.CHAT_VIDEO_QUALITY_540P?a=c.CHAT_VIDEO_QUALITY_720P:a===c.CHAT_VIDEO_QUALITY_720P&&(a=c.CHAT_VIDEO_QUALITY_540P),this.controller.sdkData.dataApi.updateApi("video_quality",a||0)}return o?(this.type=i.type,this.channelId=i.channelId,this.target=i.account,this.calling=!0,this.setSessionConfig({signalStartTime:Date.now()})):(this.log("rejectNetcall",i),this.packNetcallRecord({type:i.type,channelId:i.channelId,isCaller:!1,target:i.account,recordType:"rejectNetcall"})),this.nim.calleeAck(i).then(function(){if(o)return t.sessionConfig&&e.setSessionConfig(t.sessionConfig),e.beCalledInfo=i,e.initSession({beCalledInfo:i})},function(t){throw e.log(t),t})},b.initSession=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionMode="p2p";var i=this.isCaller?this.callerInfo:t.beCalledInfo;this.parseAccountUidMap(i.accountUidMap),!i.account&&i.uid&&(i.account=this.getAccountWithUid(i.uid)),this.callAccepted=!0,this.signalInited=!0,this.setSessionConfig({signalEndTime:Date.now()}),this.controller.sdkData.dataApi.startInfo({uid:i.uid}),setTimeout(function(){e.emit("callAccepted",{type:i.type,account:i.account})},1)},b.startRtc=function(){var e=this.sessionMode=this.sessionMode||"p2p",t="meeting"===e?this.imInfo:this.isCaller?this.callerInfo:this.beCalledInfo;t=t||this.imInfo,t.sessionMode=e,this.imInfo=this.imInfo||t;var i=this.controller.startRtc(t);return i},b.onCalleeAck=function(e){if(!this.notCurrentChannelId(e)){if(this.setSessionConfig({signalEndTime:Date.now()}),e.accepted)return this.callAccepted=!0,this.initSession();this.log("netcallRejected",e),this.packNetcallRecord({type:e.type,channelId:e.channelId,isCaller:!0,target:e.account,recordType:"netcallRejected"});var t=e.account;this.resetWhenHangup(),this.emit("callRejected",{account:t})}},b.onNetcallControl=function(e){this.emit("control",e)},b.netDetect=function(){return this.signalInited?this.signal.netDetect():this.rejectWithNoSignal()},b.rejectWithNoSignal=function(){return this.resetWhenHangup(),y.reject({code:"noConnection"})},b.onCalleeAckSync=function(e){this.emit("callerAckSync",e),this.isCurrentChannelId(e)&&this.resetWhenHangup()},b.onNotifyJoin=function(e){var t=e.accountUidMap,i=this.needQueryAccountMap;this.parseAccountUidMap(t);for(var n in t){var r=n,o=t[n];if(o in i){var a=i[o];a.account=r,delete i[o],this.emit("joinChannel",a)}}},b.onHangup=function(e){e.type=0,this.emit("hangup",e),this.controller.sdkData.dataApi.sendApi(),this.isCurrentChannelId(e)&&this.resetWhenHangup()},b.hangup=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.sdkData.dataApi.sendApi();var t=e.channelId;!t&&this.calling&&this.channelId&&(t=this.channelId),t&&this.nim.hangup({channelId:t}),t===this.channelId&&(this.isCaller&&!this.callAccepted&&(this.log("cancelNetcallBeforeAccept",{channelId:t}),this.packNetcallRecord({recordType:"cancelNetcallBeforeAccept"})),this.resetWhenHangup())},b.packNetcallRecord=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.recordType,i=g.exist(e.type)?e.type:this.type,n=g.exist(e.channelId)?e.channelId:this.channelId,r=g.exist(e.duration)?e.duration:0,o=g.exist(e.isCaller)?e.isCaller:this.isCaller,a=g.exist(e.target)?e.target:this.target,s=this.getAccount(),c=o?s:a,d=o?a:s,u=+new Date;this.nim.protocol.onMsg({content:{msg:{attach:JSON.stringify({data:{calltype:i,channel:n,duration:r,ids:[s,a],time:u},id:t}),from:c,fromClientType:o?16:0,fromDeviceId:"",fromNick:"",idClient:g.guid(),idServer:g.guid(),scene:0,time:u,to:d,type:5}}})},b.resetWhenHangup=function(){this.resetStatus(),this.controller.hangup()},b.control=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.command,n=t.channelId;if(n||(n=this.channelId),i&&n)return this.controller.sdkData.dataApi.updateApi("call_control_type"),this.nim.netcallControl({channelId:n,type:i})["catch"](function(t){e.log(t)})},b.startRecordMp4=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.sdkData.dataApi.updateApi("record"),this.controller.startRecordMp4(e)},b.stopRecordMp4=function(){return this.controller.stopRecord()},b.startRecordAac=function(){return this.controller.sdkData.dataApi.updateApi("audio_record"),this.controller.startRecordAac()},b.stopRecordAac=function(){return this.controller.stopRecord()},b.setVideoViewSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.setVideoViewSize(e)},b.setVideoViewRemoteSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.setVideoViewRemoteSize(e)},b.startLocalStream=function(e){return this.controller.sdkData.dataApi.updateApi("display"),e=a.n2node(e),this.controller.startLocalStream(e)},b.stopLocalStream=function(){return this.controller.stopLocalStream()},b.startRemoteStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.node=a.n2node(e.node),this.controller.startRemoteStream(e)},b.stopRemoteStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.stopRemoteStream(e)},b.suspendLocalStream=function(){return this.controller.suspendLocalStream()},b.resumeLocalStream=function(){return this.controller.resumeLocalStream()},b.suspendRemoteStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.suspendRemoteStream(e)},b.resumeRemoteStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.resumeRemoteStream(e)},b.setAudioStart=function(e){return this.controller.setAudioStart(e)},b.setAudioBlack=function(e){return this.controller.setAudioBlack(e)},b.setVideoBlack=function(e){return this.controller.setVideoBlack(e)},b.setVideoShow=function(e){return this.controller.setVideoShow(e)},b.switchVideoToAudio=function(){var e=this;return this.controller.sdkData.dataApi.updateApi("switch_p2p_type"),this.controller.switchVideoToAudio().then(function(){return e.type=c.NETCALL_TYPE_AUDIO,y.resolve()})["catch"](function(e){return y.resolve(e)})},b.switchAudioToVideo=function(){var e=this;return this.controller.sdkData.dataApi.updateApi("switch_p2p_type"),this.controller.switchAudioToVideo().then(function(){return e.type=c.NETCALL_TYPE_VIDEO,y.resolve()})["catch"](function(e){return y.resolve(e)})},b.stopDevice=function(e){return this.controller.stopDevice(e)},b.startDevice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.devices=g.merge({},this.controller.getDeviceStatus()),this.controller.startDevice(e)},b.getDevicesOfType=function(e){return this.controller.mediaDevices.getDevicesOfType(e).then(function(e){return{devices:e}})},b.setSessionConfig=function(e){this.controller.setSessionConfig(e)},b.setSessionVideoQuality=function(e){this.controller.setSessionVideoQuality(e)},b.setSessionVideoFrameRate=function(e){this.controller.setSessionVideoFrameRate(e)},b.setSessionAudioQuality=function(e){this.controller.setSessionAudioQuality(e)},b.setCaptureVolume=function(e){return e=void 0===e?1:e/255,this.controller.setCaptureVolume(e)},b.setPlayVolume=function(e){return e.constructor===String&&(e=+e),e.constructor===Number&&(e={volume:e}),e.volume=void 0===e.volume?1:e.volume/255,e.volume=e.volume>1?1:e.volume,this.controller.setPlayVolume(e)},b.log=function(){var e=this.nim.logger;e.log.apply(e,arguments)},b.error=function(){var e=this.nim.logger;e.error.apply(e,arguments)},b.info=function(){var e=this.nim.logger;e.info.apply(e,arguments)},b.parseAccountUidMap=function(e){var t=this;Object.keys(e).forEach(function(i){t.addAccountUidMap({account:i,uid:e[i]})})},b.addAccountUidMap=function(e){var t=e.account,i=e.uid;this.uidAccountMap||(this.uidAccountMap={}),this.uidAccountMap[i]=t,this.accountUidMap||(this.accountUidMap={}),this.accountUidMap[t]=i},b.getAccountWithUid=function(e){if(this.uidAccountMap)return this.uidAccountMap[e]},b.getUidWithAccount=function(e){if(this.accountUidMap)return this.accountUidMap[e]},b.setNetcallSession=function(e){return this.calling?y.reject({type:"statusNotMatch",error:"开启会话失败: 当前正在通话中"}):(this.signalInited=!0,this.role=0,this.calling=!0,this.channelId=e.channelId,this.type=e.netcallType,this.imInfo=e,this.imInfo.serverAddrs=e.rtcServerMap,this.imInfo.rtcUrls=e.rtcServerMap,this.beCalledInfo=this.imInfo,this.target=e.target.account,this.parseAccountUidMap(e.accountUidMap),y.resolve())},b.startSession=b.startRtc,b.destroy=function(){},e.exports=S,i(211)},183:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}i(174);var a=i(8),s=i(71),c=void 0,d=void 0,u=function(e){function t(){n(this,t);var i=r(this,e.call(this));return i.init(),i}return o(t,e),t}(a);u.install=function(e){c=e.Promise,d=e.util};var l=u.prototype;l.init=function(){var e=this;this.getDevices();var t=void 0;navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",function(i){t&&(clearTimeout(t),t=null);var n=d.merge({},e.devicesCache);t=setTimeout(function(){t=null,e.getDevices(!0).then(function(){e.emit("deviceStatus",e.devicesCache),e.filterDeviceChange(e.devicesCache,n)})["catch"](function(){})},500)})},l.filterDeviceChange=function(e,t){function i(e){var t={};return Object.keys(e).forEach(function(i){e[i].forEach(function(e){t[i+e.deviceId]=Object.assign({},e,{type:i})})}),t}var n=this,r=i(e),o=i(t),a=Object.keys(r),s=Object.keys(o);a.length>s.length?!function(){var e=[];a.forEach(function(t){s.indexOf(t)===-1&&e.push(r[t])}),e.length&&n.emit("deviceAdd",e)}():!function(){var e=[];s.forEach(function(t){a.indexOf(t)===-1&&e.push(o[t])}),e.length&&n.emit("deviceRemove",e)}()},l.getDevicesOfType=function(e){var t,i=(t={},t[s.DEVICE_TYPE_AUDIO_IN]="audioIn",t[s.DEVICE_TYPE_AUDIO_OUT_LOCAL]="audioOut",t[s.DEVICE_TYPE_AUDIO_OUT_CHAT]="audioOut",t[s.DEVICE_TYPE_VIDEO]="video",t);return void 0!==i[e]?this.getDevices().then(function(t){return t[i[e]]})["catch"](function(e){console.error(e)}):this.getDevices()},l.getDevices=function(e){var t=this;return!e&&this.devicesCache?c.resolve(this.devicesCache):new c(function(e,i){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?void navigator.mediaDevices.enumerateDevices().then(function(i){var n={video:[],audioIn:[],audioOut:[]};return i.forEach(function(e){"videoinput"===e.kind?n.video.push({deviceId:e.deviceId,label:e.label?e.label:"camera "+(n.video.length+1)}):"audioinput"===e.kind?n.audioIn.push({deviceId:e.deviceId,label:e.label?e.label:"microphone "+(n.audioIn.length+1)}):"audiooutput"===e.kind&&n.audioOut.push({deviceId:e.deviceId,label:e.label?e.label:"speaker "+(n.audioOut.length+1)})}),t.devicesCache=n,e(n)})["catch"](function(e){return i(e)}):i(new Error("your browser not support this feature, see https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"))})},l.getDeviceStatus=function(){return{hasAudio:this.devicesCache.audioIn.length>0,hasVideo:this.devicesCache.video.length>0}},e.exports=u},184:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=void 0,s=void 0,c=i(181),d=i(8),u=function(e){function t(){n(this,t);var i=r(this,e.call(this));return i.recordedChunks=[],i.isRecording=!1,i.contentTypes=["video/mp4;codecs=opus","video/webm","video/webm;codecs=h264","video/x-matroska;codecs=opus","video/invalid"],i}return o(t,e),t}(d);u.install=function(e){a=e.Promise,s=e.util};var l=u.prototype;l.validation=function(e){return e.filter(function(e){return MediaRecorder.isTypeSupported(e)})},l.format=function(){var e=this,t=this.stream,i=this.option;return new a(function(n,r){if(/(LocalMediaStream|MediaStream)/.test(t.constructor)&&(t=[t]),t.constructor!==Array)return r("音视频录制输入错误");if("audio"===i.type)return e.audioController=new c(t,e.uid),e.opStream=e.audioController.outputStream,window.audios=e.opStream,n();var o=new MediaStream;return t.forEach(function(e){e&&/(LocalMediaStream|MediaStream)/.test(e.constructor)&&e.getTracks().forEach(function(e){o.addTrack(e)})}),0===o.getTracks().length?r("当前没有任何音视频数据，无法进行录制"):(e.opStream=o,void n())})},l.start=function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"video"};if(!i.account)return a.reject("需要录制的帐号缺失");if(!e)return a.reject("获取视频流失败");if(!window.MediaRecorder||!MediaRecorder.isTypeSupported)return a.reject("当前浏览器不支持音视频录制功能");this.stream=e,this.option=i,"audio"===i.type&&(this.contentTypes=["audio/wav","audio/ogg","audio/pcm","audio/webm"]);var n=this.mimeType=this.validation(this.contentTypes)[0];return n?this.isRecording?a.reject("音视频正在录制中，请勿重复操作"):this.format().then(function(){return t._start()})["catch"](function(e){return a.reject(e)}):a.reject("当前浏览器不支持对应格式的视频录制")},l._start=function(){var e={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:this.mimeType},t=this.recorder=new MediaRecorder(this.opStream,e);return t.ondataavailable=this.ondataavailable.bind(this),t.onstop=this.onstop.bind(this),this.isRecording=!0,this.status="started",this.recorder.start(),this.startTimer(),a.resolve(this.option)},l.stop=function(e){if(!this.isRecording||!this.recorder)return a.reject("请先开启音视频录制");if(this.status="stopped",s.rtcLog("MediaRecorder: stop event",this.recorder.state),"inactive"===this.recorder.state)return s.rtcWarn("MediaRecorder already stopped:",this.recorder.state),a.reject("音视频录制已结束，请勿重复操作");var t=this.option.account+"--"+Date.now()+"--"+(this.option.type||"video");return this.fileName=e||t,this.recorder.stop(),a.resolve()},l.ondataavailable=function(e){return s.rtcLog("MediaRecorder: data received"),e.data.size>0?void this.recordedChunks.push(e.data):(this.stop(),a.reject("获取视频流失败"))},l.onstop=function(){if(s.rtcLog("MediaRecorder: onstop"),"stopped"!==this.status)return this._start();var e=new Blob(this.recordedChunks,{type:this.mimeType}),t=URL.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=t,i.download=(this.fileName||Date.now())+".webm",i.click(),window.URL.revokeObjectURL(t),this.destroy(),this.clearTimer(),this.emit("stopRecord")},l.pause=function(){this.recorder&&this.recorder.pause()},l.resume=function(){this.recorder&&this.recorder.resume()},l.destroy=function(){this.stream=null,this.recorder=null,this.recordedChunks=[],this.isRecording=!1,this.audioController&&this.audioController.destroy(),this.audioController=null,this.fileName=this.fileNameDefault="",this.option={},this.status=""},l.startTimer=function(){var e=this;this.timer||(this.timer=setInterval(function(){s.rtcLog((new Date).toLocaleString()+" --> MediaRecorder status: "+e.recorder.state)},2e3))},l.clearTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},t["default"]=u,e.exports=t["default"]},185:function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(214),c=n(s);i(174);var d=window.sdpTransform=i(220),u=i(8),l=(i(186),i(213)),p=window.Promise,h=void 0,f=function(e){function t(i){r(this,t);var n=o(this,e.call(this));return n.init(),n.controller=i,n}return a(t,e),t}(u);f.install=function(e){p=p||e.Promise,h=e.util};var m=f.prototype;m.resetStatus=function(){this.isSdpUpdate=!1,this.sdpOffer=null,this.sdpAnswer=null,this.iceOffer=[],this.iceAnswer=[]},m.init=function(){this.resetStatus();var e=this.rtcConnection=new RTCPeerConnection;e.onaddstream=this.onRemoteStream.bind(this),e.ontrack=this.onRemoteTrack.bind(this),e.onremovestream=function(e){},e.onicecandidate=function(e){if(h.rtcLog("gather candidate",e&&e.candidate&&e.candidate.candidate),e.candidate){if(/ tcp /gi.test(e.candidate.candidate))return;this.iceOffer.push(e.candidate)}else h.rtcLog("onicecandidate end")}.bind(this),e.onnegotiationneeded=function(e){h.rtcLog("onnegotiationneeded"),this.emit("negotiationneeded",e)}.bind(this),e.oniceconnectionstatechange=function(){var t=e.iceConnectionState;"connected"===t&&(this.iceCompleted=!0,this.stats.start()),this.emit("iceconnectionstatechange",e.iceConnectionState)}.bind(this),this.initStats()},m.initStats=function(){var e=this;this.stats=new c["default"]({peer:this.rtcConnection,interval:2e3}),this.stats.on("stats",function(t){e.emit("rtcStats",t)})},m.doSendIce=function(){if(this.sdpAnswer){var e=this.iceOffer;if(e.length>0&&!this.iceCompleted){var t=e.shift();this.emit("iceCandidate",t),this.doSendIce()}}},m.onRemoteStream=function(e){return h.rtcLog("get remote stream",e.stream),!e.stream||e.stream&&"default"===e.stream.id?h.rtcLog("remote stream is default stream, do nothing"):void this.emit("getRemoteStream",e.stream)},m.onRemoteTrack=function(e){},m.getIceConnectionState=function(){if(this.rtcConnection)return this.rtcConnection.iceConnectionState},m.checkNegotiation=function(){return!(0===this.oldTracks&&0===this.newTracks)},m.addStream=function(e){if(e){e.stream&&(e=e.stream);var t,i,n,r,o=this.rtcConnection,a=this.stream;n=e.getAudioTracks()[0],r=e.getVideoTracks()[0];var s=o.getLocalStreams();if(s=s.length>0?s[0]:null,this.oldTracks=s&&s.getTracks().length||0,h.rtcLog("当前rtc轨道数目",s&&s.id,this.oldTracks),s&&s.getTracks().forEach(function(e){h.rtcLog("更新前轨道id:",e.kind+":"+e.id)}),!a)return this.addAudioTrack(e),this.addVideoTrack(e),s=o.getLocalStreams(),s=s.length>0?s[0]:null,this.newTracks=s&&s.getTracks().length||0,h.rtcLog("更新后rtc轨道数目",s&&s.id,this.newTracks),void(s&&s.getTracks().forEach(function(e){h.rtcLog("   > 轨道id:",e.kind+":"+e.id)}));t=a&&a.getAudioTracks()[0],i=a&&a.getVideoTracks()[0],n=e.getAudioTracks()[0],r=e.getVideoTracks()[0],t||n&&this.addAudioTrack(e),i||r&&this.addVideoTrack(e),t&&(n?n!==t&&this.updateAudioTrack(e):this.removeAudioTrack()),i&&(r?r!==i&&this.updateVideoTrack(e):this.removeVideoTrack()),s=o.getLocalStreams(),s=s.length>0?s[0]:null,this.newTracks=s&&s.getTracks().length||0,h.rtcLog("更新后rtc轨道数目",s&&s.id,this.newTracks),s&&s.getTracks().forEach(function(e){h.rtcLog("   > 轨道id:",e.kind+":"+e.id)})}},m.removeVideoTrack=function(){var e=this.rtcConnection,t=this.stream;if(t){var i=t.getVideoTracks()[0],n=!!navigator.mozGetUserMedia;if(!i)return h.rtcWarn("removeVideo() | no video track"),p.reject(new Error("no video track"));if(t.removeTrack(i),n){for(var r=void 0,o=e.getSenders(),a=Array.isArray(o),s=0,o=a?o:o[Symbol.iterator]();;){if(a){if(s>=o.length)break;r=o[s++]}else{if(s=o.next(),s.done)break;r=s.value}if(r.track===i)break}e.removeTrack(r)}}},m.addVideoTrack=function(e){var t=this.rtcConnection,i=this.stream,n=i,r=e.getVideoTracks()[0],o=!!navigator.mozGetUserMedia;if(r)if(i||(i=new MediaStream,this.stream=i),i.addTrack(r),o){var a=t.addTrack(r,i),s=this.controller.getVideoSessionConfig(),c={maxFramerate:s.frameRate,scaleResolutionDownBy:2};a.setParameters({encodings:[c]})}else!n&&t.addStream(i)},m.updateVideoTrack=function(e){var t=this.rtcConnection,i=this.stream;if(i){var n=!!navigator.mozGetUserMedia;if(!n)return this.removeVideoTrack(!0),this.addVideoTrack(e);for(var r=e.getVideoTracks()[0],o=i.getVideoTracks()[0],a=void 0,s=t.getSenders(),c=Array.isArray(s),d=0,s=c?s:s[Symbol.iterator]();;){if(c){if(d>=s.length)break;a=s[d++]}else{if(d=s.next(),d.done)break;a=d.value}if(a.track===o)break}a.replaceTrack(r),i.removeTrack(o),i.addTrack(r)}},m.removeAudioTrack=function(){var e=this.rtcConnection,t=this.stream,i=t.getAudioTracks()[0],n=!!navigator.mozGetUserMedia;if(!i)return h.rtcWarn("removeAudio() | no audio track"),p.reject(new Error("no audio track"));if(t.removeTrack(i),n){for(var r=void 0,o=e.getSenders(),a=Array.isArray(o),s=0,o=a?o:o[Symbol.iterator]();;){if(a){if(s>=o.length)break;r=o[s++]}else{if(s=o.next(),s.done)break;r=s.value}if(r.track===i)break}e.removeTrack(r)}},m.addAudioTrack=function(e){var t=this.rtcConnection,i=this.stream,n=i,r=!!navigator.mozGetUserMedia,o=e.getAudioTracks()[0];o&&(i||(i=new MediaStream,this.stream=i),i.addTrack(o),r?t.addTrack(o,i):!n&&t.addStream(i))},m.updateAudioTrack=function(e){var t=this.rtcConnection,i=this.stream,n=!!navigator.mozGetUserMedia;if(i){if(!n)return this.removeAudioTrack(!0),this.addAudioTrack(e);for(var r=e.getAudioTracks()[0],o=i.getAudioTracks()[0],a=void 0,s=t.getSenders(),c=Array.isArray(s),d=0,s=c?s:s[Symbol.iterator]();;){if(c){if(d>=s.length)break;a=s[d++]}else{if(d=s.next(),d.done)break;a=d.value}if(a.track===o)break}a.replaceTrack(r),i.removeTrack(o),i.addTrack(r)}},m.removeStream=function(e){e&&(e.stream&&(e=e.stream),this.rtcConnection.removeStream(e))},m.createAnswer=function(e){return this.rtcConnection.createAnswer().then(function(e){return e.sdp=l.maybePreferVideoReceiveCodec(e.sdp,{videoRecvCodec:"H264"}),e=this.filterLocalDescription(e)}.bind(this))["catch"](function(e){h.rtcLog(e)})},m.createOffer=function(){var e=this,t={offerToReceiveAudio:1,offerToReceiveVideo:1};h.rtcLog("\r\n-------------------------netease: activity start----------------------------\r\n"),delete this.rtcConnection.localDescription;var i=new p(function(i,n){e.rtcConnection.createOffer(t).then(function(e){this.resetStatus(),e.sdp=l.maybePreferVideoReceiveCodec(e.sdp,{videoRecvCodec:"H264"}),e=this.filterLocalDescription(e),i(e)}.bind(e))["catch"](function(e){h.rtcError(e),n(e)})});return i},m.getLocalSdp=function(){return this.rtcConnection.localDescription},m.getRemoteSdp=function(){return this.rtcConnection.remoteDescription},m.checkMediaStatus=function(e,t){var i={audio:!1,video:!1},n=d.parse(t),r=e.getAudioTracks()[0],o=e.getVideoTracks()[0],a=null;return h.rtcLog("track status",n),n.media.forEach(function(e,n){"audio"===e.type&&(e.ssrcs&&r?(a=new RegExp(r.id),i.audio=a.test(t)):i.audio=!1),"video"===e.type&&(e.ssrcs&&o?(a=new RegExp(o.id),i.video=a.test(t)):i.video=!1)}),i},m.filterLocalDescription=function(e){var t=this,i=this.controller.imInfo.uid,n=this.controller.imInfo.channelId,r=e.sdp,o=d.parse(r);h.rtcLog(o);var a=this.rtcConnection.getLocalStreams();a=a[0]||new MediaStream;var s=a.getAudioTracks()[0],c=a.getVideoTracks()[0],u=void 0;return o.media&&o.media.forEach(function(r,a){if("audio"===r.type&&(u=r,!s&&delete r.ssrcs&&delete r.ssrcGroups&&delete r.msid),"video"===r.type&&(!c&&delete r.ssrcs&&delete r.ssrcGroups&&delete r.msid,u&&u.msid&&r.msid)){var d=u.msid.split(" "),l=r.msid.split(" ");l[0]=d[0],r.msid=l.join(" ")}navigator.mozGetUserMedia?r.bandwidth=[{type:"TIAS",limit:800}]:r.bandwidth=[{type:"AS",limit:800}],r.iceUfrag&&(r.iceUfrag=n+"/"+i),"audio"===r.type&&(r.ptime=60,r.maxptime=60,r.fmtp&&r.fmtp.length&&!function(){var e=!1,i=t.controller.sessionConfig.highAudio?48e3:16e3;r.fmtp.forEach(function(t){t.config&&t.config.indexOf("minptime=")!==-1&&(t.config=t.config.replace(/minptime=\d+/,"minptime=60")),t.config&&t.config.indexOf("sprop-maxcapturerate=")!==-1&&t.config.indexOf("maxplaybackrate")!==-1&&(e=!0,t.config=t.config.replace(/sprop-maxcapturerate=\d+/,"sprop-maxcapturerate="+i),t.config=t.config.replace(/maxplaybackrate=\d+/,"maxplaybackrate="+i)),e||(t.config+=";maxplaybackrate="+i+";sprop-maxcapturerate="+i),t.config+=";maxaveragebitrate=131072;stereo=1;sprop-stereo=1;cbr=1"})}()),"offer"===e.type&&!function(){var e=r.mid;r.mid=n+"-"+i+"_"+a,o.groups&&o.groups.forEach(function(t){var i=t.mids.split(" ");i.indexOf(e)!==-1&&(i.splice(i.indexOf(e),1,r.mid),t.mids=i.join(" "))})}()}),e.sdp=d.write(o),e},m.setRemoteDescription=function(e,t){var i=this;"offer"===e.type&&h.rtcLog("\r\n-------------------------netease: activity start----------------------------\r\n"),h.rtcLog("get remote sdp "+t+" --> "+e.type,e.sdp);var n={sdp:e.sdp,type:e.type};return"offer"!==e.type||this.sdpAnswer?(n.sdp=l.maybePreferVideoSendCodec(n.sdp,{videoRecvCodec:"H264"}),this.rtcConnection.setRemoteDescription(n).then(function(){if("answer"===e.type){if(i.sdpAnswer=n,i.iceCompleted)return void i.emit("iceCompleted");i.doSendIce()}else i.sdpAnswer=null;return p.resolve()})["catch"](function(e){return h.rtcWarn(e),p.reject()})):p.reject()},m.setLocalDescription=function(e,t){var i=this;return this.isSdpUpdate=t,this.sdpOffer=e,h.rtcLog("set local sdp "+e.type,e.sdp),this.rtcConnection.setLocalDescription(e).then(function(){return"answer"===e.type?(i.sdpAnswer=e,i.iceCompleted&&i.emit("iceCompleted")):i.sdpAnswer=null,p.resolve()})["catch"](function(e){h.rtcWarn(e)})},m.addRemoteIceCandidate=function(e){var t=this;h.rtcLog("set remote ICE ",e),this.rtcConnection.addIceCandidate(new RTCIceCandidate(e)).then(function(){t.iceAnswer.push(e),t.iceAnswer.length===t.iceOffer.length&&(t.iceCompleted=!0,t.iceAnswer=[],t.iceOffer=[],t.emit("iceCompleted"))})["catch"](function(e){h.rtcWarn(e)})},m.close=function(){this.rtcConnection&&this.rtcConnection.close(),this.stats&&this.stats.stop()},e.exports=f},186:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=i(8),s=void 0,c=function(e){function t(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;n(this,t);var a=r(this,e.call(this));return a.reset(),a.rtcConnection=i,a.statsIntervalTime=o,a.init(),a}return o(t,e),t.prototype.reset=function(){this.intervalId=null,this.rtcConnection=null,this.preStats=null},t.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},t.prototype.init=function(){var e=this;navigator.webkitGetUserMedia&&(this.intervalId=setInterval(function(){e.rtcConnection.getStats(function(t){var i=[];t.result().forEach(function(e){var t={};e.names().forEach(function(i){t[i]=e.stat(i)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(t)}),e.dealStats(i)})},this.statsIntervalTime))},t.prototype.dealStats=function(e){var t=this.filterItems(e);this.formatStats(t)},t.prototype.filterItems=function(e){var t={ssrc:{local:{},remote:{}},videoBwe:{},googCandidatePair:{}};return e.forEach(function(e){if("ssrc"===e.type){if(!e.googCodecName)return;var i=e.mediaType,n=e.bytesReceived?"remote":"local",r=t.ssrc,o=r[n]=r[n]||{};o[i]=e,"local"!==n||"video"!==i||"true"!==e.googBandwidthLimitedResolution&&"true"!==e.googCpuLimitedResolution||console.warn("googBandwidthLimitedResolution:"+e.googBandwidthLimitedResolution,"googCpuLimitedResolution:"+e.googCpuLimitedResolution)}else if("VideoBwe"===e.type)t.videoBwe=e;else if("googCandidatePair"===e.type){if("false"===e.googActiveConnection)return;t[e.type]=e}}),t},t.prototype.formatStats=function(e){var t=e.ssrc,i=t.local=t.local||{},n=t.remote=t.remote||{};if(i.total={bytesSent:0,bytesSentRate:0,packetsLost:0,packetsSent:0,packetsLostRate:0,frameHeightSent:0,frameWidthSent:0,frameRateSent:0},n.total={bytesReceived:0,bytesReceivedRate:0,packetsLost:0,packetsReceived:0,packetsLostRate:0,frameHeightReceived:0,frameWidthReceived:0,frameRateReceived:0},(i.video||i.audio)&&(i.total.bytesSent=parseInt(i.audio&&i.audio.bytesSent?i.audio.bytesSent:0)+parseInt(i.video&&i.video.bytesSent?i.video.bytesSent:0),i.total.packetsLost=parseInt(i.audio&&i.audio.packetsLost?i.audio.packetsLost:0)+parseInt(i.video&&i.video.packetsLost?i.video.packetsLost:0),i.total.packetsSent=parseInt(i.audio&&i.audio.packetsSent?i.audio.packetsSent:0)+parseInt(i.video&&i.video.packetsSent?i.video.packetsSent:0),i.video&&(i.total.frameHeightSent=parseInt(i.video.googFrameHeightSent||0),i.total.frameWidthSent=parseInt(i.video.googFrameWidthSent||0),i.total.frameRateSent=parseInt(i.video.googFrameRateSent||0))),(n.video||n.audio)&&(n.total.bytesReceived=parseInt(n.audio&&n.audio.bytesReceived?n.audio.bytesReceived:0)+parseInt(n.video&&n.video.bytesReceived?n.video.bytesReceived:0),n.total.packetsLost=parseInt(n.audio&&n.audio.packetsLost?n.audio.packetsLost:0)+parseInt(n.video&&n.video.packetsLost?n.video.packetsLost:0),n.total.packetsReceived=parseInt(n.audio&&n.audio.packetsReceived?n.audio.packetsReceived:0)+parseInt(n.video&&n.video.packetsReceived?n.video.packetsReceived:0),n.video&&(n.total.frameHeightReceived=parseInt(n.video.googFrameHeightReceived||0),n.total.frameWidthReceived=parseInt(n.video.googFrameWidthReceived||0),n.total.frameRateReceived=parseInt(n.video.googFrameRateReceived||0))),this.preStats){var r=this.preStats.ssrc.local,o=this.preStats.ssrc.remote,a=i.total.bytesSent-r.total.bytesSent;a&&(i.total.bytesSentRate=parseInt(a/this.statsIntervalTime*1e3));var c=n.total.bytesReceived-o.total.bytesReceived;c&&(n.total.bytesReceivedRate=parseInt(c/this.statsIntervalTime*1e3));var d=i.total.packetsSent-r.total.packetsSent,u=i.total.packetsLost-r.total.packetsLost;d&&(i.total.packetsLostRate=parseFloat((u/d).toFixed(5)));var l=n.total.packetsReceived-o.total.packetsReceived;u=n.total.packetsLost-o.total.packetsLost,l&&(n.total.packetsLostRate=parseFloat((u/l).toFixed(5)))}this.preStats=e,this.emit("rtcStats",s.merge({},e,4))},t}(a);c.install=function(e){s=e.util},t["default"]=c,e.exports=t["default"]},187:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=i(8),s=i(9),c=void 0,d=void 0,u=function(e){function t(){return n(this,t),r(this,e.apply(this,arguments))}return o(t,e),t}(a);u.install=function(e){c=e.Promise,d=e.util};var l=u.prototype;l.connect=function(e){var t=this;return e?new c(function(i,n){var r=t.ws=new WebSocket("wss://"+e),o=t;t.url=e,r.onopen=function(e){o.initSignal(),o.signalConnected=!0,o.emit("signalConnected"),i(o)},r.onclose=r.onerror=function(e){o.signalConnected=!1,n(e)}}):c.reject("信令链接地址缺失，请主叫方或者会议发起者打开webrtc兼容开关")},l.initSignal=function(){var e=this,t=this.ws,i=t.send;t.send=function(e){i.call(this,JSON.stringify(e))},t.onmessage=function(t){var i=JSON.parse(t.data||null);i&&(e.emit("message",i),e.isHeartBeating&&"keep_alive_ack"===i.type&&e.onHeartBeat(i))},t.onclose=function(t){e.signalConnected=!1,e.emit("signalClosed",t)},t.onerror=function(t){e.signalConnected=!1,e.emit("signalError",t)}},l.send=function(e){var t=this;"keep_alive"!==e.type,this.ws&&this.signalConnected?(e&&e.cid&&e.uid&&(e.cid=""+e.cid,e.uid=""+e.uid),e.browser={},e.browser.name=s.name,e.browser.version=s.version,this.ws.send(e)):this.once("signalConnected",function(){t.send(e)})},l.heartbeat=function(e){this.socketData=e||this.socketData,this.heartBeatList=[],this.bindHearBeat(5)},l.onHeartBeat=function(e){this.heartBeatList.shift(),this.bindHearBeat(5)},l.heartBeatHandler=function(){var e=this.socketData,t=this.heartBeatList;if(t){if(t.constructor===Array&&0===t.length){var i=Date.now().toString();return t.push(i),this.send({type:"keep_alive",uid:e.uid,cid:e.cid,params:{content:{timestamp:i}}}),void this.bindHearBeat(5)}var n=Date.now()-t[0];if(n>3e4)this.emit("signalClosed");else if(n>2e3&&n<3e4){var r=Date.now().toString();t.push(r),this.send({type:"keep_alive",uid:e.uid,cid:e.cid,params:{content:{timestamp:r}}}),this.bindHearBeat(2)}}},l.bindHearBeat=function(e){this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.isHeartBeating=setTimeout(this.heartBeatHandler.bind(this),1e3*e)},l.stopHeartBeat=function(){this.isHeartBeating&&(clearTimeout(this.isHeartBeating),clearInterval(this.heartBeatTimer),this.isHeartBeating=null,this.heartBeatTimer=null,this.heartBeatList=null,this.heartBeatCount=0)},l.logout=function(){var e=this.socketData,t=Date.now().toString();this.send({type:"logout",uid:e.uid,cid:e.cid,params:{content:{timestamp:t}}})},l.destroy=function(){var e="signal close -> signal.js";d.rtcLog(e),this.stopHeartBeat(),this.logout(),this.ws&&(this.ws.onopen=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.ws=null)},e.exports=u},188:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}i(174);var a=i(181),s=i(8),c=void 0,d=void 0,u=function(e){function t(i){n(this,t);var o=r(this,e.call(this));return o.isRemote=!!i.isRemote,o.constraint=i.constraint||{},o.stream=i.stream,o.container=i.container,o.uid=i.uid||"",o.isAudio="audio"===i.type,o.initNode(),o.videoRatioIntervalId=null,o.startVideoRatioMonitor(),o}return o(t,e),t}(s);u.install=function(e){c=e.Promise,d=e.util};var l=u.prototype;l.initNode=function(){if(!this.node){var e=this.stream.getVideoTracks();0===e.length?(this.isAudio=!0,this.initAudioNode()):this.initVideoNode(),this.isRemote&&!this.isAudio&&this.initVideoEvent()}},l.initAudioNode=function(){this.audioStream=this.stream,this.gainController=new a(this.audioStream,this.uid,!0),this.stream=this.gainController.outputStream,this.node=document.createElement("audio"),this.node.dataset.uid=this.uid},l.initVideoNode=function(){var e=document.createElement("div");e.style.overflow="hidden",e.style.position="relative",e.style.width="100px",e.style.height="100px",e.style.display="none";var t=document.createElement("video");t.dataset.uid=this.uid,t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%,-50%)",e.appendChild(t),this.node=t,this.videoContainer=e,setTimeout(function(){this.videoContainer&&(this.videoContainer.style.display="inline-block")}.bind(this),200)},l.initVideoEvent=function(){},l.setMuted=function(e){this.node&&(this.muted=!!e,this.node.muted=!!e,this.setPlayVolume())},l.getMuted=function(){return!!this.muted},l.setPlayVolume=function(e){var t=void 0;e?(e.constructor===Number&&(t=e),e.constructor===Object&&(t=void 0===e.volume?1:e.volume)):t=this.volume,this.volume=t,this.getMuted()||this.node&&(t=void 0===t||t>1?1:t,this.node.volume=t)},l.getPlayVolume=function(){return void 0!==this.volume?this.volume:1},l.setGain=function(e){if(this.stream&&!this.isRemote){if(void 0===e&&(e=1),this.gainOff)return this.gain=e,e;this.gainController.setGain(e),this.gain=e}},l.getGain=function(){return void 0!==this.gain?this.gain:1},l.setGainOff=function(){this.stream&&!this.isRemote&&(this.gainController.setGain(0),this.gainOff=!0)},l.setGainOn=function(){this.stream&&!this.isRemote&&(this.gainController.setGain(void 0!==this.gain?this.gain:1),this.gainOff=!1)},l.show=function(e){if(this.node){if(this.isAudio)return this.node.srcObject=this.audioStream,this.play(),void(this.enable=!0);e=this.container=e||this.container,this.node&&this.videoContainer&&(this.videoContainer&&e&&e.appendChild(this.videoContainer),this.node.srcObject||(this.node.srcObject=this.stream),this.play(),this.enable=!0)}},l.updateStream=function(e){var t=this.stream,i=this.node;if(i&&t){if(this.isAudio)return d.rtcLog("更新音频流:",e),this.destroyMedia(this.audioStream),this.audioStream=e,this.gainController.updateStream(e),void(this.stream=this.gainController.outputStream);this.destroyMedia(this.stream),this.stream=e,i.srcObject=this.stream,d.rtcLog("更新视频流:",e),d.rtcLog(i)}},l.isShown=function(){return this.node&&this.node.srcObject&&this.enable},l.removeTrack=function(e){var t=this.stream;t&&t.removeTrack(e)},l.updateView=function(){this.node.srcObject&&(this.node.srcObject=this.stream,this.play())},l.hide=function(){var e=this.videoContainer;e&&(this.node.paused||this.node.pause(),e.parentNode&&e.parentNode.removeChild(e),this.enable=!1)},l.resize=function(e){if(this.node&&this.videoContainer&&!this.isAudio&&e&&e.width&&e.height){if(e.cut=void 0===e.cut||e.cut,this.resizeOptions=e,this.videoContainer.style.width=e.width+"px",this.videoContainer.style.height=e.height+"px",!e.cut)return this.node.style.height="100%",void(this.node.style.width="100%");if(this.node.videoWidth&&this.node.videoHeight){var t=this.node.videoWidth,i=this.node.videoHeight,n=t/i,r=e.width/e.height;n>r?(this.node.style.height="100%",this.node.style.width="auto"):(this.node.style.width="100%",this.node.style.height="auto")}else this.node.width=e.width,this.node.height=e.height}},l.startVideoRatioMonitor=function(){var e=this;this.isAudio||null===this.videoRatioIntervalId&&(this.preVideoWidth=this.node.videoWidth,this.preVideoHeight=this.node.videoHeight,this.videoRatioIntervalId=setInterval(function(){e.resizeOptions&&(e.preVideoWidth===e.node.videoWidth&&e.preVideoHeight===e.node.videoHeight||(e.resize(e.resizeOptions),e.preVideoWidth=e.node.videoWidth,e.preVideoHeight=e.node.videoHeight))},1e3))},l.getAudioVolume=function(){return this.gainController.getVolumeData()},l.getMetaWidth=function(e){if(this.node&&!this.isAudio)return this.node.videoWidth},l.getMetaHeight=function(e){if(this.node&&!this.isAudio)return this.node.videoHeight},l.resume=function(){this.play()},l.pause=function(){this.node.pause()},l.play=function(){var e=this.node;4!==e.readyState&&e.load(),0!==e.played.length&&e.pause(),e.play()["catch"](function(e){d.rtcLog(e)}),this.isAudio&&this.setMuted(!1)},l.stopDevice=function(){this.isAudio?(this.destroyMedia(this.audioStream),this.audioStream=null):(this.destroyMedia(this.stream),this.stream=null)},l.destroyMedia=function(e){if(e){var t=e.getTracks();t&&0!==t.length&&t.forEach(function(t){t.stop(),e.removeTrack(t)})}},l.destroy=function(){this.hide(),this.node.srcObject=null,this.node=null,this.videoContainer=null,this.stream&&(this.destroyMedia(this.stream),this.destroyMedia(this.audioStream),this.stream=null,this.audioStream=null,null!==this.videoRatioIntervalId&&(clearInterval(this.videoRatioIntervalId),this.videoRatioIntervalId=null),this.gainController&&this.gainController.context&&this.gainController.destroy&&this.gainController.destroy())},u.getLocalStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},t=e.audio?"audio":"";return navigator.mediaDevices.getUserMedia(e).then(function(i){return"audio"===t?i:new u({stream:i,type:t,isRemote:!1,constraint:e})})["catch"](function(e){var t="启动设备失败: "+e.name;return c.reject(t)})},e.exports=u},189:function(e,t){var i=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach(function(e){var t=i[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},211:function(e,t,i){"use strict";var n=i(182),r=i(71),o=n.prototype,a=void 0;o.setUtil=function(e){a=e},o.createChannel=function(e){var t=this;return a.verifyOptions(e,"channelName"),e.custom=e.custom||"",e.webrtcEnable=!0,this.controller.sdkData.dataApi.updateApi("meeting"),this.setSessionConfig({signalStartTime:Date.now()}),this.nim.createChannel(e).then(function(e){return Promise.resolve(e)},function(e){return t.setSessionConfig({signalEndTime:Date.now()}),t.controller.updateInfoOnce({code:e.code}),Promise.reject(e)})},o.joinChannel=function(e){var t=this;if(this.controller.sdkData.dataApi.updateApi("meeting"),this.signalInited)return Promise.reject("已经加入会议");a.verifyOptions(e,"channelName type");var i=e.sessionConfig,n=void 0===i?{}:i;if(n.bypassRtmp=e.liveEnable,e.liveEnable&&this.controller.sdkData.dataApi.updateApi("bypass",void 0!==n.splitMode?+n.splitMode+1:0),n.highAudio&&this.controller.sdkData.dataApi.updateApi("hd_audio"),void 0!==n.videoFrameRate&&this.controller.sdkData.dataApi.updateApi("fps",0===+n.videoFrameRate?0:+n.videoFrameRate+1),void 0!==n.videoQuality){var o=+n.videoQuality;o===r.CHAT_VIDEO_QUALITY_540P?o=r.CHAT_VIDEO_QUALITY_720P:o===r.CHAT_VIDEO_QUALITY_720P&&(o=r.CHAT_VIDEO_QUALITY_540P),this.controller.sdkData.dataApi.updateApi("video_quality",o||0)}return a.merge(this,{sessionConfig:n}),this.setSessionConfig(n),this.setSessionConfig({signalStartTime:Date.now()}),this.nim.joinChannel({channelName:e.channelName,liveEnable:e.liveEnable}).then(function(i){return t.setSessionConfig({signalEndTime:Date.now()}),t.signalInited=!0,t.sessionMode=i.sessionMode="meeting",t.channelId=i.channelId,t.channelName=e.channelName,t.parseAccountUidMap(i.accountUidMap),i.uid=t.getUidWithAccount(t.nim.account),t.type=i.type=i.type||r.NETCALL_TYPE_VIDEO,i.account=t.nim.account,t.imInfo=i,t.controller.sdkData.dataApi.startInfo({uid:i.uid}),Promise.resolve({uid:i.uid,account:t.nim.account,type:i.type})})["catch"](function(e){return t.setSessionConfig({signalEndTime:Date.now()}),t.controller.updateInfoOnce({code:e.code}),Promise.reject(e)})},o.leaveChannel=function(){return this.signalInited&&this.sessionMode?"meeting"!==this.sessionMode?Promise.reject({code:"not in a meeting"}):(this.controller.sdkData.dataApi.sendApi(),this.signalInited=!1,this.controller.hangup(),Promise.resolve()):Promise.reject({code:"noConnection"})},o.changeRoleToPlayer=function(){return 0===this.role?Promise.resolve({role:"player"}):(this.role=0,this.controller.rtc&&this.controller.rtc?(this.controller.updateRtcStream(),this.controller.createOffer(!0).then(function(){return Promise.resolve({role:"player"})})):Promise.resolve({role:"player"}))},o.changeRoleToAudience=function(){return 1===this.role?Promise.resolve({role:"audience"}):(this.role=1,this.controller.rtc&&this.controller.rtc?(this.controller.updateRtcStream(),this.controller.createOffer(!0).then(function(){return Promise.resolve({role:"audience"})})):Promise.resolve({role:"audience"}))},o.updateRtmpUrl=function(e){return this.controller.setSessionConfig({rtmpUrl:e}),this.controller.updateRtmpUrl(),Promise.resolve()}},212:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=i(184),c=i(8),d=i(71),u=i(183),l=i(188),p=i(185),h=i(187),f=i(86),m=void 0,v=void 0,g=function(e){function t(i,o,a){n(this,t);var s=r(this,e.call(this));return s.sessionConfig={},s.container=i,s.remoteContainer=o,s.client=a,s.init(),s.resetStatus(),s}return o(t,e),t}(c);g.install=function(e){m=m||e.Promise,v=e.util};var y=g.prototype;y.init=function(){this.mediaDevices=new u,this.mediaDevices.on("deviceStatus",this.onDeviceStatusChange.bind(this)),this.mediaDevices.on("deviceAdd",this.onDeviceAdd.bind(this)),this.mediaDevices.on("deviceRemove",this.onDeviceRemove.bind(this)),this.rtcRecorder=new s,f.init(this.client.nim.options.appKey,"WebRTC"),this.sdkData=f},y.resetStatus=function(){this.rtc&&this.rtc.close(),this.rtc=null,this.rtcFirstConnected=!1,this.signal&&(this.signal.destroy(),this.signal=null),this.rtcRecorder.stop()["catch"](),this.imInfo={},this.stopAudioMonitor(),f.dataRtc.stopInfo(),this.destroyMediaStream({type:"all"}),this.remoteStreamList={},this.remoteUidMsidMap={},this.remoteStreams={},this.deviceVideoStatus=!1,this.deviceAudioStatus=!1,this.monitorRemoteStreamStartTime=null,this.userJoinTimeoutId=null,window.myRtcRemoteStream=this.remoteStreamList},y.destroyMediaStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"all"};if("local"!==e.type&&"all"!==e.type||(this.destroyLocalMediaStream(),"local"!==e.type)){if("remote"===e.type)return void this.destroyRemoteMediaStream(e.uid);var t=this.remoteStreamList;if(t){for(var i in t)this.destroyRemoteMediaStream(i);this.remoteStreamList={}}}},y.destroyLocalMediaStream=function(){this.localAudioStream&&(this.localAudioStream.destroy(),this.localAudioStream=null),this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null),this.localStream&&(this.localStream.destroy(),this.localStream=null)},y.destroyRemoteMediaStream=function(e){if(e&&this.remoteStreamList&&this.remoteStreamList[e]){var t=this.remoteStreamList[e];t.remoteStream&&t.remoteStream.destroy(),t.remoteVideoStream&&t.remoteVideoStream.destroy(),t.remoteAudioStream&&t.remoteAudioStream.destroy(),t.remoteStream=null,t.remoteVideoStream=null,t.remoteAudioStream=null,this.remoteStreamList[e]=null}},y.getUidByMsid=function(e){var t=this.remoteUidMsidMap;for(var i in t)if(t[i]===e)return i;return null},y.getMsidByUid=function(e){return this.remoteUidMsidMap(e)},y.initSignal=function(){var e=this;if(this.signal)return m.resolve();this.stopSignal();var t=new h,i=this.imInfo.rtcUrls.shift();return i?t.connect(i).then(function(t){return e.signal=t,e.initSignalEvent(),e.signal.heartbeat({uid:e.imInfo.uid,cid:e.imInfo.channelId}),m.resolve()})["catch"](function(){return e.initSignal()}):m.reject("无可用webrtc服务器地址")},y.initSignalEvent=function(){var e=this;this.signal.on("message",this.onMessage.bind(this)),this.signal.on("signalClosed",function(){e.emit("signalClosed"),e.stopSignal(),e.rtcRecorder.stop()["catch"]()}),this.signal.on("signalError",function(e){})},y.stopSignal=function(){this.signal&&(this.signal.destroy(),this.signal=null,this.client.signalInited=!1,this.stopRemoteStream())},y.switchVideoToAudio=function(){var e=this;return m.resolve().then(function(){if(!e.rtc)throw new Error("current has no session stared, can't switch video to audio");return e.localVideoStream&&(e.localVideoStream.destroy(),e.localVideoStream=null),m.resolve()})},y.switchAudioToVideo=function(){var e=this;return m.resolve().then(function(){if(!e.rtc)throw new Error("current has no session stared, can't switch audio to video");return e.localVideoStream?(e.updateRtcStream(),e.createOffer(!0)):m.resolve()})},y.updateLocalStream=function(){v.rtcLog("更新本地音视频流,重组合成新的轨道,当前角色："+(0===this.client.role?"player":"audience"));var e=this.client.getUidWithAccount(this.client.getAccount()),t=void 0;if(t=this.localStream?this.localStream.stream||new MediaStream:new MediaStream,"meeting"===this.client.sessionMode&&0!==this.client.role)return t.getTracks().forEach(function(e){t.removeTrack(e)}),t;var i=t&&t.getVideoTracks()[0];if(this.localVideoStream){var n=this.localVideoStream.stream.getVideoTracks()[0];n!==i&&(i&&t.removeTrack(i),t.addTrack(n))}else i&&t.removeTrack(i);var r=t&&t.getAudioTracks()[0];if(this.localAudioStream){var o=this.localAudioStream.stream&&this.localAudioStream.stream.getAudioTracks()[0];o!==r&&(r&&t.removeTrack(r),t.addTrack(o))}else r&&t.removeTrack(r);return this.localStream||(this.localStream=new l({stream:t,uid:e})),t},y.updateRtcStream=function(){var e=window.myLocalStream=this.updateLocalStream();this.rtc&&(v.rtcLog("attach ms length: "+e.getTracks().length),v.rtcLog("本地流附加rtc ---> ",e),this.rtc.addStream(e))},y.startRtc=function(e){var t=this;this.imInfo=e;var i=e.serverMap?JSON.parse(e.serverMap):{};e.rtcUrls=e.rtcUrls||i.webrtcs||[i.webrtc];var n=void 0;return n=this.signal?m.resolve(this.signal):this.initSignal(),n=n.then(function(){return t.rtc||(t.rtc=new p(t),t.initRtcEvent()),t.doRtc(e.sessionMode)})},y.hangup=function(){this.client.signalInited&&this.stopSignal(),null!==this.userJoinTimeoutId&&(clearTimeout(this.userJoinTimeoutId),this.userJoinTimeoutId=null),this.resetStatus()},y.logout=function(){this.signal&&this.signal.logout()},y.doRtc=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"p2p";this.setSessionConfig({rtcStartTime:Date.now()}),this.updateRtcStream();var i=this.createOffer().then(function(){var i=new m(function(i,n){e.once("userJoined",function(e){v.rtcLog("once userJoined-->",e),i(e)}),e.once("rtcConnectSuccess",function(t){v.rtcLog("rtc connect success"),e.rtcFirstConnected=!0,e.setSessionConfig({rtcEndTime:Date.now()}),e.startAudioMonitor(),f.dataRtc.startInfo({rtcConnection:e.rtc.rtcConnection,imInfo:e.imInfo,remoteUidMsidMap:e.remoteUidMsidMap,sessionConfig:e.sessionConfig,videoConfig:e.getVideoSessionConfig(),uid:e.client.getUid()}),i(t)}),e.once("rtcConnectError",function(e){f.dataRtc.stopInfo(),n(e)}),"p2p"===t&&(e.userJoinTimeoutId=setTimeout(function(){n("user join timeout")},5e4))});return i});return i},y.createOffer=function(e){var t=this;return this.rtc.sdpAnswer=null,e&&!this.rtc.checkNegotiation()?m.resolve():(this.createOfferLockTimer&&(v.rtcLog("销毁 createoffer timer"),clearTimeout(this.createOfferLockTimer)),v.rtcLog("新建 createoffer timer"),this.createOfferLockTimer=setTimeout(function(){t.createOfferLockTimer=null,v.rtcLog("------ 执行 createoffer ------"),t._createOffer(e)},500),m.resolve())},y._createOffer=function(e){var t=this,i=this.rtc,n=new m(function(n,r){return i?void i.createOffer().then(function(o){i.setLocalDescription(o,e).then(function(){t.sendOffer(o,e),n()})["catch"](function(e){r(e)})}):r("rtc not connected")});return n},y.doSendOffer=function(e){var t=e.offer,i=e.isUpdate,n=e.ice_offer;this.sendOffer(t,i,n)},y.sendOffer=function(e,t){var i=this.imInfo,n=this.getVideoSessionConfig(),r=this.sessionConfig||{},o=t?"sdp_update":"sdp_offer",a=this.mediaDevices.getDeviceStatus(),s={type:o,uid:i.uid,cid:i.channelId,session_mode:i.sessionMode||"p2p",record:{support_video_record:r.recordVideo||!1,support_audio_record:r.recordAudio||!1},bypass_rtmp:{is_host:!!r.rtmpUrl,support_bypass_rtmp:r.bypassRtmp||!1,support_bypass_rtmp_record:r.rtmpRecord||!1,bypass_rtmp_url:r.rtmpUrl||"",participant_mode:"M-"+r.splitMode,layout:r.layout||""},params:{token:i.channelId+"",user_type:2,user_token_type:0,content:e,streamSetting:{video:{width:n.width,height:n.height,frameRate:n.frameRate}}},hasAudio:this.deviceAudioStatus&&a.hasAudio&&!this.client.role,hasVideo:this.deviceVideoStatus&&a.hasVideo&&!this.client.role};v.rtcLog("send offer",s),this.signal&&this.signal.send(s)},y.updateRtmpUrl=function(){this.signal&&this.signal.send({type:"update_bypass_url",uid:this.imInfo.uid,cid:this.imInfo.channelId,params:{content:{bypass_url:this.sessionConfig.rtmpUrl}}})},y.getDeviceStatus=function(){return this.mediaDevices.getDeviceStatus()},y.onDeviceStatusChange=function(e){v.rtcLog("onDeviceStatusChange"),this.emit("deviceStatus",e)},y.onDeviceAdd=function(e){v.rtcLog("onDeviceAdd"),this.client.devices.needVideo=this.deviceVideoStatus,this.client.devices.needAudio=this.deviceAudioStatus,this.emit("deviceAdd",e)},y.onDeviceRemove=function(e){var t=this;v.rtcLog("onDeviceRemove"),(this.localVideoStream||this.localAudioStream)&&e.forEach(function(e){t.localVideoStream&&e.deviceId===t.localVideoStream.constraint.video.deviceId&&(t.localVideoStream.destroy(),t.localVideoStream=null,t.client.devices.hasVideo=!1,t.rtcFirstConnected&&(t.updateRtcStream(),t.createOffer(!0))),t.localAudioStream&&e.deviceId===t.localAudioStream.constraint.audio.deviceId&&(t.localAudioStream.destroy(),t.localAudioStream=null,t.client.devices.hasAudio=!1,t.rtcFirstConnected&&(t.updateRtcStream(),t.createOffer(!0)))}),this.emit("deviceRemove",e)},y.initRtcEvent=function(){var e=this;this.rtc.on("sendOffer",this.doSendOffer.bind(this)),this.rtc.on("iceCompleted",this.startSdp_offer.bind(this)),this.rtc.on("getRemoteStream",this.onRemoteStream.bind(this)),this.rtc.on("iceCandidate",this.onLocalIceCandidate.bind(this)),this.rtc.on("negotiationneeded",this.onNegotiationNeeded.bind(this)),this.rtc.on("iceconnectionstatechange",this.onIceConnectionStateChange.bind(this)),this.rtc.on("rtcStats",function(t){e.emit("statistics",t),e.monitorRemoteStream(t),f.dataRtc.updateInfo(t)}),this.mediaDevices.getDevices().then(function(t){e.emit("devices",t)})},y.startAudioMonitor=function(){function e(){var e={},t=0;this.localAudioStream&&(t=this.localAudioStream.getAudioVolume()),e.self={status:t},f.dataRtc.updateLocalVolumn(e.self.status);var i=this.remoteStreamList;for(var n in i){var r=this.client.getAccountWithUid(n);r&&(t=i[n]&&i[n].remoteAudioStream?i[n].remoteAudioStream.getAudioVolume():0,e[r]={status:t})}this.emit("audioVolume",e)}var t=this.audioMonitorTimer;t||(t=this.audioMonitorTimer=setInterval(e.bind(this),500))},y.stopAudioMonitor=function(){var e=this.audioMonitorTimer;e&&(clearInterval(e),e=this.audioMonitorTimer=null)},y.monitorRemoteStream=function(e){if(this.remoteVideoStream||this.remoteAudioStream){if(!e.ssrc.remote||!e.ssrc.remote.total)return;var t=e.ssrc.remote.total;if(t.bytesReceivedRate>0||!this.monitorRemoteStreamStartTime)this.monitorRemoteStreamStartTime=Date.now();else{var i=Date.now();i-this.monitorRemoteStreamStartTime>1e4&&(v.rtcWarn("10秒内未收到音视频数据"),this.emit("remoteStreamNoData"),this.monitorRemoteStreamStartTime=null)}}else this.monitorRemoteStreamStartTime=null},y.onRemoteStream=function(e){v.rtcLog("收到远程流");var t=e.id,i=this.getUidByMsid(t);return i?void this.doRemoteStream(e,i):(this.remoteStreams[t]=e,window.myRemoteStreams=this.remoteStreams,v.rtcWarn("无法找到远程流对应的uid!!,先暂存",e))},y.checkRemoteTrack=function(e,t){var i=this.remoteStreamList[e],n=window.remoteStream=i.remoteStream&&i.remoteStream.stream;if(n){var r=this.rtc.checkMediaStatus(n,t.sdp);v.rtcLog(e+" checkRemoteTrack",r),r.video||i.remoteVideoStream&&i.remoteVideoStream.hide()}},y.startDoRemoteStream=function(e,t){this.remoteStreams[t]&&this.doRemoteStream(this.remoteStreams[t],e)},y.doRemoteStream=function(e,t){var i=this;v.rtcLog("响应远程推送过来的流数据，即将进行轨道重组，轨道数目: "+e.getTracks().length,e),e&&e.getTracks().forEach(function(e){v.rtcLog("   > 轨道id:",e.kind+":"+e.id)}),window.myRemoteStreamList=this.remoteStreamList,window.myRtc=this.rtc.rtcConnection;var n=this.remoteStreamList[t];n.remoteStream?n.remoteStream.updateStream(e):n.remoteStream=new l({uid:t,stream:e,isRemote:!0,container:n.container});var r=e.getAudioTracks(),o=e.getVideoTracks();if(r.length){var a=new MediaStream;a.addTrack(r[0]),v.rtcLog("重组音频流:",a),n.remoteAudioStream?n.remoteAudioStream.updateStream(a):n.remoteAudioStream=new l({uid:t,stream:a,type:"audio",isRemote:!0,container:n.container}),n.remoteAudioStream.show()}if(o.length){var s=new MediaStream;s.addTrack(o[0]),v.rtcLog("重组视频流:",s),n.remoteVideoStream?n.remoteVideoStream.updateStream(s):n.remoteVideoStream=new l({uid:t,stream:s,isRemote:!0,container:n.container}),setTimeout(function(){n.isVideoEnable&&n.remoteVideoStream&&(n.remoteVideoStream.show(),n.remoteVideoStream.resize(n.videoSizeOptions||this.videoViewRemoteSizeOptions))}.bind(this),100)}e.onaddtrack=function(r){i.emit("addtrack",r);var o=r.track,a=o.kind;if(v.rtcLog(e.id,"on add track:",a,o),"video"===a){var s=new MediaStream;s.addTrack(o),n.remoteVideoStream?n.remoteVideoStream.updateStream(s):n.remoteVideoStream=new l({uid:t,stream:s,isRemote:!0,container:n.container}),setTimeout(function(){v.rtcLog("delay video show"),n.isVideoEnable&&n.remoteVideoStream&&(n.remoteVideoStream.show(),n.remoteVideoStream.resize(n.videoSizeOptions||this.videoViewRemoteSizeOptions))}.bind(i),100)}else{var c=new MediaStream;c.addTrack(o),n.remoteAudioStream?n.remoteAudioStream.updateStream(c):n.remoteAudioStream=new l({uid:t,stream:c,type:"audio",isRemote:!0,container:n.container}),n.remoteAudioStream.show()}},e.onremovetrack=function(t){v.rtcLog(e,"on remove track:",t),i.emit("removetrack",t);var r=t.track,o=r.kind;"video"===o?n.remoteVideoStream&&n.remoteVideoStream.hide():n.remoteAudioStream}},y.onLocalIceCandidate=function(e){var t="ice_offer";/\d tcp \d/.test(e.candidate)||(v.rtcLog("do send ice",e.candidate),this.signal&&this.signal.send({type:t,uid:this.imInfo.uid,cid:this.imInfo.channelId,params:{content:e}}))},y.onNegotiationNeeded=function(){this.rtcFirstConnected&&(v.rtcLog("onNegotiationNeeded"),this.createOffer(!0))},y.onIceConnectionStateChange=function(e){v.rtcLog("ice connection state change to:"+e),
"connected"===e?(this.emit("rtcConnectSuccess"),this.startSdp_offer()):"failed"===e&&this.emit("rtcConnectFailed")},y.onMessage=function(e){var t={sdp_answer:"onSdp_answer",ice_offer:"onIce_OfferAnswer",ice_answer:"onIce_OfferAnswer",sdp_offer:"onSdp_offer",client_logout:"onClient_logout",logout:"onClient_logout"};if(e&&e.cid&&e.uid&&(e.cid=+e.cid,e.uid=+e.uid),e.cid!==this.imInfo.channelId)return v.rtcError("websocket message not belong to this session");var i=t[e.type];this[i]&&this[i](e)},y.onSdp_answer=function(e){v.rtcLog("onSdp_answer-->",e);var t=e.params.auth_res-0;return 200!==t?(v.rtcWarn("服务器验证不通过, 断开连接"),void this.emit("rtcConnectFailed",{code:t,error:"服务器验证不通过, 断开连接"})):void this.rtc.setRemoteDescription(e.params.content,"answer").then(function(){})},y.onSdp_offer=function(e){return this.rtc.iceCompleted&&this.rtc.sdpAnswer?this.doSdp_offer(e):(this.remote_SdpOffers=this.remote_SdpOffers||[],this.remote_SdpOffers.push(e),void v.rtcLog("onSdp_offer -> []",this.remote_SdpOffers))},y.startSdp_offer=function(){var e=this.remote_SdpOffers,t=this;if(e&&0!==e.length){v.rtcLog("开始处理sdp_offer",e);var i=e.shift();t.doSdp_offer(i),setTimeout(t.startSdp_offer.bind(t),100)}},y.doSdp_offer=function(e){var t=this;v.rtcLog("处理sdp_offer");var i=e.uid,n=e.cid;if(!i||!n)return v.rtcError("非法会话",e);var r=JSON.parse(e.params.content.msids);r.forEach(function(i){if(i.uid){i.uid=i.uid-0;var n=new Date;n=n.toLocaleString(),v.rtcLog(n+" 有用户状态更新",e),t.remoteUidMsidMap[i.uid]?t.updateRemoteUserStream(i.uid,i.msid):(t.updateRemoteUserStream(i.uid,i.msid),t.emit("userJoined",{uid:i.uid})),t.remoteStreams[i.msid]&&t.startDoRemoteStream(i.uid,i.msid),t.checkRemoteTrack(i.uid,e.params.content)}else v.rtcWarn("未知用户或者数据流的sdp_offer",i)}),this.rtc.setRemoteDescription(e.params.content,"offer").then(function(){var e=t.getVideoSessionConfig();t.rtc.createAnswer().then(function(i){t.rtc.setLocalDescription(i),t.signal&&t.signal.send({type:"sdp_answer",uid:t.imInfo.uid,cid:t.imInfo.channelId,params:{content:i,streamSetting:{video:{width:e.width,height:e.height,frameRate:e.frameRate}}}})})["catch"](function(e){v.rtcError(e)})})["catch"](function(){})},y.onIce_OfferAnswer=function(e){var t=e.params.content;"object"!==("undefined"==typeof t?"undefined":a(t))&&(t={candidate:t}),this.rtc.addRemoteIceCandidate(t)},y.onClient_logout=function(e){v.rtcLog("on logout",e);var t=e.uid;if(this.remoteUidMsidMap[t]){var i=this.client.getAccountWithUid(t),n=e.params&&e.params.content&&e.params.content.logout_type||"timeout";n="normal"===n?d.HANGUP_TYPE_NORMAL:d.HANGUP_TYPE_TIMEOUT,this.destroyMediaStream({uid:t,type:"remote"}),this.removeRemoteUserStream(t),this.emit("leaveChannel",{account:i,type:n})}},y.getVideoSessionConfig=function(){var e,t,i={},n=this.sessionConfig,r=n&&n.videoQuality||d.CHAT_VIDEO_QUALITY_NORMAL,o=n&&n.videoFrameRate||d.CHAT_VIDEO_FRAME_RATE_NORMAL,a=(e={},e[d.CHAT_VIDEO_QUALITY_NORMAL]="640x480",e[d.CHAT_VIDEO_QUALITY_LOW]="176x144",e[d.CHAT_VIDEO_QUALITY_MEDIUM]="352x288",e[d.CHAT_VIDEO_QUALITY_HIGH]="480x320",e[d.CHAT_VIDEO_QUALITY_480P]="640x480",e[d.CHAT_VIDEO_QUALITY_540P]="960x540",e[d.CHAT_VIDEO_QUALITY_720P]="1280x720",e),s=(t={},t[d.CHAT_VIDEO_FRAME_RATE_NORMAL]=15,t[d.CHAT_VIDEO_FRAME_RATE_5]=5,t[d.CHAT_VIDEO_FRAME_RATE_10]=10,t[d.CHAT_VIDEO_FRAME_RATE_15]=15,t[d.CHAT_VIDEO_FRAME_RATE_20]=20,t[d.CHAT_VIDEO_FRAME_RATE_25]=25,t);return i.frameRate=s[o],i.width=parseInt(a[r].split("x")[0]),i.height=parseInt(a[r].split("x")[1]),i},y.stopDevice=function(e){var t=this;return new m(function(i,n){if(e===d.DEVICE_TYPE_VIDEO){if(t.deviceVideoStatus=!1,t.localVideoStream)return t.localVideoStream.destroy(),t.localVideoStream=null,t.rtcFirstConnected&&t.client.type===d.NETCALL_TYPE_VIDEO?(t.updateRtcStream(),t.createOffer(!0).then(i)):i()}else if(e===d.DEVICE_TYPE_AUDIO_IN){if(t.deviceAudioStatus=!1,t.localAudioStream)return t.localAudioStream.stopDevice(),i()}else e===d.DEVICE_TYPE_AUDIO_OUT_LOCAL?t.localAudioStream&&t.localAudioStream.setMuted(!0):e===d.DEVICE_TYPE_AUDIO_OUT_CHAT&&t.setAudioBlack();i()})},y.startDevice=function(e){var t=this;return new m(function(i,n){var r=e.type,o=e.device;if(r===d.DEVICE_TYPE_VIDEO&&(t.deviceVideoStatus=!0),r===d.DEVICE_TYPE_AUDIO_IN&&(t.deviceAudioStatus=!0),r===d.DEVICE_TYPE_AUDIO_OUT_LOCAL)return t.localAudioStream&&(t.localAudioStream.show(),t.localAudioStream.setMuted(!1)),i();if(r===d.DEVICE_TYPE_AUDIO_OUT_CHAT)return t.setAudioStart(),i();var a=m.resolve();r!==d.DEVICE_TYPE_DESKTOP_SCREEN&&r!==d.DEVICE_TYPE_DESKTOP_WINDOW&&(o&&o.deviceId||(a=new m(function(e,i){t.mediaDevices.getDevicesOfType(r).then(function(t){t.length?(o=t[0],e(o)):i("开启设备失败: 没有找到可用设备")})}))),a.then(function(){if(r===d.DEVICE_TYPE_VIDEO&&t.localVideoStream&&t.localVideoStream.constraint&&t.localVideoStream.constraint.video.deviceId===o.deviceId)return void v.rtcLog("摄像头已开启，重复操作");if(r===d.DEVICE_TYPE_AUDIO_IN&&t.localAudioStream&&t.localAudioStream.audioStream&&t.localAudioStream.constraint.audio.deviceId===o.deviceId){v.rtcLog("麦克风已开启，设置track为enable");var e=t.localAudioStream.stream&&t.localAudioStream.stream.getAudioTracks()[0];return void(e&&(e.enabled=!0))}return r===d.DEVICE_TYPE_VIDEO?t._getVideoStream(o,i,n):r===d.DEVICE_TYPE_AUDIO_IN?t._getAudioStream(o,i,n):r===d.DEVICE_TYPE_DESKTOP_SCREEN||r===d.DEVICE_TYPE_DESKTOP_WINDOW?t._getScreenStream(r,i,n):void 0}).then(function(){i()})["catch"](function(e){n(e)})})},y._getVideoStream=function(e,t,i){var n=this,r={};this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null);var o=r.video={};o.deviceId=e.deviceId;var a=this.getVideoSessionConfig();return v.merge(o,a),l.getLocalStream(r).then(function(e){if(n.localVideoStream=e,n.rtcFirstConnected&&n.client.type===d.NETCALL_TYPE_VIDEO)return n.updateRtcStream(),n.createOffer(!0).then(t)})},y._getAudioStream=function(e,t,i){var n=this,r={},o=r.audio={};return o.deviceId=e.deviceId,l.getLocalStream(r).then(function(e){return n.localAudioStream?(n.localAudioStream.updateStream(e),t()):(n.localAudioStream=new l({stream:e,type:"audio",isRemote:!1,constraint:r}),n.rtcFirstConnected?(n.updateRtcStream(),n.createOffer(!0).then(t)):void 0)})},y._getScreenStream=function(e,t,i){var n=this;this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null),e=e===d.DEVICE_TYPE_DESKTOP_SCREEN?"screen":"window";var r={audio:!1,video:{mediaSource:e}};return l.getLocalStream(r).then(function(e){if(n.localVideoStream=e,n.rtcFirstConnected)return n.updateRtcStream(),n.createOffer(!0).then(t)})},y.setSessionConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionConfig=v.merge(this.sessionConfig,e)},y.setSessionVideoQuality=function(e){void 0!==e&&(this.sessionConfig.videoQuality=e)},y.setSessionVideoFrameRate=function(e){void 0!==e&&(this.sessionConfig.videoFrameRate=e)},y.setSessionAudioQuality=function(e){this.sessionConfig.highAudio=!!e},y.setCaptureVolume=function(e){(void 0===e||e>1)&&(e=1),this.localAudioStream&&this.localAudioStream.setGain(e)},y.setPlayVolume=function(e){return e.fn="setPlayVolume",e.option={volume:e.volume},this.localAudioStream&&this.localAudioStream.setPlayVolume(e.volume),this.optionRemoteStream(e)},y.startLocalStream=function(e){var t=this;if(this.localVideoStream){if(this.localVideoStream.container=e||this.container,!this.localVideoStream.container)return this.client.error("开启本地视频流失败: video容器节点缺失"),m.reject("开启本地视频流失败: video容器节点缺失");this.localVideoStream.resize(this.videoViewSizeOptions),this.localVideoStream.show(),this.localVideoStream.on("resize",function(e){t.emit("streamResize",e)}),this.localVideoStream.on("error",function(e){t.emit("error",e)}),this.localVideoStream.isShown()||this.updateRtcStream()}},y.stopLocalStream=function(){this.localVideoStream&&this.localVideoStream.hide()},y.updateRemoteUserStream=function(e,t){this.remoteUidMsidMap[e]=t,this.remoteStreamList[e]||(this.remoteStreamList[e]={isVideoEnable:!0,container:null})},y.removeRemoteUserStream=function(e){delete this.remoteUidMsidMap[e],delete this.remoteStreamList[e]},y.startRecordMp4=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,i=void 0,n=void 0;if(t)if(t===this.client.getAccount())i=null;else if(i=this.client.getUidWithAccount(t),!i)return m.reject("账号不在本次会议中，无法进行录制");if(t=t||this.client.getAccount(),n=this.localStream,i&&(n=this.remoteStreamList[i].remoteStream),!n||!n.stream)return m.reject("当前没有音视频数据，无法进行录制");var r=[n.stream];return this.rtcRecorder.start(r,{account:t})},y.stopRecord=function(){return this.rtcRecorder.stop()},y.startRecordAac=function(){var e=this.localAudioStream,t=this.client.getAccount(),i=[];e&&e.stream&&(i=[e.stream]);var n=this.remoteStreamList;for(var r in n)n[r].remoteStream&&n[r].remoteStream.stream&&i.push(n[r].remoteStream.stream);return this.rtcRecorder.start(i,{account:t,type:"audio"})},y.startRemoteStream=function(){function e(e){e.container=n&&n.node||e.container,e.isVideoEnable=!0,e.remoteVideoStream&&(e.remoteVideoStream.resize(e.videoSizeOptions),e.remoteVideoStream.show())}var t,i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("p2p"===this.client.sessionMode){if(!this.remoteContainer&&!n.node||!this.client.target)return m.reject("不传参数且点对点模式实例化Netcall必须设置remoteContainer与target；传参数必须包含account，node");t=this.client.getUidWithAccount(this.client.target),i=this.remoteStreamList[t],n.node=n.node||this.remoteContainer}else{if(!n.uid&&n.account&&(t=this.client.getUidWithAccount(n.account),!t))return m.reject("帐号不在会议中，请检查");t=n.uid||t,i=this.remoteStreamList[t]}if(i)return i.container=n&&n.node||i.container,i.container?(e(i),m.resolve()):m.reject(t+" 开启显示远端视频画面失败: 请传递video容器");var r=this.remoteStreamList;for(var o in r){if(r[o].container=n&&n.node||r[o].container,!r[o].container)return m.reject(t+" 开启显示远端视频画面失败: 请传递video容器");e(r[o])}return m.resolve()},y.stopRemoteStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.constructor===String&&(e={account:e}),e.fn="hide",this.optionRemoteStream(e)},y.suspendLocalStream=function(){return this.localVideoStream?(this.localVideoStream.pause(),m.resolve()):m.reject("本地没有音视频流，无法进行操作")},y.resumeLocalStream=function(){return this.localVideoStream?(this.localVideoStream.resume(),m.resolve()):m.reject("本地没有音视频流，无法进行操作")},y.suspendRemoteStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="pause",this.optionRemoteStream(e)},y.resumeRemoteStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="resume",this.optionRemoteStream(e)},y.optionRemoteStream=function(){function e(e){return o?void(e.remoteAudioStream&&e.remoteAudioStream[i]&&e.remoteAudioStream[i](a)):("resize"===i&&(e.videoSizeOptions=a||this.videoViewRemoteSizeOptions),e.remoteVideoStream&&e.remoteVideoStream[i]&&e.remoteVideoStream[i](a),void(e.isVideoEnable="hide"!==i))}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.fn,n=t.uid,r=t.account,o=t.isAudio,a=t.option,s=void 0;if(o=o||/(setPlayVolume|setGain)/.test(i),!n&&r&&(n=this.client.getUidWithAccount(r),!n))return m.reject("操作帐号不在会议中，请检查");if(n)return s=this.remoteStreamList[n],s&&e(s),m.resolve();s=this.remoteStreamList;for(var c in s)s[c]&&e(s[c]);return m.resolve()},y.setVideoViewSize=function(e){this.videoViewSizeOptions=e,this.localVideoStream&&this.localVideoStream.resize(this.videoViewSizeOptions)},y.setVideoViewRemoteSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="resize",e.option={width:e.width,height:e.height,cut:e.cut},this.optionRemoteStream(e)},y.setAudioStart=function(e){return this.optionRemoteStream({fn:"setMuted",account:e,isAudio:!0,option:!1})},y.setAudioBlack=function(e){return this.optionRemoteStream({fn:"setMuted",account:e,isAudio:!0,option:!0})},y.setVideoBlack=function(e){return this.optionRemoteStream({fn:"hide",account:e})},y.setVideoShow=function(e){return this.optionRemoteStream({fn:"show",account:e})},y.updateInfoOnce=function(e){f.dataRtc.updateInfoOnce({imInfo:e,sessionConfig:this.sessionConfig,videoConfig:this.getVideoSessionConfig()})},e.exports=g},213:function(e,t){"use strict";e.exports={randomSSRC:function(){var e=Math.floor(1e8*Math.random())+1e7;return e>1e8?99999999:e},_createLocalDescription:function(e,t){function i(e,i){var a={};switch(a.type=i,i){case"audio":case"video":a.protocol="RTP/SAVPF",a.port=9,a.direction="sendrecv";break;case"application":a.protocol="DTLS/SCTP",a.port=0,a.payloads="0",a.direction="inactive"}a.connection={ip:"127.0.0.1",version:4},a.mid=e,a.iceUfrag=r.usernameFragment,a.icePwd=r.password,a.candidates=[];for(var l=o,p=Array.isArray(l),h=0,l=p?l:l[Symbol.iterator]();;){var f;if(p){if(h>=l.length)break;f=l[h++]}else{if(h=l.next(),h.done)break;f=h.value}var m=f,v={};v.component=1,v.foundation=m.foundation,v.ip=m.ip,v.port=m.port,v.priority=m.priority,v.transport=m.protocol.toLowerCase(),v.type=m.type,"tcp"===v.transport&&(v.tcptype=m.tcpType),a.candidates.push(v)}if(a.endOfCandidates="end-of-candidates","offer"===t?a.setup="actpass":a.setup="server"===s.role?"active":"passive","audio"===i||"video"===i){a.rtp=[],a.rtcpFb=[],a.fmtp=[];for(var g=[],y=c.codecs,S=Array.isArray(y),b=0,y=S?y:y[Symbol.iterator]();;){var C;if(S){if(b>=y.length)break;C=y[b++]}else{if(b=y.next(),b.done)break;C=b.value}var w=C;if(!w.kind||w.kind===i){g.push(w.preferredPayloadType);var T={codec:w.name,payload:w.preferredPayloadType,rate:w.clockRate};if(w.numChannels>1&&(T.encoding=w.numChannels),a.rtp.push(T),w.parameters){for(var _={config:"",payload:w.preferredPayloadType},R=Object.keys(w.parameters),A=Array.isArray(R),E=0,R=A?R:R[Symbol.iterator]();;){var k;if(A){if(E>=R.length)break;k=R[E++]}else{if(E=R.next(),E.done)break;k=E.value}var I=k;_.config&&(_.config+=";"),_.config+=I+"="+w.parameters[I]}_.config&&a.fmtp.push(_)}for(var O=w.rtcpFeedback||[],P=Array.isArray(O),M=0,O=P?O:O[Symbol.iterator]();;){var x;if(P){if(M>=O.length)break;x=O[M++]}else{if(M=O.next(),M.done)break;x=M.value}var L=x;a.rtcpFb.push({payload:w.preferredPayloadType,subtype:L.parameter||void 0,type:L.type})}}}0===g.length?(a.payloads="9",a.port=0,a.direction="inactive"):a.payloads=g.join(" "),a.ssrcs=[],a.ssrcGroups=[];for(var D=d.values(),V=Array.isArray(D),U=0,D=V?D:D[Symbol.iterator]();;){var N;if(V){if(U>=D.length)break;N=D[U++]}else{if(U=D.next(),U.done)break;N=U.value}var j=N,B=j.rtpSender,F=j.stream.id,H=B.track;if("ended"!==H.readyState&&H.kind===i){j.ssrc||(j.ssrc=this.randomSSRC());var G=u&&"video"===H.kind;G&&!j.rtxSsrc&&(j.rtxSsrc=j.ssrc+1),a.ssrcs.push({attribute:"cname",id:j.ssrc,value:CNAME}),a.ssrcs.push({attribute:"msid",id:j.ssrc,value:F+" "+H.id}),a.ssrcs.push({attribute:"mslabel",id:j.ssrc,value:F}),a.ssrcs.push({attribute:"label",id:j.ssrc,value:H.id}),G&&(a.ssrcs.push({attribute:"cname",id:j.rtxSsrc,value:CNAME}),a.ssrcs.push({attribute:"msid",id:j.rtxSsrc,value:F+" "+H.id}),a.ssrcs.push({attribute:"mslabel",id:j.rtxSsrc,value:F}),a.ssrcs.push({attribute:"label",id:j.rtxSsrc,value:H.id}),a.ssrcGroups.push({semantics:"FID",ssrcs:j.ssrc+" "+j.rtxSsrc}))}}a.ext=[];for(var W=c.headerExtensions,z=Array.isArray(W),Y=0,W=z?W:W[Symbol.iterator]();;){var J;if(z){if(Y>=W.length)break;J=W[Y++]}else{if(Y=W.next(),Y.done)break;J=Y.value}var q=J;q.kind&&q.kind!==i||a.ext.push({value:q.preferredId,uri:q.uri})}a.rtcpMux="rtcp-mux",a.rtcpRsize="rtcp-rsize"}n.media.push(a)}var n={},r=this._iceGatherer.getLocalParameters(),o=this._iceGatherer.getLocalCandidates(),a=this._dtlsTransport.getLocalParameters(),s=this._dtlsTransport.getRemoteParameters(),c=this._localCapabilities,d=this._localTrackInfos;"offer"===t&&this._sdpGlobalFields.version++,n.version=0,n.origin={address:"127.0.0.1",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"jitsi-ortc-webrtc-shim"},n.name="-",n.timing={start:0,stop:0},n.msidSemantic={semantic:"WMS",token:"*"},n.groups=[{mids:Array.from(this._mids.keys()).join(" "),type:"BUNDLE"}],n.media=[],n.fingerprint={hash:a.fingerprints[0].value,type:a.fingerprints[0].algorithm};for(var u=!1,l=c.codecs,p=Array.isArray(l),h=0,l=p?l:l[Symbol.iterator]();;){var f;if(p){if(h>=l.length)break;f=l[h++]}else{if(h=l.next(),h.done)break;f=h.value}var m=f;if("video"===m.kind&&"rtx"===m.name){u=!0;break}}for(var v=this._mids,g=Array.isArray(v),y=0,v=g?v:v[Symbol.iterator]();;){var S;if(g){if(y>=v.length)break;S=v[y++]}else{if(y=v.next(),y.done)break;S=y.value}var b=S,C=b[0],w=b[1];i.call(this,C,w)}var T=new RTCSessionDescription({type:t,_sdpObject:n});return T},mergeConstraints:function(e,t){if(!e||!t)return e||t;var i=e;for(var n in t)i[n]=t[n];return i},iceCandidateType:function(e){return e.split(" ")[7]},formatTypePreference:function(e){if(/Chrome\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TLS";case 1:return"TURN/TCP";case 2:return"TURN/UDP"}else if(/Firefox\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TCP";case 5:return"TURN/UDP"}return""},maybeSetOpusOptions:function(e,t){return"true"===t.opusStereo?e=this.setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=this.removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=this.setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=this.removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=this.setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=this.removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=this.setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},maybeSetAudioSendBitRate:function(e,t){return t.audioSendBitrate?(console.log("Prefer audio send bitrate: "+t.audioSendBitrate),this.preferBitRate(e,t.audioSendBitrate,"audio")):e},maybeSetAudioReceiveBitRate:function(e,t){return t.audioRecvBitrate?(console.log("Prefer audio receive bitrate: "+t.audioRecvBitrate),this.preferBitRate(e,t.audioRecvBitrate,"audio")):e},maybeSetVideoSendBitRate:function(e,t){return t.videoSendBitrate?(console.log("Prefer video send bitrate: "+t.videoSendBitrate),this.preferBitRate(e,t.videoSendBitrate,"video")):e},maybeSetVideoReceiveBitRate:function(e,t){return t.videoRecvBitrate?(console.log("Prefer video receive bitrate: "+t.videoRecvBitrate),this.preferBitRate(e,t.videoRecvBitrate,"video")):e},preferBitRate:function(e,t,i){var n=e.split("\r\n"),r=this.findLine(n,"m=",i);if(null===r)return console.log("Failed to add bandwidth line to sdp, as no m-line found"),e;var o=this.findLineInRange(n,r+1,-1,"m=");null===o&&(o=n.length);var a=this.findLineInRange(n,r+1,o,"c=");if(null===a)return console.log("Failed to add bandwidth line to sdp, as no c-line found"),e;var s=this.findLineInRange(n,a+1,o,"b=AS");s&&n.splice(s,1);var c="b=AS:"+t;return n.splice(a+1,0,c),e=n.join("\r\n")},maybeSetVideoSendInitialBitRate:function(e,t){var i=t.videoSendInitialBitrate;if(!i)return e;var n=i,r=t.videoSendBitrate;r&&(i>r&&(console.log("Clamping initial bitrate to max bitrate of "+r+" kbps."),i=r,t.videoSendInitialBitrate=i),n=r);var o=e.split("\r\n"),a=this.findLine(o,"m=","video");if(null===a)return console.log("Failed to find video m-line"),e;var s=t.videoRecvCodec;return e=this.setCodecParam(e,s,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=this.setCodecParam(e,s,"x-google-max-bitrate",n.toString())},removePayloadTypeFromMline:function(e,t){e=e.split(" ");for(var i=0;i<e.length;++i)e[i]===t.toString()&&e.splice(i,1);return e.join(" ")},removeCodecByName:function(e,t){var i=this.findLine(e,"a=rtpmap",t);if(null===i)return e;var n=this.getCodecPayloadTypeFromLine(e[i]);e.splice(i,1);var r=this.findLine(e,"m=","video");return null===r?e:(e[r]=this.removePayloadTypeFromMline(e[r],n),e)},removeCodecByPayloadType:function(e,t){var i=this.findLine(e,"a=rtpmap",t.toString());if(null===i)return e;e.splice(i,1);var n=this.findLine(e,"m=","video");return null===n?e:(e[n]=this.removePayloadTypeFromMline(e[n],t),e)},maybeRemoveVideoFec:function(e,t){if("false"!==t.videoFec)return e;var i=e.split("\r\n"),n=this.findLine(i,"a=rtpmap","red");if(null===n)return e;var r=this.getCodecPayloadTypeFromLine(i[n]);if(i=this.removeCodecByPayloadType(i,r),i=this.removeCodecByName(i,"ulpfec"),n=this.findLine(i,"a=fmtp",r.toString()),null===n)return e;var o=this.parseFmtpLine(i[n]),a=o.pt;return null===a?e:(i.splice(n,1),i=this.removeCodecByPayloadType(i,a),i.join("\r\n"))},maybePreferAudioSendCodec:function(e,t){return this.maybePreferCodec(e,"audio","send",t.audioSendCodec)},maybePreferAudioReceiveCodec:function(e,t){return this.maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},maybePreferVideoSendCodec:function(e,t){return this.maybePreferCodec(e,"video","send",t.videoSendCodec)},maybePreferVideoReceiveCodec:function(e,t){return this.maybePreferCodec(e,"video","receive",t.videoRecvCodec)},maybePreferCodec:function(e,t,i,n){var r=t+" "+i+" codec";if(!n)return console.log("No preference on "+r+"."),e;console.log("Prefer "+r+": "+n);var o=e.split("\r\n"),a=this.findLine(o,"m=",t);if(null===a)return e;var s=this.getCodecPayloadType(o,n);return s?o[a]=this.setDefaultCodec(o[a],s):console.error("no prefered codec found for ",n),e=o.join("\r\n")},setCodecParam:function(e,t,i,n){var r=e.split("\r\n"),o=this.findFmtpLine(r,t),a={};if(null===o){var s=this.findLine(r,"a=rtpmap",t);if(null===s)return e;var c=this.getCodecPayloadTypeFromLine(r[s]);a.pt=c.toString(),a.params={},a.params[i]=n,r.splice(s+1,0,this.writeFmtpLine(a))}else a=this.parseFmtpLine(r[o]),a.params[i]=n,r[o]=this.writeFmtpLine(a);return e=r.join("\r\n")},removeCodecParam:function(e,t,i){var n=e.split("\r\n"),r=this.findFmtpLine(n,t);if(null===r)return e;var o=this.parseFmtpLine(n[r]);delete o.params[i];var a=this.writeFmtpLine(o);return null===a?n.splice(r,1):n[r]=a,e=n.join("\r\n")},parseFmtpLine:function(e){var t={},i=e.indexOf(" "),n=e.substring(i+1).split("; "),r=new RegExp("a=fmtp:(\\d+)"),o=e.match(r);if(!o||2!==o.length)return null;t.pt=o[1];for(var a={},s=0;s<n.length;++s){var c=n[s].split("=");2===c.length&&(a[c[0]]=c[1])}return t.params=a,t},writeFmtpLine:function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,i=e.params,n=[],r=0;for(var o in i)n[r]=o+"="+i[o],++r;return 0===r?null:"a=fmtp:"+t.toString()+" "+n.join("; ")},findFmtpLine:function(e,t){var i=this.getCodecPayloadType(e,t);return i?this.findLine(e,"a=fmtp:"+i.toString()):null},findLine:function(e,t,i){return this.findLineInRange(e,0,-1,t,i)},findLineInRange:function(e,t,i,n,r){for(var o=i!==-1?i:e.length,a=t;a<o;++a)if(0===e[a].indexOf(n)&&(!r||e[a].toLowerCase().indexOf(r.toLowerCase())!==-1))return a;return null},getCodecPayloadType:function(e,t){var i=this.findLine(e,"a=rtpmap",t);return i?this.getCodecPayloadTypeFromLine(e[i]):null},getCodecPayloadTypeFromLine:function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),i=e.match(t);return i&&2===i.length?i[1]:null},setDefaultCodec:function(e,t){var i=e.split(" "),n=i.slice(0,3);n.push(t);for(var r=3;r<i.length;r++)i[r]!==t&&n.push(i[r]);return n.join(" ")}}},214:function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=i(8),c=n(s),d=function(e){function t(i){r(this,t);var n=o(this,e.call(this));if(n.peer=i.peer,n.mediaStreamTrack=i.mediaStreamTrack,n.interval=i.interval,n.peer instanceof RTCPeerConnection){if(!(n.mediaStreamTrack instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"2nd argument is not instance of MediaStreamTrack."}else if(!(n.mediaStreamTrack instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"1st argument is not instance of MediaStreamTrack.";return n.init(),n}return a(t,e),t.prototype.init=function(){this.mediaStreamTrack,window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={}),this.reset(),this.initStatsResult(),this.initStatsParser(),this.initStatsParserFn()},t.prototype.reset=function(){this.nomore=!1,this.AUDIO_codecs=["opus","isac","ilbc"],this.VIDEO_codecs=["vp9","vp8","h264"],this.SSRC={audio:{send:[],recv:[]},video:{send:[],recv:[]}},this.LOCAL_candidateType=[],this.LOCAL_transport=[],this.LOCAL_ipAddress=[],this.LOCAL_networkType=[],this.REMOTE_candidateType=[],this.REMOTE_transport=[],this.REMOTE_ipAddress=[],this.REMOTE_networkType=[]},t.prototype.initStatsResult=function(){var e=((navigator.connection||{}).type||"unknown").toString().toLowerCase();this.statsResult={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},results:{},connectionType:{systemNetworkType:e,systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){nomore=!0})}},t.prototype.initStatsParser=function(){var e=this;this.statsParser={checkIfOfferer:function(t){"googLibjingleSession"===t.type&&(e.statsResult.isOfferer=t.googInitiator)}}},t.prototype.initStatsParserFn=function(){var e=this.AUDIO_codecs,t=this.VIDEO_codecs,i=this.SSRC,n=this.statsParser,r=this.statsResult,o=this.LOCAL_candidateType,a=this.LOCAL_transport,s=this.LOCAL_ipAddress,c=this.LOCAL_networkType,d=this.REMOTE_candidateType,u=this.REMOTE_transport,l=this.REMOTE_ipAddress,p=this.REMOTE_networkType;n.datachannel=function(e){"datachannel"===e.type&&(r.datachannel={state:e.state})},n.googCertificate=function(e){"googCertificate"===e.type&&(r.encryption=e.googFingerprintAlgorithm)},n.checkAudioTracks=function(t){if(t.googCodecName&&"audio"===t.mediaType&&e.indexOf(t.googCodecName.toLowerCase())!==-1){var i=t.id.split("_").pop();if(r.audio[i].codecs.indexOf(t.googCodecName)===-1&&r.audio[i].codecs.push(t.googCodecName),t.bytesSent){var n=0;if(t.bytesSent){r.internal.audio[i].prevBytesSent||(r.internal.audio[i].prevBytesSent=t.bytesSent);var o=t.bytesSent-r.internal.audio[i].prevBytesSent;r.internal.audio[i].prevBytesSent=t.bytesSent,n=o/1024}r.audio[i].availableBandwidth=n.toFixed(1)}if(t.bytesReceived){var n=0;if(t.bytesReceived){r.internal.audio[i].prevBytesReceived||(r.internal.audio[i].prevBytesReceived=t.bytesReceived);var o=t.bytesReceived-r.internal.audio[i].prevBytesReceived;r.internal.audio[i].prevBytesReceived=t.bytesReceived,n=o/1024}t.availableBandwidth=n.toFixed(1),r.audio[i].availableBandwidth=t.availableBandwidth}r.audio[i].tracks.indexOf(t.googTrackId)===-1&&r.audio[i].tracks.push(t.googTrackId)}},n.checkVideoTracks=function(e){if(e.googCodecName&&"video"===e.mediaType&&t.indexOf(e.googCodecName.toLowerCase())!==-1){var i=e.id.split("_").pop();if(r.video[i].codecs.indexOf(e.googCodecName)===-1&&r.video[i].codecs.push(e.googCodecName),e.bytesSent){var n=0;r.internal.video[i].prevBytesSent||(r.internal.video[i].prevBytesSent=e.bytesSent);var o=e.bytesSent-r.internal.video[i].prevBytesSent;r.internal.video[i].prevBytesSent=e.bytesSent,n=o/1024}if(e.bytesReceived){var n=0;r.internal.video[i].prevBytesReceived||(r.internal.video[i].prevBytesReceived=e.bytesReceived);var o=e.bytesReceived-r.internal.video[i].prevBytesReceived;r.internal.video[i].prevBytesReceived=e.bytesReceived,n=o/1024}e.availableBandwidth=n.toFixed(1),r.video[i].availableBandwidth=e.availableBandwidth,e.googFrameHeightReceived&&e.googFrameWidthReceived&&(r.resolutions[i].width=e.googFrameWidthReceived,r.resolutions[i].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(r.resolutions[i].width=e.googFrameWidthSent,r.resolutions[i].height=e.googFrameHeightSent),r.video[i].tracks.indexOf(e.googTrackId)===-1&&r.video[i].tracks.push(e.googTrackId)}},n.bweforvideo=function(e){"VideoBwe"===e.type&&(r.video.bandwidth={googActualEncBitrate:e.googActualEncBitrate,googAvailableSendBandwidth:e.googAvailableSendBandwidth,googAvailableReceiveBandwidth:e.googAvailableReceiveBandwidth,googRetransmitBitrate:e.googRetransmitBitrate,googTargetEncBitrate:e.googTargetEncBitrate,googBucketDelay:e.googBucketDelay,googTransmitBitrate:e.googTransmitBitrate})},n.googCandidatePair=function(e){if("googCandidatePair"===e.type&&(r.connectionType.bitsSentPerSecond=8*(e.bytesSent-(r.connectionType.prevBytesSent||0))/1024/2,r.connectionType.bitsReceivedPerSecond=8*(e.bytesReceived-(r.connectionType.prevBytesReceived||0))/1024/2,r.connectionType.bitsSentPerSecond=r.connectionType.bitsSentPerSecond.toFixed(1),r.connectionType.bitsReceivedPerSecond=r.connectionType.bitsReceivedPerSecond.toFixed(1),r.connectionType.prevBytesSent=e.bytesSent,r.connectionType.prevBytesReceived=e.bytesReceived,"true"===e.googActiveConnection)){r.connectionType.local.ipAddress=e.googLocalAddress,r.connectionType.remote.ipAddress=e.googRemoteAddress,r.connectionType.transport=e.googTransportType;var t=r.internal.candidates[e.localCandidateId];t&&t.ipAddress&&(r.connectionType.systemIpAddress=t.ipAddress);var i=r.internal.candidates[e.remoteCandidateId];i&&i.ipAddress&&(r.connectionType.systemIpAddress=i.ipAddress)}},n.localcandidate=function(e){"localcandidate"===e.type&&(e.candidateType&&o.indexOf(e.candidateType)===-1&&o.push(e.candidateType),e.transport&&a.indexOf(e.transport)===-1&&a.push(e.transport),e.ipAddress&&s.indexOf(e.ipAddress+":"+e.portNumber)===-1&&s.push(e.ipAddress+":"+e.portNumber),e.networkType&&c.indexOf(e.networkType)===-1&&c.push(e.networkType),r.internal.candidates[e.id]={candidateType:o,ipAddress:s,portNumber:e.portNumber,networkType:c,priority:e.priority,transport:a,timestamp:e.timestamp,id:e.id,type:e.type},r.connectionType.local.candidateType=o,r.connectionType.local.ipAddress=s,r.connectionType.local.networkType=c,r.connectionType.local.transport=a)},n.remotecandidate=function(e){"remotecandidate"===e.type&&(e.candidateType&&d.indexOf(e.candidateType)===-1&&d.push(e.candidateType),e.transport&&u.indexOf(e.transport)===-1&&u.push(e.transport),e.ipAddress&&l.indexOf(e.ipAddress+":"+e.portNumber)===-1&&l.push(e.ipAddress+":"+e.portNumber),e.networkType&&p.indexOf(e.networkType)===-1&&p.push(e.networkType),r.internal.candidates[e.id]={candidateType:d,ipAddress:l,portNumber:e.portNumber,networkType:p,priority:e.priority,transport:u,timestamp:e.timestamp,id:e.id,type:e.type},r.connectionType.remote.candidateType=d,r.connectionType.remote.ipAddress=l,r.connectionType.remote.networkType=p,r.connectionType.remote.transport=u)},n.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(r[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(r[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},n.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();i[e.mediaType][t].indexOf(e.ssrc)===-1&&i[e.mediaType][t].push(e.ssrc),r[e.mediaType][t].streams=i[e.mediaType][t].length}}},t.prototype.start=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.interval;
this.statsTimer&&clearInterval(this.statsTimer),this.interval=e,this.statsTimer=setInterval(this.getStats.bind(this),e)},t.prototype.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.reset())},t.prototype.getStats=function(){var e=this.formatResult.bind(this),t=this.peer,i=this.mediaStreamTrack;"undefined"!=typeof window.InstallTrigger?t.getStats(i,function(t){var i=[];t.forEach(function(e){i.push(e)}),e(i)},e):t.getStats(function(t){var i=[];t.result().forEach(function(e){var t={};e.names().forEach(function(i){t[i]=e.stat(i)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(t)}),e(i)})},t.prototype.formatResult=function(e){var t=this.peer,i=(this.mediaStreamTrack,this.statsParser),n=this.statsResult;e.forEach(function(e){Object.keys(i).forEach(function(t){"function"==typeof i[t]&&i[t](e)})});try{t.iceConnectionState.search(/failed/gi)!==-1&&(this.nomore=!0)}catch(e){this.nomore=!0}this.nomore===!0&&(n.datachannel&&(n.datachannel.state="close"),n.ended=!0),n.results=e,this.emit("stats",n)},t}(c["default"]);t["default"]=d,e.exports=t["default"]},215:function(e,t){"use strict";var i,n,r=navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||(navigator.mediaDevices=navigator.mediaDevices||{},navigator.mediaDevices.getUserMedia=function(e){return new Promise(function(t,i){return navigator.getUserMedia?void navigator.getUserMedia(e,function(e){t(e)},function(e){i(e)}):i("当前浏览器还不支持API: getUserMedia")})});var o=window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,a=window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,s=window.RTCDataChannel=window.RTCDataChannel||window.DataChannel,c=window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,d=window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate,u=window.MediaStream=window.MediaStream||window.webkitMediaStream;window.mozRTCPeerConnection||navigator.mozGetUserMedia?(i="moz",n=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)):(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)&&(i="webkit",n=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10));var l="https:"===window.location.protocol&&("webkit"===i&&n>=26||"moz"===i&&n>=33),p=document.createElement("video"),h=p&&p.canPlayType&&"probably"===p.canPlayType('video/webm; codecs="vp8", vorbis');e.exports={prefix:i,browserVersion:n,support:!!r||!!a,RTCPeerConnection:!!a,Vp8:h,GetUserMedia:!!r,DataChannel:!!(a&&s&&a.prototype&&a.prototype.createDataChannel),WebAudio:!(!o||!o.prototype.createMediaStreamSource),MediaStream:!!u,ScreenSharing:!!l,AudioContext:o,RTCSessionDescription:c,RTCIceCandidate:d,getUserMedia:r}},220:function(e,t,i){var n=i(221),r=i(222);t.write=r,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},221:function(e,t,i){var n=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,i,r){if(r&&!i)t[r]=n(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(t[i[o]]=n(e[o+1]))},o=function(e,t,i){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:n?t[e.name]:t;r(i.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},a=i(189),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},i=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),n=i[i.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(r))return o(c,n,r)}}),t.media=i,t};var c=function(e,t){var i=t.split(/=(.+)/,2);return 2===i.length&&(e[i[0]]=n(i[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],i=e.split(" ").map(n),r=0;r<i.length;r+=3)t.push({component:i[r],ip:i[r+1],port:i[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,i=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),i=!0),{scid:t,paused:i}})})}},222:function(e,t,i){var n=i(189),r=/%[sdv%]/g,o=function(e){var t=1,i=arguments,n=i.length;return e.replace(r,function(e){if(t>=n)return e;var r=i[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},a=function(e,t,i){var n=t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format,r=[e+"="+n];if(t.names)for(var a=0;a<t.names.length;a+=1){var s=t.names[a];t.name?r.push(i[t.name][s]):r.push(i[t.names[a]])}else r.push(i[t.name]);return o.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var i=t.outerOrder||s,r=t.innerOrder||c,o=[];return i.forEach(function(t){n[t].forEach(function(i){i.name in e&&null!=e[i.name]?o.push(a(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){o.push(a(t,i,e))})})}),e.media.forEach(function(e){o.push(a("m",n.m[0],e)),r.forEach(function(t){n[t].forEach(function(i){i.name in e&&null!=e[i.name]?o.push(a(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){o.push(a(t,i,e))})})})}),o.join("\r\n")+"\r\n"}},223:function(e,t){"use strict";var i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},i.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},i.matchPrefix=function(e,t){return i.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},i.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var i={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":i.relatedAddress=t[n+1];break;case"rport":i.relatedPort=parseInt(t[n+1],10);break;case"tcptype":i.tcpType=t[n+1]}return i},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.numChannels=3===t.length?parseInt(t[2],10):1,i},i.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,i={},n=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<n.length;r++)t=n[r].trim().split("="),i[t[0].trim()]=t[1];return i},i.writeFmtp=function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substr(t+1,n-t-1),i.value=e.substr(n+1)):i.attribute=e.substr(t+1),i},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.getDtlsParameters=function(e,t){var n=i.splitLines(e);n=n.concat(i.splitLines(t));var r=n.filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14),o={role:"auto",fingerprints:[{algorithm:r.split(" ")[0].toLowerCase(),value:r.split(" ")[1]}]};return o},i.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},i.getIceParameters=function(e,t){var n=i.splitLines(e);n=n.concat(i.splitLines(t));var r={usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return r},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e),r=n[0].split(" "),o=3;o<r.length;o++){var a=r[o],s=i.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=i.parseRtpMap(s),d=i.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=d.length?i.parseFmtp(d[0]):{},c.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(i.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)});var r=0;return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),r>0&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=i.writeExtmap(e)}),n},i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,s=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=i.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(i),o&&(i=JSON.parse(JSON.stringify(i)),i.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(i))}}),0===n.length&&c&&n.push({ssrc:c});var u=i.matchPrefix(e,"b=");return u.length&&(0===u[0].indexOf("b=TIAS:")?u=parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")&&(u=parseInt(u[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=u})),n},i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var o=i.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},i.parseMsid=function(e){var t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var r=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return r.length>0?(t=r[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},i.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,r){var o=i.writeRtpDescription(e.kind,t);if(o+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),o},i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){var t=i.splitLines(e),n=t[0].split(" ");return n[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},e.exports=i},224:function(e,t,i){"use strict";var n=i(34).log,r=i(34).browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(i){var n=new Event("track");n.track=i.track,n.receiver={track:i.track},n.streams=[e.stream],t.dispatchEvent(n)}),e.stream.getTracks().forEach(function(t){var i=new Event("track");i.track=t,i.receiver={track:t},i.streams=[e.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(){if("object"==typeof window&&window.RTCPeerConnection&&!("getSenders"in RTCPeerConnection.prototype)&&"createDTMFSender"in RTCPeerConnection.prototype){RTCPeerConnection.prototype.getSenders=function(){return this._senders};var e=RTCPeerConnection.prototype.addStream,t=RTCPeerConnection.prototype.removeStream;RTCPeerConnection.prototype.addStream=function(t){var i=this;i._senders=i._senders||[],e.apply(i,[t]),t.getTracks().forEach(function(e){i._senders.push({track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=i.createDTMFSender(e):this._dtmf=null),this._dtmf}})})},RTCPeerConnection.prototype.removeStream=function(e){var i=this;i._senders=i._senders||[],t.apply(i,[e]),e.getTracks().forEach(function(e){var t=i._senders.find(function(t){return t.track===e});t&&i._senders.splice(i._senders.indexOf(t),1)})}}},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;return this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),void e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):void(this.src="")}}))},shimPeerConnection:function(){if(window.RTCPeerConnection){var e=RTCPeerConnection;window.RTCPeerConnection=function(t,i){if(t&&t.iceServers){for(var n=[],r=0;r<t.iceServers.length;r++){var o=t.iceServers[r];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(console.warn("RTCIceServer.url is deprecated! Use urls instead."),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,n.push(o)):n.push(t.iceServers[r])}t.iceServers=n}return new e(t,i)},window.RTCPeerConnection.prototype=e.prototype,Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return e.generateCertificate}})}else window.RTCPeerConnection=function(e,t){return n("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new webkitRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}});var t=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,i,n){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var a=function(e){var t={},i=e.result();return i.forEach(function(e){var i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),t[i.id]=i}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return t.apply(this,[c,arguments[0]])}return new Promise(function(e,i){t.apply(r,[function(t){e(s(a(t)))},i])}).then(i,n)},r.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var e=arguments,i=this,n=new Promise(function(n,r){t.apply(i,[e[0],n,r])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),r.version<52&&["createOffer","createAnswer"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var i=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,r){t.apply(e,[n,r,i])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var i=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimGetSendersWithDtmf:o.shimGetSendersWithDtmf,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:i(225)}},225:function(e,t,i){"use strict";var n=i(34).log,r=i(34).browserDetails;e.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[r("min",i)]=n.ideal,t.optional.push(o),o={},o[r("max",i)]=n.ideal,t.optional.push(o)):(o[r("",i)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",i)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,i)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,i){if(t=JSON.parse(JSON.stringify(t)),t&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var o=t.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var a=r.version<61;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||a)){delete t.video.facingMode;var s;if("environment"===o.exact||"environment"===o.ideal?s=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(s=["front"]),s)return navigator.mediaDevices.enumerateDevices().then(function(r){r=r.filter(function(e){return"videoinput"===e.kind});var a=r.find(function(e){return s.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});return!a&&r.length&&s.indexOf("back")!==-1&&(a=r[r.length-1]),a&&(t.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),t.video=e(t.video),n("chrome: "+JSON.stringify(t)),i(t)})}t.video=e(t.video)}return n("chrome: "+JSON.stringify(t)),i(t)},i=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,n,r){t(e,function(e){navigator.webkitGetUserMedia(e,n,function(e){r(i(e))})})};navigator.getUserMedia=o;var a=function(e){return new Promise(function(t,i){navigator.getUserMedia(e,t,i)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(i){e(i.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),navigator.mediaDevices.getUserMedia){var s=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return s(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(i(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return a(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},226:function(e,t,i){"use strict";var n=i(34).browserDetails,r=i(228);e.exports={shimGetUserMedia:i(227),shimPeerConnection:function(){if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),n.version<15025)){var e=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(t){e.set.call(this,t);var i=new Event("enabled");i.enabled=t,this.dispatchEvent(i)}})}window.RTCPeerConnection=r(n.version)},shimReplaceTrack:function(){!window.RTCRtpSender||"replaceTrack"in RTCRtpSender.prototype||(RTCRtpSender.prototype.replaceTrack=RTCRtpSender.prototype.setTrack)}}},227:function(e,t){"use strict";e.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(i){return t(i)["catch"](function(t){return Promise.reject(e(t))})}}},228:function(e,t,i){"use strict";function n(e){var t=e.filter(function(e){return"audio"===e.kind}),i=e.filter(function(e){return"video"===e.kind});for(e=[];t.length||i.length;)t.length&&e.push(t.shift()),i.length&&e.push(i.shift());return e}function r(e,t){var i=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof n;return r&&(n=[n]),n=n.filter(function(e){var n=0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!i;return n?(i=!0,!0):0===e.indexOf("stun:")&&t>=14393}),delete e.url,e.urls=r?n[0]:n,!!n.length}return!1})}var o=i(223);e.exports=function(e){var t=function(t){var i=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return i.localStreams},this.getRemoteStreams=function(){return i.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},t&&t.iceTransportPolicy)switch(t.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=t.iceTransportPolicy}this.usingBundle=t&&"max-bundle"===t.bundlePolicy,t&&t.iceServers&&(this.iceOptions.iceServers=r(t.iceServers,e)),this._config=t||{},this.transceivers=[],this._localIceCandidatesBuffer=[]};return t.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},t.prototype._emitBufferedCandidates=function(){var e=this,t=o.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(i){var n=!i.candidate||0===Object.keys(i.candidate).length;if(n)for(var r=1;r<t.length;r++)t[r].indexOf("\r\na=end-of-candidates\r\n")===-1&&(t[r]+="a=end-of-candidates\r\n");else t[i.candidate.sdpMLineIndex+1]+="a="+i.candidate.candidate+"\r\n";if(e.localDescription.sdp=t.join(""),e.dispatchEvent(i),null!==e.onicecandidate&&e.onicecandidate(i),!i.candidate&&"complete"!==e.iceGatheringState){var o=e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});o&&"complete"!==e.iceGatheringStateChange&&(e.iceGatheringState="complete",e._emitGatheringStateChange())}}),this._localIceCandidatesBuffer=[]},t.prototype.getConfiguration=function(){return this._config},t.prototype.addStream=function(t){if(e>=15025)this.localStreams.push(t);else{var i=t.clone();t.getTracks().forEach(function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),this.localStreams.push(i)}this._maybeFireNegotiationNeeded()},t.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},t.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},t.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},t.prototype._getCommonCapabilities=function(e,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===e||t[i].preferredPayloadType===e)return t[i]},r=function(e,t,i,r){var o=n(e.parameters.apt,i),a=n(t.parameters.apt,r);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!r(n,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(n.numChannels,a.numChannels),i.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var r=t.headerExtensions[n];if(e.uri===r.uri){i.headerExtensions.push(r);break}}}),i},t.prototype._createIceAndDtlsTransports=function(e,t){var i=this,n=new RTCIceGatherer(i.iceOptions),r=new RTCIceTransport(n);n.onlocalcandidate=function(a){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var c=a.candidate,d=!c||0===Object.keys(c).length;d?void 0===n.state&&(n.state="completed"):(c.component="RTCP"===r.component?2:1,s.candidate.candidate=o.writeCandidate(c));var u=o.splitSections(i.localDescription.sdp);d?u[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n":u[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n",i.localDescription.sdp=u.join("");var l=i._pendingOffer?i._pendingOffer:i.transceivers,p=l.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(i.iceGatheringState){case"new":d||i._localIceCandidatesBuffer.push(s),d&&p&&i._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":i._emitBufferedCandidates(),d||(i.dispatchEvent(s),null!==i.onicecandidate&&i.onicecandidate(s)),p&&(i.dispatchEvent(new Event("icecandidate")),null!==i.onicecandidate&&i.onicecandidate(new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange());break;case"complete":}},r.onicestatechange=function(){i._updateConnectionState()};var a=new RTCDtlsTransport(r);return a.ondtlsstatechange=function(){i._updateConnectionState()},a.onerror=function(){a.state="failed",i._updateConnectionState()},{iceGatherer:n,iceTransport:r,dtlsTransport:a}},t.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var i=this.transceivers[e].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlssttatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},t.prototype._transceive=function(t,i,n){var r=this._getCommonCapabilities(t.localCapabilities,t.remoteCapabilities);i&&t.rtpSender&&(r.encodings=t.sendEncodingParameters,r.rtcp={cname:o.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(r.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(r)),n&&t.rtpReceiver&&("video"===t.kind&&t.recvEncodingParameters&&e<15019&&t.recvEncodingParameters.forEach(function(e){delete e.rtx}),r.encodings=t.recvEncodingParameters,r.rtcp={cname:t.rtcpParameters.cname,compound:t.rtcpParameters.compound},t.sendEncodingParameters.length&&(r.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),
t.rtpReceiver.receive(r))},t.prototype.setLocalDescription=function(e){var t,i,n=this;if("offer"===e.type)this._pendingOffer&&(t=o.splitSections(e.sdp),i=t.shift(),t.forEach(function(e,t){var i=o.parseRtpParameters(e);n._pendingOffer[t].localCapabilities=i}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=o.splitSections(n.remoteDescription.sdp),i=t.shift();var r=o.matchPrefix(i,"a=ice-lite").length>0;t.forEach(function(e,t){var a=n.transceivers[t],s=a.iceGatherer,c=a.iceTransport,d=a.dtlsTransport,u=a.localCapabilities,l=a.remoteCapabilities,p=o.isRejected(e);if(!p&&!a.isDatachannel){var h=o.getIceParameters(e,i),f=o.getDtlsParameters(e,i);r&&(f.role="server"),n.usingBundle&&0!==t||(c.start(s,h,r?"controlling":"controlled"),d.start(f));var m=n._getCommonCapabilities(u,l);n._transceive(a,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var s=arguments[1];window.setTimeout(function(){s(),"new"===n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),n._emitBufferedCandidates()},0)}var c=Promise.resolve();return c.then(function(){a||("new"===n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),window.setTimeout(n._emitBufferedCandidates.bind(n),500))}),c},t.prototype.setRemoteDescription=function(t){var i=this,n={},r=[],a=o.splitSections(t.sdp),s=a.shift(),c=o.matchPrefix(s,"a=ice-lite").length>0,d=o.matchPrefix(s,"a=group:BUNDLE ").length>0,u=o.matchPrefix(s,"a=ice-options:")[0];switch(u?this.canTrickleIceCandidates=u.substr(14).split(" ").indexOf("trickle")>=0:this.canTrickleIceCandidates=!1,a.forEach(function(a,u){var l=o.splitLines(a),p=o.getKind(a),h=o.isRejected(a),f=l[0].substr(2).split(" ")[2],m=o.getDirection(a,s),v=o.parseMsid(a),g=o.getMid(a)||o.generateIdentifier();if("application"===p&&"DTLS/SCTP"===f)return void(i.transceivers[u]={mid:g,isDatachannel:!0});var y,S,b,C,w,T,_,R,A,E,k,I,O=o.parseRtpParameters(a);h||(k=o.getIceParameters(a,s),I=o.getDtlsParameters(a,s),I.role="client"),R=o.parseRtpEncodingParameters(a);var P=o.parseRtcpParameters(a),M=o.matchPrefix(a,"a=end-of-candidates",s).length>0,x=o.matchPrefix(a,"a=candidate:").map(function(e){return o.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==t.type||h)"answer"!==t.type||h||(d&&u>0&&(i._disposeIceAndDtlsTransports(u),i.transceivers[u].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[u].iceTransport=i.transceivers[0].iceTransport,i.transceivers[u].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[u].rtpSender&&i.transceivers[u].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[u].rtpReceiver&&i.transceivers[u].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),y=i.transceivers[u],S=y.iceGatherer,b=y.iceTransport,C=y.dtlsTransport,w=y.rtpSender,T=y.rtpReceiver,_=y.sendEncodingParameters,A=y.localCapabilities,i.transceivers[u].recvEncodingParameters=R,i.transceivers[u].remoteCapabilities=O,i.transceivers[u].rtcpParameters=P,(c||M)&&x.length&&b.setRemoteCandidates(x),d&&0!==u||(b.start(S,k,"controlling"),C.start(I)),i._transceive(y,"sendrecv"===m||"recvonly"===m,"sendrecv"===m||"sendonly"===m),!T||"sendrecv"!==m&&"sendonly"!==m?delete y.rtpReceiver:(E=T.track,v?(n[v.stream]||(n[v.stream]=new MediaStream),n[v.stream].addTrack(E),r.push([E,T,n[v.stream]])):(n["default"]||(n["default"]=new MediaStream),n["default"].addTrack(E),r.push([E,T,n["default"]]))));else{var L=d&&u>0?{iceGatherer:i.transceivers[0].iceGatherer,iceTransport:i.transceivers[0].iceTransport,dtlsTransport:i.transceivers[0].dtlsTransport}:i._createIceAndDtlsTransports(g,u);if(!M||d&&0!==u||L.iceTransport.setRemoteCandidates(x),A=RTCRtpReceiver.getCapabilities(p),e<15019&&(A.codecs=A.codecs.filter(function(e){return"rtx"!==e.name})),_=[{ssrc:1001*(2*u+2)}],"sendrecv"!==m&&"sendonly"!==m||(T=new RTCRtpReceiver(L.dtlsTransport,p),E=T.track,v?(n[v.stream]||(n[v.stream]=new MediaStream,Object.defineProperty(n[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(E,"id",{get:function(){return v.track}}),n[v.stream].addTrack(E),r.push([E,T,n[v.stream]])):(n["default"]||(n["default"]=new MediaStream),n["default"].addTrack(E),r.push([E,T,n["default"]]))),i.localStreams.length>0&&i.localStreams[0].getTracks().length>=u){var D;"audio"===p?D=i.localStreams[0].getAudioTracks()[0]:"video"===p&&(D=i.localStreams[0].getVideoTracks()[0]),D&&(e>=15019&&"video"===p&&(_[0].rtx={ssrc:1001*(2*u+2)+1}),w=new RTCRtpSender(D,L.dtlsTransport))}i.transceivers[u]={iceGatherer:L.iceGatherer,iceTransport:L.iceTransport,dtlsTransport:L.dtlsTransport,localCapabilities:A,remoteCapabilities:O,rtpSender:w,rtpReceiver:T,kind:p,mid:g,rtcpParameters:P,sendEncodingParameters:_,recvEncodingParameters:R},i._transceive(i.transceivers[u],!1,"sendrecv"===m||"sendonly"===m)}}),this.usingBundle=d,this.remoteDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}return Object.keys(n).forEach(function(e){var t=n[e];if(t.getTracks().length){i.remoteStreams.push(t);var o=new Event("addstream");o.stream=t,i.dispatchEvent(o),null!==i.onaddstream&&window.setTimeout(function(){i.onaddstream(o)},0),r.forEach(function(e){var n=e[0],r=e[1];if(t.id===e[2].id){var o=new Event("track");o.track=n,o.receiver=r,o.streams=[t],i.dispatchEvent(o),null!==i.ontrack&&window.setTimeout(function(){i.ontrack(o)},0)}})}}),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},t.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},t.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},t.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},t.prototype._updateConnectionState=function(){var e,t=this,i={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){i[e.iceTransport.state]++,i[e.dtlsTransport.state]++}),i.connected+=i.completed,e="new",i.failed>0?e="failed":i.connecting>0||i.checking>0?e="connecting":i.disconnected>0?e="disconnected":i["new"]>0?e="new":(i.connected>0||i.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},t.prototype.createOffer=function(){var t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var i;1===arguments.length&&"function"!=typeof arguments[0]?i=arguments[0]:3===arguments.length&&(i=arguments[2]);var r=[],a=0,s=0;if(this.localStreams.length&&(a=this.localStreams.reduce(function(e,t){return e+t.getAudioTracks().length},0),s=this.localStreams.reduce(function(e,t){return e+t.getVideoTracks().length},0)),i){if(i.mandatory||i.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==i.offerToReceiveAudio&&(a=i.offerToReceiveAudio===!0?1:i.offerToReceiveAudio===!1?0:i.offerToReceiveAudio),void 0!==i.offerToReceiveVideo&&(s=i.offerToReceiveVideo===!0?1:i.offerToReceiveVideo===!1?0:i.offerToReceiveVideo)}for(this.localStreams.forEach(function(e){e.getTracks().forEach(function(t){r.push({kind:t.kind,track:t,stream:e,wantReceive:"audio"===t.kind?a>0:s>0}),"audio"===t.kind?a--:"video"===t.kind&&s--})});a>0||s>0;)a>0&&(r.push({kind:"audio",wantReceive:!0}),a--),s>0&&(r.push({kind:"video",wantReceive:!0}),s--);r=n(r);var c=o.writeSessionBoilerplate(),d=[];r.forEach(function(i,n){var r=i.track,a=i.kind,s=o.generateIdentifier(),c=t.usingBundle&&n>0?{iceGatherer:d[0].iceGatherer,iceTransport:d[0].iceTransport,dtlsTransport:d[0].dtlsTransport}:t._createIceAndDtlsTransports(s,n),u=RTCRtpSender.getCapabilities(a);e<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var l,p,h=[{ssrc:1001*(2*n+1)}];r&&(e>=15019&&"video"===a&&(h[0].rtx={ssrc:1001*(2*n+1)+1}),l=new RTCRtpSender(r,c.dtlsTransport)),i.wantReceive&&(p=new RTCRtpReceiver(c.dtlsTransport,a)),d[n]={iceGatherer:c.iceGatherer,iceTransport:c.iceTransport,dtlsTransport:c.dtlsTransport,localCapabilities:u,remoteCapabilities:null,rtpSender:l,rtpReceiver:p,kind:a,mid:s,sendEncodingParameters:h,recvEncodingParameters:null}}),"max-compat"!==this._config.bundlePolicy&&(c+="a=group:BUNDLE "+d.map(function(e){return e.mid}).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",r.forEach(function(e,t){var i=d[t];c+=o.writeMediaSection(i,i.localCapabilities,"offer",e.stream),c+="a=rtcp-rsize\r\n"}),this._pendingOffer=d;var u=new RTCSessionDescription({type:"offer",sdp:c});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,u),Promise.resolve(u)},t.prototype.createAnswer=function(){var e=this,t=o.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(i){if(i.isDatachannel)return void(t+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+i.mid+"\r\n");var n=e._getCommonCapabilities(i.localCapabilities,i.remoteCapabilities),r=n.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!r&&i.sendEncodingParameters[0].rtx&&delete i.sendEncodingParameters[0].rtx,t+=o.writeMediaSection(i,n,"answer",e.localStreams[0]),i.rtcpParameters&&i.rtcpParameters.reducedSize&&(t+="a=rtcp-rsize\r\n")});var i=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},t.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===e.sdpMid){t=i;break}var n=this.transceivers[t];if(n){var r=Object.keys(e.candidate).length>0?o.parseCandidate(e.candidate):{};if("tcp"===r.protocol&&(0===r.port||9===r.port))return Promise.resolve();if("1"!==r.component)return Promise.resolve();n.iceTransport.addRemoteCandidate(r);var a=o.splitSections(this.remoteDescription.sdp);a[t+1]+=(r.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}else for(var s=0;s<this.transceivers.length;s++)if(this.transceivers[s].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},t.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(i){t[i]&&e.push(t[i].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],i=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(n){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=i(e[t]),r.set(t,e[t])})}),t&&window.setTimeout(t,0,r),n(r)})})},t}},229:function(e,t,i){"use strict";var n=i(34).browserDetails,r={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var i=new Event("track");i.track=t,i.receiver={track:t},i.streams=[e.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(n.version<38&&e&&e.iceServers){for(var i=[],r=0;r<e.iceServers.length;r++){var o=e.iceServers[r];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),i.push(s)}else i.push(e.iceServers[r])}e.iceServers=i}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(i){t.set(i,e[i]),t[i]=e[i]}),t},i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,o,a){return r.apply(this,[e||null]).then(function(e){if(n.version<48&&(e=t(e)),n.version<53&&!o)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(o,a)}}}};e.exports={shimOnTrack:r.shimOnTrack,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:i(230)}},230:function(e,t,i){"use strict";var n=i(34).log,r=i(34).browserDetails;e.exports=function(){var e=function(e){return{name:{NotSupportedError:"TypeError",SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,i,o){var a=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n=e[i]="object"==typeof e[i]?e[i]:{ideal:e[i]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(i),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[i]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var r={};"number"==typeof n.ideal?r[i]={min:n.ideal,max:n.ideal}:r[i]=n.ideal,e.advanced.push(r),delete n.ideal,Object.keys(n).length||delete e[i]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),r.version<38&&(n("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),n("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,i,function(t){o(e(t))})},i=function(e){return new Promise(function(i,n){t(e,i,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},r.version<41){var o=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return o().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(r.version<49){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return a(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,i,n){return r.version<44?t(e,i,n):(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),void navigator.mediaDevices.getUserMedia(e).then(i,n))}}},231:function(e,t){"use strict";var i={shimOnAddStream:function(){"object"!=typeof window||!window.RTCPeerConnection||"onaddstream"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._streams||(this._streams=[]),!(this._streams.indexOf(t)>=0)){this._streams.push(t);var i=new Event("addstream");i.stream=e.streams[0],this.dispatchEvent(i)}}.bind(this))}})},shimGetUserMedia:function(){navigator.getUserMedia||(navigator.webkitGetUserMedia?navigator.getUserMedia=navigator.webkitGetUserMedia.bind(navigator):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(e,t,i){navigator.mediaDevices.getUserMedia(e).then(t,i)}.bind(navigator)))}};e.exports={shimOnAddStream:i.shimOnAddStream,shimGetUserMedia:i.shimGetUserMedia}}})});
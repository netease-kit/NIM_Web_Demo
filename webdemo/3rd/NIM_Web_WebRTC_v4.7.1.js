!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebRTC=t():e.WebRTC=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=n(244),a=i(o),s=n(11);n(58);var c=n(128),d=n(185),u=n(194),l=n(195),p=n(196),f=void 0,h=r({},s.constantRtc,{install:function(e,t){c.install(e,t),d.install(e,t),e.parser.mixin({configMap:u,serializeMap:l,unserializeMap:p})},getInstance:function(e){return f||(f=new a["default"](e)),f},destroy:function(){f&&(f.destroy(),f=null)}});e.exports=h},,function(e,t,n){(function(t,i){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function r(e){return"function"==typeof e}function o(e){Q=e}function a(e){q=e}function s(){return function(){return t.nextTick(p)}}function c(){return"undefined"!=typeof J?function(){J(p)}:l()}function d(){var e=0,t=new Z(p),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function u(){var e=new MessageChannel;return e.port1.onmessage=p,function(){return e.port2.postMessage(0)}}function l(){var e=setTimeout;return function(){return e(p,1)}}function p(){for(var e=0;e<K;e+=2){var t=ne[e],n=ne[e+1];t(n),ne[e]=void 0,ne[e+1]=void 0}K=0}function f(){try{var e=n(27);return J=e.runOnLoop||e.runOnContext,c()}catch(t){return l()}}function h(e,t){var n=arguments,i=this,r=new this.constructor(v);void 0===r[re]&&L(r);var o=i._state;return o?!function(){var e=n[o-1];q(function(){return M(o,r,e,i._result)})}():P(i,r,e,t),r}function m(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(v);return R(n,e),n}function v(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function S(e){try{return e.then}catch(t){return ce.error=t,ce}}function b(e,t,n,i){try{e.call(t,n,i)}catch(r){return r}}function C(e,t,n){q(function(e){var i=!1,r=b(n,t,function(n){i||(i=!0,t!==n?R(e,n):E(e,n))},function(t){i||(i=!0,O(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&r&&(i=!0,O(e,r))},e)}function T(e,t){t._state===ae?E(e,t._result):t._state===se?O(e,t._result):P(t,void 0,function(t){return R(e,t)},function(t){return O(e,t)})}function _(e,t,n){t.constructor===e.constructor&&n===h&&t.constructor.resolve===m?T(e,t):n===ce?O(e,ce.error):void 0===n?E(e,t):r(n)?C(e,t,n):E(e,t)}function R(t,n){t===n?O(t,g()):e(n)?_(t,n,S(n)):E(t,n)}function w(e){e._onerror&&e._onerror(e._result),A(e)}function E(e,t){e._state===oe&&(e._result=t,e._state=ae,0!==e._subscribers.length&&q(A,e))}function O(e,t){e._state===oe&&(e._state=se,e._result=t,q(w,e))}function P(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+ae]=n,r[o+se]=i,0===o&&e._state&&q(A,e)}function A(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,a=0;a<t.length;a+=3)i=t[a],r=t[a+n],i?M(n,i,r,o):r(o);e._subscribers.length=0}}function I(){this.error=null}function k(e,t){try{return e(t)}catch(n){return de.error=n,de}}function M(e,t,n,i){var o=r(n),a=void 0,s=void 0,c=void 0,d=void 0;if(o){if(a=k(n,i),a===de?(d=!0,s=a.error,a=null):c=!0,t===a)return void O(t,y())}else a=i,c=!0;t._state!==oe||(o&&c?R(t,a):d?O(t,s):e===ae?E(t,a):e===se&&O(t,a))}function D(e,t){try{t(function(t){R(e,t)},function(t){O(e,t)})}catch(n){O(e,n)}}function x(){return ue++}function L(e){e[re]=ue++,e._state=void 0,e._result=void 0,e._subscribers=[]}function j(e,t){this._instanceConstructor=e,this.promise=new e(v),this.promise[re]||L(this.promise),z(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&E(this.promise,this._result))):O(this.promise,N())}function N(){return new Error("Array Methods must be provided an Array")}function U(e){return new j(this,e).promise}function V(e){var t=this;return new t(z(e)?function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,n=new t(v);return O(n,e),n}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function H(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function G(e){this[re]=x(),this._result=this._state=void 0,this._subscribers=[],v!==e&&("function"!=typeof e&&F(),this instanceof G?D(this,e):H())}function W(){var e=void 0;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===r&&!n.cast)return}e.Promise=G}var Y=void 0;Y=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var z=Y,K=0,J=void 0,Q=void 0,q=function(e,t){ne[K]=e,ne[K+1]=t,K+=2,2===K&&(Q?Q(p):ie())},$="undefined"!=typeof window?window:void 0,X=$||{},Z=X.MutationObserver||X.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),ie=void 0;ie=ee?s():Z?d():te?u():void 0===$?f():l();var re=Math.random().toString(36).substring(16),oe=void 0,ae=1,se=2,ce=new I,de=new I,ue=0;return j.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===oe&&n<e;n++)this._eachEntry(t[n],n)},j.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===m){var r=S(e);if(r===h&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===G){var o=new n(v);_(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},j.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===oe&&(this._remaining--,e===se?O(i,n):this._result[t]=n),0===this._remaining&&E(i,this._result)},j.prototype._willSettleAt=function(e,t){var n=this;P(e,void 0,function(e){return n._settledAt(ae,t,e)},function(e){return n._settledAt(se,t,e)})},G.all=U,G.race=V,G.resolve=m,G.reject=B,G._setScheduler=o,G._setAsap=a,G._asap=q,G.prototype={constructor:G,then:h,"catch":function(e){return this.then(null,e)}},G.polyfill=W,G.Promise=G,G})}).call(t,n(9),function(){return this}())},function(e,t,n){(function(t){"use strict";var n="'4db505f2e1cdc97d7458d785af6ed6d86bf9c3e3",i="4db505f2'",r="4.7.1",o="2.3.1.0118",a="3.6.1",s="41",c=1,d="https://lbs.netease.im/lbs/webconf.jsp",u="development"===t.env.NODE_ENV?6e3:42e3,l={info:{hash:n,shortHash:i,version:r,sdkVersion:s,nrtcVersion:a,protocolVersion:c},agentVersion:o,lbsUrl:d,connectTimeout:u,xhrTimeout:u,socketTimeout:u,reconnectionDelay:656.25,reconnectionDelayMax:u,reconnectionJitter:.1,heartbeatInterval:18e4,cmdTimeout:u};l.formatSocketUrl=function(e){var t=e.url,n=e.secure,i=n?"https":"http";return t.indexOf("http")===-1?i+"://"+t:t},l.fileServerUrl="https://nos.netease.com",l.replaceUrl="http://nos.netease.im",l.genUploadUrl=function(e){return l.uploadUrl?l.uploadUrl+"/"+e:l.fileServerUrl+"/"+e},l.genDownloadUrl=function(e,t){return l.downloadUrl?l.replaceUrl+"/"+e+"/"+t:"https://"+e+".nosdn.127.net/"+t},e.exports=l}).call(t,n(9))},function(e,t,n){"use strict";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(){this._events=new i,this._eventsCount=0}var a=Object.prototype.hasOwnProperty,s="~";Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)a.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e,t){var n=s?s+e:e,i=this._events[n];if(t)return!!i;if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},o.prototype.emit=function(e,t,n,i,r,o){var a=s?s+e:e;if(!this._events[a])return!1;var c,d,u=this._events[a],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,r),!0;case 6:return u.fn.call(u.context,t,n,i,r,o),!0}for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u.fn.apply(u.context,c)}else{var p,f=u.length;for(d=0;d<f;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),l){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,n);break;case 4:u[d].fn.call(u[d].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];u[d].fn.apply(u[d].context,c)}}return!0},o.prototype.on=function(e,t,n){var i=new r(t,n||this),o=s?s+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],i]:this._events[o].push(i):(this._events[o]=i,this._eventsCount++),this},o.prototype.once=function(e,t,n){var i=new r(t,n||this,!0),o=s?s+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],i]:this._events[o].push(i):(this._events[o]=i,this._eventsCount++),this},o.prototype.removeListener=function(e,t,n,r){var o=s?s+e:e;if(!this._events[o])return this;if(!t)return 0===--this._eventsCount?this._events=new i:delete this._events[o],this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||(0===--this._eventsCount?this._events=new i:delete this._events[o]);else{for(var c=0,d=[],u=a.length;c<u;c++)(a[c].fn!==t||r&&!a[c].once||n&&a[c].context!==n)&&d.push(a[c]);d.length?this._events[o]=1===d.length?d[0]:d:0===--this._eventsCount?this._events=new i:delete this._events[o]}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new i:delete this._events[t])):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=s,o.EventEmitter=o,e.exports=o},,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(46);Object.defineProperty(t,"ajax",{enumerable:!0,get:function(){return i(r)["default"]}});var o=n(47);Object.defineProperty(t,"element",{enumerable:!0,get:function(){return i(o)["default"]}});var a=n(48);Object.defineProperty(t,"tool",{enumerable:!0,get:function(){return i(a)["default"]}})},,function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(e){if(l===clearTimeout)return clearTimeout(e);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function a(){m&&f&&(m=!1,f.length?h=f.concat(h):v=-1,h.length&&s())}function s(){if(!m){var e=r(a);m=!0;for(var t=h.length;t;){for(f=h,h=[];++v<t;)f&&f[v].run();v=-1,t=h.length}f=null,m=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function d(){}var u,l,p=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(e){l=i}}();var f,h=[],m=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new c(e,t)),1!==h.length||m||r(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=d,p.addListener=d,p.once=d,p.off=d,p.removeListener=d,p.removeAllListeners=d,p.emit=d,p.prependListener=d,p.prependOnceListener=d,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},,function(e,t){"use strict";t.__esModule=!0;var n,i,r,o,a={CONTROL_COMMAND_BUSY:9,CONTROL_COMMAND_SELF_ON_BACKGROUND:12,CONTROL_COMMAND_START_NOTIFY_RECEIVED:13},s={NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_ON:1,NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_OFF:2,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_ON:3,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_OFF:4,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO:5,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_AGREE:6,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_REJECT:7,NETCALL_CONTROL_COMMAND_SWITCH_VIDEO_TO_AUDIO:8,NETCALL_CONTROL_COMMAND_BUSY:9,NETCALL_CONTROL_COMMAND_SELF_CAMERA_INVALID:10,NETCALL_CONTROL_COMMAND_SELF_AUDIO_INVALID:11,NETCALL_CONTROL_COMMAND_SELF_ON_BACKGROUND:12,NETCALL_CONTROL_COMMAND_START_NOTIFY_RECEIVED:13,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_START:14,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_STOP:15},c={HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1},d={NETCALL_TYPE_AUDIO:1,NETCALL_TYPE_VIDEO:2,DEVICE_TYPE_AUDIO_IN:0,DEVICE_TYPE_AUDIO_OUT_LOCAL:1,DEVICE_TYPE_AUDIO_OUT_CHAT:2,DEVICE_TYPE_VIDEO:3,DEVICE_TYPE_DESKTOP_SCREEN:4,DEVICE_TYPE_DESKTOP_WINDOW:5,CHAT_VIDEO_QUALITY_NORMAL:0,CHAT_VIDEO_QUALITY_LOW:1,CHAT_VIDEO_QUALITY_MEDIUM:2,CHAT_VIDEO_QUALITY_HIGH:3,CHAT_VIDEO_QUALITY_480P:4,CHAT_VIDEO_QUALITY_540P:5,CHAT_VIDEO_QUALITY_720P:6,CHAT_VIDEO_FRAME_RATE_NORMAL:0,CHAT_VIDEO_FRAME_RATE_5:1,CHAT_VIDEO_FRAME_RATE_10:2,CHAT_VIDEO_FRAME_RATE_15:3,CHAT_VIDEO_FRAME_RATE_20:4,CHAT_VIDEO_FRAME_RATE_25:5,LAYOUT_SPLITBOTTOMHORFLOATING:0,LAYOUT_SPLITTOPHORFLOATING:1,LAYOUT_SPLITLATTICETILE:2,LAYOUT_SPLITLATTICECUTTINGTILE:3,LAYOUT_SPLITCUSTOM:4,ROLE_PLAYER:0,ROLE_AUDIENCE:1},u={WB_TYPE_TCP:2,WB_TYPE_UDP:3,CALL_TYPE_NONE:0,CALL_TYPE_AUDIO:1,HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1};d.deviceTypeMap=(n={},n[d.DEVICE_TYPE_AUDIO_IN]="audioIn",n[d.DEVICE_TYPE_AUDIO_OUT_CHAT]="audioOut",n[d.DEVICE_TYPE_VIDEO]="video",n),d.deviceTypeMap=(i={},i[d.DEVICE_TYPE_AUDIO_IN]="audioIn",i[d.DEVICE_TYPE_AUDIO_OUT_LOCAL]="audioOut",i[d.DEVICE_TYPE_AUDIO_OUT_CHAT]="audioOut",i[d.DEVICE_TYPE_VIDEO]="video",i),d.videoMap={frame:(r={},r[d.CHAT_VIDEO_QUALITY_NORMAL]="480x320",r[d.CHAT_VIDEO_QUALITY_LOW]="176x144",r[d.CHAT_VIDEO_QUALITY_MEDIUM]="352x288",r[d.CHAT_VIDEO_QUALITY_HIGH]="480x320",r[d.CHAT_VIDEO_QUALITY_480P]="640x480",r[d.CHAT_VIDEO_QUALITY_540P]="960x540",r[d.CHAT_VIDEO_QUALITY_720P]="1280x720",r),frameRate:(o={},o[d.CHAT_VIDEO_FRAME_RATE_NORMAL]=15,o[d.CHAT_VIDEO_FRAME_RATE_5]=5,o[d.CHAT_VIDEO_FRAME_RATE_10]=10,o[d.CHAT_VIDEO_FRAME_RATE_15]=15,o[d.CHAT_VIDEO_FRAME_RATE_20]=20,o[d.CHAT_VIDEO_FRAME_RATE_25]=25,o)};var l={getVideoSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.quality,n=void 0===t?d.CHAT_VIDEO_QUALITY_NORMAL:t,i=e.frameRate,r=void 0===i?d.CHAT_VIDEO_FRAME_RATE_NORMAL:i,o={},a=d.videoMap.frame[n];return o.frameRate=d.videoMap.frameRate[r],o.width=+a.split("x")[0],o.height=+a.split("x")[1],o},getDeviceTypeStr:function(e){return d.deviceTypeMap[e]},getDeviceTypeMap:function(e){return d.deviceTypeMap[e]}},p=Object.assign(d,s,c),f=Object.assign(u,a,c);t.constantTool=l,t.constantRtc=p,t.constantBB=f},function(e,t,n){var i;(function(e,r){(function(){"use strict";function o(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function a(e,t,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=c(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function s(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=T)for(;++n<i;)t(e[n],n,e);else d(e,t)}function c(e){return e=h(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:o(e)}function d(e,t){for(var n in e)E.call(e,n)&&t(e[n],n,e)}function u(e){return null==e?o(e):O.call(e).slice(8,-1)}function l(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}function p(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function f(e,t){var n=null;return s(e,function(i,r){n=t(n,i,r,e)}),n}function h(e){return String(e).replace(/^ +| +$/g,"")}function m(e){function t(t){return f(t,function(t,n){return t||RegExp("\\b"+(n.pattern||p(n))+"\\b","i").exec(e)&&(n.label||n)})}function n(t){return f(t,function(t,n,i){return t||(n[Q]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Q)]||RegExp("\\b"+p(i)+"(?:\\b|\\w*\\d)","i").exec(e))&&i})}function i(t){return f(t,function(t,n){return t||RegExp("\\b"+(n.pattern||p(n))+"\\b","i").exec(e)&&(n.label||n)})}function r(t){return f(t,function(t,n){var i=n.pattern||p(n);return!t&&(t=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=a(t,i,n.label||n)),t})}function o(t){return f(t,function(t,n){var i=n.pattern||p(n);return!t&&(t=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=c(t[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function s(t){return f(t,function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}function v(){return this.description||""}var S=g,b=e&&"object"==typeof e&&"String"!=u(e);b&&(S=e,e=null);var C=S.navigator||{},T=C.userAgent||"";e||(e=T);var w,E,P=b||R==y,A=b?!!C.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(O.toString()),I="Object",k=b?I:"ScriptBridgingProxyObject",M=b?I:"Environment",D=b&&S.java?"JavaPackage":u(S.java),x=b?I:"RuntimeObject",L=/\bJava/.test(D)&&S.java,j=L&&u(S.environment)==M,N=L?"a":"α",U=L?"b":"β",V=S.document||{},B=S.operamini||S.opera,F=_.test(F=b&&B?B["[[Class]]"]:u(B))?F:B=null,H=e,G=[],W=null,Y=e==T,z=Y&&B&&"function"==typeof B.version&&B.version(),K=t([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),J=i(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Q=o([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),q=n({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),$=r(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(K&&(K=[K]),q&&!Q&&(Q=o([q])),(w=/\bGoogle TV\b/.exec(Q))&&(Q=w[0]),/\bSimulator\b/i.test(e)&&(Q=(Q?Q+" ":"")+"Simulator"),"Opera Mini"==J&&/\bOPiOS\b/.test(e)&&G.push("running in Turbo/Uncompressed mode"),"IE"==J&&/\blike iPhone OS\b/.test(e)?(w=m(e.replace(/like iPhone OS/,"")),q=w.manufacturer,Q=w.product):/^iP/.test(Q)?(J||(J="Safari"),$="iOS"+((w=/ OS ([\d_]+)/i.exec(e))?" "+w[1].replace(/_/g,"."):"")):"Konqueror"!=J||/buntu/i.test($)?q&&"Google"!=q&&(/Chrome/.test(J)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(Q))||/\bAndroid\b/.test($)&&/^Chrome/.test(J)&&/\bVersion\//i.test(e)?(J="Android Browser",$=/\bAndroid\b/.test($)?$:"Android"):"Silk"==J?(/\bMobi/i.test(e)||($="Android",G.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&G.unshift("accelerated")):"PaleMoon"==J&&(w=/\bFirefox\/([\d.]+)\b/.exec(e))?G.push("identifying as Firefox "+w[1]):"Firefox"==J&&(w=/\b(Mobile|Tablet|TV)\b/i.exec(e))?($||($="Firefox OS"),Q||(Q=w[1])):!J||(w=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(J))?(J&&!Q&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(w+"/")+8))&&(J=null),(w=Q||q||$)&&(Q||q||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test($))&&(J=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test($)?$:w)+" Browser")):"Electron"==J&&(w=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&G.push("Chromium "+w):$="Kubuntu",z||(z=s(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",p(J),"(?:Firefox|Minefield|NetFront)"])),(w="iCab"==K&&parseFloat(z)>3&&"WebKit"||/\bOpera\b/.test(J)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(K)&&"WebKit"||!K&&/\bMSIE\b/i.test(e)&&("Mac OS"==$?"Tasman":"Trident")||"WebKit"==K&&/\bPlayStation\b(?! Vita\b)/i.test(J)&&"NetFront")&&(K=[w]),"IE"==J&&(w=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(J+=" Mobile",$="Windows Phone "+(/\+$/.test(w)?w:w+".x"),G.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(J="IE Mobile",$="Windows Phone 8.x",G.unshift("desktop mode"),z||(z=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=J&&"Trident"==K&&(w=/\brv:([\d.]+)/.exec(e))&&(J&&G.push("identifying as "+J+(z?" "+z:"")),J="IE",z=w[1]),Y){if(l(S,"global"))if(L&&(w=L.lang.System,H=w.getProperty("os.arch"),$=$||w.getProperty("os.name")+" "+w.getProperty("os.version")),P&&l(S,"system")&&(w=[S.system])[0]){$||($=w[0].os||null);try{w[1]=S.require("ringo/engine").version,z=w[1].join("."),J="RingoJS"}catch(X){w[0].global.system==S.system&&(J="Narwhal")}}else"object"==typeof S.process&&!S.process.browser&&(w=S.process)?"object"==typeof w.versions?"string"==typeof w.versions.electron?(G.push("Node "+w.versions.node),J="Electron",z=w.versions.electron):"string"==typeof w.versions.nw&&(G.push("Chromium "+z,"Node "+w.versions.node),J="NW.js",z=w.versions.nw):(J="Node.js",H=w.arch,$=w.platform,z=/[\d.]+/.exec(w.version),z=z?z[0]:"unknown"):j&&(J="Rhino");else u(w=S.runtime)==k?(J="Adobe AIR",$=w.flash.system.Capabilities.os):u(w=S.phantom)==x?(J="PhantomJS",z=(w=w.version||null)&&w.major+"."+w.minor+"."+w.patch):"number"==typeof V.documentMode&&(w=/\bTrident\/(\d+)/i.exec(e))?(z=[z,V.documentMode],(w=+w[1]+4)!=z[1]&&(G.push("IE "+z[1]+" mode"),K&&(K[1]=""),z[1]=w),z="IE"==J?String(z[1].toFixed(1)):z[0]):"number"==typeof V.documentMode&&/^(?:Chrome|Firefox)\b/.test(J)&&(G.push("masking as "+J+" "+z),J="IE",z="11.0",K=["Trident"],$="Windows");$=$&&c($)}if(z&&(w=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(z)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(Y&&C.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(W=/b/i.test(w)?"beta":"alpha",z=z.replace(RegExp(w+"\\+?$"),"")+("beta"==W?U:N)+(/\d+\+?/.exec(w)||"")),"Fennec"==J||"Firefox"==J&&/\b(?:Android|Firefox OS)\b/.test($))J="Firefox Mobile";else if("Maxthon"==J&&z)z=z.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Q))"Xbox 360"==Q&&($=null),"Xbox 360"==Q&&/\bIEMobile\b/.test(e)&&G.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(J)&&(!J||Q||/Browser|Mobi/.test(J))||"Windows CE"!=$&&!/Mobi/i.test(e))if("IE"==J&&Y)try{null===S.external&&G.unshift("platform preview")}catch(X){G.unshift("embedded")}else(/\bBlackBerry\b/.test(Q)||/\bBB10\b/.test(e))&&(w=(RegExp(Q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||z)?(w=[w,/BB10/.test(e)],$=(w[1]?(Q=null,q="BlackBerry"):"Device Software")+" "+w[0],z=null):this!=d&&"Wii"!=Q&&(Y&&B||/Opera/.test(J)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==J&&/\bOS X (?:\d+\.){2,}/.test($)||"IE"==J&&($&&!/^Win/.test($)&&z>5.5||/\bWindows XP\b/.test($)&&z>8||8==z&&!/\bTrident\b/.test(e)))&&!_.test(w=m.call(d,e.replace(_,"")+";"))&&w.name&&(w="ing as "+w.name+((w=w.version)?" "+w:""),_.test(J)?(/\bIE\b/.test(w)&&"Mac OS"==$&&($=null),w="identify"+w):(w="mask"+w,J=F?c(F.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(w)&&($=null),Y||(z=null)),K=["Presto"],G.push(w));else J+=" Mobile";(w=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(w=[parseFloat(w.replace(/\.(\d)$/,".0$1")),w],"Safari"==J&&"+"==w[1].slice(-1)?(J="WebKit Nightly",W="alpha",z=w[1].slice(0,-1)):z!=w[1]&&z!=(w[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(z=null),w[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==w[0]&&537.36==w[2]&&parseFloat(w[1])>=28&&"WebKit"==K&&(K=["Blink"]),Y&&(A||w[1])?(K&&(K[1]="like Chrome"),w=w[1]||(w=w[0],w<530?1:w<532?2:w<532.05?3:w<533?4:w<534.03?5:w<534.07?6:w<534.1?7:w<534.13?8:w<534.16?9:w<534.24?10:w<534.3?11:w<535.01?12:w<535.02?"13+":w<535.07?15:w<535.11?16:w<535.19?17:w<536.05?18:w<536.1?19:w<537.01?20:w<537.11?"21+":w<537.13?23:w<537.18?24:w<537.24?25:w<537.36?26:"Blink"!=K?"27":"28")):(K&&(K[1]="like Safari"),w=w[0],w=w<400?1:w<500?2:w<526?3:w<533?4:w<534?"4+":w<535?5:w<537?6:w<538?7:w<601?8:"8"),K&&(K[1]+=" "+(w+="number"==typeof w?".x":/[.+]/.test(w)?"":"+")),"Safari"==J&&(!z||parseInt(z)>45)&&(z=w)),"Opera"==J&&(w=/\bzbov|zvav$/.exec($))?(J+=" ",G.unshift("desktop mode"),"zvav"==w?(J+="Mini",z=null):J+="Mobile",$=$.replace(RegExp(" *"+w+"$"),"")):"Safari"==J&&/\bChrome\b/.exec(K&&K[1])&&(G.unshift("desktop mode"),J="Chrome Mobile",z=null,/\bOS X\b/.test($)?(q="Apple",$="iOS 4.3+"):$=null),z&&0==z.indexOf(w=/[\d.]+$/.exec($))&&e.indexOf("/"+w+"-")>-1&&($=h($.replace(w,""))),K&&!/\b(?:Avant|Nook)\b/.test(J)&&(/Browser|Lunascape|Maxthon/.test(J)||"Safari"!=J&&/^iOS/.test($)&&/\bSafari\b/.test(K[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(J)&&K[1])&&(w=K[K.length-1])&&G.push(w),G.length&&(G=["("+G.join("; ")+")"]),q&&Q&&Q.indexOf(q)<0&&G.push("on "+q),Q&&G.push((/^on /.test(G[G.length-1])?"":"on ")+Q),$&&(w=/ ([\d.+]+)$/.exec($),E=w&&"/"==$.charAt($.length-w[0].length-1),$={architecture:32,family:w&&!E?$.replace(w[0],""):$,version:w?w[1]:null,toString:function(){var e=this.version;return this.family+(e&&!E?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(w=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(H))&&!/\bi686\b/i.test(H)?($&&($.architecture=64,$.family=$.family.replace(RegExp(" *"+w),"")),J&&(/\bWOW64\b/i.test(e)||Y&&/\w(?:86|32)$/.test(C.cpuClass||C.platform)&&!/\bWin64; x64\b/i.test(e))&&G.unshift("32-bit")):$&&/^OS X/.test($.family)&&"Chrome"==J&&parseFloat(z)>=39&&($.architecture=64),e||(e=null);var Z={};return Z.description=e,Z.layout=K&&K[0],Z.manufacturer=q,Z.name=J,Z.prerelease=W,Z.product=Q,Z.ua=e,Z.version=J&&z,Z.os=$||{architecture:null,family:null,version:null,toString:function(){return"null"}},Z.parse=m,Z.toString=v,Z.version&&G.unshift(z),Z.name&&G.unshift(J),$&&J&&($!=String($).split(" ")[0]||$!=J.split(" ")[0]&&!Q)&&G.push(Q?"("+$+")":"on "+$),G.length&&(Z.description=G.join(" ")),Z}var v={"function":!0,object:!0},g=v[typeof window]&&window||this,y=g,S=v[typeof t]&&t,b=v[typeof e]&&e&&!e.nodeType&&e,C=S&&b&&"object"==typeof r&&r;!C||C.global!==C&&C.window!==C&&C.self!==C||(g=C);var T=Math.pow(2,53)-1,_=/\bOpera/,R=this,w=Object.prototype,E=w.hasOwnProperty,O=w.toString,P=m();g.platform=P,i=function(){return P}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))}).call(this)}).call(t,n(16)(e),function(){return this}())},,,,function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},,,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(24);Object.defineProperty(t,"monitor",{enumerable:!0,get:function(){return i(r)["default"]}});var o=n(34);Object.defineProperty(t,"signal",{enumerable:!0,get:function(){return i(o)["default"]}});var a=n(64);Object.defineProperty(t,"configMap",{enumerable:!0,get:function(){return i(a)["default"]}});var s=n(7);Object.defineProperty(t,"utils",{enumerable:!0,get:function(){return i(s)["default"]}})},function(e,t){"use strict";function n(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}var i=!0,r=!0;e.exports={extractVersion:n,disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){r&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,i={};if(i.browser=null,i.version=null,"undefined"==typeof e||!e.navigator)return i.browser="Not a browser.",i;if(t.mozGetUserMedia)i.browser="firefox",i.version=n(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)i.browser="chrome",i.version=n(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return i.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",i;i.browser="safari",i.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=n(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return i}}},,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(43),o=i(r),a=n(44),s=i(a),c=n(45),d=i(c);t["default"]={DataApi:function(e){return new o["default"](e)},DataRtc:function(e){return new s["default"](e)},DataStats:function(e){return new d["default"](e)}},e.exports=t["default"]},,function(e,t,n){var i,r;!function(o,a){"use strict";i=a,r="function"==typeof i?i.call(t,n,t,e):i,!(void 0!==r&&(e.exports=r))}(this,function(){var e,t,n,i,r=Function.call,o=Object.prototype,a=r.bind(o.hasOwnProperty),s=r.bind(o.propertyIsEnumerable),c=r.bind(o.toString),d=a(o,"__defineGetter__");d&&(e=r.bind(o.__defineGetter__),
t=r.bind(o.__defineSetter__),n=r.bind(o.__lookupGetter__),i=r.bind(o.__lookupSetter__));var u=function(e){return null==e||"object"!=typeof e&&"function"!=typeof e};Object.getPrototypeOf||(Object.getPrototypeOf=function(e){var t=e.__proto__;return t||null===t?t:"[object Function]"===c(e.constructor)?e.constructor.prototype:e instanceof Object?o:null});var l=function(e){try{return e.sentinel=0,0===Object.getOwnPropertyDescriptor(e,"sentinel").value}catch(t){return!1}};if(Object.defineProperty){var p=l({}),f="undefined"==typeof document||l(document.createElement("div"));if(!f||!p)var h=Object.getOwnPropertyDescriptor}if(!Object.getOwnPropertyDescriptor||h){var m="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(e,t){if(u(e))throw new TypeError(m+e);if(h)try{return h.call(Object,e,t)}catch(r){}var c;if(!a(e,t))return c;if(c={enumerable:s(e,t),configurable:!0},d){var l=e.__proto__,p=e!==o;p&&(e.__proto__=o);var f=n(e,t),v=i(e,t);if(p&&(e.__proto__=l),f||v)return f&&(c.get=f),v&&(c.set=v),c}return c.value=e[t],c.writable=!0,c}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){return Object.keys(e)}),!Object.create){var v,g=!({__proto__:null}instanceof Object),y=function(){if(!document.domain)return!1;try{return!!new ActiveXObject("htmlfile")}catch(e){return!1}},S=function(){var e,t;t=new ActiveXObject("htmlfile");var n="script";return t.write("<"+n+"></"+n+">"),t.close(),e=t.parentWindow.Object.prototype,t=null,e},b=function(){var e,t=document.createElement("iframe"),n=document.body||document.documentElement;return t.style.display="none",n.appendChild(t),t.src="javascript:",e=t.contentWindow.Object.prototype,n.removeChild(t),t=null,e};v=g||"undefined"==typeof document?function(){return{__proto__:null}}:function(){var e=y()?S():b();delete e.constructor,delete e.hasOwnProperty,delete e.propertyIsEnumerable,delete e.isPrototypeOf,delete e.toLocaleString,delete e.toString,delete e.valueOf;var t=function(){};return t.prototype=e,v=function(){return new t},new t},Object.create=function(e,t){var n,i=function(){};if(null===e)n=v();else{if(null!==e&&u(e))throw new TypeError("Object prototype may only be an Object or null");i.prototype=e,n=new i,n.__proto__=e}return void 0!==t&&Object.defineProperties(n,t),n}}var C=function(e){try{return Object.defineProperty(e,"sentinel",{}),"sentinel"in e}catch(t){return!1}};if(Object.defineProperty){var T=C({}),_="undefined"==typeof document||C(document.createElement("div"));if(!T||!_)var R=Object.defineProperty,w=Object.defineProperties}if(!Object.defineProperty||R){var E="Property description must be an object: ",O="Object.defineProperty called on non-object: ",P="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(r,a,s){if(u(r))throw new TypeError(O+r);if(u(s))throw new TypeError(E+s);if(R)try{return R.call(Object,r,a,s)}catch(c){}if("value"in s)if(d&&(n(r,a)||i(r,a))){var l=r.__proto__;r.__proto__=o,delete r[a],r[a]=s.value,r.__proto__=l}else r[a]=s.value;else{var p="get"in s,f="set"in s;if(!d&&(p||f))throw new TypeError(P);p&&e(r,a,s.get),f&&t(r,a,s.set)}return r}}Object.defineProperties&&!w||(Object.defineProperties=function(e,t){if(w)try{return w.call(Object,e,t)}catch(n){}return Object.keys(t).forEach(function(n){"__proto__"!==n&&Object.defineProperty(e,n,t[n])}),e}),Object.seal||(Object.seal=function(e){if(Object(e)!==e)throw new TypeError("Object.seal can only be called on Objects.");return e}),Object.freeze||(Object.freeze=function(e){if(Object(e)!==e)throw new TypeError("Object.freeze can only be called on Objects.");return e});try{Object.freeze(function(){})}catch(A){Object.freeze=function(e){return function(t){return"function"==typeof t?t:e(t)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(e){if(Object(e)!==e)throw new TypeError("Object.preventExtensions can only be called on Objects.");return e}),Object.isSealed||(Object.isSealed=function(e){if(Object(e)!==e)throw new TypeError("Object.isSealed can only be called on Objects.");return!1}),Object.isFrozen||(Object.isFrozen=function(e){if(Object(e)!==e)throw new TypeError("Object.isFrozen can only be called on Objects.");return!1}),Object.isExtensible||(Object.isExtensible=function(e){if(Object(e)!==e)throw new TypeError("Object.isExtensible can only be called on Objects.");for(var t="";a(e,t);)t+="?";e[t]=!0;var n=a(e,t);return delete e[t],n})})},function(e,t){},,,,,,,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(20),s=n(49),c=n(4),d=function(e){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var o=r(this,e.call(this));return o.info=Object.assign({},n),o.init(),o.logger=n.logger||window.console,o.autoReconnect=n.autoReconnect||!0,o.isDestroy=!1,o.reConnectCount=0,o.wssUrl=null,o}return o(t,e),t}(c),u=d.prototype;u.init=function(){this.reset()},u.reset=function(){this.imInfo={}},u.connect=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.url,i=void 0===n?this.wssUrl:n,r=t.imInfo;return this.imInfo=r||this.imInfo,i?new Promise(function(t,n){e.url=i;var r=void 0;try{r=e.ws=new WebSocket("wss://"+i);var o=e;r.onopen=function(n){e.wssUrl=i,o.initSignal(),o.signalConnected=!0,o.emit("signalConnected"),t(o),e.heartbeat()},r.onclose=r.onerror=function(e){o.signalConnected=!1,n(e)}}catch(a){e.logger.error("信令连接建立失败",a),n(a)}}):Promise.reject("信令地址缺失")},u.initSignal=function(){var e=this,t=this.ws,n=t.send;t.send=function(e){n.call(this,JSON.stringify(e))},t.onmessage=function(t){var n=JSON.parse(t.data||null);if(n)return!e.isHeartBeating||"keep_alive_ack"!==n.type&&n.type!==s.serializeWb.gateWay.keep_alive_ack?void e.emit("message",n):void e.onHeartBeat(n)},t.onclose=function(t){e.signalConnected=!1,e.emit("signalTimeout",t)},t.onerror=function(t){e.signalConnected=!1,e.emit("signalError",t)}},u.send=function(e){var t=this;"keep_alive"!==e.type,this.ws&&this.signalConnected&&this.ws.readyState===this.ws.OPEN?(e.browser={},e.browser.name=window.platform.name,e.browser.version=window.platform.version,this.ws.send(e)):this.once("signalConnected",function(){t.send(e)})},u.heartbeat=function(){this.socketData=this.socketData||{uid:this.imInfo.uid,cid:this.imInfo.cid},this.heartBeatList=[],this.bindHearBeat(5)},u.onHeartBeat=function(e){this.heartBeatList.shift(),this.bindHearBeat(5)},u.heartBeatHandler=function(){var e=this.socketData,t=this.heartBeatList;if(t){var n=Date.now(),i=n;if(a.configMap.CURRENT.SDK_TYPE===a.configMap.SDK_TYPE.WHITEBOARD&&(i=+n.toString().slice(0,-3)),t.constructor===Array&&0===t.length){t.push(n);var r=this.getContentData({type:"keep_alive",uid:a.configMap.CURRENT.SDK_TYPE===a.configMap.SDK_TYPE.WHITEBOARD?+e.uid:e.uid+"",cid:a.configMap.CURRENT.SDK_TYPE===a.configMap.SDK_TYPE.WHITEBOARD?+e.cid:e.cid+""},i);return this.send(r),void this.bindHearBeat(5)}var o=Date.now()-t[0];if(o>3e4)this.logger.error("socket error: heartbeat timeout"),this.emit("signalTimeout");else if(o>2e3&&o<3e4){this.logger.warn("socket error: no response, keep heartbeat"),t.push(n);var s=this.getContentData({type:"keep_alive",uid:e.uid,cid:e.cid},i);this.send(s),this.bindHearBeat(2)}}},u.getContentData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];return a.configMap.CURRENT.SDK_TYPE===a.configMap.SDK_TYPE.WHITEBOARD?(e.version=31,e.type=s.serializeWb.gateWay[e.type],e.content={params:{timestamp:+t}}):e.params={content:{timestamp:t+""}},e},u.bindHearBeat=function(e){this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.isHeartBeating=setTimeout(this.heartBeatHandler.bind(this),1e3*e)},u.stopHeartBeat=function(){this.isHeartBeating&&(this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.heartBeatTimer&&clearInterval(this.heartBeatTimer),this.isHeartBeating=null,this.heartBeatTimer=null,this.heartBeatList=null,this.heartBeatCount=0)},u.logout=function(){var e=this.socketData,t=Date.now().toString(),n=this.getContentData({type:"logout",uid:e.uid,cid:e.cid},t);this.send(n)},u.destroy=function(){this.logger.log("signal close -> signal.js"),this.stopHeartBeat(),this.isDestroy=!0,this.ws&&(this.ws.onopen=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.ws=null)},t["default"]=d,e.exports=t["default"]},,,,,,,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(197);Object.defineProperty(t,"Devices",{enumerable:!0,get:function(){return i(r)["default"]}});var o=n(198);Object.defineProperty(t,"Recorder",{enumerable:!0,get:function(){return i(o)["default"]}});var a=n(199);Object.defineProperty(t,"MStream",{enumerable:!0,get:function(){return i(a)["default"]}})},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=n(7),o=n(3),a=o.info.nrtcVersion,s="https://statistic.live.126.net/statistic/realtime/sdkFunctioninfo",c=function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,u);var t=e.appkey,n=e.platform;this.apis={},this.isRtc=/WebRTC/.test(n),this.init(t,n),this.resetStatus()};t["default"]=c;var d=c.prototype;d.init=function(e,t){this.apis=Object.assign(this.apis,{ver:1,platform:t,sdk_ver:a||"v4.4.0",uid:null,appkey:e,time:null})},d.start=function(e){this.calling=!0,this.apis=Object.assign(this.apis,e)},d.resetStatus=function(){this.calling=!1,this.apis=Object.assign(this.apis,{p2p:{value:0},meeting:{value:0},bypass:{value:0},call_control_type:{value:0},self_mute:{value:-1},self_mic_mute:{value:-1},switch_p2p_type:{value:0},set_speaker:{value:-1},net_detect:{value:this.isRtc?-1:0},beautify:{value:-1},water_mark:{value:-1},audio_samples:{value:-1},video_samples:{value:-1},pre_view_mirror:{value:-1},code_mirror:{value:-1},custom_audio:{value:-1},custom_video:{value:-1},audio_mix:{value:-1},snap_shot:{value:-1},record:{value:0},audio_record:{value:0},display:{value:0},android_compatibility:{value:-1},hd_audio:{value:0},video_quality:{value:0},fps:{value:0},prefered_video_encoder:{value:-1},prefered_video_decoder:{value:-1},video_max_encode_bitrate:{value:this.isRtc?-1:0},audio_scene:{value:-1},video_adaptive_strategy:{value:this.isRtc?-1:0},ans:{value:this.isRtc?-1:0},agc:{value:-1},dtx:{value:-1},aec:{value:this.isRtc?-1:0},awc:{value:this.isRtc?-1:0}})},d.update=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=e.key,i=e.ext;e.constructor===String&&(n=e),i=i||t,this.apis[n]&&(this.apis[n].value=1,void 0!==i&&(this.apis[n].ext=i),/(p2p|meeting)/.test(n)&&(this.calling=!0))},d.send=function(){var e=this;this.calling&&(this.calling=!1,this.apis.time=Date.now(),(0,r.ajax)({type:"post",url:s,data:this.apis}).then(function(t){e.resetStatus()})["catch"](function(t){console.log("err",t),e.resetStatus()}))},e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=n(7),o=n(3),a=o.info.nrtcVersion,s="https://statistic.live.126.net/statistic/realtime/sdkinfo",c=function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,l);var t=e.appkey;this.infos={},this.userlist=[],this.localVolumn=0,this.local={},this.remote={},this.init(t),this.resetStatus()};t["default"]=c;var d=c.prototype;d.init=function(e){this.infos=Object.assign(this.infos,{ver:1,device:-1,isp:-1,platform:u.convertPlatform(platform.os.family)+"-"+platform.os.version,browser:platform.name+"-"+platform.version,sdk_ver:a||"3.6.0",appkey:e,interval:60,samples:30,time:null,qos_algorithm:-1,fec_algorithm:-1,qos_scene:-1,qos_strategy:-1})},d.resetStatus=function(){this.infos=Object.assign(this.infos,{uid:null,cid:null,push_url:null,turn_ip:null,proxy_ip:null,meeting:!1,live:!1}),this.clearInfoData(),this.uidSsrcMap={},this.userlist=[]},d.initInfoData=function(e){var t={uid:e,cid:this.imInfo&&this.imInfo.channelId||-1,push_url:this.sessionConfig&&this.sessionConfig.rtmpUrl||-1,turn_ip:this.imInfo&&this.imInfo.turnMap||-1,proxy_ip:this.imInfo&&this.imInfo.turnMap||-1,meeting:/^meeting$/gi.test(this.imInfo.sessionMode),live:this.sessionConfig&&this.sessionConfig.liveEnable||!1,p2p:!1,isp:-1,net:-1,connect_state:this.imInfo&&this.imInfo.code||200,signalling_time:(this.sessionConfig&&this.sessionConfig.signalEndTime||0)-(this.sessionConfig&&this.sessionConfig.signalStartTime||0),connect_time:(this.sessionConfig&&this.sessionConfig.rtcEndTime||0)-(this.sessionConfig&&this.sessionConfig.rtcStartTime||0)};this.infos=Object.assign(this.infos,t)},d.clearInfoData=function(){this.localVolumn=0,this.infos=Object.assign(this.infos,{rx:{audio:[],video:[]},tx:{a_lost:[],v_lost:[],rtt:[],rtt_mdev:[],set_v_fps:[],qos_v_fps:[],v_fps:[],set_v_quality:[],real_v_res:[],real_v_kbps:[],real_v_kbps_n:[],real_a_kbps:[],real_a_kbps_n:[],set_v_kbps:[],qos_v_kbps:[],tx_bw_kbps:[],a_volume:[]}})},d.start=function(e){var t=this,n=e.info,i=e.imInfo,r=e.remoteUidMsidMap,o=e.sessionConfig,a=e.rtcConnection,s=e.uid;i&&r&&a&&(this.infos.appkey=n.appKey||n.appkey||this.infos.appkey,this.imInfo=i||{},this.remoteUidMsidMap=r||{},this.sessionConfig=o||{},this.rtcConnection=a,this.videoConfig=e.videoConfig||{},this.statsTimer||(this.getTurnMap(),this.initInfoData(s),this.format(),this.statsTimer=setInterval(function(){t.sendInfo()},1e3*this.infos.interval)))},d.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.resetStatus())},d.update=function(e){this.rtcStats=e,this.format(),this.updateRxMediaInfo(),this.updateTxMediaInfo()},d.updateOnce=function(e){var t=e.imInfo,n=e.remoteUidMsidMap,i=e.sessionConfig,r=e.rtcConnection;t&&(this.imInfo=t||{},this.remoteUidMsidMap=n||{},this.sessionConfig=i||{},this.rtcConnection=r||{},this.videoConfig=e.videoConfig||{},this.getTurnMap(),this.initInfoData(),this.sendInfo())},d.updateLocalVolumn=function(e){this.localVolumn=e},d.updateRxMediaInfo=function(){var e=this,t={u:[],g:[],c:[],bn:[],bc:[]},n={u:[],i:[],bn:[],bc:[],r:[],f:[]};this.userlist.map(function(i){var r=e.getMediaStats(i);t.u.push(r.audio.u),t.g.push(-1),t.c.push(-1),t.bn.push(r.audio.bn),t.bc.push(r.audio.bc),n.u.push(r.video.u),n.i.push(r.video.i),n.bn.push(r.video.bn),n.bc.push(r.video.bc),n.r.push(r.video.r),n.f.push(r.video.f)}),this.infos.rx.audio.push(t),this.infos.rx.video.push(n)},d.getMediaStats=function(e){var t=this.rtcStats,n={audio:{u:+e,g:-1,c:-1,bn:0,bc:0},video:{u:+e,i:-1,bn:0,bc:0,r:-1,f:0}},i={},r=this.uidSsrcMap[e];if(!r)return n;r=r.join("|");var o=new RegExp("("+r+")");return t.results.filter(function(e){return o.test(e.ssrc)&&(i[e.mediaType]=e),o.test(e)}),i.audio&&(n.audio.bn=(i.audio.availableBandwidth||0)-0,n.audio.bc=-1),i.video&&(n.video.bn=(i.video.availableBandwidth||0)-0,n.video.bc=i.video.googFrameWidthReceived+"x"+i.video.googFrameHeightReceived,n.video.f=(i.video.googFrameRateDecoded||0)-0),n},d.getLocalMediaStats=function(){var e=this.rtcStats,t={a_lost:-1,v_lost:-1,rtt:0,rtt_mdev:-1,set_v_fps:this.videoConfig.frameRate||0,qos_v_fps:0,v_fps:0,set_v_quality:this.sessionConfig.videoQuality,real_v_res:0,real_v_kbps:0,real_v_kbps_n:0,real_a_kbps:-1,real_a_kbps_n:0,set_v_kbps:-1,qos_v_kbps:0,tx_bw_kbps:0,a_volume:0},n={},i=this.imInfo.uid,r=this.uidSsrcMap[i];if(!r)return t;r=r.join("|");var o=new RegExp("("+r+")");return e.results.filter(function(e){return e.localCandidateId?void(n.rtt=e):(o.test(e.ssrc)&&(n[e.mediaType]=e),o.test(e))}),n.audio&&(t.real_a_kbps_n=(n.audio.availableBandwidth||e.audio.send.availableBandwidth)-0,t.a_volume=this.localVolumn-0),n.video&&(t.qos_v_fps=n.video.googFrameRateInput-0,t.v_fps=n.video.googFrameRateSent-0,t.real_v_res=n.video.googFrameWidthSent+"x"+n.video.googFrameHeightSent,t.real_v_kbps=n.video.googEncodeUsagePercent-0,t.real_v_kbps_n=n.video.availableBandwidth-0),t.rtt=n.rtt.googRtt-0,t.tx_bw_kbps=(e.connectionType.bitsSentPerSecond||0)-0,t},d.updateTxMediaInfo=function(){var e=this.getLocalMediaStats(),t=this.infos.tx;for(var n in e)t[n].push(e[n]);this.infos.net=u.convertNetwork(this.rtcStats.connectionType.local.networkType[0])},d.getTurnMap=function(){var e=this.imInfo;e.serverMap&&(e.turnMap=JSON.parse(e.serverMap||null),e.turnMap=e.turnMap&&e.turnMap.turnaddrs,e.turnMap=e.turnMap&&e.turnMap[0],e.turnMap=e.turnMap.constructor===Array?e.turnMap[0]:e.turnMap,e.turnMap=e.turnMap&&e.turnMap.match(/\d+\.\d+.\d+\.\d+/),e.turnMap=e.turnMap[0])},d.getSsrc=function(e,t){var n=[],i={audio:this.getTypeSsrc("audio",e,t),video:this.getTypeSsrc("video",e,t)};return i.audio&&n.push(i.audio),i.video&&n.push(i.video),n},d.getTypeSsrc=function(e,t,n){var i=void 0,r="";if(i=new RegExp(e+"[.\\r\\n\\s\\S]*ssrc:(\\d+)\\smsid:"+t),r=n.match(i),r=r&&r[0])return i=new RegExp("ssrc:\\d+\\smsid:"+t),r=r.match(i),r=r.map(function(e){return i=new RegExp("ssrc:(\\d+)\\s"),e=e.match(i),e[1]})},d.format=function(){this.formatLocal(),this.formatRemote()},d.formatLocal=function(){this.localSdp=this.rtcConnection.localDescription,this.localStream=this.rtcConnection.getLocalStreams()[0],this.localStream&&(this.uidSsrcMap[this.imInfo.uid]=this.getSsrc(this.localStream.id,this.localSdp.sdp),this.local.ssrc=this.uidSsrcMap[this.imInfo.uid])},d.formatRemote=function(){this.remoteSdp=this.rtcConnection.remoteDescription,this.userlist=[];var e=this.remoteUidMsidMap;for(var t in e)this.userlist.push(t),this.remote[t]={},this.uidSsrcMap[t]=this.getSsrc(e[t],this.remoteSdp.sdp),this.remote[t].ssrc=this.uidSsrcMap[t]},d.sendInfo=function(){var e=this;this.infos.uid&&this.infos.cid&&(this.infos.time=Date.now(),this.infos.samples=this.infos.rx.audio.length,(0,r.ajax)({type:"post",url:s,data:this.infos}).then(function(t){e.clearInfoData()})["catch"](function(t){e.clearInfoData()}))};var u={convertNetwork:function(e){var t={wlan:"wifi",lan:"ethernet"};return t[e]||"unknown"},convertPlatform:function(e){var t=/Windows/i,n=/OS X/i,i=void 0;return i=t.test(e)&&"Win"||e,i=n.test(i)&&"Mac"||i}};e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=n(7),o=n(3),a=o.info.nrtcVersion,s="//statistic.live.126.net/webrtc/stat",c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=t.appkey;this.infos={},this.init(n),this.resetStatus()}return e.prototype.resetStatus=function(){},e.prototype.init=function(e){this.infos=Object.assign(this.infos,{interval:60,ver:1,platform:d.convertPlatform(platform.os.family)+"-"+platform.os.version,browser:platform.name+"-"+platform.version,sdk_ver:a||"3.6.0",uid:null,appkey:e,time:null,data:{}})},e.prototype.clear=function(){this.infos.data={}},e.prototype.start=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.infos.appkey=t.appKey||t.appkey||this.infos.appkey,this.infos.cid=t.cid,this.infos.uid=t.uid,this.statsTimer||(this.statsTimer=setInterval(function(){e.send()},1e3*this.infos.interval))},e.prototype.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.clear())},e.prototype.update=function(e){this.infos.data["stat_"+Date.now()]=e},e.prototype.send=function(){var e=this;0!==Object.keys(this.infos.data).length&&(this.infos.time=Date.now(),(0,r.ajax)({type:"post",url:s,data:this.infos}).then(function(t){e.clear()})["catch"](function(e){console.log("err",e)}))},e}();t["default"]=c;var d={convertNetwork:function(e){var t={wlan:"wifi",lan:"ethernet"};return t[e]||"unknown"},convertPlatform:function(e){var t=/Windows/i,n=/OS X/i,i=void 0;return i=t.test(e)&&"Win"||e,i=n.test(i)&&"Mac"||i}};e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e){if(!e.url||!e.data)return Promise.reject("参数不完整，无法发起请求");e.dataType=e.dataType||"json";var t=new XMLHttpRequest;return t.open(e.type||"GET",e.url,!0),t.responseType=""+e.dataType,t.setRequestHeader("Content-type","application/json;charset=UTF-8"),new Promise(function(n,i){t.onload=function(){var e=t.response;n(e)},t.onerror=function(e){i(e)},t.send(JSON.stringify(e.data))})};e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={html2node:function(e){var t=document.createElement("div");t.innerHTML=e;var n,i,r=[];if(t.children)for(n=0,i=t.children.length;n<i;n++)r.push(t.children[n]);else for(n=0,i=t.childNodes.length;n<i;n++){var o=t.childNodes[n];1===o.nodeType&&r.push(o)}return r.length>1?t:r[0]},n2node:function(e){return e?/HTML.+Element/gi.test(e)?e:e[0]&&/HTML.+Element/gi.test(e[0])?e[0]:null:null}},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={merge:function(){var e=arguments;return e[0]=Object.assign.apply(Object.assign,arguments),e[0]},verifyOptions:function(){var e=arguments;if(e[0]&&e[0].constructor===Object)for(var t=1;t<arguments.length;t++){var n=e[t];n=n.split(" "),n.map(function(t){if(!e[0][t])throw Error("参数缺失 "+t)})}},guid:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return e()+e()+e()+e()+e()+e()+e()+e()}}()},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var n={gateWay:{login:1,loginAck:2,join:3,keep_alive:4,keep_alive_ack:5,keep_alive_node:6,broadcast:7,toUser:8,logout:9}},i={gateWay:{1:"login",2:"loginAck",3:"join",4:"keep_alive",5:"keep_alive_ack",6:"keep_alive_node",7:"broadcast",8:"toUser",9:"logout"}};t.serializeWb=n,t.unserializeWb=i},,,,,,,,,function(e,t,n){"use strict";function i(e,t){for(var n in t)e[n]=t[n];return e}n(26),n(12),n(2).Promise,window.Object.assign||(window.Object.assign=function(){for(var e=arguments,t=1;t<e.length;t++)e[0]=i(e[0],e[t]);return e[0]})},,,,,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(7),s=n(4),c=function(e){function t(n){i(this,t);var o=r(this,e.call(this));return n.container=a.element.n2node(n.container),n.remoteContainer=a.element.n2node(n.remoteContainer),a.tool.merge(o,n),o.init(),o}return o(t,e),t}(s),d=c.prototype;d.init=function(){var e=this;this.resetStatus(),window.addEventListener("beforeunload",this.beforeunload.bind(this));var t=this.nim&&this.nim.logger||window.console;this.logger={log:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.debug&&t.log.apply(t,arguments)},error:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.debug&&t.error.apply(t,arguments)},warn:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.debug&&t.warn.apply(t,arguments)}},this.log=this.logger.log,this.error=this.logger.error,this.warn=this.logger.warn},d.resetStatus=function(){this.signalInited=!1,this.channelId=null,this.type=null,this.target={account:null,uid:null},this.sessionConfig={},this.sessionMode=null,this.imInfo={},this.calling=!1,this.isCaller=!1,this.callee=null,this.callAccepted=!1,this.callerInfo=null,this.beCalledInfo=null,this.nim&&(this.nim.protocol&&this.nim.protocol.setCurrentNetcall&&this.nim.protocol.setCurrentNetcall(),this.nim.protocol&&this.nim.protocol.setCurrentWhiteBoard&&this.nim.protocol.setCurrentWhiteBoard()),this.needQueryAccountMap={},this.accountUidMap={},this.uidAccountMap={},this.isOnHangup=!1},d.beforeunload=function(){this.signalInited&&(this.callerInfo||this.beCalledInfo?this.hangup():this.leaveChannel())},d.baseGetAccount=function(){return this.nim&&this.nim.account},d.baseGetUid=function(){return this.accountUidMap?this.accountUidMap[this.nim.account]||"-1":"-1"},d.parseAccountUidMap=function(e){var t=this;Object.keys(e).forEach(function(n){t.addAccountUidMap({account:n,uid:e[n]})})},d.addAccountUidMap=function(e){var t=e.account,n=e.uid;this.uidAccountMap||(this.uidAccountMap={}),this.uidAccountMap[n]=t,this.accountUidMap||(this.accountUidMap={}),this.accountUidMap[t]=n},d.getAccountWithUid=function(e){if(this.uidAccountMap)return this.uidAccountMap[e]},d.getUidWithAccount=function(e){if(this.accountUidMap)return this.accountUidMap[e]},d.baseIsCurrentChannelId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.channelId&&this.channelId===e.channelId},d.baseNotCurrentChannelId=function(e){return!this.baseIsCurrentChannelId(e)},d.baseResponse=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.fn||"calleeAck",i=t.beCalledInfo||this.beCalledInfo,r=i.accepted=t.accepted!==!1;return r?(this.sessionMode="p2p",this.type=i.type,this.channelId=i.channelId,this.target.account=i.account,this.calling=!0,this.imInfo=i,this.imInfo.sessionMode=this.sessionMode,this.setSessionConfig({signalStartTime:Date.now()})):(this.log("reject call",i),this.packNetcallRecord({type:i.type,channelId:i.channelId,isCaller:!1,target:i.account,recordType:"rejectNetcall"})),this.nim[n](i).then(function(){r&&(t.sessionConfig&&e.setSessionConfig(t.sessionConfig),e.beCalledInfo=i,e.initSession({beCalledInfo:i}))},function(t){throw e.log(t),t})},d.baseControl=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.channelId=t.channelId||this.channelId,t.command&&t.channelId){this.controller.uploadDataApi("update",{key:"call_control_type"});var n=t.fn||"netcallControl";return t.type=t.command,this.nim[n](t)["catch"](function(t){e.log(t)})}},d.baseHangup=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.uploadDataApi("send");var t=e.channelId,n=void 0===t?this.channelId:t,i=e.recordType;if(n){var r=e.fn||"hangup";this.nim[r]({channelId:n})}n===this.channelId&&(this.isCaller&&!this.callAccepted&&(this.log(i,{channelId:n}),this.packNetcallRecord({recordType:i})),this.resetWhenHangup())},d.baseStartSession=function(){this.imInfo.cid=this.imInfo.cid||this.imInfo.channelId;var e=this.sessionMode=this.sessionMode||"p2p";this.imInfo.sessionMode=e,this.imInfo.sessionConfig=this.sessionConfig},d.packNetcallRecord=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.recordType,n=e.type||this.type,i=e.channelId||this.channelId,r=e.duration||0,o=e.isCaller||this.isCaller,s=e.target||this.target.account,c=this.baseGetAccount(),d=o?c:s,u=o?s:c,l=+new Date;this.nim.protocol.onMsg({content:{msg:{attach:JSON.stringify({data:{calltype:n,channel:i,duration:r,ids:[c,s],time:l},id:t}),from:d,fromClientType:o?16:0,fromDeviceId:"",fromNick:"",idClient:a.tool.guid(),idServer:a.tool.guid(),scene:0,time:l,to:u,type:5}}})},d.setSessionConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.tool.merge(this.sessionConfig,e)},d.initSignal=function(){return Promise.resolve()},d.initSession=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionMode="p2p";var n=this.isCaller?this.callerInfo:t.beCalledInfo;this.parseAccountUidMap(n.accountUidMap),!n.account&&n.uid&&(n.account=this.getAccountWithUid(n.uid)),this.callAccepted=!0,this.signalInited=!0,this.setSessionConfig({signalEndTime:Date.now()}),this.controller.uploadDataApi("start",{uid:n.uid}),this.target.uid=this.getUidWithAccount(this.target.account);var i={type:n.type,account:this.target&&this.target.account||n.account,channelId:n.channelId};n.netcallType&&(i.netcallType=n.netcallType),this.imInfo.target=this.target,setTimeout(function(){e.emit("callAccepted",i)},1)},d.onBeCalled=function(e){this.signalInited=!0,this.channelId=e.channelId,this.beCalledInfo=e,this.log("beCalling",e),this.emit("beCalling",e)},d.onUserJoin=function(e){if(this.log("client on userJoined",e),e.type=e.type||this.type,e.account=this.getAccountWithUid(e.uid),e.mode=this.sessionMode,e.account!==this.baseGetAccount()){if(e.account)return this.logger.log("有人加入 ----> 来自信令层的通知",e),void this.emit("joinChannel",e);this.needQueryAccountMap[e.uid]=e;var t=this.nim.queryAccountUidMap||this.nim.wbQueryAccountUidMap;t.call(this.nim,this.channelName,[e.uid])}},d.onUserLeft=function(e){var t=this;this.channelId&&(this.logger.log("leave channel from signal"),"p2p"===this.imInfo.sessionMode?(this.controller.uploadDataApi("send"),setTimeout(function(){t.logger.log("超时处理 onUserLeft"),t.resetWhenHangup()},1e3),this.emit("hangup",{channelId:e.channelId||e.cid,account:this.target.account,type:e.type||0})):this.emit("leaveChannel",{channelId:e.channelId||e.cid,account:this.getAccountWithUid(e.uid),type:e.type||0}))},d.onNotifyJoin=function(e){this.logger.log("join channel from IM");var t=e.accountUidMap,n=this.needQueryAccountMap;this.parseAccountUidMap(t);for(var i in t){var r=i,o=t[i];if(o in n){var a=n[o];a.account=r,delete n[o],this.logger.log("有人加入 ----> 来自IM的通知",e),this.emit("joinChannel",a)}}},d.onCalleeAck=function(e){if(this.logger.log("收到被叫的通知",e),!this.baseNotCurrentChannelId(e)){var t=e.account,n=this.beCalledInfo||this.callerInfo;this.target.account=t,this.setSessionConfig({signalEndTime:Date.now()}),e.accepted?(this.callAccepted=!0,this.initSession()):(this.log("call Rejected",e),this.packNetcallRecord({type:e.type,channelId:e.channelId,isCaller:!0,target:e.account,recordType:"netcallRejected"}),this.resetWhenHangup(),this.emit("callRejected",{type:n.type,account:t}))}},d.onHangup=function(e){var t=this;this.channelId&&(this.logger.log("on hangup from IM"),this.controller.uploadDataApi("send"),setTimeout(function(){t.logger.log("超时处理 onHangup"),t.resetWhenHangup()},1e3),this.emit("hangup",{channelId:e.channelId,account:e.account,type:0}))},d.onControl=function(e){this.emit("control",e)},d.onCalleeAckSync=function(e){this.emit("callerAckSync",e),this.baseIsCurrentChannelId(e)&&this.resetWhenHangup()},d.baseCreateChannel=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.tool.verifyOptions(n,"channelName"),n.custom=n.custom||"",this.setSessionConfig({signalStartTime:Date.now()}),this.nim[e](n).then(function(e){return Promise.resolve(e)})["catch"](function(e){return t.setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})},d.baseJoinChannel=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.nim[e](n).then(function(e){return t.setSessionConfig({signalEndTime:Date.now()}),t.signalInited=!0,t.sessionMode=e.sessionMode="meeting",t.parseAccountUidMap(e.accountUidMap),e.uid=t.getUidWithAccount(t.nim.account),Promise.resolve(e)})["catch"](function(e){return t.setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})},d.format=function(e){return e.rtcServerMap&&(e.rtcServerMap=JSON.parse(e.rtcServerMap),e.rtcServerMap=e.rtcServerMap.webrtcarray||[e.rtcServerMap.webrtc]||e.rtcServerMap),e.wbServerMap&&(e.wbServerMap=JSON.parse(e.wbServerMap),e.wbServerMap=e.wbServerMap.webrtcarray||[e.wbServerMap.webrtc]||e.wbServerMap),e},d.resetWhenHangup=function(){},e.exports=c},function(e,t){"use strict";t.__esModule=!0;var n,i,r={CURRENT:{SDK_TYPE:null},SDK_TYPE:{NETCALL:1,
WEBRTC:2,WHITEBOARD:3,NRTC:4},SDK_NAME:{1:"Netcall",2:"WebRTC",3:"WhiteBoard",4:"NRTC"}};r.STATS_FUN=(n={},n[r.SDK_TYPE.NETCALL]=1,n[r.SDK_TYPE.WEBRTC]=1,n[r.SDK_TYPE.NRTC]=1,n[r.SDK_TYPE.WHITEBOARD]=0,n),r.STATS_RTC=(i={},i[r.SDK_TYPE.WEBRTC]=1,i[r.SDK_TYPE.NRTC]=1,i[r.SDK_TYPE.WHITEBOARD]=0,i),t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(11),s=n(20),c=n(24),d=n(4),u=n(34),l=function(e){function t(n){i(this,t);var o=r(this,e.call(this,n));return o.info={},o._init(n),o._reset(),o}return o(t,e),t.prototype._init=function(e){this.info=Object.assign(this.info,e),this.logger=e.logger||window.console,this.dataApi=(0,c.DataApi)({appkey:this.info.appKey,platform:s.configMap.SDK_NAME[s.configMap.CURRENT.SDK_TYPE]}),this.dataRtc=(0,c.DataRtc)({appkey:this.info.appKey}),this.dataStats=(0,c.DataStats)({appkey:this.info.appKey})},t.prototype._reset=function(){this.signal&&(this.signal.destroy(),this.signal=null),this.sessionConfig={},this.imInfo={},this.target={},this.userJoinTimeoutId=0,this.remoteNodeStatus={},this.dataRtc.stop(),this.dataStats.stop()},t.prototype.resetStatus=function(){this._reset()},t.prototype._startSession=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.imInfo||e;this.setSessionConfig(t.sessionConfig);var n=t.serverMap?JSON.parse(t.serverMap):{};t.urlArray=t.serverAddrs||n.webrtcarray||[n.webrtc];var i=void 0;return i=this.signal?Promise.resolve(this.signal):this._initSignal()},t.prototype._initSignal=function(){var e=this;if(this.signal)return Promise.resolve();var t=new u({logger:this.logger}),n=this.imInfo.urlArray;if(n){var i=n.shift();return i?t.connect({url:i,imInfo:this.imInfo}).then(function(t){return e.signal=t,e._initSignalEvent(),Promise.resolve(t.url)})["catch"](function(t){return e._initSignal()}):Promise.reject("无可用的网关服务器地址, 如果当前应用是WebRTC音视频, 请确保对方打开了WebRTC兼容开关")}},t.prototype._initSignalEvent=function(){var e=this,t=this.signal;t.on("signalTimeout",this.onSignalTimeout.bind(this)),t.on("message",this.onSignalMessage.bind(this)),t.on("signalClosed",function(){e.emit("signalClosed"),e.resetStatus()}),this.signal.on("signalError",function(t){e.emit("signalClosed"),e._stopSignal()})},t.prototype._stopSignal=function(){this.signal&&(this.signal.destroy(),this.signal=null)},t.prototype._stopSession=function(){this._stopSignal(),this._reset()},t.prototype._logout=function(){this.signal&&this.signal.logout()},t.prototype.setAppKey=function(e){e&&(this.info.appKey=e)},t.prototype.getUidByMsid=function(e){var t=this.remoteUidMsidMap;for(var n in t)if(t[n]===e)return n;return null},t.prototype.getMsidByUid=function(e){return this.remoteUidMsidMap(e)},t.prototype.setSessionConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionConfig=Object.assign(this.sessionConfig,e)},t.prototype.onSignalMessage=function(e){},t.prototype.onSignalTimeout=function(e){},t.prototype.uploadDataRtcStart=function(){this.info.appKey&&s.configMap.STATS_FUN[s.configMap.CURRENT.SDK_TYPE]&&this.dataRtc.start({info:this.info,rtcConnection:this.rtc.rtcConnection,imInfo:this.imInfo,remoteUidMsidMap:this.remoteUidMsidMap,sessionConfig:this.sessionConfig,videoConfig:this.imInfo.videoConfig,uid:this.imInfo.uid})},t.prototype.uploadDataRtcStop=function(){s.configMap.STATS_RTC[s.configMap.CURRENT.SDK_TYPE]&&this.dataRtc.stop()},t.prototype.uploadDataRtcOnce=function(e){if(s.configMap.STATS_RTC[s.configMap.CURRENT.SDK_TYPE]){var t=a.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});this.dataRtc.updateOnce({info:this.info,imInfo:e,sessionConfig:this.sessionConfig,videoConfig:t})}},t.prototype.uploadDataRtc=function(e,t){if(s.configMap.STATS_RTC[s.configMap.CURRENT.SDK_TYPE]&&this.info.appKey)return"volume"===e?void this.dataRtc.updateLocalVolumn(t):void this.dataRtc.update(e,t)},t.prototype.uploadDataApi=function(e,t){s.configMap.STATS_FUN[s.configMap.CURRENT.SDK_TYPE]&&this.info.appKey&&("start"===e&&(t.appkey=this.info.appKey),this.dataApi[e]&&this.dataApi[e](t))},t.prototype.uploadDataRtcNewStart=function(){s.configMap.STATS_RTC[s.configMap.CURRENT.SDK_TYPE]&&this.dataStats.start({info:this.info,rtcConnection:this.rtc.rtcConnection,imInfo:this.imInfo,cid:this.imInfo.cid,uid:this.imInfo.uid})},t.prototype.uploadDataRtcNewStop=function(){s.configMap.STATS_RTC[s.configMap.CURRENT.SDK_TYPE]&&this.dataStats.stop()},t.prototype.uploadDataRtcNew=function(e){s.configMap.STATS_RTC[s.configMap.CURRENT.SDK_TYPE]&&this.dataStats.update(e)},t}(d);t["default"]=l,e.exports=t["default"]},,,,,,,,,,function(e,t){"use strict";function n(e){i(e.enable)&&(this.enable=e.enable?1:0),i(e.needBadge)&&(this.needBadge=e.needBadge?1:0),i(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0),i(e.pushContent)&&(this.pushContent=""+e.pushContent),i(e.custom)&&(this.custom=""+e.custom),i(e.pushPayload)&&(this.pushPayload=""+e.pushPayload),i(e.sound)&&(this.sound=""+e.sound),i(e.webrtcEnable)&&(this.webrtcEnable=e.webrtcEnable?1:0)}t.__esModule=!0,t["default"]=function(e){var t=e.util;return i=t.notundef,n};var i=void 0;e.exports=t["default"]},,,,,,,,,,,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(200);Object.defineProperty(t,"RtcUtil",{enumerable:!0,get:function(){return i(r)["default"]}});var o=n(201);Object.defineProperty(t,"SdpUtil",{enumerable:!0,get:function(){return i(o)["default"]}});var a=n(203);Object.defineProperty(t,"RtcStats",{enumerable:!0,get:function(){return i(a)["default"]}});var s=n(202);Object.defineProperty(t,"RtcStatsNew",{enumerable:!0,get:function(){return i(s)["default"]}});var c=n(88);Object.defineProperty(t,"RtcSupport",{enumerable:!0,get:function(){return i(c)["default"]}})},function(e,t){"use strict";t.__esModule=!0;var n,i,r=navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||(navigator.mediaDevices=navigator.mediaDevices||{},navigator.mediaDevices.getUserMedia=function(e){return new Promise(function(t,n){return navigator.getUserMedia?void navigator.getUserMedia(e,function(e){t(e)},function(e){n(e)}):n("当前浏览器还不支持API: getUserMedia")})});var o=window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,a=window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,s=window.RTCDataChannel=window.RTCDataChannel||window.DataChannel,c=window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,d=window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate,u=window.MediaStream=window.MediaStream||window.webkitMediaStream;window.mozRTCPeerConnection||navigator.mozGetUserMedia?(n="moz",i=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)):(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)&&(n="webkit",i=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10));var l="https:"===window.location.protocol&&("webkit"===n&&i>=26||"moz"===n&&i>=33),p=document.createElement("video"),f=p&&p.canPlayType&&"probably"===p.canPlayType('video/webm; codecs="vp8", vorbis');t["default"]={prefix:n,browserVersion:i,support:!!r||!!a,RTCPeerConnection:!!a,Vp8:f,GetUserMedia:!!r,DataChannel:!!(a&&s&&a.prototype&&a.prototype.createDataChannel),WebAudio:!(!o||!o.prototype.createMediaStreamSource),MediaStream:!!u,ScreenSharing:!!l,AudioContext:o,RTCSessionDescription:c,RTCIceCandidate:d,getUserMedia:r},e.exports=t["default"]},function(e,t,n){"use strict";function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stream,n=e.uid,i=e.isAnalyze,o=e.isRemote;this.support=r.WebAudio&&r.MediaStream,this.gain=1,this.stream=t,this.support&&(this.audioIn={},this.uid=n||0,this.isAnalyze=i,this.isRemote=o||!1,this.instant=0,this.slow=0,this.clip=0,this.init())}t.__esModule=!0,t["default"]=i;var r=n(88);i.ac=r.WebAudio&&r.MediaStream?new r.AudioContext:{},i.destination=i.ac.createMediaStreamDestination?i.ac.createMediaStreamDestination():{};var o=i.prototype;o.context=i.ac,o.init=function(){this.validateInput()&&(this.isAnalyze&&this.initMonitor(),this.formatStreams(),this.initWebAudio(),this.initAudioIn())},o.validateInput=function(){return/(Array|MediaStream|LocalMediaStream)/.test(this.stream.constructor)},o.initMonitor=function(){var e=this,t=this.script=this.context.createScriptProcessor(0,1,1);t.onaudioprocess=function(t){var n,i=t.inputBuffer.getChannelData(0),r=0,o=0;for(n=0;n<i.length;++n)r+=Math.abs(i[n]),Math.abs(i[n])>.99&&(o+=1);e.instant=Math.sqrt(r/i.length),e.slow=.95*e.slow+.05*e.instant,e.clip=o/i.length}},o.initWebAudio=function(){var e=this.context;this.gainFilter=e.createGain(),this.destination=this.isRemote?i.destination:e.createMediaStreamDestination(),this.gainFilter.gain.value=this.gain,this.gainFilter.connect(this.destination)},o.initAudioIn=function(){function e(e){if(!/(MediaStream|LocalMediaStream)/.test(e.constructor))return null;if(0===e.getAudioTracks().length)return null;var t=r.createMediaStreamSource(e);return n.isAnalyze&&n.script&&(t.connect(n.script),n.script.connect(n.gainFilter)),t.connect(n.gainFilter),t}var t=this,n=this,i=this.stream,r=this.context,o=void 0;return/(MediaStream|LocalMediaStream)/.test(i.constructor)?(e(i),void(this.outputStream=this.destination.stream)):void(i.constructor===Array&&(i.forEach(function(n){o=e(n),o&&(t.audioIn[n.id]=o)}),this.outputStream=this.destination.stream))},o.formatStreams=function(){var e=this.stream,t=[];return/(MediaStream|LocalMediaStream)/.test(e.constructor)?(e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))}),void(this.stream=t)):void(e.constructor===Array&&(e.map(function(e){e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))})}),this.stream=t))},o.addStream=function(e){var t=this.context;if(0!==e.getAudioTracks().length){var n=t.createMediaStreamSource(e);this.isAnalyze&&this.script&&n.connect(this.script),n.connect(this.gainFilter),this.audioIn[e.id]=n,this.outputStream=this.destination.stream}},o.updateStream=function(e){if(this.audioIn)for(var t in this.audioIn)this.audioIn[t]&&this.audioIn[t].disconnect(0),this.audioIn[t]=null;this.audioIn={},this.stream=e,this.initAudioIn()},o.setGain=function(e){this.support&&(this.gainFilter.gain.value=e,this.gain=e)},o.getGain=function(){return this.gain},o.off=function(){return this.setGain(0)},o.on=function(){this.setGain(1)},o.destroy=function(){function e(e){e&&e.getTracks().forEach(function(t){e.removeTrack(t)})}if(this.instant=0,this.slow=0,this.clip=0,this.gainFilter&&this.gainFilter.disconnect(0),this.script&&this.script.disconnect(0),this.audioIn)for(var t in this.audioIn)this.audioIn[t]&&this.audioIn[t].disconnect(0);this.audioIn={};var n=this.stream;/(MediaStream|LocalMediaStream)/.test(n.constructor)&&e(n),n.constructor===Array&&n.forEach(function(t){e(t)}),this.stream=null,this.outputStream=null},o.getVolumeData=function(){return this.instant.toFixed(2)},e.exports=t["default"]},,,,,,,,,,,,,,,function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,n){"use strict";var i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},i.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},i.matchPrefix=function(e,t){return i.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},i.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},i.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)t=i[r].trim().split("="),n[t[0].trim()]=t[1];return n},i.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){i.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){var n=i.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:n.map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},i.getIceParameters=function(e,t){var n=i.splitLines(e);n=n.concat(i.splitLines(t));var r={usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return r},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e),r=n[0].split(" "),o=3;o<r.length;o++){var a=r[o],s=i.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=i.parseRtpMap(s),d=i.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=d.length?i.parseFmtp(d[0]):{},c.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(i.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)});var r=0;return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),r>0&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=i.writeExtmap(e)}),n},i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,s=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=i.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(i),o&&(i=JSON.parse(JSON.stringify(i)),i.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(i))}}),0===n.length&&c&&n.push({ssrc:c});var u=i.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=u})),n},i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var o=i.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},i.parseMsid=function(e){var t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var r=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return r.length>0?(t=r[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t){var n,r=void 0!==t?t:2;return n=e?e:i.generateSessionId(),"v=0\r\no=thisisadapterortc "+n+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,r){var o=i.writeRtpDescription(e.kind,t);if(o+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),o},i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){var t=i.splitLines(e),n=t[0].split(" ");return n[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e),n=t[0].split(" ");return{kind:n[0].substr(2),port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.exports=i},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(75),r={};r.install=function(e){var t=e.fn,n=e.util,r=i({util:n});t.initNetcall=function(e){return n.verifyOptions(e,"type accounts"),e.pushContent="",e.custom="",e.pushConfig||(e.pushConfig={}),e.pushConfig.webrtcEnable=e.webrtcEnable,e.pushConfig=new r(e.pushConfig),this.cbAndSendCmd("initNetcall",e)},t.keepCalling=function(e){return n.verifyOptions(e,"type accounts channelId"),this.cbAndSendCmd("keepCalling",e)},t.calleeAck=function(e){return n.verifyOptions(e,"account channelId type accepted"),this.cbAndSendCmd("calleeAck",e)},t.hangup=function(e){return n.verifyOptions(e,"channelId"),this.cbAndSendCmd("hangup",e)},t.netcallControl=function(e){return n.verifyOptions(e,"channelId type"),this.cbAndSendCmd("netcallControl",e)},t.createChannel=function(e){return this.cbAndSendCmd("createChannel",e)},t.joinChannel=function(e){return n.verifyOptions(e,"channelName"),n.verifyBooleanWithDefault(e,"liveEnable",!1),n.verifyBooleanWithDefault(e,"webrtcEnable",!1),this.cbAndSendCmd("joinChannel",{channelName:e.channelName,liveOption:{liveEnable:e.liveEnable?1:0,webrtcEnable:e.webrtcEnable?1:0}})},t.queryAccountUidMap=function(e,t){return this.cbAndSendCmd("queryAccountUidMap",{channelName:e,uids:t})}},e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){"use strict";var n={};n.install=function(e){var t=e.Protocol.fn;t.processNetcall=function(e){switch(e.cmd){case"initNetcall":this.onInitNetcall(e);break;case"beCalled":this.onBeCalled(e);break;case"keepCalling":this.onKeepCalling(e);break;case"calleeAck":break;case"notifyCalleeAck":this.onNotifyCalleeAck(e);break;case"hangup":break;case"notifyHangup":this.onNotifyHangup(e);break;case"notifyNetcallControl":this.onNetcallControl(e);break;case"notifyCalleeAckSync":this.onNotifyCalleeAckSync(e);break;case"notifyNetcallRecord":this.onMsg(e);break;case"createChannel":break;case"joinChannel":this.joinChannel(e);break;case"notifyJoin":this.notifyJoin(e)}},t.onInitNetcall=function(e){if(!e.error){var t=e.obj.type;e.obj=e.content,e.obj.type=t,e.obj.accounts=e.obj.keepCallingAccounts,this.setCurrentNetcall(e.obj.channelId),this.keepCalling(e)}},t.setCurrentNetcall=function(e){this.currentNetcallChannelId=e},t.onKeepCalling=function(e){e.error||e.content.accounts.length&&this.keepCalling(e)},t.keepCalling=function(e){var t=this,n=e.obj,i=n.type,r=n.accounts,o=n.channelId;r&&r.length&&setTimeout(function(){t.currentNetcallChannelId&&t.currentNetcallChannelId===o&&t.api.keepCalling({type:i,accounts:r,channelId:o})["catch"](function(){})},3e3)},t.onBeCalled=function(e){e.error||this.emitAPI({type:"beCalled",obj:e.content})},t.onNotifyCalleeAck=function(e){e.error||this.emitAPI({type:"notifyCalleeAck",obj:e.content})},t.onNotifyHangup=function(e){e.error||this.emitAPI({type:"notifyHangup",obj:e.content})},t.onNetcallControl=function(e){e.error||this.emitAPI({type:"netcallControl",obj:e.content})},t.onNotifyCalleeAckSync=function(e){e.error||this.emitAPI({type:"notifyCalleeAckSync",obj:e.content})},t.notifyJoin=function(e){e.error||this.emitAPI({type:"notifyJoin",obj:e.content})},t.joinChannel=function(e){e.obj=e.content}},e.exports=n},,,,,,,,,function(e,t){"use strict";var n=9,i={netcall:{id:n,initNetcall:1,keepCalling:3,calleeAck:4,notifyCalleeAck:5,hangup:6,notifyHangup:7,netcallControl:8,notifyNetcallControl:9,verifyChannelId:10,createChannel:13,joinChannel:14,queryAccountUidMap:16}},r={initNetcall:{sid:n,cid:i.netcall.initNetcall,params:[{type:"byte",name:"type"},{type:"StrArray",name:"accounts"},{type:"String",name:"pushContent"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"}]},keepCalling:{sid:n,cid:i.netcall.keepCalling,params:[{type:"byte",name:"type"},{type:"StrArray",name:"accounts"},{type:"long",name:"channelId"}]},calleeAck:{sid:n,cid:i.netcall.calleeAck,params:[{type:"string",name:"account"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"}]},hangup:{sid:n,cid:i.netcall.hangup,params:[{type:"long",name:"channelId"}]},netcallControl:{sid:n,cid:i.netcall.netcallControl,params:[{type:"long",name:"channelId"},{type:"byte",name:"type"}]},verifyChannelId:{sid:n,cid:i.netcall.verifyChannelId,params:[{type:"long",name:"channelId"},{type:"String",name:"account"}]},createChannel:{sid:n,cid:i.netcall.createChannel,params:[{type:"String",name:"channelName"},{type:"String",name:"custom"},{type:"String",name:"webrtcEnable"}]},joinChannel:{sid:n,cid:i.netcall.joinChannel,params:[{type:"String",name:"channelName"},{type:"Property",name:"liveOption"}]},queryAccountUidMap:{sid:n,cid:i.netcall.queryAccountUidMap,params:[{type:"String",name:"channelName"},{type:"LongArray",name:"uids"}]}},o="netcall",a={"9_1":{service:o,cmd:"initNetcall",response:[{type:"Number",name:"timetag"},{type:"Number",name:"uid"},{type:"Number",name:"channelId"},{type:"StrArray",name:"turnServerList"},{type:"StrArray",name:"sturnServerList"},{type:"StrArray",name:"proxyServerList"},{type:"StrArray",name:"keepCallingAccounts"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"clientConfig"},{type:"String",name:"serverMap"}]},"9_2":{service:o,cmd:"beCalled",response:[{type:"Number",name:"timetag"},{type:"Number",name:"type"},{type:"Number",name:"channelId"},{type:"String",name:"account"},{type:"Number",name:"uid"},{type:"StrArray",name:"turnServerList"},{type:"StrArray",name:"sturnServerList"},{type:"StrArray",name:"proxyServerList"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"clientConfig"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"},{type:"String",name:"serverMap"}]},"9_3":{service:o,cmd:"keepCalling",response:[{type:"StrArr",name:"accounts"}]},"9_4":{service:o,cmd:"calleeAck",response:[]},"9_5":{service:o,cmd:"notifyCalleeAck",response:[{type:"String",name:"account"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"}]},"9_6":{service:o,cmd:"hangup",response:[]},"9_7":{service:o,cmd:"notifyHangup",response:[{type:"long",name:"channelId"},{type:"String",name:"account"},{type:"long",name:"timetag"
}]},"9_8":{service:o,cmd:"netcallControl",response:[]},"9_9":{service:o,cmd:"notifyNetcallControl",response:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"long",name:"channelId"}]},"9_10":{service:o,cmd:"verifyChannelId",response:[]},"9_11":{service:o,cmd:"notifyNetcallRecord",response:[{type:"Property",name:"msg"}]},"9_12":{service:o,cmd:"notifyCalleeAckSync",response:[{type:"String",name:"timetag"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"},{type:"byte",name:"fromClientType"}]},"9_13":{service:o,cmd:"createChannel",response:[{type:"long",name:"timetag"}]},"9_14":{service:o,cmd:"joinChannel",response:[{type:"long",name:"timetag"},{type:"long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"serverMap"},{type:"String",name:"clientConfig"},{type:"String",name:"custom"}]},"9_15":{service:o,cmd:"notifyJoin",response:[{type:"Long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"}]},"9_16":{service:o,cmd:"queryAccountUidMap",response:[]}};e.exports={idMap:i,cmdConfig:r,packetConfig:a}},function(e,t){"use strict";e.exports={pushConfig:{enable:1,needBadge:2,needPushNick:3,pushContent:4,custom:5,pushPayload:6,sound:7,webrtcEnable:10},liveOption:{liveEnable:1,webrtcEnable:2}}},function(e,t){"use strict";e.exports={pushConfig:{1:"enable",2:"needBadge",3:"needPushNick",4:"pushContent",5:"custom",6:"pushPayload",7:"sound",10:"webrtcEnable"},liveOption:{1:"liveEnable",2:"webrtcEnable"}}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(4),s=function(e){function t(){i(this,t);var n=r(this,e.call(this));return n.init(),n}return o(t,e),t}(a);t["default"]=s;var c=s.prototype;c.init=function(){var e=this;this.getDevices();var t=void 0;navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",function(n){t&&(clearTimeout(t),t=null);var i=Object.assign({},e.devicesCache);t=setTimeout(function(){t=null,e.getDevices(!0).then(function(){e.emit("deviceStatus",e.devicesCache),e.filterDeviceChange(e.devicesCache,i)})["catch"](function(){})},500)})},c.filterDeviceChange=function(e,t){function n(e){var t={};return Object.keys(e).forEach(function(n){e[n].forEach(function(e){t[n+e.deviceId]=Object.assign({},e,{type:n})})}),t}var i=n(e),r=n(t),o=Object.keys(i),a=Object.keys(r);if(o.length>a.length){var s=[];o.forEach(function(e){a.indexOf(e)===-1&&s.push(i[e])}),s.length&&this.emit("deviceAdd",s)}else{var c=[];a.forEach(function(e){o.indexOf(e)===-1&&c.push(r[e])}),c.length&&this.emit("deviceRemove",c)}},c.getDevicesOfType=function(e){return void 0!==e?this.getDevices().then(function(t){return[t[e]]}):this.getDevices()},c.getDevices=function(e){var t=this;return!e&&this.devicesCache?Promise.resolve(this.devicesCache):new Promise(function(e,n){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?void navigator.mediaDevices.enumerateDevices().then(function(i){if(0===i.length)return n("没有找到可用设备");var r={video:[],audioIn:[],audioOut:[]};return i.forEach(function(e){"videoinput"===e.kind?r.video.push({deviceId:e.deviceId,label:e.label?e.label:"camera "+(r.video.length+1)}):"audioinput"===e.kind?r.audioIn.push({deviceId:e.deviceId,label:e.label?e.label:"microphone "+(r.audioIn.length+1)}):"audiooutput"===e.kind&&r.audioOut.push({deviceId:e.deviceId,label:e.label?e.label:"speaker "+(r.audioOut.length+1)})}),t.devicesCache=r,e(r)})["catch"](function(e){return n(e)}):n(new Error("your browser not support this feature, see https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"))})},c.getDeviceStatus=function(){return{hasAudio:this.devicesCache.audioIn.length>0,hasVideo:this.devicesCache.video.length>0}},e.exports=t["default"]},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=n(89),c=i(s),d=n(4),u={},l=function(e){function t(){r(this,t);var n=o(this,e.call(this));return n.recordedChunks=[],n.isRecording=!1,n.contentTypes=["video/mp4;codecs=opus","video/webm","video/webm;codecs=h264","video/x-matroska;codecs=opus","video/invalid"],n}return a(t,e),t.init=function(e){u=e||window.Logger},t.prototype.validation=function(e){return e.filter(function(e){return MediaRecorder.isTypeSupported(e)})},t.prototype.format=function(){var e=this,t=this.stream,n=this.option;return new Promise(function(i,r){if(/(LocalMediaStream|MediaStream)/.test(t.constructor)&&(t=[t]),t.constructor!==Array)return r("音视频录制输入错误");if("audio"===n.type)return e.audioController=new c["default"]({stream:t,uid:e.uid}),e.opStream=e.audioController.outputStream,window.audios=e.opStream,i();var o=new MediaStream;return t.forEach(function(e){e&&/(LocalMediaStream|MediaStream)/.test(e.constructor)&&e.getTracks().forEach(function(e){o.addTrack(e)})}),0===o.getTracks().length?r("当前没有任何音视频数据，无法进行录制"):(e.opStream=o,void i())})},t.prototype.start=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"video"};if(!n.uid)return Promise.reject("需要录制的帐号缺失");if(!e)return Promise.reject("获取视频流失败");if(!window.MediaRecorder||!MediaRecorder.isTypeSupported)return Promise.reject("当前浏览器不支持音视频录制功能");this.stream=e,this.option=n,"audio"===n.type&&(this.contentTypes=["audio/wav","audio/ogg","audio/pcm","audio/webm"]);var i=this.mimeType=this.validation(this.contentTypes)[0];return i?this.isRecording?Promise.reject("音视频正在录制中，请勿重复操作"):this.format().then(function(){return t._start()})["catch"](function(e){return Promise.reject(e)}):Promise.reject("当前浏览器不支持对应格式的视频录制")},t.prototype._start=function(){var e={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:this.mimeType},t=this.recorder=new MediaRecorder(this.opStream,e);return t.ondataavailable=this.ondataavailable.bind(this),t.onstop=this.onstop.bind(this),this.isRecording=!0,this.status="started",this.recorder.start(),this.startTimer(),Promise.resolve(this.option)},t.prototype.stop=function(e){if(!this.isRecording||!this.recorder)return Promise.reject("请先开启音视频录制");if(this.status="stopped",u.log("MediaRecorder: stop event",this.recorder.state),"inactive"===this.recorder.state)return u.warn("MediaRecorder already stopped:",this.recorder.state),Promise.reject("音视频录制已结束，请勿重复操作");var t=(this.option.account||this.option.uid)+"--"+Date.now()+"--"+(this.option.type||"video");return this.fileName=e||t,this.recorder.stop(),Promise.resolve()},t.prototype.leave=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isRecording&&this.recorder){var t=e.uid;t&&this.option&&this.option&&t===+this.option.uid&&this.stop()}},t.prototype.ondataavailable=function(e){return u.log("MediaRecorder: data received"),e.data.size>0?void this.recordedChunks.push(e.data):(this.stop(),Promise.reject("获取视频流失败"))},t.prototype.onstop=function(){if(u.log("MediaRecorder: onstop"),"stopped"!==this.status)return this._start();var e=new Blob(this.recordedChunks,{type:this.mimeType}),t=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=t,n.download=(this.fileName||Date.now())+".webm",n.click(),window.URL.revokeObjectURL(t),this.destroy(),this.clearTimer(),this.emit("stopRecord")},t.prototype.pause=function(){this.recorder&&this.recorder.pause()},t.prototype.resume=function(){this.recorder&&this.recorder.resume()},t.prototype.destroy=function(){this.stream=null,this.recorder=null,this.recordedChunks=[],this.isRecording=!1,this.audioController&&this.audioController.destroy(),this.audioController=null,this.fileName=this.fileNameDefault="",this.option={},this.status=""},t.prototype.startTimer=function(){var e=this;this.timer||(this.timer=setInterval(function(){u.log((new Date).toLocaleString()+" --> MediaRecorder status: "+e.recorder.state),u.log(e.opStream.getTracks())},2e3))},t.prototype.clearTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},t}(d);t["default"]=l,e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(89),s=n(4),c={},d=function(e){function t(n){i(this,t);var o=r(this,e.call(this));return o.isRemote=!!n.isRemote,o.constraint=n.constraint||{},o.stream=n.stream,o.audioStream=n.stream,o.container=n.container,o.uid=n.uid||"",o.isAudio="audio"===n.type,o.initNode(),o.videoRatioIntervalId=null,o.startVideoRatioMonitor(),o}return o(t,e),t.init=function(e){c=e||window.console},t.destroyMedia=function(e){var t=this;if(e){var n=e.getTracks();n&&0!==n.length&&n.forEach(function(n){c.log("destroy track",t.uid||e.id,n),n.stop(),e.removeTrack(n)})}},t.getLocalStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},n=e.audio?"audio":"";return navigator.mediaDevices.getUserMedia(e).then(function(i){return"audio"===n?i:new t({stream:i,type:n,isRemote:!1,constraint:e})})["catch"](function(e){var t="启动设备失败: "+e.name;return Promise.reject(t)})},t.prototype.initNode=function(){if(!this.node){var e=this.stream.getVideoTracks();0===e.length?(this.isAudio=!0,this.initAudioNode()):this.initVideoNode(),this.isRemote&&!this.isAudio&&this.initVideoEvent()}},t.prototype.initAudioNode=function(){this.audioStream=this.stream,this.webAudio=new a({stream:this.audioStream,uid:this.uid,isAnalyze:!0,isRemote:this.isRemote}),this.stream=this.webAudio.outputStream,this.node=document.createElement("audio"),this.node.dataset.uid=this.uid},t.prototype.initVideoNode=function(){var e=this,t=document.createElement("div");t.style.overflow="hidden",t.style.position="relative",t.style.width="100px",t.style.height="100px",t.style.display="none";var n=document.createElement("video");n.dataset.uid=this.uid,n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%,-50%)",t.appendChild(n),this.node=n,this.videoContainer=t,setTimeout(function(){e.videoContainer&&(e.videoContainer.style.display="inline-block")},1e3)},t.prototype.initVideoEvent=function(){},t.prototype.setMuted=function(e){this.node&&(this.muted=!!e,this.node.muted=!!e,this.setPlayVolume())},t.prototype.getMuted=function(){return!!this.muted},t.prototype.setPlayVolume=function(e){var t=void 0;e?(e.constructor===Number&&(t=e),e.constructor===Object&&(t=void 0===e.volume?1:e.volume)):t=this.volume,this.volume=t,this.getMuted()||this.node&&(t=void 0===t||t>1?1:t,this.node.volume=t)},t.prototype.getPlayVolume=function(){return void 0!==this.volume?this.volume:1},t.prototype.setGain=function(e){if(this.stream&&!this.isRemote){if(void 0===e&&(e=1),this.gainOff)return this.gain=e,e;this.webAudio&&this.webAudio.setGain(e),this.gain=e}},t.prototype.getGain=function(){return void 0!==this.gain?this.gain:1},t.prototype.setGainOff=function(){this.stream&&!this.isRemote&&(this.webAudio&&this.webAudio.setGain(0),this.gainOff=!0)},t.prototype.setGainOn=function(){this.stream&&!this.isRemote&&(this.webAudio&&this.webAudio.setGain(void 0!==this.gain?this.gain:1),this.gainOff=!1)},t.prototype.show=function(e){if(this.node){if(this.isAudio)return this.node.srcObject=this.audioStream,this.play(),void(this.enable=!0);var t=this.videoContainer;e=this.container=e||this.container,t&&e&&(t.parentNode&&t.parentNode===t||(t.parentNode&&t.parentNode.removeChild(t),e.appendChild(t)),this.node.srcObject||(this.node.srcObject=this.stream),this.play(),this.enable=!0)}},t.prototype.hide=function(){var e=this.videoContainer;e&&(this.node.paused||this.node.pause(),e.parentNode&&e.parentNode.removeChild(e),this.enable=!1)},t.prototype.updateStream=function(e){var n=this.node;if(n&&e){if(this.isAudio)return c.log("更新音频流:",e),this.audioStream&&t.destroyMedia(this.audioStream),this.webAudio&&(this.webAudio.updateStream(e),this.stream=this.webAudio.outputStream),void(this.audioStream=e);t.destroyMedia(this.stream),this.stream=e,n.srcObject=this.stream,c.log("更新视频流:",e)}},t.prototype.isShown=function(){return this.node&&this.node.srcObject&&this.enable},t.prototype.removeTrack=function(e){var t=this.stream;t&&t.removeTrack(e)},t.prototype.resize=function(e){if(this.node&&this.videoContainer&&!this.isAudio&&e&&e.width&&e.height){if(e.cut=void 0===e.cut||e.cut,this.resizeOptions=e,this.videoContainer.style.width=e.width+"px",this.videoContainer.style.height=e.height+"px",!e.cut)return this.node.style.height="100%",void(this.node.style.width="100%");if(this.node.videoWidth&&this.node.videoHeight){var t=this.node.videoWidth,n=this.node.videoHeight,i=t/n,r=e.width/e.height;i>r?(this.node.style.height="100%",this.node.style.width="auto"):(this.node.style.width="100%",this.node.style.height="auto")}else this.node.width=e.width,this.node.height=e.height}},t.prototype.startVideoRatioMonitor=function(){var e=this;this.isAudio||null===this.videoRatioIntervalId&&(this.preVideoWidth=this.node.videoWidth,this.preVideoHeight=this.node.videoHeight,this.videoRatioIntervalId=setInterval(function(){e.resizeOptions&&(e.preVideoWidth===e.node.videoWidth&&e.preVideoHeight===e.node.videoHeight||(e.resize(e.resizeOptions),e.preVideoWidth=e.node.videoWidth,e.preVideoHeight=e.node.videoHeight))},1e3))},t.prototype.getAudioVolume=function(){return this.webAudio&&this.webAudio.getVolumeData()||0},t.prototype.getMetaWidth=function(e){if(this.node&&!this.isAudio)return this.node.videoWidth},t.prototype.getMetaHeight=function(e){if(this.node&&!this.isAudio)return this.node.videoHeight},t.prototype.resume=function(){this.play()},t.prototype.pause=function(){this.node.pause()},t.prototype.play=function(){var e=this.node;4!==e.readyState&&e.load(),0!==e.played.length&&e.pause(),e.play()["catch"](function(e){c.log("mediaStream:",e)}),this.isAudio&&this.setMuted(!1)},t.prototype.stopDevice=function(){this.isAudio?(t.destroyMedia(this.audioStream),this.audioStream=null):(t.destroyMedia(this.stream),this.stream=null)},t.prototype.destroy=function(){this.hide(),this.node&&(this.node.pause(),this.node=null),this.videoContainer=null,this.stream&&(t.destroyMedia(this.audioStream),this.isRemote||t.destroyMedia(this.stream),this.stream=null,this.audioStream=null,null!==this.videoRatioIntervalId&&(clearInterval(this.videoRatioIntervalId),this.videoRatioIntervalId=null),this.webAudio&&this.webAudio.context&&this.webAudio.destroy&&this.webAudio.destroy())},t}(s);t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i=n(217),r={},o=200,a={};t["default"]={init:function(e){a=e||window.console},fnShake:function(e){var t=this,n=e.fn,i=e.peer,s=void 0===i?{}:i;if(n)return s.id||(s.id=Object.keys(r).length+1),n="_"+n,r[s.id]||(r[s.id]={}),r[s.id]&&r[s.id][n]&&(a.log("destroy "+n+" timer"),clearTimeout(r[s.id][n]),r[s.id][n]=null),a.log("create "+n+" timer"),new Promise(function(i,a){r[s.id][n]=setTimeout(function(){r[s.id][n]=null,i(t[n](e))},o)})},createOffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fnShake({peer:e,fn:"createOffer"})},_createOffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer;return a.log("------ do createoffer ------"),t.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1})},formatSdp:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offerOrAnswer,n=e.uid,r=e.cid,o=e.highAudio,s=e.stero,c=e.stream||new MediaStream,d=t.sdp,u=[],l=i.parse(d);a.log("原始sdp "+t.type+" \n",d),a.log(l);var p=c.getAudioTracks()[0],f=c.getVideoTracks()[0],h=void 0;return l.media&&l.media.forEach(function(e,i){if(e.candidates&&delete e.candidates,(/audio/.test(e.type)&&!p||/video/.test(e.type)&&!f)&&delete e.ssrcs&&delete e.ssrcGroups&&delete e.msid,"audio"===e.type&&(h=e),"video"===e.type&&f&&e.ssrcs.map(function(e){/^label$/.test(e.attribute)&&e.value!==f.id&&u.push(e.id)}),navigator.mozGetUserMedia?e.bandwidth=[{type:"TIAS",limit:800}]:e.bandwidth=[{type:"AS",limit:800}],e.iceUfrag&&(e.iceUfrag=r+"/"+n),"audio"===e.type&&(e.ptime=60,e.maxptime=60,e.fmtp&&e.fmtp.length)){var a=!1,c=o?48e3:16e3;e.fmtp.forEach(function(e){e.config&&e.config.indexOf("minptime=")!==-1&&(e.config=e.config.replace(/minptime=\d+/,"minptime=60")),e.config&&e.config.indexOf("sprop-maxcapturerate=")!==-1&&e.config.indexOf("maxplaybackrate")!==-1&&(a=!0,e.config=e.config.replace(/sprop-maxcapturerate=\d+/,"sprop-maxcapturerate="+c),e.config=e.config.replace(/maxplaybackrate=\d+/,"maxplaybackrate="+c)),a||(e.config+=";maxplaybackrate="+c+";sprop-maxcapturerate="+c),s&&(e.config+=";maxaveragebitrate=131072;stereo=1;sprop-stereo=1;cbr=1")})}if("offer"===t.type){var d=e.mid;e.mid=r+"-"+n+"_"+i,l.groups&&l.groups.forEach(function(t){var n=t.mids.split(" ");n.indexOf(d)!==-1&&(n.splice(n.indexOf(d),1,e.mid),t.mids=n.join(" "))})}}),t.sdp=i.write(l),u.length>0&&u.map(function(e){var n=new RegExp("a=ssrc:"+e+".+\\r\\n","gi");t.sdp=t.sdp.replace(n,"")}),t},formatSSRCChrome:function(e,t,n){return e.map(function(e,i){return e.id=t+"0"+n+"0"+Math.floor(i/4),e.id-=0,e})},formatSSRCFirefox:function(e,t,n){return e.map(function(e,i){return e.id=t+"0"+n+"0"+Math.floor(i/4),e.id-=0,e})},formatSdpRemote:function(e){var t=/Chrome/gi.test(navigator.userAgent);return t?this.formatSdpRemoteChrome(e):this.formatSdpRemoteFirefox(e)},formatSdpRemoteChrome:function(e){return e=e.replace(/a=msid:.+\r\na=ssrc:\d+ cname:.+/gi,function(e,t){var n=e.match(/a=ssrc:(\d+)/),i=e.match(/a=msid:(.+) (.+)/);return n[1]&&(e=e.replace("a=msid","a=ssrc:"+n[1]+" msid")),i[1]&&n[1]&&(e+="\r\na=ssrc:"+n[1]+" mslabel:"+i[1]),i[2]&&n[1]&&(e+="\r\na=ssrc:"+n[1]+" label:"+i[2]),e}),a.log("formated: \n",e),e},formatSdpRemoteFirefox:function(e){return e=e.replace(/\r\na=msid:.+\r\na=ssrc:\d+ cname:.+/gi,function(e,t){var n=e.match(/\r\na=ssrc:\d+ cname:.+/);return e=e.replace(/a=ssrc:\d+ cname:.+/,""),e=e.replace("a=msid",n[0]+"\r\na=msid")}),a.log("formated: \n",e),e},parse:function(e){var t=i.parse(e);a.log(t)},updateMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="updateMediaStream",this.fnShake(e)},_updateMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer,n=e.currStream,i=e.streams,r=void 0===i?[]:i,o=this.checkCurrStream(t),s={},c=t,d=n||new MediaStream;r.forEach(function(e){e.getTracks().forEach(function(e){s[e.id]=e})});var u=Object.keys(o.tracks).filter(function(e){return!s[e]}),l=Object.keys(s).filter(function(e){return!o.tracks[e]});return u&&u.forEach(function(e){var t=o.tracks[e].sender,n=o.tracks[e].track;a.warn("remove old track",n),d.removeTrack(n),c.removeTrack(t)}),l&&l.forEach(function(e){var t=s[e];a.log("add new track",t),d.addTrack(t),c.addTrack(t,d)}),this.checkCurrStream(t),Promise.resolve(d)},checkCurrStream:function(e){a.log("current track status:");var t={},n=e.getSenders();return n&n.forEach(function(e){var n=e.track;t[n.id]={sender:e,track:n},a.log(" --> track id:",n.kind+":"+n.id)}),{tracks:t}},checkMediaStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audio,n=e.video,r=e.sdp,o=e.uid,s={audio:!1,video:!1},c=i.parse(r),d=t&&t.getAudioTracks()[0],u=n&&n.getVideoTracks()[0];return a.log(o+" checkMediaStatus ----> track status",c),d&&a.log("audioTrack ----> ",d),u&&a.log("videoTrack ----> ",u),s.audio=d&&"ended"!==d.readyState&&new RegExp(d.id).test(r),s.video=u&&"ended"!==u.readyState&&new RegExp(u.id).test(r),s}},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={randomSSRC:function(){var e=Math.floor(1e8*Math.random())+1e7;return e>1e8?99999999:e},_createLocalDescription:function(e,t){function n(e,n){var a={};switch(a.type=n,n){case"audio":case"video":a.protocol="RTP/SAVPF",a.port=9,a.direction="sendrecv";break;case"application":a.protocol="DTLS/SCTP",a.port=0,a.payloads="0",a.direction="inactive"}a.connection={ip:"127.0.0.1",version:4},a.mid=e,a.iceUfrag=r.usernameFragment,a.icePwd=r.password,a.candidates=[];for(var l=o,p=Array.isArray(l),f=0,l=p?l:l[Symbol.iterator]();;){var h;if(p){if(f>=l.length)break;h=l[f++]}else{if(f=l.next(),f.done)break;h=f.value}var m=h,v={};v.component=1,v.foundation=m.foundation,v.ip=m.ip,v.port=m.port,v.priority=m.priority,v.transport=m.protocol.toLowerCase(),v.type=m.type,"tcp"===v.transport&&(v.tcptype=m.tcpType),a.candidates.push(v)}if(a.endOfCandidates="end-of-candidates","offer"===t?a.setup="actpass":a.setup="server"===s.role?"active":"passive","audio"===n||"video"===n){a.rtp=[],a.rtcpFb=[],a.fmtp=[];for(var g=[],y=c.codecs,S=Array.isArray(y),b=0,y=S?y:y[Symbol.iterator]();;){var C;if(S){if(b>=y.length)break;C=y[b++]}else{if(b=y.next(),b.done)break;C=b.value}var T=C;if(!T.kind||T.kind===n){g.push(T.preferredPayloadType);var _={codec:T.name,payload:T.preferredPayloadType,rate:T.clockRate};if(T.numChannels>1&&(_.encoding=T.numChannels),a.rtp.push(_),T.parameters){for(var R={config:"",payload:T.preferredPayloadType},w=Object.keys(T.parameters),E=Array.isArray(w),O=0,w=E?w:w[Symbol.iterator]();;){var P;if(E){if(O>=w.length)break;P=w[O++]}else{if(O=w.next(),O.done)break;P=O.value}var A=P;R.config&&(R.config+=";"),R.config+=A+"="+T.parameters[A]}R.config&&a.fmtp.push(R)}for(var I=T.rtcpFeedback||[],k=Array.isArray(I),M=0,I=k?I:I[Symbol.iterator]();;){var D;if(k){if(M>=I.length)break;D=I[M++]}else{if(M=I.next(),M.done)break;D=M.value}var x=D;a.rtcpFb.push({payload:T.preferredPayloadType,subtype:x.parameter||void 0,type:x.type})}}}0===g.length?(a.payloads="9",a.port=0,a.direction="inactive"):a.payloads=g.join(" "),a.ssrcs=[],a.ssrcGroups=[];for(var L=d.values(),j=Array.isArray(L),N=0,L=j?L:L[Symbol.iterator]();;){var U;if(j){if(N>=L.length)break;U=L[N++]}else{if(N=L.next(),N.done)break;U=N.value}var V=U,B=V.rtpSender,F=V.stream.id,H=B.track;if("ended"!==H.readyState&&H.kind===n){V.ssrc||(V.ssrc=this.randomSSRC());var G=u&&"video"===H.kind;G&&!V.rtxSsrc&&(V.rtxSsrc=V.ssrc+1),a.ssrcs.push({attribute:"cname",id:V.ssrc,value:CNAME}),a.ssrcs.push({attribute:"msid",id:V.ssrc,value:F+" "+H.id}),a.ssrcs.push({attribute:"mslabel",id:V.ssrc,value:F}),a.ssrcs.push({attribute:"label",id:V.ssrc,value:H.id}),G&&(a.ssrcs.push({attribute:"cname",id:V.rtxSsrc,value:CNAME}),a.ssrcs.push({attribute:"msid",id:V.rtxSsrc,value:F+" "+H.id}),a.ssrcs.push({attribute:"mslabel",id:V.rtxSsrc,value:F}),a.ssrcs.push({attribute:"label",id:V.rtxSsrc,value:H.id}),a.ssrcGroups.push({semantics:"FID",ssrcs:V.ssrc+" "+V.rtxSsrc}))}}a.ext=[];for(var W=c.headerExtensions,Y=Array.isArray(W),z=0,W=Y?W:W[Symbol.iterator]();;){var K;if(Y){if(z>=W.length)break;K=W[z++]}else{if(z=W.next(),z.done)break;K=z.value}var J=K;J.kind&&J.kind!==n||a.ext.push({value:J.preferredId,uri:J.uri})}a.rtcpMux="rtcp-mux",a.rtcpRsize="rtcp-rsize"}i.media.push(a)}var i={},r=this._iceGatherer.getLocalParameters(),o=this._iceGatherer.getLocalCandidates(),a=this._dtlsTransport.getLocalParameters(),s=this._dtlsTransport.getRemoteParameters(),c=this._localCapabilities,d=this._localTrackInfos;"offer"===t&&this._sdpGlobalFields.version++,i.version=0,i.origin={address:"127.0.0.1",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"jitsi-ortc-webrtc-shim"},i.name="-",i.timing={start:0,stop:0},i.msidSemantic={semantic:"WMS",token:"*"},i.groups=[{mids:Array.from(this._mids.keys()).join(" "),type:"BUNDLE"}],i.media=[],i.fingerprint={hash:a.fingerprints[0].value,type:a.fingerprints[0].algorithm};for(var u=!1,l=c.codecs,p=Array.isArray(l),f=0,l=p?l:l[Symbol.iterator]();;){var h;if(p){if(f>=l.length)break;h=l[f++]}else{if(f=l.next(),f.done)break;h=f.value}var m=h;if("video"===m.kind&&"rtx"===m.name){u=!0;break}}for(var v=this._mids,g=Array.isArray(v),y=0,v=g?v:v[Symbol.iterator]();;){var S;if(g){if(y>=v.length)break;S=v[y++]}else{if(y=v.next(),y.done)break;S=y.value}var b=S,C=b[0],T=b[1];n.call(this,C,T)}var _=new RTCSessionDescription({type:t,_sdpObject:i});return _},mergeConstraints:function(e,t){if(!e||!t)return e||t;var n=e;for(var i in t)n[i]=t[i];return n},iceCandidateType:function(e){return e.split(" ")[7]},formatTypePreference:function(e){if(/Chrome\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TLS";case 1:return"TURN/TCP";case 2:return"TURN/UDP"}else if(/Firefox\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TCP";case 5:return"TURN/UDP"}return""},maybeSetOpusOptions:function(e,t){return"true"===t.opusStereo?e=this.setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=this.removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=this.setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=this.removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=this.setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=this.removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=this.setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},maybeSetAudioSendBitRate:function(e,t){return t.audioSendBitrate?(console.log("Prefer audio send bitrate: "+t.audioSendBitrate),this.preferBitRate(e,t.audioSendBitrate,"audio")):e},maybeSetAudioReceiveBitRate:function(e,t){return t.audioRecvBitrate?(console.log("Prefer audio receive bitrate: "+t.audioRecvBitrate),this.preferBitRate(e,t.audioRecvBitrate,"audio")):e},maybeSetVideoSendBitRate:function(e,t){return t.videoSendBitrate?(console.log("Prefer video send bitrate: "+t.videoSendBitrate),this.preferBitRate(e,t.videoSendBitrate,"video")):e},maybeSetVideoReceiveBitRate:function(e,t){return t.videoRecvBitrate?(console.log("Prefer video receive bitrate: "+t.videoRecvBitrate),this.preferBitRate(e,t.videoRecvBitrate,"video")):e},preferBitRate:function(e,t,n){var i=e.split("\r\n"),r=this.findLine(i,"m=",n);if(null===r)return console.log("Failed to add bandwidth line to sdp, as no m-line found"),e;var o=this.findLineInRange(i,r+1,-1,"m=");null===o&&(o=i.length);var a=this.findLineInRange(i,r+1,o,"c=");if(null===a)return console.log("Failed to add bandwidth line to sdp, as no c-line found"),e;var s=this.findLineInRange(i,a+1,o,"b=AS");s&&i.splice(s,1);var c="b=AS:"+t;return i.splice(a+1,0,c),e=i.join("\r\n")},maybeSetVideoSendInitialBitRate:function(e,t){var n=t.videoSendInitialBitrate;if(!n)return e;var i=n,r=t.videoSendBitrate;r&&(n>r&&(console.log("Clamping initial bitrate to max bitrate of "+r+" kbps."),n=r,t.videoSendInitialBitrate=n),i=r);var o=e.split("\r\n"),a=this.findLine(o,"m=","video");if(null===a)return console.log("Failed to find video m-line"),e;var s=t.videoRecvCodec;return e=this.setCodecParam(e,s,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=this.setCodecParam(e,s,"x-google-max-bitrate",i.toString())},removePayloadTypeFromMline:function(e,t){e=e.split(" ");for(var n=0;n<e.length;++n)e[n]===t.toString()&&e.splice(n,1);return e.join(" ")},removeCodecByName:function(e,t){var n=this.findLine(e,"a=rtpmap",t);if(null===n)return e;var i=this.getCodecPayloadTypeFromLine(e[n]);e.splice(n,1);var r=this.findLine(e,"m=","video");return null===r?e:(e[r]=this.removePayloadTypeFromMline(e[r],i),e)},removeCodecByPayloadType:function(e,t){var n=this.findLine(e,"a=rtpmap",t.toString());if(null===n)return e;e.splice(n,1);var i=this.findLine(e,"m=","video");return null===i?e:(e[i]=this.removePayloadTypeFromMline(e[i],t),e)},maybeRemoveVideoFec:function(e,t){if("false"!==t.videoFec)return e;var n=e.split("\r\n"),i=this.findLine(n,"a=rtpmap","red");if(null===i)return e;var r=this.getCodecPayloadTypeFromLine(n[i]);if(n=this.removeCodecByPayloadType(n,r),n=this.removeCodecByName(n,"ulpfec"),i=this.findLine(n,"a=fmtp",r.toString()),null===i)return e;var o=this.parseFmtpLine(n[i]),a=o.pt;return null===a?e:(n.splice(i,1),n=this.removeCodecByPayloadType(n,a),n.join("\r\n"))},maybePreferAudioSendCodec:function(e,t){return this.maybePreferCodec(e,"audio","send",t.audioSendCodec)},maybePreferAudioReceiveCodec:function(e,t){return this.maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},maybePreferVideoSendCodec:function(e,t){return this.maybePreferCodec(e,"video","send",t.videoSendCodec)},maybePreferVideoReceiveCodec:function(e,t){return this.maybePreferCodec(e,"video","receive",t.videoRecvCodec)},maybePreferCodec:function(e,t,n,i){var r=t+" "+n+" codec";if(!i)return console.log("No preference on "+r+"."),e;console.log("Prefer "+r+": "+i);var o=e.split("\r\n"),a=this.findLine(o,"m=",t);if(null===a)return e;var s=this.getCodecPayloadType(o,i);return s?o[a]=this.setDefaultCodec(o[a],s):console.error("no prefered codec found for ",i),e=o.join("\r\n")},setCodecParam:function(e,t,n,i){var r=e.split("\r\n"),o=this.findFmtpLine(r,t),a={};if(null===o){var s=this.findLine(r,"a=rtpmap",t);if(null===s)return e;var c=this.getCodecPayloadTypeFromLine(r[s]);a.pt=c.toString(),a.params={},a.params[n]=i,r.splice(s+1,0,this.writeFmtpLine(a))}else a=this.parseFmtpLine(r[o]),a.params[n]=i,r[o]=this.writeFmtpLine(a);return e=r.join("\r\n")},removeCodecParam:function(e,t,n){var i=e.split("\r\n"),r=this.findFmtpLine(i,t);if(null===r)return e;var o=this.parseFmtpLine(i[r]);delete o.params[n];var a=this.writeFmtpLine(o);return null===a?i.splice(r,1):i[r]=a,e=i.join("\r\n")},parseFmtpLine:function(e){var t={},n=e.indexOf(" "),i=e.substring(n+1).split("; "),r=new RegExp("a=fmtp:(\\d+)"),o=e.match(r);if(!o||2!==o.length)return null;t.pt=o[1];for(var a={},s=0;s<i.length;++s){var c=i[s].split("=");2===c.length&&(a[c[0]]=c[1])}return t.params=a,t},writeFmtpLine:function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,n=e.params,i=[],r=0;for(var o in n)i[r]=o+"="+n[o],++r;return 0===r?null:"a=fmtp:"+t.toString()+" "+i.join("; ")},findFmtpLine:function(e,t){var n=this.getCodecPayloadType(e,t);return n?this.findLine(e,"a=fmtp:"+n.toString()):null},findLine:function(e,t,n){return this.findLineInRange(e,0,-1,t,n)},findLineInRange:function(e,t,n,i,r){for(var o=n!==-1?n:e.length,a=t;a<o;++a)if(0===e[a].indexOf(i)&&(!r||e[a].toLowerCase().indexOf(r.toLowerCase())!==-1))return a;return null},getCodecPayloadType:function(e,t){var n=this.findLine(e,"a=rtpmap",t);return n?this.getCodecPayloadTypeFromLine(e[n]):null},getCodecPayloadTypeFromLine:function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null},setDefaultCodec:function(e,t){var n=e.split(" "),i=n.slice(0,3);i.push(t);for(var r=3;r<n.length;r++)n[r]!==t&&i.push(n[r]);return i.join(" ")}},e.exports=t["default"]},function(e,t,n){"use strict";function i(e){
return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=n(4),c=i(s),d={K:{framesEncoded:1,qpSum:1,audioOutputLevel:1,googDecodingCTN:1,googDecodingNormal:1,googAvailableSendBandwidth:1,googTargetEncBitrate:1,googActualEncBitrate:1,googRetransmitBitrate:1,googTransmitBitrate:1},T:{googCaptureStartNtpTimeMs:1}},u=function(e){function t(n){r(this,t);var i=o(this,e.call(this));return i.controller=n.controller||{},i.uid=0,i.interval=1e3,i.init(),i}return a(t,e),t.prototype.init=function(){this.reset()},t.prototype.reset=function(){this.peer=null,this.statsTimer=null,this.lastStats=null},t.prototype.start=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.interval;if(this.statsTimer&&clearInterval(this.statsTimer),!e)throw Error("no peer for stats");this.peer=e,this.uid=this.controller.imInfo.uid,this.interval=t,this.statsTimer=setInterval(this.getStats.bind(this),t)},t.prototype.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.peer&&"closed"!==this.peer.signalingState&&this.peer.close(),this.reset())},t.prototype.getStats=function(){var e=this;this.peer.getStats(function(t){var n={},i=t.result();i.forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n[t.id]=t}),n=e.format(n),e.emit("stats",n),e.lastStats=n})},t.prototype.format=function(e){return!this.peer||/(failed|closed)/gi.test(this.peer.iceConnectionState)?void this.stop():(e=this.ssrcLocal(e),e=this.ssrcRemote(e))},t.prototype.getUidBySSRC=function(e,t){var n=void 0;n=/Chrome/gi.test(navigator.userAgent)?new RegExp("a=ssrc:"+e+" msid:(.+) (.+)"):new RegExp("a=msid:(.+) (.+)[.\\r\\n\\s\\S]*a=ssrc:"+e);var i=t.match(n);return i&&i[1]?this.controller.getUidByMsid(i[1])||0:0},t.prototype.formatSSRC=function(e,t,n){var i=this,r={};return Object.values(e).map(function(e){if(/^(bweforvideo|ssrc_)/gi.test(e.id)){e=i.formatData(e);var o=new RegExp("ssrc_(\\d+)_"+n),a=e.id.match(o),s=e.id;if(r[s]=e,a&&a[1]){var c="send"===n?i.uid:i.getUidBySSRC(e.ssrc,t);if("recv"===n&&0===c)return void delete r[s];e.id="ssrc_"+a[1]+"_"+c+"_"+n+"_"+e.mediaType,"send"===n&&(e.bitsSentPerSecond=i.getLastStats(e.id,"bytesSent",e),e.packetsSentPerSecond=i.getLastStats(e.id,"packetsSent",e)),"recv"===n&&(e.bitsReceivedPerSecond=i.getLastStats(e.id,"bytesReceived",e),e.packetsReceivedPerSecond=i.getLastStats(e.id,"packetsReceived",e)),r[e.id]=e,delete r[s]}}}),r},t.prototype.formatData=function(e){return Object.keys(e).map(function(t){d.K[t]&&(e[t]=(e[t]/1024).toFixed(2)),d.T[t]&&(e[t]=(e[t]/1024/1024).toFixed(2))}),e},t.prototype.ssrcLocal=function(e){var t=this.peer.localDescription;return this.formatSSRC(e,t.sdp,"send")},t.prototype.ssrcRemote=function(e){var t=this.peer.remoteDescription;return this.formatSSRC(e,t.sdp,"recv")},t.prototype.getLastStats=function(e,t,n){var i=null;return i=this.lastStats&&this.lastStats[e]?n[t]-this.lastStats[e][t]:n[t],i=/bytes/gi.test(t)?(8*i*1e3/this.interval/1024).toFixed(2):1e3*i/this.interval},t}(c["default"]);t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=n(4),c=i(s),d=function(e){function t(n){r(this,t);var i=o(this,e.call(this));return i.peer=n.peer,i.mediaStreamTrack=n.mediaStreamTrack,i.interval=5e3,i.init(),i}return a(t,e),t.prototype.init=function(){this.reset(),this.initStatsResult(),this.initStatsParser(),this.initStatsParserFn()},t.prototype.reset=function(){this.nomore=!1,this.AUDIO_codecs=["opus","isac","ilbc"],this.VIDEO_codecs=["vp9","vp8","h264"],this.SSRC={audio:{send:[],recv:[]},video:{send:[],recv:[]}},this.LOCAL_candidateType=[],this.LOCAL_transport=[],this.LOCAL_ipAddress=[],this.LOCAL_networkType=[],this.REMOTE_candidateType=[],this.REMOTE_transport=[],this.REMOTE_ipAddress=[],this.REMOTE_networkType=[]},t.prototype.initStatsResult=function(){var e=((navigator.connection||{}).type||"unknown").toString().toLowerCase();this.statsResult={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},results:{},connectionType:{systemNetworkType:e,systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){nomore=!0})}},t.prototype.initStatsParser=function(){var e=this;this.statsParser={checkIfOfferer:function(t){"googLibjingleSession"===t.type&&(e.statsResult.isOfferer=t.googInitiator)}}},t.prototype.initStatsParserFn=function(){var e=this.AUDIO_codecs,t=this.VIDEO_codecs,n=this.SSRC,i=this.statsParser,r=this.statsResult,o=this.LOCAL_candidateType,a=this.LOCAL_transport,s=this.LOCAL_ipAddress,c=this.LOCAL_networkType,d=this.REMOTE_candidateType,u=this.REMOTE_transport,l=this.REMOTE_ipAddress,p=this.REMOTE_networkType;i.datachannel=function(e){"datachannel"===e.type&&(r.datachannel={state:e.state})},i.googCertificate=function(e){"googCertificate"===e.type&&(r.encryption=e.googFingerprintAlgorithm)},i.checkAudioTracks=function(t){if(t.googCodecName&&"audio"===t.mediaType&&e.indexOf(t.googCodecName.toLowerCase())!==-1){var n=t.id.split("_").pop();if(r.audio[n].codecs.indexOf(t.googCodecName)===-1&&r.audio[n].codecs.push(t.googCodecName),t.bytesSent){var i=0;if(t.bytesSent){r.internal.audio[n].prevBytesSent||(r.internal.audio[n].prevBytesSent=t.bytesSent);var o=t.bytesSent-r.internal.audio[n].prevBytesSent;r.internal.audio[n].prevBytesSent=t.bytesSent,i=o/1024}r.audio[n].availableBandwidth=i.toFixed(1)}if(t.bytesReceived){var i=0;if(t.bytesReceived){r.internal.audio[n].prevBytesReceived||(r.internal.audio[n].prevBytesReceived=t.bytesReceived);var o=t.bytesReceived-r.internal.audio[n].prevBytesReceived;r.internal.audio[n].prevBytesReceived=t.bytesReceived,i=o/1024}t.availableBandwidth=i.toFixed(1),r.audio[n].availableBandwidth=t.availableBandwidth}r.audio[n].tracks.indexOf(t.googTrackId)===-1&&r.audio[n].tracks.push(t.googTrackId)}},i.checkVideoTracks=function(e){if(e.googCodecName&&"video"===e.mediaType&&t.indexOf(e.googCodecName.toLowerCase())!==-1){var n=e.id.split("_").pop();if(r.video[n].codecs.indexOf(e.googCodecName)===-1&&r.video[n].codecs.push(e.googCodecName),e.bytesSent){var i=0;r.internal.video[n].prevBytesSent||(r.internal.video[n].prevBytesSent=e.bytesSent);var o=e.bytesSent-r.internal.video[n].prevBytesSent;r.internal.video[n].prevBytesSent=e.bytesSent,i=o/1024}if(e.bytesReceived){var i=0;r.internal.video[n].prevBytesReceived||(r.internal.video[n].prevBytesReceived=e.bytesReceived);var o=e.bytesReceived-r.internal.video[n].prevBytesReceived;r.internal.video[n].prevBytesReceived=e.bytesReceived,i=o/1024}e.availableBandwidth=i.toFixed(1),r.video[n].availableBandwidth=e.availableBandwidth,e.googFrameHeightReceived&&e.googFrameWidthReceived&&(r.resolutions[n].width=e.googFrameWidthReceived,r.resolutions[n].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(r.resolutions[n].width=e.googFrameWidthSent,r.resolutions[n].height=e.googFrameHeightSent),r.video[n].tracks.indexOf(e.googTrackId)===-1&&r.video[n].tracks.push(e.googTrackId)}},i.bweforvideo=function(e){"VideoBwe"===e.type&&(r.video.bandwidth={googActualEncBitrate:e.googActualEncBitrate,googAvailableSendBandwidth:e.googAvailableSendBandwidth,googAvailableReceiveBandwidth:e.googAvailableReceiveBandwidth,googRetransmitBitrate:e.googRetransmitBitrate,googTargetEncBitrate:e.googTargetEncBitrate,googBucketDelay:e.googBucketDelay,googTransmitBitrate:e.googTransmitBitrate})},i.googCandidatePair=function(e){if("googCandidatePair"===e.type&&(r.connectionType.bitsSentPerSecond=8*(e.bytesSent-(r.connectionType.prevBytesSent||0))/1024/2,r.connectionType.bitsReceivedPerSecond=8*(e.bytesReceived-(r.connectionType.prevBytesReceived||0))/1024/2,r.connectionType.bitsSentPerSecond=r.connectionType.bitsSentPerSecond.toFixed(1),r.connectionType.bitsReceivedPerSecond=r.connectionType.bitsReceivedPerSecond.toFixed(1),r.connectionType.prevBytesSent=e.bytesSent,r.connectionType.prevBytesReceived=e.bytesReceived,"true"===e.googActiveConnection)){r.connectionType.local.ipAddress=e.googLocalAddress,r.connectionType.remote.ipAddress=e.googRemoteAddress,r.connectionType.transport=e.googTransportType;var t=r.internal.candidates[e.localCandidateId];t&&t.ipAddress&&(r.connectionType.systemIpAddress=t.ipAddress);var n=r.internal.candidates[e.remoteCandidateId];n&&n.ipAddress&&(r.connectionType.systemIpAddress=n.ipAddress)}},i.localcandidate=function(e){"localcandidate"===e.type&&(e.candidateType&&o.indexOf(e.candidateType)===-1&&o.push(e.candidateType),e.transport&&a.indexOf(e.transport)===-1&&a.push(e.transport),e.ipAddress&&s.indexOf(e.ipAddress+":"+e.portNumber)===-1&&s.push(e.ipAddress+":"+e.portNumber),e.networkType&&c.indexOf(e.networkType)===-1&&c.push(e.networkType),r.internal.candidates[e.id]={candidateType:o,ipAddress:s,portNumber:e.portNumber,networkType:c,priority:e.priority,transport:a,timestamp:e.timestamp,id:e.id,type:e.type},r.connectionType.local.candidateType=o,r.connectionType.local.ipAddress=s,r.connectionType.local.networkType=c,r.connectionType.local.transport=a)},i.remotecandidate=function(e){"remotecandidate"===e.type&&(e.candidateType&&d.indexOf(e.candidateType)===-1&&d.push(e.candidateType),e.transport&&u.indexOf(e.transport)===-1&&u.push(e.transport),e.ipAddress&&l.indexOf(e.ipAddress+":"+e.portNumber)===-1&&l.push(e.ipAddress+":"+e.portNumber),e.networkType&&p.indexOf(e.networkType)===-1&&p.push(e.networkType),r.internal.candidates[e.id]={candidateType:d,ipAddress:l,portNumber:e.portNumber,networkType:p,priority:e.priority,transport:u,timestamp:e.timestamp,id:e.id,type:e.type},r.connectionType.remote.candidateType=d,r.connectionType.remote.ipAddress=l,r.connectionType.remote.networkType=p,r.connectionType.remote.transport=u)},i.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(r[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(r[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},i.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();n[e.mediaType][t].indexOf(e.ssrc)===-1&&n[e.mediaType][t].push(e.ssrc),r[e.mediaType][t].streams=n[e.mediaType][t].length}}},t.prototype.start=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.interval;if(this.statsTimer&&clearInterval(this.statsTimer),!e)throw Error("no peer for stats");this.peer=e,this.interval=t,this.statsTimer=setInterval(this.getStats.bind(this),t)},t.prototype.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.reset())},t.prototype.getStats=function(){var e=this.formatResult.bind(this),t=this.peer,n=this.mediaStreamTrack;"undefined"!=typeof window.InstallTrigger?t.getStats(n,function(t){var n=[];t.forEach(function(e){n.push(e)}),e(n)},e):t.getStats(function(t){var n=[];t.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)}),e(n)})},t.prototype.formatResult=function(e){var t=this.peer,n=(this.mediaStreamTrack,this.statsParser),i=this.statsResult;e.forEach(function(e){Object.keys(n).forEach(function(t){"function"==typeof n[t]&&n[t](e)})});try{t.iceConnectionState.search(/failed/gi)!==-1&&(this.nomore=!0)}catch(r){this.nomore=!0}this.nomore===!0&&(i.datachannel&&(i.datachannel.state="close"),i.ended=!0),i.results=e,this.emit("stats",i)},t}(c["default"]);t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i=n(11);t["default"]={getAccount:function(){return this.baseGetAccount()},getUid:function(){return this.baseGetUid()},isCurrentChannelId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.baseIsCurrentChannelId(e)},notCurrentChannelId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!this.isCurrentChannelId(e)},switchVideoToAudio:function(){var e=this;return this.controller.uploadDataApi("update",{key:"switch_p2p_type"}),this.controller.switchVideoToAudio().then(function(){return e.type=i.constantRtc.NETCALL_TYPE_AUDIO,Promise.resolve()})["catch"](function(e){return Promise.resolve(e)})},switchAudioToVideo:function(){var e=this;return this.controller.uploadDataApi("update",{key:"switch_p2p_type"}),this.controller.switchAudioToVideo().then(function(){return e.type=i.constantRtc.NETCALL_TYPE_VIDEO,Promise.resolve()})["catch"](function(e){return Promise.resolve(e)})},changeRoleToPlayer:function(){return 0===this.imInfo.role?Promise.resolve({role:"player"}):(this.imInfo.role=0,this.controller.switchRole().then(function(){return Promise.resolve({role:"player"})}))},changeRoleToAudience:function(){return 1===this.imInfo.role?Promise.resolve({role:"audience"}):(this.imInfo.role=1,this.controller.switchRole().then(function(){return Promise.resolve({role:"audience"})}))},updateRtmpUrl:function(e){return this.controller.setSessionConfig({rtmpUrl:e}),this.controller.updateRtmpUrl(),Promise.resolve()},setSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.setSessionConfig(e)},setSessionVideoQuality:function(e){this.controller.setSessionVideoQuality(e)},setSessionVideoFrameRate:function(e){this.controller.setSessionVideoFrameRate(e)},setSessionAudioQuality:function(e){this.controller.setSessionAudioQuality(e)},setCaptureVolume:function(e){return e=void 0===e?1:e/255,this.controller.setCaptureVolume(e)},setPlayVolume:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.constructor===String&&(e=+e),e.constructor===Number&&(e={volume:e}),e.volume=void 0===e.volume?1:e.volume/255,e.volume=e.volume>1?1:e.volume,this.controller.setPlayVolume(e)},destroyMediaStream:function(e){this.controller.destroyMediaStream({uid:e,type:"remote"})}},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={getDevicesOfType:function(e){return this.controller.getDevicesOfType(e).then(function(e){return{devices:e}})},stopDevice:function(e){return this.controller.stopDevice(e)},startDevice:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.devices=Object.assign({},this.controller.getDeviceStatus()),this.controller.startDevice(e)}},e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i=n(7);t["default"]={startRecordMp4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.uploadDataApi("update",{key:"record"}),this.controller.startRecordMp4(e)},stopRecordMp4:function(){return this.controller.stopRecord()},startRecordAac:function(){return this.controller.uploadDataApi("update",{key:"audio_record"}),this.controller.startRecordAac()},stopRecordAac:function(){return this.controller.stopRecord()},setVideoViewSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.setVideoViewSize(e)},setVideoViewRemoteSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.setVideoViewRemoteSize(e)},startLocalStream:function(e){return this.controller.uploadDataApi("update",{key:"display"}),e=i.element.n2node(e),this.controller.startLocalStream(e)},stopLocalStream:function(){return this.controller.stopLocalStream()},startRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.node=i.element.n2node(e.node),this.controller.startRemoteStream(e)},stopRemoteStream:function(e){return this.controller.stopRemoteStream(e)},suspendLocalStream:function(){return this.controller.suspendLocalStream()},resumeLocalStream:function(){return this.controller.resumeLocalStream()},suspendRemoteStream:function(e){return this.controller.suspendRemoteStream(e)},resumeRemoteStream:function(e){return this.controller.resumeRemoteStream(e)},setAudioStart:function(e){return this.controller.setAudioStart(e)},setAudioBlack:function(e){return this.controller.setAudioBlack(e)},setVideoBlack:function(e){return this.controller.setVideoBlack(e)},setVideoShow:function(e){return this.controller.setVideoShow(e)},updateRtmpUrl:function(e){return this.controller.setSessionConfig({rtmpUrl:e}),this.controller.updateRtmpUrl(),Promise.resolve()}},e.exports=t["default"]},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=n(65),c=i(s),d=n(42),u=n(11),l=n(87),p=n(212),f=i(p),h=n(210),m=i(h),v=n(209),g=i(v),y=n(211),S=i(y),b=n(208),C=i(b),T=function(e){function t(n){r(this,t);var i=o(this,e.call(this,n));return i.logger=n.logger||{},i.resetStatus(),i.init(),i}return a(t,e),t.prototype.resetStatus=function(){this.rtc&&"closed"!==this.rtc.signalingState&&this.rtc.close(),this.stats&&this.stats.stop(),this.statsNew&&this.statsNew.stop(),this.stopAudioMonitor(),this.destroyMediaStream({type:"all"}),this._reset(),this.currRmoteOffer=null,this.rtc=null,this.rtcConnected=!1,this.reConnectCount=0,this.remote_SdpOffers=[],this.remoteUidMsidMap={},this.remoteStreamList={},this.remoteStreams={},this.remoteTrackMap={},this.currRemoteTrack={},this.deviceVideoStatus=!1,this.deviceAudioStatus=!1,this.monitorRemoteStreamStartTime=null,this.userJoinTimeoutId=null},t.prototype.init=function(){this.mediaDevices=new d.Devices,this.mediaDevices.on("deviceStatus",this.onDeviceStatusChange.bind(this)),this.mediaDevices.on("deviceAdd",this.onDeviceAdd.bind(this)),this.mediaDevices.on("deviceRemove",this.onDeviceRemove.bind(this)),this.rtcRecorder=new d.Recorder,this.initStats(),l.RtcUtil.init(this.logger),d.Recorder.init(this.logger),d.MStream.init(this.logger)},t.prototype.initStats=function(){var e=this;this.stats=new l.RtcStats({controller:this,interval:2e3}),this.stats.on("stats",function(t){e.monitorRemoteStream(t),e.uploadDataRtc(t)}),this.statsNew=new l.RtcStatsNew({controller:this,interval:1e3}),this.statsNew.on("stats",function(t){e.uploadDataRtcNew(t)})},t.prototype.startSession=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.imInfo=t,this.sessionConfig=Object.assign(this.sessionConfig,t.sessionConfig);var n=u.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});return this.imInfo=Object.assign(this.imInfo,{videoConfig:n}),this._startSession().then(function(n){return e.rtc?Promise.resolve():void(e.rtc=new f["default"]({imInfo:t,logger:e.logger,sessionConfig:e.sessionConfig,controller:e}))}).then(function(t){e.initRtcEvent()}).then(function(n){e.rtcLogin(t.sessionMode)})["catch"](function(e){return Promise.reject(e)})},t.prototype.stopSession=function(){return this.rtcLogout(),this._stopSession(),this.stopRecord()["catch"](function(e){}),this.resetStatus(),Promise.resolve()},t.prototype.initRtcEvent=function(){var e=this;this.rtc.on("sessionConnected",function(){e.emit("sessionConnected")}),this.rtc.on("ready",this.startSdp_offer.bind(this)),this.rtc.on("iceCompleted",this.startSdp_offer.bind(this)),this.rtc.on("getRemoteStream",this.onRemoteStream.bind(this)),this.rtc.on("iceCandidate",this.onLocalIceCandidate.bind(this)),this.rtc.on("negotiationneeded",this.onNegotiationNeeded.bind(this)),this.rtc.on("iceconnectionstatechange",this.onIceConnectionStateChange.bind(this)),this.mediaDevices.getDevices().then(function(t){e.emit("devices",t)})},t.prototype.rtcLogin=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"p2p";return this.setSessionConfig({rtcStartTime:Date.now()}),this.updateRtcStream(),this.createOffer(!1).then(function(){return new Promise(function(n,i){e.once("sessionConnected",function(t){e.logger.log("rtc connect success"),e.rtcConnected=!0,e.setSessionConfig({rtcEndTime:Date.now()}),e.startAudioMonitor(),e.uploadDataRtcStart(),e.uploadDataRtcNewStart(),n(t)}),e.once("rtcConnectError",function(t){e.uploadDataRtcStop(),i(t)}),"p2p"===t&&(e.userJoinTimeoutId=setTimeout(function(){i("user join timeout")},5e4))})})["catch"](function(e){return Promise.reject(e)})},t.prototype.rtcLogout=function(){var e=Date.now(),t={params:{content:{timestamp:e}}};this.sendMsg("logout",t)},t.prototype.sendMsg=function(e,t){var n={type:e,uid:this.imInfo.uid+"",cid:this.imInfo.cid+""};n=Object.assign(n,t),this.signal&&this.logger.log("sendMsg ---> "+e,n),this.signal&&this.signal.send(n)},t.prototype.onSignalMessage=function(e){if(e&&e.cid&&e.uid&&(e.cid=+e.cid,e.uid=+e.uid),e.cid!==this.imInfo.cid)return this.logger.error("websocket message not belong to this session");var t=e.type;this["on"+t]&&this["on"+t](e)},t.prototype.hangup=function(){this.stopSession(),null!==this.userJoinTimeoutId&&(clearTimeout(this.userJoinTimeoutId),this.userJoinTimeoutId=null),this.resetStatus()},t.prototype.onjoin=function(){},t.prototype.onclient_logout=function(e){var t=e.params.content.logout_type;t="normal"===t?u.constantRtc.HANGUP_TYPE_NORMAL:u.constantRtc.HANGUP_TYPE_TIMEOUT;var n=e.uid,i=e.cid;this.remoteUidMsidMap.hasOwnProperty(n)&&(this.destroyMediaStream({uid:n,type:"remote"}),this.removeRemoteUserStream(n),this.rtcRecorder&&this.rtcRecorder.leave({uid:n}),this.emit("leaveChannel",{uid:n,cid:i,type:t}))},t.prototype.startAudioMonitor=function(){function e(){var e={},t=0;this.localAudioStream&&(t=this.localAudioStream.getAudioVolume()),e.self={status:t},this.uploadDataRtc("volume",e.self.status);var n=this.remoteStreamList;for(var i in n){var r=this.info.client.getAccountWithUid(i);t=n[i]&&n[i].remoteAudioStream?n[i].remoteAudioStream.getAudioVolume():0,e[r||i]={status:t}}this.emit("audioVolume",e)}var t=this.audioMonitorTimer;t||(t=this.audioMonitorTimer=setInterval(e.bind(this),500))},t.prototype.stopAudioMonitor=function(){var e=this.audioMonitorTimer;e&&(clearInterval(e),e=this.audioMonitorTimer=null)},t}(c["default"]),_=T.prototype;_=Object.assign(_,m["default"]),_=Object.assign(_,g["default"]),_=Object.assign(_,C["default"]),_=Object.assign(_,S["default"]),t["default"]=T,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={switchRole:function(){return this.rtc?(this.updateRtcStream(),this.createOffer(!0)):Promise.resolve()},switchVideoToAudio:function(){return this.rtc?(this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null),Promise.resolve()):Promise.reject("no connection")},switchAudioToVideo:function(){return this.rtc?this.localVideoStream?(this.updateRtcStream(),this.createOffer(!0)):Promise.resolve():Promise.reject("no connection")},setSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionConfig=Object.assign(this.sessionConfig,e)},setSessionVideoQuality:function(e){void 0!==e&&this.setSessionConfig({videoQuality:e})},setSessionVideoFrameRate:function(e){void 0!==e&&this.setSessionConfig({videoFrameRate:e})},setSessionAudioQuality:function(e){this.setSessionConfig({highAudio:!!e})},startRecordMp4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,n=e.uid;if(t)if(t===this.info.client.getAccount())n=null;else if(n=this.info.client.getUidWithAccount(t),!n)return Promise.reject("账号不在本次会议中，无法进行录制");t=t||this.info.client.getAccount();var i=[];if(n){var r=this.remoteStreamList[n];if(!r)return Promise.reject("需要录制的账号不正确");r.remoteAudioStream&&i.push(r.remoteAudioStream.stream),r.remoteVideoStream&&i.push(r.remoteVideoStream.stream)}else this.localAudioStream&&i.push(this.localAudioStream.stream),this.localVideoStream&&i.push(this.localVideoStream.stream);return 0===i.length?Promise.reject("当前没有音视频数据，无法进行录制"):(n=n||t&&this.info.client.getUidWithAccount(t)||this.imInfo.uid,this.rtcRecorder.start(i,{account:t,uid:n}))},stopRecord:function(){return this.rtcRecorder.stop()},startRecordAac:function(){var e=this.info.client.getAccount(),t=this.imInfo.uid,n=[];this.localAudioStream&&n.push(this.localAudioStream.stream);var i=this.remoteStreamList;for(var r in i)i[r].remoteAudioStream&&i[r].remoteAudioStream.stream&&n.push(i[r].remoteAudioStream.stream);return this.rtcRecorder.start(n,{account:e,uid:t,type:"audio"})}},e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i=n(42),r=n(11),o={audio:null,video:null,screen:null,debounceTime:500};t["default"]={getDeviceStatus:function(){return this.mediaDevices.getDeviceStatus()},getDevicesOfType:function(e){return this.mediaDevices.getDevicesOfType(r.constantTool.getDeviceTypeMap(e)).then(function(e){return Promise.resolve(e[0])})},onDeviceStatusChange:function(e){this.logger.log("onDeviceStatusChange"),this.emit("deviceStatus",e)},onDeviceAdd:function(e){this.logger.log("onDeviceAdd"),this.emit("deviceAdd",e)},onDeviceRemove:function(e){var t=this;this.logger.log("onDeviceRemove"),(this.localVideoStream||this.localAudioStream)&&e.forEach(function(e){t.localVideoStream&&e.deviceId===t.localVideoStream.constraint.video.deviceId&&(t.localVideoStream.destroy(),t.localVideoStream=null,t.client.devices.hasVideo=!1,t.rtcConnected&&(t.updateRtcStream(),t.createOffer(!0))),t.localAudioStream&&e.deviceId===t.localAudioStream.constraint.audio.deviceId&&(t.localAudioStream.destroy(),t.localAudioStream=null,t.client.devices.hasAudio=!1)}),this.emit("deviceRemove",e)},checkDeviceStatus:function(e,t){return e===r.constantRtc.DEVICE_TYPE_VIDEO&&this.localVideoStream&&this.localVideoStream.constraint.video.deviceId===t.deviceId?(this.enableDevice(e),Promise.reject("设备已开启，重复操作")):e===r.constantRtc.DEVICE_TYPE_AUDIO_IN&&this.localAudioStream&&this.localAudioStream.audioStream&&this.localAudioStream.constraint.audio.deviceId===t.deviceId?(this.enableDevice(e),Promise.reject("设备已开启，重复操作")):Promise.resolve()},stopDevice:function(e){var t=this;return new Promise(function(n,i){if(e===r.constantRtc.DEVICE_TYPE_VIDEO){if(t.deviceVideoStatus=!1,t.localVideoStream)return t.localVideoStream.destroy(),t.localVideoStream=null,t.rtcConnected?(t.updateRtcStream(),t.createOffer(!0).then(n),n()):n()}else if(e===r.constantRtc.DEVICE_TYPE_AUDIO_IN){if(t.deviceAudioStatus=!1,t.localAudioStream)return t.localAudioStream.stopDevice(),n()}else e===r.constantRtc.DEVICE_TYPE_AUDIO_OUT_LOCAL?t.localAudioStream&&t.localAudioStream.setMuted(!0):e===r.constantRtc.DEVICE_TYPE_AUDIO_OUT_CHAT&&t.setAudioBlack();n()})},destroyDevice:function(e){this.logger.log("销毁设备",e);var t=e===r.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream";return this[t]&&this[t].destroy(),this[t]=null,Promise.resolve()},disableDevice:function(e){this.logger.log("暂停设备",e);var t=e===r.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream",n=this[t].stream&&this[t].stream.getTracks();return n.forEach(function(e){e.enabled=!1}),Promise.resolve()},enableDevice:function(e){this.logger.log("恢复设备",e);var t=e===r.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream",n=this[t].stream&&this[t].stream.getTracks();return n.forEach(function(e){e.enabled=!0}),Promise.resolve()},startDevice:function(e){var t=this;return new Promise(function(n,i){var o=e.type,a=e.device;if(o===r.constantRtc.DEVICE_TYPE_VIDEO&&(t.deviceVideoStatus=!0),o===r.constantRtc.DEVICE_TYPE_AUDIO_IN&&(t.deviceAudioStatus=!0),o===r.constantRtc.DEVICE_TYPE_AUDIO_OUT_LOCAL)return t.setAudioStart(-1),n();if(o===r.constantRtc.DEVICE_TYPE_AUDIO_OUT_CHAT)return t.setAudioStart(),n();var s=Promise.resolve();o!==r.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN&&o!==r.constantRtc.DEVICE_TYPE_DESKTOP_WINDOW&&(a&&a.deviceId||(s=t.getDevicesOfType(o))),s.then(function(e){return a=a||e&&e[0],t.checkDeviceStatus(o,a).then(function(){return o===r.constantRtc.DEVICE_TYPE_VIDEO?t.getStream("Video",a,n,i):o===r.constantRtc.DEVICE_TYPE_AUDIO_IN?t.getStream("Audio",a,n,i):o===r.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN||o===r.constantRtc.DEVICE_TYPE_DESKTOP_WINDOW?t.getStream("Screen",o,n,i):void 0})["catch"](function(e){/重复操作/.test(e)?n():i(e)})}).then(function(e){n(e)})["catch"](function(e){i(e)})})},getStream:function(e,t,n,i){var r="_get"+e+"Stream";return o[e]&&o[e].lockerTimer&&(this.logger.log("destroy "+r+" timer"),clearTimeout(o[e].lockerTimer)),this.logger.log("create "+r+" timer"),o[e]={},this[r](t,n,i)},_getVideoStream:function(e,t,n){var o=this,a={};this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null);var s={};s.deviceId=e.deviceId;var c=r.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});return s=Object.assign(s,c),a.video=s,this.logger.log("_getVideoStream",a),i.MStream.getLocalStream(a).then(function(e){o.localVideoStream=e,o.rtcConnected&&(o.updateRtcStream(),o.createOffer(!0)),t()})["catch"](function(e){n(e)})},_getAudioStream:function(e,t,n){var r=this,o={},a={};return a.deviceId=e.deviceId,o.audio=a,this.logger.log("_getAudioStream",o),i.MStream.getLocalStream(o).then(function(e){r.localAudioStream?r.localAudioStream.updateStream(e):(r.localAudioStream=new i.MStream({stream:e,type:"audio",isRemote:!1,constraint:o}),r.rtcConnected&&(r.updateRtcStream(),r.createOffer(!0))),t()})["catch"](n)},_getScreenStream:function(e,t,n){var o=this;this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null),e=e===r.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN?"screen":"window";var a={audio:!1,video:{mediaSource:e}};return this.logger.log("_getScreenStream",a),i.MStream.getLocalStream(a).then(function(e){o.localVideoStream=e,o.rtcConnected&&(o.updateRtcStream(),o.createOffer(!0))})["catch"](n)}},e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i=n(42),r=n(20);t["default"]={destroyMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"all"};if("local"!==e.type&&"all"!==e.type||(this.destroyLocalMediaStream(),
"local"!==e.type)){if("remote"===e.type)return void this.destroyRemoteMediaStream(e.uid);var t=this.remoteStreamList;if(t){for(var n in t)this.destroyRemoteMediaStream(n);this.remoteStreamList={}}}},destroyLocalMediaStream:function(){this.localAudioStream&&(this.localAudioStream.destroy(),this.localAudioStream=null),this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null)},destroyRemoteMediaStream:function(e){if(e&&this.remoteStreamList&&this.remoteStreamList[e]){var t=this.remoteStreamList[e];t.remoteStream&&t.remoteStream.destroy(),t.remoteVideoStream&&t.remoteVideoStream.destroy(),t.remoteAudioStream&&t.remoteAudioStream.destroy(),t.remoteStream=null,t.remoteVideoStream=null,t.remoteAudioStream=null,this.remoteStreamList[e]=null;var n=this.remoteUidMsidMap[e],r=this.remoteStreams[n];this.switchTrackEvent({stream:r,uid:e,isOn:!1}),i.MStream.destroyMedia(r)}},setCaptureVolume:function(e){(void 0===e||e>1)&&(e=1),this.localAudioStream&&this.localAudioStream.setGain(e)},setPlayVolume:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.option={volume:e.volume},this.localAudioStream&&this.localAudioStream.setPlayVolume(e.volume),this.optionRemoteStream("setPlayVolume",e)},setAudioStart:function(e){return e===-1?void(this.localAudioStream&&this.localAudioStream.show()&&this.localAudioStream.setMuted(!1)):this.optionRemoteStream("setMuted",{account:e,isAudio:!0,option:!1})},setAudioBlack:function(e){return this.optionRemoteStream("setMuted",{account:e,isAudio:!0,option:!0})},setVideoBlack:function(e){return this.optionRemoteStream("hide",e)},setVideoShow:function(e){return this.optionRemoteStream("show",e)},setVideoViewSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.videoViewSizeOptions=e,this.localVideoStream&&this.localVideoStream.resize(this.videoViewSizeOptions)},setVideoViewRemoteSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.option=e,this.optionRemoteStream("resize",e)},startLocalStream:function(e){var t=this;if(this.localVideoStream){if(this.localVideoStream.container=e||this.info.container,!this.localVideoStream.container)return this.logger.error("开启本地视频流失败: video容器节点缺失"),Promise.reject("开启本地视频流失败: video容器节点缺失");this.localVideoStream.resize(this.videoViewSizeOptions),this.localVideoStream.show(),this.localVideoStream.on("resize",function(e){t.emit("streamResize",e)}),this.localVideoStream.on("error",function(e){t.emit("error",e)}),this.localVideoStream.isShown()||this.updateRtcStream()}},stopLocalStream:function(){this.localVideoStream&&this.localVideoStream.hide()},startRemoteStream:function(){function e(e){e.container=t&&i||e.container,e.isVideoEnable=!0,e.remoteVideoStream&&(e.remoteVideoStream.resize(e.videoSizeOptions),e.remoteVideoStream.show())}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.uid,i=t.node,r=void 0;if("p2p"===this.imInfo.sessionMode&&!n&&(n=this.info.client.target.uid,!this.info.remoteContainer&&!i))return Promise.reject("startRemoteStream失败：点对点模式实例化Netcall必须设置remoteContainer与target；或者参数必须包含account，node");if(r=this.remoteStreamList[n],n&&!r)return Promise.reject("帐号不在会议中，请检查");if(i=i||this.info.remoteContainer,r)return r.container=t&&i||r.container,r.container?(e(r),Promise.resolve()):Promise.reject(n+" 开启显示远端视频画面失败: 请传递video容器");var o=this.remoteStreamList;for(var a in o){if(o[a].container=t&&i||o[a].container,!o[a].container)return Promise.reject(n+" 开启显示远端视频画面失败: 请传递video容器");e(o[a])}return Promise.resolve()},stopRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("hide",e)},suspendLocalStream:function(){return this.localVideoStream?(this.localVideoStream.pause(),Promise.resolve()):Promise.reject("本地没有音视频流，无法进行操作")},resumeLocalStream:function(){return this.localVideoStream?(this.localVideoStream.resume(),Promise.resolve()):Promise.reject("本地没有音视频流，无法进行操作")},suspendRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("pause",e)},resumeRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("resume",e)},optionRemoteStream:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.constructor===String&&(t={account:t}),t.fn=e;var n=t,i=n.account;return i&&i.constructor===Object&&(t=Object.assign(t,i),t.account.constructor===Object&&delete t.account),t.uid||r.configMap.CURRENT.SDK_TYPE!==r.configMap.SDK_TYPE.NRTC||(t.uid=t.account,delete t.account),this.doOptionRemoteStream(t)},doOptionRemoteStream:function(){function e(e){return o?void(e.remoteAudioStream&&e.remoteAudioStream[n]&&e.remoteAudioStream[n](a)):("resize"===n&&(e.videoSizeOptions=a||this.videoViewRemoteSizeOptions),e.remoteVideoStream&&e.remoteVideoStream[n]&&e.remoteVideoStream[n](a),void(e.isVideoEnable="hide"!==n))}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.fn,i=t.uid,r=t.account,o=t.isAudio,a=t.option,s=void 0;if(o=o||/(setPlayVolume|setGain)/.test(n),"p2p"!==this.imInfo.sessionMode||i||(i=this.info.client.target.uid),!i&&r&&(i=this.info.client.getUidWithAccount(r),!i))return Promise.reject("目标账号不正确或者未在当前会话中");if(i)return s=this.remoteStreamList[i],s&&e(s),Promise.resolve();s=this.remoteStreamList;for(var c in s)s[c]&&e(s[c]);return Promise.resolve()}},e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(42),o=3;t["default"]={createOffer:function(e){var t=this;return this.rtc.createOffer().then(function(n){return t.rtc.setLocalDescription(n,e)}).then(function(n){return t.sendOffer(n,e),Promise.resolve()})},onsdp_answer:function(e){this.logger.log("onSdp_answer-->",e);var t=e.params.auth_res-0;return 200!==t?(this.logger.warn("服务器验证不通过, 断开连接"),this.emit("signalClosed",{code:t,error:"服务器验证不通过, 断开连接"}),void this.stopSession()):void this.rtc.setRemoteDescription(e.params.content,"answer").then(function(){})},onice_answer:function(e){var t=e.params.content;"object"!==("undefined"==typeof t?"undefined":i(t))&&(t={candidate:t}),this.rtc.addRemoteIceCandidate(t)},onsdp_offer:function(e){return this.logger.log("iceCompleted",this.rtc.iceCompleted,"sdpAnswer",this.rtc.sdpAnswer),this.rtc.iceCompleted&&this.rtc.sdpAnswer?this.doSdp_offer(e):(this.remote_SdpOffers=this.remote_SdpOffers||[],this.remote_SdpOffers.push(e),void this.logger.log("onSdp_offer -> []",this.remote_SdpOffers))},monitorRemoteStream:function(e){if(this.remoteVideoStream||this.remoteAudioStream){if(!e.ssrc.remote||!e.ssrc.remote.total)return;var t=e.ssrc.remote.total;if(t.bytesReceivedRate>0||!this.monitorRemoteStreamStartTime)this.monitorRemoteStreamStartTime=Date.now();else{var n=Date.now();n-this.monitorRemoteStreamStartTime>1e4&&(this.logger.warn("10秒内未收到音视频数据"),this.emit("remoteStreamNoData"),this.monitorRemoteStreamStartTime=null)}}else this.monitorRemoteStreamStartTime=null},onRemoteStream:function(e,t){window.myRemoteStreams=this.remoteStreams,window.myRemoteStreamList=this.remoteStreamList,this.logger.log("get remote stream");var n=e.id,i=this.getUidByMsid(n);return this.remoteStreams[n]=e,i?void this.doRemoteStream(e,i,t):this.logger.warn("无法找到远程流对应的uid!!,先暂存",e)},startDoRemoteStream:function(e,t){this.remoteStreams[t]&&this.doRemoteStream(this.remoteStreams[t],e)},composeTrack:function(e,t,n){var i=this.remoteStreamList[e],o=new MediaStream,a="audio"===n?"remoteAudioStream":"remoteVideoStream";o.addTrack(t),i[a]?i[a].updateStream(o):i[a]=new r.MStream({uid:e,stream:o,type:n,isRemote:!0,container:i.container}),"audio"===n&&i[a].show()},delayVideoShow:function(e){var t=this.remoteStreamList[e];if(t.isVideoEnable){var n=this.checkRemoteTrack(e,this.currRmoteOffer);this.logger.log(e+" delay video show, rms.isVideoEnable",t.isVideoEnable&&n.video),t.isVideoEnable&&n.video&&(t.remoteVideoStream.resize(t.videoSizeOptions||this.videoViewRemoteSizeOptions),t.remoteVideoStream.show())}},switchTrackEvent:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.stream,i=t.uid,r=t.isOn,o=void 0===r||r;if(n&&i){if(!o)return n.onaddtrack=null,n.onremovetrack=null,this.logger.log("remove trackevent: onaddtrack",n.id),void this.logger.log("remove trackevent: onremovetrack",n.id);n.onaddtrack||(this.logger.log("add trackevent onaddtrack",n.id),n.onaddtrack=function(t){e.emit("addtrack",t);var r=t.track,o=r.kind;e.logger.log(n.id,"on add track:",o,r.id,r),e.composeTrack(i,r,o),"video"===o&&setTimeout(function(){e.delayVideoShow(i)},100)}),n.onremovetrack||(this.logger.log("add trackevent onremovetrack",n.id),n.onremovetrack=function(t){var r=t.track,o=r.kind,a=e.remoteStreamList[i];a&&(e.logger.warn(n.id,"on remove track:",o,r),e.emit("removetrack",t),"video"===o&&a.remoteVideoStream&&a.remoteVideoStream.hide())})}},doRemoteStream:function(e,t,n){/Chrome/gi.test(navigator.userAgent)?this.doRemoteStreamChrome(e,t,n):this.doRemoteStreamFirefox(e,t,n)},doRemoteStreamChrome:function(e,t){var n=this;this.logger.log("get "+t+" stream, track num: "+e.getTracks().length,e),e&&e.getTracks().forEach(function(e){n.logger.log("   > track id:",e.kind+":"+e.id,e)});var i=e.getAudioTracks()[0],r=e.getVideoTracks()[0];i&&this.composeTrack(t,i,"audio"),r&&this.composeTrack(t,r,"video"),r&&setTimeout(function(){n.delayVideoShow(t)},100),this.switchTrackEvent({stream:e,uid:t})},doRemoteStreamFirefox:function(e,t,n){this.logger.log("收到 "+t+" 轨道: ",n&&n.id,e,n),n&&("audio"===n.kind&&this.composeTrack(t,n,n.kind),this.switchTrackEvent({stream:e,uid:t}))},sendOffer:function(e,t){var n=this.imInfo,i=this.imInfo.videoConfig,r=this.sessionConfig||{},o=t?"sdp_update":"sdp_offer",a=this.mediaDevices.getDeviceStatus(),s={session_mode:n.sessionMode||"p2p",record:{support_video_record:r.recordVideo||!1,support_audio_record:r.recordAudio||!1},bypass_rtmp:{is_host:!!r.rtmpUrl,support_bypass_rtmp:r.liveEnable||!1,support_bypass_rtmp_record:r.rtmpRecord||!1,bypass_rtmp_url:r.rtmpUrl||"",participant_mode:"M-"+r.splitMode,layout:r.layout||""},params:{token:n.token||n.cid+"",user_type:n.token?3:2,user_token_type:0,content:e,streamSetting:{video:{width:i.width,height:i.height,frameRate:r.liveEnable&&i.frameRate>15?15:i.frameRate}}},hasAudio:this.deviceAudioStatus&&a.hasAudio&&!this.imInfo.role||!1,hasVideo:this.deviceVideoStatus&&a.hasVideo&&!this.imInfo.role||!1};this.sendMsg(o,s)},sendAnswer:function(e){var t=this.imInfo.videoConfig,n={params:{content:e,streamSetting:{video:t}}};this.sendMsg("sdp_answer",n)},startSdp_offer:function(){var e=this.remote_SdpOffers;if(e&&0!==e.length){this.logger.log("start do sdp_offer",e);var t=e.shift();this.doSdp_offer(t),setTimeout(this.startSdp_offer.bind(this),200)}},doSdp_offer:function(e){var t=this,n=e.uid,i=e.cid;if(!n||!i)return this.logger.error("非法会话",e);var r=e.params.content;this.currRmoteOffer=r.sdp;var o=JSON.parse(r.msids);this.logger.log("do dp_offer",o),o.forEach(function(n){if(!n.uid)return t.logger.warn("未知用户或者数据流的sdp_offer",n);var o=+n.uid,a=n.msid;return t.remoteUidMsidMap.hasOwnProperty(o)?(t.updateRemoteUserStream(o,a),void t.checkRemoteTrack(o,r.sdp)):(t.logger.log("new user join "+o,e),t.updateRemoteUserStream(o,a),t.emit("userJoined",{uid:o,cid:i}),void(t.remoteStreams[a]&&t.startDoRemoteStream(o,a)))}),this.rtc.setRemoteDescription(r,"offer").then(function(){t.rtc.createAnswer().then(function(e){t.rtc.setLocalDescription(e),t.sendAnswer(e)})})["catch"](function(e){e&&e.constructor===Object&&t.logger.error(e.code,e.name,e.message)})},onLocalIceCandidate:function(e){if(!/\d tcp \d/.test(e.candidate)){var t={params:{content:e}};this.sendMsg("ice_offer",t)}},onNegotiationNeeded:function(){this.rtcConnected&&(this.logger.log("onNegotiationNeeded"),this.createOffer(!0))},onIceConnectionStateChange:function(e){var t=this;if(this.logger.log("ice connection state change to:"+e),"connected"===e&&(this.emit("sessionConnected"),this.stats.start(this.rtc.rtcConnection),this.statsNew.start(this.rtc.rtcConnection)),"failed"===e){if(o)return this.stopSession(),void this.emit("signalClosed");this.reConnectCount++,this.logger.log("3s后尝试第"+this.reConnectCount+"次重连服务器"),setTimeout(function(){t.logger.log("假的重连")},3e3)}},updateRtcStream:function(){this.localStream=this.localStream||{},this.logger.log("update stream, current role："+(0===this.imInfo.role?"player":"audience"));var e=[];if(0===this.imInfo.role||"p2p"===this.imInfo.sessionMode){var t=this.localAudioStream,n=this.localVideoStream;t&&t.stream&&e.push(t.stream),n&&n.stream&&e.push(n.stream)}this.rtc&&this.rtc.updateStream(e)},updateRemoteUserStream:function(e,t){this.remoteUidMsidMap[e]=t,this.remoteStreamList[e]||(this.remoteStreamList[e]={isVideoEnable:!0,container:null})},removeRemoteUserStream:function(e){this.logger.log("remove logout user",e),delete this.remoteUidMsidMap[e],delete this.remoteStreamList[e]},checkRemoteTrack:function(e,t){var n=this.remoteStreamList[e];if(!n)return{};var i=n.remoteAudioStream&&n.remoteAudioStream.audioStream,r=n.remoteVideoStream&&n.remoteVideoStream.stream;if(!i&&!r)return{};var o=this.rtc.checkMediaStatus({audio:i,video:r,sdp:t,uid:e});return this.logger.log("checkRemoteTrack "+e,o),o.video||n.remoteVideoStream&&n.remoteVideoStream.hide(),o}},e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(87);n(220);var s=n(4),c=function(e){function t(n){i(this,t);var o=r(this,e.call(this));return o.logger=n.logger||{},o.imInfo=n.imInfo,o.sessionConfig=n.sessionConfig,o.controller=n.controller,o.init(),o.isProgress=!1,o}return o(t,e),t}(s);t["default"]=c;var d=c.prototype;d.resetStatus=function(){this.sdpOffer=null,this.sdpAnswer=null,this.iceOffer=[],this.iceAnswer=[],this.offerCount=0},d.setProgress=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isProgress=e,e===!1&&"completed"===this.rtcConnection.iceConnectionState&&this.emit("ready")},d.init=function(){var e=this;if(this.resetStatus(),!this.rtcConnection){var t=/Chrome/gi.test(navigator.userAgent),n=this.rtcConnection=new RTCPeerConnection;n.onicecandidate=this.onIceCandidate.bind(this),n.onnegotiationneeded=this.onNegotiationneeded.bind(this),n.oniceconnectionstatechange=this.onIceStateChange.bind(this),t?(n.onaddstream=this.onRemoteStream.bind(this),n.onremovestream=function(t){e.logger.warn("on remove stream:",t.stream)}):n.ontrack=this.onRemoteTrack.bind(this),window.myRtc=n}},d.doSendIce=function(){if(this.sdpAnswer){var e=this.iceOffer;if(e.length>0&&!this.iceCompleted){var t=e.shift();this.emit("iceCandidate",t),this.doSendIce()}}},d.onIceCandidate=function(e){if(this.logger.log("gather candidate",e&&e.candidate&&e.candidate.candidate),e.candidate){if(/ tcp /gi.test(e.candidate.candidate))return;this.iceOffer.push(e.candidate),this.offerCount++}else this.logger.log("onicecandidate end")},d.onIceStateChange=function(){if(this.rtcConnection){var e=this.rtcConnection.iceConnectionState;"connected"===e&&this.iceCompleted&&this.setProgress(!1),this.emit("iceconnectionstatechange",this.rtcConnection.iceConnectionState)}},d.onNegotiationneeded=function(e){this.emit("negotiationneeded",e)},d.getReceivers=function(){return this.rtcConnection.getReceivers()},d.getRemoteStreams=function(){return this.rtcConnection.getRemoteStreams()},d.onRemoteStream=function(e){return!e.stream||e.stream&&"default"===e.stream.id?this.logger.log("remote stream is default stream, do nothing"):void this.emit("getRemoteStream",e.stream)},d.onRemoteTrack=function(e){var t=e.streams[0];t&&this.emit("getRemoteStream",t,e.track)},d.getIceConnectionState=function(){if(this.rtcConnection)return this.rtcConnection.iceConnectionState},d.checkNegotiation=function(){return!(0===this.oldTracks&&0===this.newTracks)},d.updateStream=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];a.RtcUtil.updateMediaStream({peer:this.rtcConnection,currStream:this.currStream,streams:t}).then(function(t){e.currStream||(e.currStream=t)})},d.createAnswer=function(e){var t=this;return this.setProgress(!0),this.rtcConnection.createAnswer().then(function(e){return e.sdp=a.SdpUtil.maybePreferVideoReceiveCodec(e.sdp,{videoRecvCodec:"H264"}),e=a.RtcUtil.formatSdp({offerOrAnswer:e,uid:t.imInfo.uid,cid:t.imInfo.cid,stream:t.currStream,highAudio:t.sessionConfig.highAudio,stero:t.sessionConfig.stero})})["catch"](function(e){t.logger.log(e)})},d.createOffer=function(){var e=this;return this.setProgress(!0),a.RtcUtil.createOffer(this.rtcConnection).then(function(t){return e.logger.log("\r\n-------------------------netease: activity start----------------------------\r\n"),e.resetStatus(),t.sdp=a.SdpUtil.maybePreferVideoReceiveCodec(t.sdp,{videoRecvCodec:"H264"}),e.logger.log("this.currentStream",e.currStream),t=a.RtcUtil.formatSdp({offerOrAnswer:t,uid:e.imInfo.uid,cid:e.imInfo.cid,stream:e.currStream,highAudio:e.sessionConfig.highAudio,stero:e.sessionConfig.stero}),Promise.resolve(t)})["catch"](function(t){return e.logger.error(t),Promise.reject(t)})},d.getLocalSdp=function(){return this.rtcConnection.localDescription},d.getRemoteSdp=function(){return this.rtcConnection.remoteDescription},d.checkMediaStatus=function(e,t,n){return a.RtcUtil.checkMediaStatus(e,t,n)},d.logSdp=function(){this.rtcConnection.remoteDescription&&console.log("remoteDescription after setRemoteDescription",this.rtcConnection.remoteDescription.sdp),this.rtcConnection.currentRemoteDescription&&console.log("currentRemoteDescription after setRemoteDescription",this.rtcConnection.currentRemoteDescription.sdp)},d.setRemoteDescription=function(e,t){var n=this;"offer"===e.type&&this.logger.log("\r\n-------------------------netease: activity start----------------------------\r\n"),this.setProgress("offer"===e.type),this.logger.log("get remote sdp "+t+" --> "+e.type+"\n",e.sdp);var i={sdp:e.sdp,type:e.type};return"offer"!==e.type||this.sdpAnswer?(i.sdp=a.SdpUtil.maybePreferVideoSendCodec(i.sdp,{videoRecvCodec:"H264"}),i.sdp=a.RtcUtil.formatSdpRemote(i.sdp),a.RtcUtil.parse(i.sdp),this.rtcConnection.setRemoteDescription(i).then(function(){if("answer"===e.type){if(n.sdpAnswer=i,n.iceCompleted)return void n.emit("iceCompleted");n.doSendIce()}else n.sdpAnswer=null;return Promise.resolve()})["catch"](function(e){return Promise.reject(e)})):Promise.reject()},d.setLocalDescription=function(e,t){var n=this;return this.sdpOffer=e,this.logger.log("set local sdp "+e.type+"\n",e.sdp),this.rtcConnection.setLocalDescription(e).then(function(){return"answer"===e.type?(n.sdpAnswer=e,n.iceCompleted&&n.emit("iceCompleted"),n.setProgress(!1)):n.sdpAnswer=null,Promise.resolve(e)})["catch"](function(t){return n.logger.warn(t),Promise.resolve(e)})},d.addRemoteIceCandidate=function(e){var t=this;this.logger.log("set remote ICE ",e),this.rtcConnection.addIceCandidate(new RTCIceCandidate(e)).then(function(){t.iceAnswer.push(e),t.iceAnswer.length===t.offerCount&&(t.iceCompleted=!0,t.iceAnswer=[],t.offerCount=0,t.emit("iceCompleted"))})["catch"](function(e){t.logger.warn(e)})},d.close=function(){this.logger.log("close rtc"),this.rtcConnection&&this.rtcConnection.close(),this.rtcConnection=null},e.exports=t["default"]},,,,function(e,t,n){"use strict";function i(e,t,n,i,r){var o=d.writeRtpDescription(e.kind,t);if(o+=d.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=d.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":r||"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+(i?i.id:"-")+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),o}function r(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof i;return r&&(i=[i]),i=i.filter(function(e){var i=0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!n;return i?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&e.indexOf("?transport=udp")===-1}),delete e.url,e.urls=r?i[0]:i,!!i.length}})}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},r=function(e,t,n,r){var o=i(e.parameters.apt,n),a=i(t.parameters.apt,r);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(i){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(i.name.toLowerCase()===a.name.toLowerCase()&&i.clockRate===a.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&a.parameters.apt&&!r(i,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(i.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}),n}function a(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n}var d=n(105);e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function l(t,n,i,r){var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=r,e.setTimeout(function(){t._dispatchEvent("track",o)})}var p=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=r(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=d.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};p.prototype.onicecandidate=null,p.prototype.onaddstream=null,p.prototype.ontrack=null,p.prototype.onremovestream=null,p.prototype.onsignalingstatechange=null,p.prototype.oniceconnectionstatechange=null,p.prototype.onicegatheringstatechange=null,p.prototype.onnegotiationneeded=null,p.prototype.ondatachannel=null,p.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},p.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},p.prototype.getConfiguration=function(){return this._config},p.prototype.getLocalStreams=function(){return this.localStreams},p.prototype.getRemoteStreams=function(){return this.remoteStreams},p.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return this.transceivers.push(n),n},p.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i=this.transceivers.find(function(e){return e.track===t});if(i)throw c("InvalidAccessError","Track already exists.");for(var r,o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(r=this.transceivers[o]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(n)===-1&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},p.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var i=e.clone();e.getTracks().forEach(function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),i.getTracks().forEach(function(e){n.addTrack(e,i)})}},p.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var i=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null;var r=this.transceivers.map(function(e){return e.stream});r.indexOf(i)===-1&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},p.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},p.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},p.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},p.prototype._createIceGatherer=function(t,n){var i=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;r.state=n?"completed":"gathering",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),r},p.prototype._gather=function(t,n){var i=this,r=this.transceivers[n].iceGatherer;if(!r.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,r.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),r.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==r.state&&"gathering"!==r.state||(r.state="completed");else{"new"===r.state&&(r.state="gathering"),a.component=1;var c=d.writeCandidate(a);o.candidate=Object.assign(o.candidate,d.parseCandidate(c)),o.candidate.candidate=c}var u=d.splitSections(i.localDescription.sdp);s?u[o.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n":u[o.candidate.sdpMLineIndex+1]+="a="+o.candidate.candidate+"\r\n",i.localDescription.sdp=u.join("");var l=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),s||i._dispatchEvent("icecandidate",o),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){r.onlocalcandidate(e)})},0)}},p.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var i=new e.RTCDtlsTransport(n);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:i}},p.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},p.prototype._transceive=function(e,n,i){var r=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:d.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),i&&e.rtpReceiver&&r.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length&&(r.encodings=e.recvEncodingParameters),r.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(r.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},p.prototype.setLocalDescription=function(e){var t=this;if(["offer","answer"].indexOf(e.type)===-1)return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));
var n,i;if("offer"===e.type)n=d.splitSections(e.sdp),i=n.shift(),n.forEach(function(e,n){var i=d.parseRtpParameters(e);t.transceivers[n].localCapabilities=i}),t.transceivers.forEach(function(e,n){t._gather(e.mid,n)});else if("answer"===e.type){n=d.splitSections(t.remoteDescription.sdp),i=n.shift();var r=d.matchPrefix(i,"a=ice-lite").length>0;n.forEach(function(e,n){var a=t.transceivers[n],s=a.iceGatherer,c=a.iceTransport,u=a.dtlsTransport,l=a.localCapabilities,p=a.remoteCapabilities,f=d.isRejected(e)&&0===d.matchPrefix(e,"a=bundle-only").length;if(!f&&!a.isDatachannel){var h=d.getIceParameters(e,i),m=d.getDtlsParameters(e,i);r&&(m.role="server"),t.usingBundle&&0!==n||(t._gather(a.mid,n),"new"===c.state&&c.start(s,h,r?"controlling":"controlled"),"new"===u.state&&u.start(m));var v=o(l,p);t._transceive(a,v.codecs.length>0,!1)}})}return t.localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve()},p.prototype.setRemoteDescription=function(i){var r=this;if(["offer","answer"].indexOf(i.type)===-1)return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,r.signalingState)||r._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+r.signalingState));var o={};r.remoteStreams.forEach(function(e){o[e.id]=e});var p=[],f=d.splitSections(i.sdp),h=f.shift(),m=d.matchPrefix(h,"a=ice-lite").length>0,v=d.matchPrefix(h,"a=group:BUNDLE ").length>0;r.usingBundle=v;var g=d.matchPrefix(h,"a=ice-options:")[0];return g?r.canTrickleIceCandidates=g.substr(14).split(" ").indexOf("trickle")>=0:r.canTrickleIceCandidates=!1,f.forEach(function(a,c){var l=d.splitLines(a),f=d.getKind(a),g=d.isRejected(a)&&0===d.matchPrefix(a,"a=bundle-only").length,y=l[0].substr(2).split(" ")[2],S=d.getDirection(a,h),b=d.parseMsid(a),C=d.getMid(a)||d.generateIdentifier();if("application"===f&&"DTLS/SCTP"===y)return void(r.transceivers[c]={mid:C,isDatachannel:!0});var T,_,R,w,E,O,P,A,I,k,M,D=d.parseRtpParameters(a);g||(k=d.getIceParameters(a,h),M=d.getDtlsParameters(a,h),M.role="client"),P=d.parseRtpEncodingParameters(a);var x=d.parseRtcpParameters(a),L=d.matchPrefix(a,"a=end-of-candidates",h).length>0,j=d.matchPrefix(a,"a=candidate:").map(function(e){return d.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!g&&v&&c>0&&r.transceivers[c]&&(r._disposeIceAndDtlsTransports(c),r.transceivers[c].iceGatherer=r.transceivers[0].iceGatherer,r.transceivers[c].iceTransport=r.transceivers[0].iceTransport,r.transceivers[c].dtlsTransport=r.transceivers[0].dtlsTransport,r.transceivers[c].rtpSender&&r.transceivers[c].rtpSender.setTransport(r.transceivers[0].dtlsTransport),r.transceivers[c].rtpReceiver&&r.transceivers[c].rtpReceiver.setTransport(r.transceivers[0].dtlsTransport)),"offer"!==i.type||g)"answer"!==i.type||g||(T=r.transceivers[c],_=T.iceGatherer,R=T.iceTransport,w=T.dtlsTransport,E=T.rtpReceiver,O=T.sendEncodingParameters,A=T.localCapabilities,r.transceivers[c].recvEncodingParameters=P,r.transceivers[c].remoteCapabilities=D,r.transceivers[c].rtcpParameters=x,j.length&&"new"===R.state&&(!m&&!L||v&&0!==c?j.forEach(function(e){s(T.iceTransport,e)}):R.setRemoteCandidates(j)),v&&0!==c||("new"===R.state&&R.start(_,k,"controlling"),"new"===w.state&&w.start(M)),r._transceive(T,"sendrecv"===S||"recvonly"===S,"sendrecv"===S||"sendonly"===S),!E||"sendrecv"!==S&&"sendonly"!==S?delete T.rtpReceiver:(I=E.track,b?(o[b.stream]||(o[b.stream]=new e.MediaStream),n(I,o[b.stream]),p.push([I,E,o[b.stream]])):(o["default"]||(o["default"]=new e.MediaStream),n(I,o["default"]),p.push([I,E,o["default"]]))));else{T=r.transceivers[c]||r._createTransceiver(f),T.mid=C,T.iceGatherer||(T.iceGatherer=r._createIceGatherer(c,v)),j.length&&"new"===T.iceTransport.state&&(!L||v&&0!==c?j.forEach(function(e){s(T.iceTransport,e)}):T.iceTransport.setRemoteCandidates(j)),A=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(A.codecs=A.codecs.filter(function(e){return"rtx"!==e.name})),O=T.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N=!1;if("sendrecv"===S||"sendonly"===S){if(N=!T.rtpReceiver,E=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,f),N){var U;I=E.track,b&&"-"===b.stream||(b?(o[b.stream]||(o[b.stream]=new e.MediaStream,Object.defineProperty(o[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(I,"id",{get:function(){return b.track}}),U=o[b.stream]):(o["default"]||(o["default"]=new e.MediaStream),U=o["default"])),U&&(n(I,U),T.associatedRemoteMediaStreams.push(U)),p.push([I,E,U])}}else T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===T.rtpReceiver.track.id});t&&u(t,e)}),T.associatedRemoteMediaStreams=[]);T.localCapabilities=A,T.remoteCapabilities=D,T.rtpReceiver=E,T.rtcpParameters=x,T.sendEncodingParameters=O,T.recvEncodingParameters=P,r._transceive(r.transceivers[c],!1,N)}}),void 0===r._dtlsRole&&(r._dtlsRole="offer"===i.type?"active":"passive"),r.remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?r._updateSignalingState("have-remote-offer"):r._updateSignalingState("stable"),Object.keys(o).forEach(function(t){var n=o[t];if(n.getTracks().length){if(r.remoteStreams.indexOf(n)===-1){r.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){r._dispatchEvent("addstream",i)})}p.forEach(function(e){var t=e[0],i=e[1];n.id===e[2].id&&l(r,t,i,[n])})}}),p.forEach(function(e){e[2]||l(r,e[0],e[1],[])}),e.setTimeout(function(){r&&r.transceivers&&r.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},p.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},p.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},p.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},p.prototype._updateConnectionState=function(){var e,t={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t["new"]>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},p.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var r=n.transceivers.filter(function(e){return"audio"===e.kind}).length,o=n.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(r=a.offerToReceiveAudio===!0?1:a.offerToReceiveAudio===!1?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=a.offerToReceiveVideo===!0?1:a.offerToReceiveVideo===!1?0:a.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?(r--,r<0&&(e.wantReceive=!1)):"video"===e.kind&&(o--,o<0&&(e.wantReceive=!1))});r>0||o>0;)r>0&&(n._createTransceiver("audio"),r--),o>0&&(n._createTransceiver("video"),o--);var s=d.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,r){var o=i.track,a=i.kind,s=i.mid||d.generateIdentifier();i.mid=s,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(r,n.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var u=i.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];o&&t>=15019&&"video"===a&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=c,i.sendEncodingParameters=u}),"max-compat"!==n._config.bundlePolicy&&(s+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){s+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+d.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(u)},p.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));var r=d.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var a=d.splitSections(n.remoteDescription.sdp).length-1;n.transceivers.forEach(function(e,s){if(!(s+1>a)){if(e.isDatachannel)return void(r+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var d=o(e.localCapabilities,e.remoteCapabilities),u=d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!u&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=i(e,d,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(s)},p.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,r){if(!n.remoteDescription)return r(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){o=a;break}var u=n.transceivers[o];if(!u)return r(c("OperationError","Can not add ICE candidate"));if(u.isDatachannel)return i();var l=Object.keys(e.candidate).length>0?d.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return i();if(l.component&&1!==l.component)return i();if((0===o||o>0&&u.iceTransport!==n.transceivers[0].iceTransport)&&!s(u.iceTransport,l))return r(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),t=d.splitSections(n.remoteDescription.sdp),t[o+1]+="a="+(l.type?p:"end-of-candidates")+"\r\n",n.remoteDescription.sdp=t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].isDatachannel||(n.transceivers[f].iceTransport.addRemoteCandidate({}),t=d.splitSections(n.remoteDescription.sdp),t[f+1]+="a=end-of-candidates\r\n",n.remoteDescription.sdp=t.join(""),!n.usingBundle));f++);i()})},p.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(n){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(n){e[n].type=t(e[n]),i.set(n,e[n])})}),n(i)})})};var f=["createOffer","createAnswer"];return f.forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),f=["setLocalDescription","setRemoteDescription","addIceCandidate"],f.forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),p}},function(e,t,n){var i=n(218),r=n(219);t.write=r,t.parse=i.parse,t.parseFmtpConfig=i.parseFmtpConfig,t.parseParams=i.parseParams,t.parsePayloads=i.parsePayloads,t.parseRemoteCandidates=i.parseRemoteCandidates,t.parseImageAttributes=i.parseImageAttributes,t.parseSimulcastStreamList=i.parseSimulcastStreamList},function(e,t,n){var i=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,n,r){if(r&&!n)t[r]=i(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=i(e[o+1]))},o=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;r(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},a=n(104),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),i=n[n.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(r))return o(c,i,r)}}),t.media=n,t};var c=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=i(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(i),r=0;r<n.length;r+=3)t.push({component:n[r],ip:n[r+1],port:n[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var i=n(104),r=/%[sdv%]/g,o=function(e){var t=1,n=arguments,i=n.length;return e.replace(r,function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},a=function(e,t,n){var i=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,r=[e+"="+i];if(t.names)for(var a=0;a<t.names.length;a+=1){var s=t.names[a];t.name?r.push(n[t.name][s]):r.push(n[t.names[a]])}else r.push(n[t.name]);return o.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,r=t.innerOrder||c,o=[];return n.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})}),e.media.forEach(function(e){o.push(a("m",i.m[0],e)),r.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})})}),o.join("\r\n")+"\r\n"}},function(e,t,n){(function(t){"use strict";var i=n(221);e.exports=i({window:t.window})}).call(t,function(){return this}())},function(e,t,n){"use strict";var i=n(21);e.exports=function(e,t){var r=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=i.log,c=i.detectBrowser(r),d={browserDetails:c,extractVersion:i.extractVersion,disableLog:i.disableLog,disableWarnings:i.disableWarnings},u=n(222)||null,l=n(225)||null,p=n(227)||null,f=n(229)||null,h=n(224)||null;switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),d;s("adapter.js shimming chrome."),d.browserShim=u,h.shimCreateObjectURL(r),u.shimGetUserMedia(r),u.shimMediaStream(r),u.shimSourceObject(r),u.shimPeerConnection(r),u.shimOnTrack(r),u.shimAddTrackRemoveTrack(r),u.shimGetSendersWithDtmf(r),h.shimRTCIceCandidate(r);break;case"firefox":if(!p||!p.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),d;s("adapter.js shimming firefox."),d.browserShim=p,h.shimCreateObjectURL(r),p.shimGetUserMedia(r),p.shimSourceObject(r),p.shimPeerConnection(r),p.shimOnTrack(r),p.shimRemoveStream(r),h.shimRTCIceCandidate(r);break;case"edge":if(!l||!l.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),d;s("adapter.js shimming edge."),d.browserShim=l,h.shimCreateObjectURL(r),l.shimGetUserMedia(r),l.shimPeerConnection(r),l.shimReplaceTrack(r);break;case"safari":if(!f||!o.shimSafari)return s("Safari shim is not included in this adapter release."),d;s("adapter.js shimming safari."),d.browserShim=f,h.shimCreateObjectURL(r),f.shimRTCIceServerUrls(r),f.shimCallbacksAPI(r),f.shimLocalStreamsAPI(r),f.shimRemoteStreamsAPI(r),f.shimTrackEventTransceiver(r),f.shimGetUserMedia(r),f.shimCreateOfferLegacy(r),h.shimRTCIceCandidate(r);break;default:s("Unsupported browser!")}return d}},function(e,t,n){"use strict";var i=n(21),r=i.log;e.exports={shimGetUserMedia:n(223),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(i){var r;r=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===i.track.id}):{track:i.track};var o=new Event("track");o.track=i.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(i){var r;r=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===i.id}):{track:i};var o=new Event("track");o.track=i,o.receiver=r,o.transceiver={receiver:r},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var r=this,o=n.apply(r,arguments);return o||(o=t(r,e),r._senders.push(o)),o};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;i.apply(t,arguments);var n=t._senders.indexOf(e);n!==-1&&t._senders.splice(n,1)}}var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],r.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;return this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),void e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):void(this.src="")}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?this._shimmedLocalStreams[n.id].indexOf(i)===-1&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});if(n)throw new DOMException("Track already exists.","InvalidAccessError")});var i=t.getSenders();n.apply(this,arguments);var r=t.getSenders().filter(function(e){return i.indexOf(e)===-1});this._shimmedLocalStreams[e.id]=[e].concat(r)};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var i=t._shimmedLocalStreams[n].indexOf(e);i!==-1&&t._shimmedLocalStreams[n].splice(i,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),r.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){function t(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}var r=i.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=o.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){var t=n.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());n._streams[t.id]=i,n._reverseStreams[i.id]=t,t=i}a.apply(n,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},s.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=i.getSenders().find(function(e){return e.track===t});if(o)throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var a=i._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);i._streams[n.id]=s,i._reverseStreams[s.id]=n,i.addStream(s)}return i.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var i=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments,r=arguments.length&&"function"==typeof arguments[0];return r?i.apply(e,[function(i){var r=t(e,i);n[0].apply(null,[r])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):i.apply(e,arguments).then(function(n){return t(e,n)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=n(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,n=d.get.apply(this);return""===n.type?n:t(e,n)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var n=e._pc===t;if(!n)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var i;Object.keys(t._streams).forEach(function(n){var r=t._streams[n].getTracks().find(function(t){return e.track===t});r&&(i=t._streams[n])}),i&&(1===i.getTracks().length?t.removeStream(t._reverseStreams[i.id]):i.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,r.push(a)):r.push(e.iceServers[o])}e.iceServers=r}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return r("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var i=this,r=arguments;if(arguments.length>0&&"function"==typeof e)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!=typeof arguments[0]))return o.apply(this,[]);var a=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){r[1](s(a(e)))};return o.apply(this,[c,arguments[0]])}return new Promise(function(e,t){o.apply(i,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,i=new Promise(function(i,r){n.apply(t,[e[0],i,r])});return e.length<2?i:i.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(i,r){n.apply(e,[i,r,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},function(e,t,n){"use strict";var i=n(21),r=i.log;e.exports=function(e){var t=i.detectBrowser(e),n=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){
t.optional=t.optional||[];var o={};"number"==typeof i.ideal?(o[r("min",n)]=i.ideal,t.optional.push(o),o={},o[r("max",n)]=i.ideal,t.optional.push(o)):(o[r("",n)]=i.ideal,t.optional.push(o))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,i){if(t.version>=61)return i(e);if(e=JSON.parse(JSON.stringify(e)),e&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var d;if("environment"===s.exact||"environment"===s.ideal?d=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return d.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});return!n&&t.length&&d.indexOf("back")!==-1&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),r("chrome: "+JSON.stringify(e)),i(e)})}e.video=o(e.video)}return r("chrome: "+JSON.stringify(e)),i(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,i){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){i&&i(s(e))})})};n.getUserMedia=c;var d=function(e){return new Promise(function(t,i){n.getUserMedia(e,t,i)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return d(e)};"undefined"==typeof n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,n){"use strict";function i(e,t,n){if(e.RTCPeerConnection){var i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);var o=function(e){i(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[i]=o,r.apply(this,[e,o])};var o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var i=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var r=n(105),o=n(21);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2));var n=new t(e),i=r.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o},i(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),i=t.revokeObjectURL.bind(t),r=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return r.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){i(e),r["delete"](e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=r.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=r.get(arguments[1])||null),c.apply(this,arguments)}}}}},function(e,t,n){"use strict";var i=n(21),r=n(216);e.exports={shimGetUserMedia:n(226),shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=r(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t){"use strict";e.exports=function(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e)["catch"](function(e){return Promise.reject(n(e))})}}},function(e,t,n){"use strict";var i=n(21);e.exports={shimGetUserMedia:n(228),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=i.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,i){if(t.version<38&&n&&n.iceServers){for(var r=[],o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),r.push(c)}else r.push(n.iceServers[o])}n.iceServers=r}return new e.mozRTCPeerConnection(n,i)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var r=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,i){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=r(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(i){if("TypeError"!==i.name)throw i;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(n,i)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;i.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&e.getTracks().indexOf(n.track)!==-1&&t.removeTrack(n)})})}}},function(e,t,n){"use strict";var i=n(21),r=i.log;e.exports=function(e){var t=i.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,i,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(n),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[n]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var r={};"number"==typeof i.ideal?r[n]={min:i.ideal,max:i.ideal}:r[n]=i.ideal,e.advanced.push(r),delete i.ideal,Object.keys(i).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(r("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),r("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,i,function(e){o(a(e))})},c=function(e){return new Promise(function(t,n){s(e,t,n)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},t.version<41){var d=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var l=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},p=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),p(e)},o&&o.prototype.getSettings){var f=o.prototype.getSettings;o.prototype.getSettings=function(){var e=f.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}n.getUserMedia=function(e,r,o){return t.version<44?s(e,r,o):(i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void n.mediaDevices.getUserMedia(e).then(r,o))}}},function(e,t,n){"use strict";var i=n(21);e.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e)===-1&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(i){t.call(n,i,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?this._localStreams.indexOf(n)===-1&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(t!==-1){this._localStreams.splice(t,1);var n=this,i=e.getTracks();this.getSenders().forEach(function(e){i.indexOf(e.track)!==-1&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var s=function(e,t,n){var i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){var i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){var i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[o])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var i=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});e.offerToReceiveAudio===!1&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):e.offerToReceiveAudio!==!0||i||n.addTransceiver("audio");var r=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});e.offerToReceiveVideo===!1&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):e.offerToReceiveVideo!==!0||r||n.addTransceiver("video")}return t.apply(n,arguments)}}}},,,,,,,,,,,,,,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=n(20),c=n(11),d=n(63),u=i(d),l=n(207),p=i(l),f=n(206),h=i(f),m=n(205),v=i(m),g=n(204),y=i(g),S=n(246),b=i(S);s.configMap.CURRENT.SDK_TYPE=s.configMap.SDK_TYPE.WEBRTC;var C=function(e){function t(n){r(this,t);var i=o(this,e.call(this,n));return i.initWR(),i}return a(t,e),t.prototype.initWR=function(){if(!this.nim)throw new Error({error:"请传入nim实例"});this.initProtocol(),this.initController(),this.devices={hasAudio:!1,hasVideo:!1}},t.prototype.resetWhenHangup=function(){this.controller.stopSession(),this.resetStatus()},t.prototype.initSignal=function(){return Promise.resolve()},t.prototype.initProtocol=function(){var e=this.nim;e.on("beCalled",this.onBeCalled.bind(this)),e.on("notifyCalleeAck",this.onCalleeAck.bind(this)),e.on("notifyHangup",this.onHangup.bind(this)),e.on("netcallControl",this.onControl.bind(this)),e.on("notifyCalleeAckSync",this.onCalleeAckSync.bind(this)),e.on("notifyJoin",this.onNotifyJoin.bind(this))},t.prototype.initController=function(){var e=this;window.myContrl=this.controller=new p["default"]({appKey:this.nim&&this.nim.options.appKey,logger:this.logger,container:this.container,remoteContainer:this.remoteContainer,client:this}),this.controller.on("sessionConnected",function(t){e.emit("sessionConnected",t)}),this.controller.on("signalClosed",function(t){e.emit("signalClosed",t)}),this.controller.on("userJoined",this.onUserJoin.bind(this)),this.controller.on("deviceStatus",function(t){e.emit("deviceStatus",t)}),this.controller.on("deviceAdd",function(t){e.emit("deviceAdd",t)}),this.controller.on("deviceRemove",function(t){e.emit("deviceRemove",t)}),this.controller.on("devices",function(t){e.emit("devices",t)}),this.controller.on("statistics",function(t){e.emit("statistics",t)}),this.controller.on("signalClosed",function(t){e.emit("signalClosed",t)}),this.controller.on("leaveChannel",this.onUserLeft.bind(this)),this.controller.on("audioVolume",function(t){e.emit("audioVolume",t)})},t.prototype.call=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.calling)return Promise.reject({type:"statusNotMatch",error:"呼叫失败: 当前正在通话中"});var t=e.account,n=e.type,i=e.pushConfig,r=e.sessionConfig;if(this.calling=!0,this.isCaller=!0,this.callee=t,this.target.account=t,this.setSessionConfig(r),this.setSessionConfig({signalStartTime:Date.now()}),this.controller.uploadDataApi("update",{key:"p2p"}),r.highAudio&&this.controller.uploadDataApi("update",{key:"hd_audio"}),void 0!==r.videoFrameRate&&this.controller.uploadDataApi("update",{key:"fps",ext:0===+r.videoFrameRate?0:+r.videoFrameRate+1}),void 0!==r.videoQuality){var o=+r.videoQuality;o===c.constantRtc.CHAT_VIDEO_QUALITY_540P?o=c.constantRtc.CHAT_VIDEO_QUALITY_720P:o===c.constantRtc.CHAT_VIDEO_QUALITY_720P&&(o=c.constantRtc.CHAT_VIDEO_QUALITY_540P),this.controller.uploadDataApi("update",{key:"video_quality",ext:o||0})}return this.initNetcall({type:n,pushConfig:i})},t.prototype.initNetcall=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.type,i=t.pushConfig;return this.type=n,this.setSessionConfig({signalStartTime:Date.now()}),this.nim.initNetcall({type:n,accounts:[this.callee],pushConfig:i,webrtcEnable:!0}).then(function(t){e.signalInited=!0,e.sessionMode="p2p",e.logger.log("initNetcall:",t),e.callerInfo=t,e.channelId=t.channelId,e.imInfo=e.callerInfo,e.imInfo.sessionMode=e.sessionMode,e.imInfo.role=0})["catch"](function(t){return e.setSessionConfig({signalEndTime:Date.now()}),e.controller.uploadDataRtcOnce({code:t.code}),e.resetWhenHangup(),Promise.reject(t)})},t.prototype.response=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sessionConfig,n=void 0===t?{}:t;if(this.controller.uploadDataApi("update",{key:"p2p"}),n.highAudio&&this.controller.uploadDataApi("update",{key:"hd_audio"}),void 0!==n.videoFrameRate&&this.controller.uploadDataApi("update",{key:"fps",ext:0===+n.videoFrameRate?0:+n.videoFrameRate+1}),void 0!==n.videoQuality){var i=+n.videoQuality;i===c.constantRtc.CHAT_VIDEO_QUALITY_540P?i=c.constantRtc.CHAT_VIDEO_QUALITY_720P:i===c.constantRtc.CHAT_VIDEO_QUALITY_720P&&(i=c.constantRtc.CHAT_VIDEO_QUALITY_540P),this.controller.uploadDataApi("update",{key:"video_quality",ext:i||0})}return e.fn="calleeAck",this.baseResponse(e)},t.prototype.control=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="netcallControl",this.baseControl(e)},t.prototype.hangup=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.fn="hangup",e.recordType="cancelNetcallBeforeAccept",this.baseHangup(e)},t.prototype.onBeCalled=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.signalInited=!0,this.channelId=e.channelId,this.beCalledInfo=e,this.log("beCalling",e),this.emit("beCalling",e)},t.prototype.setNetcallSession=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.calling?Promise.reject({type:"statusNotMatch",error:"开启会话失败: 当前正在通话中"}):(this.signalInited=!0,this.calling=!0,this.channelId=e.channelId,this.type=e.netcallType,this.imInfo=e,this.imInfo.serverAddrs=e.rtcServerMap,this.imInfo.rtcUrls=e.rtcServerMap,this.beCalledInfo=this.imInfo,this.imInfo.sessionConfig&&this.setSessionConfig(this.imInfo.sessionConfig),this.parseAccountUidMap(e.accountUidMap),Promise.resolve())},t.prototype.startSession=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.wssArr&&(this.imInfo.serverAddrs=e.wssArr.constructor===Array?e.wssArr:[e.wssArr]),this.baseStartSession(),this.controller.uploadDataApi("start",{uid:this.imInfo.uid}),this.controller.startSession(this.imInfo)},t.prototype.startRtc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.startSession(e)},t.prototype.stopSession=function(){return this.controller.stopSession()},t.prototype.joinChannel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.startSession(e)},t.prototype.leaveChannel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.stopSession(e)},t}(u["default"]),T=C.prototype;T=Object.assign(T,h["default"]),T=Object.assign(T,v["default"]),T=Object.assign(T,y["default"]),T=Object.assign(T,b["default"]),t["default"]=C,e.exports=t["default"]},,function(e,t,n){"use strict";t.__esModule=!0;var i=n(11),r=n(7);t["default"]={createChannel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.tool.verifyOptions(t,"channelName"),t.custom=t.custom||"",t.webrtcEnable=!0,this.controller.uploadDataApi("update",{key:"meeting"}),this.setSessionConfig({signalStartTime:Date.now()}),this.baseCreateChannel("createChannel",t).then(function(e){return Promise.resolve(e)})["catch"](function(t){return e.setSessionConfig({signalEndTime:Date.now()}),e.controller.uploadDataRtcOnce({code:t.code}),Promise.reject(t)})},joinChannel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.signalInited)return Promise.reject("已经加入会议");r.tool.verifyOptions(t,"channelName type");var n=t.sessionConfig,o=void 0===n?{}:n;if(o.bypassRtmp=t.liveEnable,r.tool.merge(this,{sessionConfig:o}),this.setSessionConfig(o),this.setSessionConfig({signalStartTime:Date.now()}),this.controller.uploadDataApi("update",{key:"meeting"}),t.liveEnable&&this.controller.uploadDataApi("update",{key:"bypass",ext:void 0!==o.splitMode?+o.splitMode+1:0}),o.highAudio&&this.controller.uploadDataApi("update",{key:"hd_audio"}),void 0!==o.videoFrameRate&&this.controller.uploadDataApi("update",{key:"fps",ext:0===+o.videoFrameRate?0:+o.videoFrameRate+1}),void 0!==o.videoQuality){var a=+o.videoQuality;a===i.constantRtc.CHAT_VIDEO_QUALITY_540P?a=i.constantRtc.CHAT_VIDEO_QUALITY_720P:a===i.constantRtc.CHAT_VIDEO_QUALITY_720P&&(a=i.constantRtc.CHAT_VIDEO_QUALITY_540P),this.controller.uploadDataApi("update",{key:"video_quality",ext:a||0})}return this.baseJoinChannel("joinChannel",{channelName:t.channelName,liveEnable:t.liveEnable}).then(function(n){return e.type=n.type=t.type,n.account=e.nim.account,e.imInfo=n,e.channelId=n.channelId,e.controller.uploadDataApi("start",{uid:n.uid}),Promise.resolve({uid:n.uid,account:e.nim.account,type:n.type})})["catch"](function(t){return e.controller.uploadDataRtcOnce({code:t.code}),Promise.reject(t)})},leaveChannel:function(){return this.signalInited&&this.sessionMode?"meeting"!==this.sessionMode?Promise.reject({code:"not in a meeting"}):(this.controller.uploadDataApi("send"),this.controller.hangup(),this.resetStatus(),Promise.resolve()):Promise.reject({code:"noConnection"})}},e.exports=t["default"]}])});
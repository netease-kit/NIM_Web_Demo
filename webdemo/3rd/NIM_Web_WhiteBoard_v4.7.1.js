!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.WhiteBoard=e():t.WhiteBoard=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}({0:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},r=n(247),s=i(r),a=n(11);n(58);var c=n(234),l=n(235),u=n(236),h=n(237),p=n(238),d=o({},a.constantBB,{install:function(t,e){c.install(t,e),l.install(t,e),t.parser.mixin({configMap:u,serializeMap:h,unserializeMap:p})},getInstance:function(t){return new s["default"](t)},destroy:function(t){t&&(t.destroy(),t=null)}});t.exports=d},2:function(t,e,n){(function(e,i){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(e,n){t.exports=n()}(this,function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function o(t){return"function"==typeof t}function r(t){$=t}function s(t){X=t}function a(){return function(){return e.nextTick(p)}}function c(){return"undefined"!=typeof G?function(){G(p)}:h()}function l(){var t=0,e=new Z(p),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=p,function(){return t.port2.postMessage(0)}}function h(){var t=setTimeout;return function(){return t(p,1)}}function p(){for(var t=0;t<J;t+=2){var e=nt[t],n=nt[t+1];e(n),nt[t]=void 0,nt[t+1]=void 0}J=0}function d(){try{var t=n(27);return G=t.runOnLoop||t.runOnContext,c()}catch(e){return h()}}function f(t,e){var n=arguments,i=this,o=new this.constructor(v);void 0===o[ot]&&k(o);var r=i._state;return r?!function(){var t=n[r-1];X(function(){return P(r,o,t,i._result)})}():M(i,o,t,e),o}function b(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(v);return S(n,t),n}function v(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function m(t){try{return t.then}catch(e){return ct.error=e,ct}}function _(t,e,n,i){try{t.call(e,n,i)}catch(o){return o}}function w(t,e,n){X(function(t){var i=!1,o=_(n,e,function(n){i||(i=!0,e!==n?S(t,n):I(t,n))},function(e){i||(i=!0,E(t,e))},"Settle: "+(t._label||" unknown promise"));!i&&o&&(i=!0,E(t,o))},t)}function C(t,e){e._state===st?I(t,e._result):e._state===at?E(t,e._result):M(e,void 0,function(e){return S(t,e)},function(e){return E(t,e)})}function T(t,e,n){e.constructor===t.constructor&&n===f&&e.constructor.resolve===b?C(t,e):n===ct?E(t,ct.error):void 0===n?I(t,e):o(n)?w(t,e,n):I(t,e)}function S(e,n){e===n?E(e,g()):t(n)?T(e,n,m(n)):I(e,n)}function O(t){t._onerror&&t._onerror(t._result),A(t)}function I(t,e){t._state===rt&&(t._result=e,t._state=st,0!==t._subscribers.length&&X(A,t))}function E(t,e){t._state===rt&&(t._state=at,t._result=e,X(O,t))}function M(t,e,n,i){var o=t._subscribers,r=o.length;t._onerror=null,o[r]=e,o[r+st]=n,o[r+at]=i,0===r&&t._state&&X(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,o=void 0,r=t._result,s=0;s<e.length;s+=3)i=e[s],o=e[s+n],i?P(n,i,o,r):o(r);t._subscribers.length=0}}function x(){this.error=null}function D(t,e){try{return t(e)}catch(n){return lt.error=n,lt}}function P(t,e,n,i){var r=o(n),s=void 0,a=void 0,c=void 0,l=void 0;if(r){if(s=D(n,i),s===lt?(l=!0,a=s.error,s=null):c=!0,e===s)return void E(e,y())}else s=i,c=!0;e._state!==rt||(r&&c?S(e,s):l?E(e,a):t===st?I(e,s):t===at&&E(e,s))}function N(t,e){try{e(function(e){S(t,e)},function(e){E(t,e)})}catch(n){E(t,n)}}function R(){return ut++}function k(t){t[ot]=ut++,t._state=void 0,t._result=void 0,t._subscribers=[]}function j(t,e){this._instanceConstructor=t,this.promise=new t(v),this.promise[ot]||k(this.promise),z(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&I(this.promise,this._result))):E(this.promise,U())}function U(){return new Error("Array Methods must be provided an Array")}function L(t){return new j(this,t).promise}function W(t){var e=this;return new e(z(t)?function(n,i){for(var o=t.length,r=0;r<o;r++)e.resolve(t[r]).then(n,i)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function B(t){var e=this,n=new e(v);return E(n,t),n}function H(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Y(t){this[ot]=R(),this._result=this._state=void 0,this._subscribers=[],v!==t&&("function"!=typeof t&&H(),this instanceof Y?N(this,t):F())}function V(){var t=void 0;if("undefined"!=typeof i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;if(n){var o=null;try{o=Object.prototype.toString.call(n.resolve())}catch(e){}if("[object Promise]"===o&&!n.cast)return}t.Promise=Y}var K=void 0;K=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var z=K,J=0,G=void 0,$=void 0,X=function(t,e){nt[J]=t,nt[J+1]=e,J+=2,2===J&&($?$(p):it())},Q="undefined"!=typeof window?window:void 0,q=Q||{},Z=q.MutationObserver||q.WebKitMutationObserver,tt="undefined"==typeof self&&"undefined"!=typeof e&&"[object process]"==={}.toString.call(e),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,nt=new Array(1e3),it=void 0;it=tt?a():Z?l():et?u():void 0===Q?d():h();var ot=Math.random().toString(36).substring(16),rt=void 0,st=1,at=2,ct=new x,lt=new x,ut=0;return j.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===rt&&n<t;n++)this._eachEntry(e[n],n)},j.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===b){var o=m(t);if(o===f&&t._state!==rt)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===Y){var r=new n(v);T(r,t,o),this._willSettleAt(r,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(i(t),e)},j.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===rt&&(this._remaining--,t===at?E(i,n):this._result[e]=n),0===this._remaining&&I(i,this._result)},j.prototype._willSettleAt=function(t,e){var n=this;M(t,void 0,function(t){return n._settledAt(st,e,t)},function(t){return n._settledAt(at,e,t)})},Y.all=L,Y.race=W,Y.resolve=b,Y.reject=B,Y._setScheduler=r,Y._setAsap=s,Y._asap=X,Y.prototype={constructor:Y,then:f,"catch":function(t){return this.then(null,t)}},Y.polyfill=V,Y.Promise=Y,Y})}).call(e,n(9),function(){return this}())},3:function(t,e,n){(function(e){"use strict";var n="'4db505f2e1cdc97d7458d785af6ed6d86bf9c3e3",i="4db505f2'",o="4.7.1",r="2.3.1.0118",s="3.6.1",a="41",c=1,l="https://lbs.netease.im/lbs/webconf.jsp",u="development"===e.env.NODE_ENV?6e3:42e3,h={info:{hash:n,shortHash:i,version:o,sdkVersion:a,nrtcVersion:s,protocolVersion:c},agentVersion:r,lbsUrl:l,connectTimeout:u,xhrTimeout:u,socketTimeout:u,reconnectionDelay:656.25,reconnectionDelayMax:u,reconnectionJitter:.1,heartbeatInterval:18e4,cmdTimeout:u};h.formatSocketUrl=function(t){var e=t.url,n=t.secure,i=n?"https":"http";return e.indexOf("http")===-1?i+"://"+e:e},h.fileServerUrl="https://nos.netease.com",h.replaceUrl="http://nos.netease.im",h.genUploadUrl=function(t){return h.uploadUrl?h.uploadUrl+"/"+t:h.fileServerUrl+"/"+t},h.genDownloadUrl=function(t,e){return h.downloadUrl?h.replaceUrl+"/"+t+"/"+e:"https://"+t+".nosdn.127.net/"+e},t.exports=h}).call(e,n(9))},4:function(t,e,n){"use strict";function i(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function r(){this._events=new i,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,a="~";Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(a=!1)),r.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)s.call(t,e)&&n.push(a?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},r.prototype.listeners=function(t,e){var n=a?a+t:t,i=this._events[n];if(e)return!!i;if(!i)return[];if(i.fn)return[i.fn];for(var o=0,r=i.length,s=new Array(r);o<r;o++)s[o]=i[o].fn;return s},r.prototype.emit=function(t,e,n,i,o,r){var s=a?a+t:t;if(!this._events[s])return!1;var c,l,u=this._events[s],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,i),!0;case 5:return u.fn.call(u.context,e,n,i,o),!0;case 6:return u.fn.call(u.context,e,n,i,o,r),!0}for(l=1,c=new Array(h-1);l<h;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var p,d=u.length;for(l=0;l<d;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,n);break;case 4:u[l].fn.call(u[l].context,e,n,i);break;default:if(!c)for(p=1,c=new Array(h-1);p<h;p++)c[p-1]=arguments[p];u[l].fn.apply(u[l].context,c)}}return!0},r.prototype.on=function(t,e,n){var i=new o(e,n||this),r=a?a+t:t;return this._events[r]?this._events[r].fn?this._events[r]=[this._events[r],i]:this._events[r].push(i):(this._events[r]=i,this._eventsCount++),this},r.prototype.once=function(t,e,n){var i=new o(e,n||this,!0),r=a?a+t:t;return this._events[r]?this._events[r].fn?this._events[r]=[this._events[r],i]:this._events[r].push(i):(this._events[r]=i,this._eventsCount++),this},r.prototype.removeListener=function(t,e,n,o){var r=a?a+t:t;if(!this._events[r])return this;if(!e)return 0===--this._eventsCount?this._events=new i:delete this._events[r],this;var s=this._events[r];if(s.fn)s.fn!==e||o&&!s.once||n&&s.context!==n||(0===--this._eventsCount?this._events=new i:delete this._events[r]);else{for(var c=0,l=[],u=s.length;c<u;c++)(s[c].fn!==e||o&&!s[c].once||n&&s[c].context!==n)&&l.push(s[c]);l.length?this._events[r]=1===l.length?l[0]:l:0===--this._eventsCount?this._events=new i:delete this._events[r]}return this},r.prototype.removeAllListeners=function(t){var e;return t?(e=a?a+t:t,this._events[e]&&(0===--this._eventsCount?this._events=new i:delete this._events[e])):(this._events=new i,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=a,r.EventEmitter=r,t.exports=r},7:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var o=n(46);Object.defineProperty(e,"ajax",{enumerable:!0,get:function(){return i(o)["default"]}});var r=n(47);Object.defineProperty(e,"element",{enumerable:!0,get:function(){return i(r)["default"]}});var s=n(48);Object.defineProperty(e,"tool",{enumerable:!0,get:function(){return i(s)["default"]}})},9:function(t,e){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(u===setTimeout)return setTimeout(t,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function r(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){b&&d&&(b=!1,d.length?f=d.concat(f):v=-1,f.length&&a())}function a(){if(!b){var t=o(s);b=!0;for(var e=f.length;e;){for(d=f,f=[];++v<e;)d&&d[v].run();v=-1,e=f.length}d=null,b=!1,r(t)}}function c(t,e){this.fun=t,this.array=e}function l(){}var u,h,p=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(t){u=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var d,f=[],b=!1,v=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];f.push(new c(t,e)),1!==f.length||b||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.prependListener=l,p.prependOnceListener=l,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},11:function(t,e){"use strict";e.__esModule=!0;var n,i,o,r,s={CONTROL_COMMAND_BUSY:9,CONTROL_COMMAND_SELF_ON_BACKGROUND:12,CONTROL_COMMAND_START_NOTIFY_RECEIVED:13},a={NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_ON:1,NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_OFF:2,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_ON:3,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_OFF:4,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO:5,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_AGREE:6,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_REJECT:7,NETCALL_CONTROL_COMMAND_SWITCH_VIDEO_TO_AUDIO:8,NETCALL_CONTROL_COMMAND_BUSY:9,NETCALL_CONTROL_COMMAND_SELF_CAMERA_INVALID:10,NETCALL_CONTROL_COMMAND_SELF_AUDIO_INVALID:11,NETCALL_CONTROL_COMMAND_SELF_ON_BACKGROUND:12,NETCALL_CONTROL_COMMAND_START_NOTIFY_RECEIVED:13,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_START:14,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_STOP:15},c={HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1},l={NETCALL_TYPE_AUDIO:1,NETCALL_TYPE_VIDEO:2,DEVICE_TYPE_AUDIO_IN:0,DEVICE_TYPE_AUDIO_OUT_LOCAL:1,DEVICE_TYPE_AUDIO_OUT_CHAT:2,DEVICE_TYPE_VIDEO:3,DEVICE_TYPE_DESKTOP_SCREEN:4,DEVICE_TYPE_DESKTOP_WINDOW:5,CHAT_VIDEO_QUALITY_NORMAL:0,CHAT_VIDEO_QUALITY_LOW:1,CHAT_VIDEO_QUALITY_MEDIUM:2,CHAT_VIDEO_QUALITY_HIGH:3,CHAT_VIDEO_QUALITY_480P:4,CHAT_VIDEO_QUALITY_540P:5,CHAT_VIDEO_QUALITY_720P:6,CHAT_VIDEO_FRAME_RATE_NORMAL:0,CHAT_VIDEO_FRAME_RATE_5:1,CHAT_VIDEO_FRAME_RATE_10:2,CHAT_VIDEO_FRAME_RATE_15:3,CHAT_VIDEO_FRAME_RATE_20:4,CHAT_VIDEO_FRAME_RATE_25:5,LAYOUT_SPLITBOTTOMHORFLOATING:0,LAYOUT_SPLITTOPHORFLOATING:1,LAYOUT_SPLITLATTICETILE:2,LAYOUT_SPLITLATTICECUTTINGTILE:3,LAYOUT_SPLITCUSTOM:4,ROLE_PLAYER:0,ROLE_AUDIENCE:1},u={WB_TYPE_TCP:2,WB_TYPE_UDP:3,CALL_TYPE_NONE:0,CALL_TYPE_AUDIO:1,HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1};l.deviceTypeMap=(n={},n[l.DEVICE_TYPE_AUDIO_IN]="audioIn",n[l.DEVICE_TYPE_AUDIO_OUT_CHAT]="audioOut",n[l.DEVICE_TYPE_VIDEO]="video",n),l.deviceTypeMap=(i={},i[l.DEVICE_TYPE_AUDIO_IN]="audioIn",i[l.DEVICE_TYPE_AUDIO_OUT_LOCAL]="audioOut",i[l.DEVICE_TYPE_AUDIO_OUT_CHAT]="audioOut",i[l.DEVICE_TYPE_VIDEO]="video",i),l.videoMap={frame:(o={},o[l.CHAT_VIDEO_QUALITY_NORMAL]="480x320",o[l.CHAT_VIDEO_QUALITY_LOW]="176x144",o[l.CHAT_VIDEO_QUALITY_MEDIUM]="352x288",o[l.CHAT_VIDEO_QUALITY_HIGH]="480x320",o[l.CHAT_VIDEO_QUALITY_480P]="640x480",o[l.CHAT_VIDEO_QUALITY_540P]="960x540",o[l.CHAT_VIDEO_QUALITY_720P]="1280x720",o),frameRate:(r={},r[l.CHAT_VIDEO_FRAME_RATE_NORMAL]=15,r[l.CHAT_VIDEO_FRAME_RATE_5]=5,r[l.CHAT_VIDEO_FRAME_RATE_10]=10,r[l.CHAT_VIDEO_FRAME_RATE_15]=15,r[l.CHAT_VIDEO_FRAME_RATE_20]=20,r[l.CHAT_VIDEO_FRAME_RATE_25]=25,r)};var h={getVideoSessionConfig:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.quality,n=void 0===e?l.CHAT_VIDEO_QUALITY_NORMAL:e,i=t.frameRate,o=void 0===i?l.CHAT_VIDEO_FRAME_RATE_NORMAL:i,r={},s=l.videoMap.frame[n];return r.frameRate=l.videoMap.frameRate[o],r.width=+s.split("x")[0],r.height=+s.split("x")[1],r},getDeviceTypeStr:function(t){return l.deviceTypeMap[t]},getDeviceTypeMap:function(t){return l.deviceTypeMap[t]}},p=Object.assign(l,a,c),d=Object.assign(u,s,c);e.constantTool=h,e.constantRtc=p,e.constantBB=d},12:function(t,e,n){var i;(function(t,o){(function(){"use strict";function r(t){return t=String(t),t.charAt(0).toUpperCase()+t.slice(1)}function s(t,e,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return e&&n&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(i=i[/[\d.]+$/.exec(t)])&&(t="Windows "+i),t=String(t),e&&n&&(t=t.replace(RegExp(e,"i"),n)),t=c(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function a(t,e){var n=-1,i=t?t.length:0;if("number"==typeof i&&i>-1&&i<=C)for(;++n<i;)e(t[n],n,t);else l(t,e)}function c(t){return t=f(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:r(t)}function l(t,e){for(var n in t)I.call(t,n)&&e(t[n],n,t)}function u(t){return null==t?r(t):E.call(t).slice(8,-1)}function h(t,e){var n=null!=t?typeof t[e]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!t[e])}function p(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function d(t,e){var n=null;return a(t,function(i,o){n=e(n,i,o,t)}),n}function f(t){return String(t).replace(/^ +| +$/g,"")}function b(t){function e(e){return d(e,function(e,n){return e||RegExp("\\b"+(n.pattern||p(n))+"\\b","i").exec(t)&&(n.label||n)})}function n(e){return d(e,function(e,n,i){return e||(n[$]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec($)]||RegExp("\\b"+p(i)+"(?:\\b|\\w*\\d)","i").exec(t))&&i})}function i(e){return d(e,function(e,n){return e||RegExp("\\b"+(n.pattern||p(n))+"\\b","i").exec(t)&&(n.label||n)})}function o(e){return d(e,function(e,n){var i=n.pattern||p(n);return!e&&(e=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=s(e,i,n.label||n)),e})}function r(e){return d(e,function(e,n){var i=n.pattern||p(n);return!e&&(e=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=c(e[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e})}function a(e){return d(e,function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})}function v(){return this.description||""}var m=g,_=t&&"object"==typeof t&&"String"!=u(t);_&&(m=t,t=null);var w=m.navigator||{},C=w.userAgent||"";t||(t=C);var O,I,M=_||S==y,A=_?!!w.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(E.toString()),x="Object",D=_?x:"ScriptBridgingProxyObject",P=_?x:"Environment",N=_&&m.java?"JavaPackage":u(m.java),R=_?x:"RuntimeObject",k=/\bJava/.test(N)&&m.java,j=k&&u(m.environment)==P,U=k?"a":"α",L=k?"b":"β",W=m.document||{},B=m.operamini||m.opera,H=T.test(H=_&&B?B["[[Class]]"]:u(B))?H:B=null,F=t,Y=[],V=null,K=t==C,z=K&&B&&"function"==typeof B.version&&B.version(),J=e([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),G=i(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),$=r([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),X=n({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),Q=o(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(J&&(J=[J]),X&&!$&&($=r([X])),(O=/\bGoogle TV\b/.exec($))&&($=O[0]),/\bSimulator\b/i.test(t)&&($=($?$+" ":"")+"Simulator"),"Opera Mini"==G&&/\bOPiOS\b/.test(t)&&Y.push("running in Turbo/Uncompressed mode"),"IE"==G&&/\blike iPhone OS\b/.test(t)?(O=b(t.replace(/like iPhone OS/,"")),X=O.manufacturer,$=O.product):/^iP/.test($)?(G||(G="Safari"),Q="iOS"+((O=/ OS ([\d_]+)/i.exec(t))?" "+O[1].replace(/_/g,"."):"")):"Konqueror"!=G||/buntu/i.test(Q)?X&&"Google"!=X&&(/Chrome/.test(G)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test($))||/\bAndroid\b/.test(Q)&&/^Chrome/.test(G)&&/\bVersion\//i.test(t)?(G="Android Browser",Q=/\bAndroid\b/.test(Q)?Q:"Android"):"Silk"==G?(/\bMobi/i.test(t)||(Q="Android",Y.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&Y.unshift("accelerated")):"PaleMoon"==G&&(O=/\bFirefox\/([\d.]+)\b/.exec(t))?Y.push("identifying as Firefox "+O[1]):"Firefox"==G&&(O=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(Q||(Q="Firefox OS"),$||($=O[1])):!G||(O=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(G))?(G&&!$&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(O+"/")+8))&&(G=null),(O=$||X||Q)&&($||X||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(Q))&&(G=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(Q)?Q:O)+" Browser")):"Electron"==G&&(O=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&Y.push("Chromium "+O):Q="Kubuntu",z||(z=a(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",p(G),"(?:Firefox|Minefield|NetFront)"])),(O="iCab"==J&&parseFloat(z)>3&&"WebKit"||/\bOpera\b/.test(G)&&(/\bOPR\b/.test(t)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(J)&&"WebKit"||!J&&/\bMSIE\b/i.test(t)&&("Mac OS"==Q?"Tasman":"Trident")||"WebKit"==J&&/\bPlayStation\b(?! Vita\b)/i.test(G)&&"NetFront")&&(J=[O]),"IE"==G&&(O=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(G+=" Mobile",Q="Windows Phone "+(/\+$/.test(O)?O:O+".x"),Y.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(G="IE Mobile",Q="Windows Phone 8.x",Y.unshift("desktop mode"),z||(z=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=G&&"Trident"==J&&(O=/\brv:([\d.]+)/.exec(t))&&(G&&Y.push("identifying as "+G+(z?" "+z:"")),G="IE",z=O[1]),K){if(h(m,"global"))if(k&&(O=k.lang.System,F=O.getProperty("os.arch"),Q=Q||O.getProperty("os.name")+" "+O.getProperty("os.version")),M&&h(m,"system")&&(O=[m.system])[0]){Q||(Q=O[0].os||null);try{O[1]=m.require("ringo/engine").version,z=O[1].join("."),G="RingoJS"}catch(q){O[0].global.system==m.system&&(G="Narwhal")}}else"object"==typeof m.process&&!m.process.browser&&(O=m.process)?"object"==typeof O.versions?"string"==typeof O.versions.electron?(Y.push("Node "+O.versions.node),G="Electron",z=O.versions.electron):"string"==typeof O.versions.nw&&(Y.push("Chromium "+z,"Node "+O.versions.node),G="NW.js",z=O.versions.nw):(G="Node.js",F=O.arch,Q=O.platform,z=/[\d.]+/.exec(O.version),z=z?z[0]:"unknown"):j&&(G="Rhino");else u(O=m.runtime)==D?(G="Adobe AIR",Q=O.flash.system.Capabilities.os):u(O=m.phantom)==R?(G="PhantomJS",z=(O=O.version||null)&&O.major+"."+O.minor+"."+O.patch):"number"==typeof W.documentMode&&(O=/\bTrident\/(\d+)/i.exec(t))?(z=[z,W.documentMode],(O=+O[1]+4)!=z[1]&&(Y.push("IE "+z[1]+" mode"),J&&(J[1]=""),z[1]=O),z="IE"==G?String(z[1].toFixed(1)):z[0]):"number"==typeof W.documentMode&&/^(?:Chrome|Firefox)\b/.test(G)&&(Y.push("masking as "+G+" "+z),G="IE",z="11.0",J=["Trident"],Q="Windows");Q=Q&&c(Q)}if(z&&(O=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(z)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(K&&w.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(V=/b/i.test(O)?"beta":"alpha",z=z.replace(RegExp(O+"\\+?$"),"")+("beta"==V?L:U)+(/\d+\+?/.exec(O)||"")),"Fennec"==G||"Firefox"==G&&/\b(?:Android|Firefox OS)\b/.test(Q))G="Firefox Mobile";else if("Maxthon"==G&&z)z=z.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test($))"Xbox 360"==$&&(Q=null),"Xbox 360"==$&&/\bIEMobile\b/.test(t)&&Y.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(G)&&(!G||$||/Browser|Mobi/.test(G))||"Windows CE"!=Q&&!/Mobi/i.test(t))if("IE"==G&&K)try{null===m.external&&Y.unshift("platform preview")}catch(q){Y.unshift("embedded")}else(/\bBlackBerry\b/.test($)||/\bBB10\b/.test(t))&&(O=(RegExp($.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||z)?(O=[O,/BB10/.test(t)],Q=(O[1]?($=null,X="BlackBerry"):"Device Software")+" "+O[0],z=null):this!=l&&"Wii"!=$&&(K&&B||/Opera/.test(G)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==G&&/\bOS X (?:\d+\.){2,}/.test(Q)||"IE"==G&&(Q&&!/^Win/.test(Q)&&z>5.5||/\bWindows XP\b/.test(Q)&&z>8||8==z&&!/\bTrident\b/.test(t)))&&!T.test(O=b.call(l,t.replace(T,"")+";"))&&O.name&&(O="ing as "+O.name+((O=O.version)?" "+O:""),T.test(G)?(/\bIE\b/.test(O)&&"Mac OS"==Q&&(Q=null),O="identify"+O):(O="mask"+O,G=H?c(H.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(O)&&(Q=null),K||(z=null)),J=["Presto"],Y.push(O));else G+=" Mobile";(O=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(O=[parseFloat(O.replace(/\.(\d)$/,".0$1")),O],"Safari"==G&&"+"==O[1].slice(-1)?(G="WebKit Nightly",V="alpha",z=O[1].slice(0,-1)):z!=O[1]&&z!=(O[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(z=null),O[1]=(/\bChrome\/([\d.]+)/i.exec(t)||0)[1],537.36==O[0]&&537.36==O[2]&&parseFloat(O[1])>=28&&"WebKit"==J&&(J=["Blink"]),K&&(A||O[1])?(J&&(J[1]="like Chrome"),O=O[1]||(O=O[0],O<530?1:O<532?2:O<532.05?3:O<533?4:O<534.03?5:O<534.07?6:O<534.1?7:O<534.13?8:O<534.16?9:O<534.24?10:O<534.3?11:O<535.01?12:O<535.02?"13+":O<535.07?15:O<535.11?16:O<535.19?17:O<536.05?18:O<536.1?19:O<537.01?20:O<537.11?"21+":O<537.13?23:O<537.18?24:O<537.24?25:O<537.36?26:"Blink"!=J?"27":"28")):(J&&(J[1]="like Safari"),O=O[0],O=O<400?1:O<500?2:O<526?3:O<533?4:O<534?"4+":O<535?5:O<537?6:O<538?7:O<601?8:"8"),J&&(J[1]+=" "+(O+="number"==typeof O?".x":/[.+]/.test(O)?"":"+")),"Safari"==G&&(!z||parseInt(z)>45)&&(z=O)),"Opera"==G&&(O=/\bzbov|zvav$/.exec(Q))?(G+=" ",Y.unshift("desktop mode"),"zvav"==O?(G+="Mini",z=null):G+="Mobile",Q=Q.replace(RegExp(" *"+O+"$"),"")):"Safari"==G&&/\bChrome\b/.exec(J&&J[1])&&(Y.unshift("desktop mode"),G="Chrome Mobile",z=null,/\bOS X\b/.test(Q)?(X="Apple",Q="iOS 4.3+"):Q=null),z&&0==z.indexOf(O=/[\d.]+$/.exec(Q))&&t.indexOf("/"+O+"-")>-1&&(Q=f(Q.replace(O,""))),J&&!/\b(?:Avant|Nook)\b/.test(G)&&(/Browser|Lunascape|Maxthon/.test(G)||"Safari"!=G&&/^iOS/.test(Q)&&/\bSafari\b/.test(J[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(G)&&J[1])&&(O=J[J.length-1])&&Y.push(O),Y.length&&(Y=["("+Y.join("; ")+")"]),X&&$&&$.indexOf(X)<0&&Y.push("on "+X),$&&Y.push((/^on /.test(Y[Y.length-1])?"":"on ")+$),Q&&(O=/ ([\d.+]+)$/.exec(Q),I=O&&"/"==Q.charAt(Q.length-O[0].length-1),Q={architecture:32,family:O&&!I?Q.replace(O[0],""):Q,version:O?O[1]:null,toString:function(){var t=this.version;return this.family+(t&&!I?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(O=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(F))&&!/\bi686\b/i.test(F)?(Q&&(Q.architecture=64,Q.family=Q.family.replace(RegExp(" *"+O),"")),G&&(/\bWOW64\b/i.test(t)||K&&/\w(?:86|32)$/.test(w.cpuClass||w.platform)&&!/\bWin64; x64\b/i.test(t))&&Y.unshift("32-bit")):Q&&/^OS X/.test(Q.family)&&"Chrome"==G&&parseFloat(z)>=39&&(Q.architecture=64),t||(t=null);var Z={};return Z.description=t,Z.layout=J&&J[0],Z.manufacturer=X,Z.name=G,Z.prerelease=V,Z.product=$,Z.ua=t,Z.version=G&&z,Z.os=Q||{architecture:null,family:null,version:null,toString:function(){return"null"}},Z.parse=b,Z.toString=v,Z.version&&Y.unshift(z),Z.name&&Y.unshift(G),Q&&G&&(Q!=String(Q).split(" ")[0]||Q!=G.split(" ")[0]&&!$)&&Y.push($?"("+Q+")":"on "+Q),Y.length&&(Z.description=Y.join(" ")),Z}var v={"function":!0,object:!0},g=v[typeof window]&&window||this,y=g,m=v[typeof e]&&e,_=v[typeof t]&&t&&!t.nodeType&&t,w=m&&_&&"object"==typeof o&&o;!w||w.global!==w&&w.window!==w&&w.self!==w||(g=w);var C=Math.pow(2,53)-1,T=/\bOpera/,S=this,O=Object.prototype,I=O.hasOwnProperty,E=O.toString,M=b();g.platform=M,i=function(){return M}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))}).call(this)}).call(e,n(16)(t),function(){return this}())},16:function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},20:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var o=n(24);Object.defineProperty(e,"monitor",{enumerable:!0,get:function(){return i(o)["default"]}});var r=n(34);Object.defineProperty(e,"signal",{enumerable:!0,get:function(){return i(r)["default"]}});var s=n(64);Object.defineProperty(e,"configMap",{enumerable:!0,get:function(){return i(s)["default"]}});var a=n(7);Object.defineProperty(e,"utils",{enumerable:!0,get:function(){return i(a)["default"]}})},24:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var o=n(43),r=i(o),s=n(44),a=i(s),c=n(45),l=i(c);e["default"]={DataApi:function(t){return new r["default"](t)},DataRtc:function(t){return new a["default"](t)},DataStats:function(t){return new l["default"](t)}},t.exports=e["default"]},26:function(t,e,n){var i,o;!function(r,s){"use strict";i=s,o="function"==typeof i?i.call(e,n,e,t):i,!(void 0!==o&&(t.exports=o))}(this,function(){var t,e,n,i,o=Function.call,r=Object.prototype,s=o.bind(r.hasOwnProperty),a=o.bind(r.propertyIsEnumerable),c=o.bind(r.toString),l=s(r,"__defineGetter__");l&&(t=o.bind(r.__defineGetter__),e=o.bind(r.__defineSetter__),n=o.bind(r.__lookupGetter__),i=o.bind(r.__lookupSetter__));var u=function(t){return null==t||"object"!=typeof t&&"function"!=typeof t};Object.getPrototypeOf||(Object.getPrototypeOf=function(t){var e=t.__proto__;return e||null===e?e:"[object Function]"===c(t.constructor)?t.constructor.prototype:t instanceof Object?r:null});var h=function(t){try{return t.sentinel=0,0===Object.getOwnPropertyDescriptor(t,"sentinel").value}catch(e){return!1}};if(Object.defineProperty){var p=h({}),d="undefined"==typeof document||h(document.createElement("div"));if(!d||!p)var f=Object.getOwnPropertyDescriptor}if(!Object.getOwnPropertyDescriptor||f){var b="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(t,e){if(u(t))throw new TypeError(b+t);if(f)try{return f.call(Object,t,e)}catch(o){}var c;if(!s(t,e))return c;if(c={enumerable:a(t,e),configurable:!0},l){var h=t.__proto__,p=t!==r;p&&(t.__proto__=r);var d=n(t,e),v=i(t,e);if(p&&(t.__proto__=h),d||v)return d&&(c.get=d),v&&(c.set=v),c}return c.value=t[e],c.writable=!0,c}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(t){return Object.keys(t)}),!Object.create){var v,g=!({__proto__:null}instanceof Object),y=function(){if(!document.domain)return!1;try{return!!new ActiveXObject("htmlfile")}catch(t){return!1}},m=function(){var t,e;e=new ActiveXObject("htmlfile");var n="script";return e.write("<"+n+"></"+n+">"),e.close(),t=e.parentWindow.Object.prototype,e=null,t},_=function(){var t,e=document.createElement("iframe"),n=document.body||document.documentElement;return e.style.display="none",
n.appendChild(e),e.src="javascript:",t=e.contentWindow.Object.prototype,n.removeChild(e),e=null,t};v=g||"undefined"==typeof document?function(){return{__proto__:null}}:function(){var t=y()?m():_();delete t.constructor,delete t.hasOwnProperty,delete t.propertyIsEnumerable,delete t.isPrototypeOf,delete t.toLocaleString,delete t.toString,delete t.valueOf;var e=function(){};return e.prototype=t,v=function(){return new e},new e},Object.create=function(t,e){var n,i=function(){};if(null===t)n=v();else{if(null!==t&&u(t))throw new TypeError("Object prototype may only be an Object or null");i.prototype=t,n=new i,n.__proto__=t}return void 0!==e&&Object.defineProperties(n,e),n}}var w=function(t){try{return Object.defineProperty(t,"sentinel",{}),"sentinel"in t}catch(e){return!1}};if(Object.defineProperty){var C=w({}),T="undefined"==typeof document||w(document.createElement("div"));if(!C||!T)var S=Object.defineProperty,O=Object.defineProperties}if(!Object.defineProperty||S){var I="Property description must be an object: ",E="Object.defineProperty called on non-object: ",M="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(o,s,a){if(u(o))throw new TypeError(E+o);if(u(a))throw new TypeError(I+a);if(S)try{return S.call(Object,o,s,a)}catch(c){}if("value"in a)if(l&&(n(o,s)||i(o,s))){var h=o.__proto__;o.__proto__=r,delete o[s],o[s]=a.value,o.__proto__=h}else o[s]=a.value;else{var p="get"in a,d="set"in a;if(!l&&(p||d))throw new TypeError(M);p&&t(o,s,a.get),d&&e(o,s,a.set)}return o}}Object.defineProperties&&!O||(Object.defineProperties=function(t,e){if(O)try{return O.call(Object,t,e)}catch(n){}return Object.keys(e).forEach(function(n){"__proto__"!==n&&Object.defineProperty(t,n,e[n])}),t}),Object.seal||(Object.seal=function(t){if(Object(t)!==t)throw new TypeError("Object.seal can only be called on Objects.");return t}),Object.freeze||(Object.freeze=function(t){if(Object(t)!==t)throw new TypeError("Object.freeze can only be called on Objects.");return t});try{Object.freeze(function(){})}catch(A){Object.freeze=function(t){return function(e){return"function"==typeof e?e:t(e)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(t){if(Object(t)!==t)throw new TypeError("Object.preventExtensions can only be called on Objects.");return t}),Object.isSealed||(Object.isSealed=function(t){if(Object(t)!==t)throw new TypeError("Object.isSealed can only be called on Objects.");return!1}),Object.isFrozen||(Object.isFrozen=function(t){if(Object(t)!==t)throw new TypeError("Object.isFrozen can only be called on Objects.");return!1}),Object.isExtensible||(Object.isExtensible=function(t){if(Object(t)!==t)throw new TypeError("Object.isExtensible can only be called on Objects.");for(var e="";s(t,e);)e+="?";t[e]=!0;var n=s(t,e);return delete t[e],n})})},27:function(t,e){},34:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=n(20),a=n(49),c=n(4),l=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var r=o(this,t.call(this));return r.info=Object.assign({},n),r.init(),r.logger=n.logger||window.console,r.autoReconnect=n.autoReconnect||!0,r.isDestroy=!1,r.reConnectCount=0,r.wssUrl=null,r}return r(e,t),e}(c),u=l.prototype;u.init=function(){this.reset()},u.reset=function(){this.imInfo={}},u.connect=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.url,i=void 0===n?this.wssUrl:n,o=e.imInfo;return this.imInfo=o||this.imInfo,i?new Promise(function(e,n){t.url=i;var o=void 0;try{o=t.ws=new WebSocket("wss://"+i);var r=t;o.onopen=function(n){t.wssUrl=i,r.initSignal(),r.signalConnected=!0,r.emit("signalConnected"),e(r),t.heartbeat()},o.onclose=o.onerror=function(t){r.signalConnected=!1,n(t)}}catch(s){t.logger.error("信令连接建立失败",s),n(s)}}):Promise.reject("信令地址缺失")},u.initSignal=function(){var t=this,e=this.ws,n=e.send;e.send=function(t){n.call(this,JSON.stringify(t))},e.onmessage=function(e){var n=JSON.parse(e.data||null);if(n)return!t.isHeartBeating||"keep_alive_ack"!==n.type&&n.type!==a.serializeWb.gateWay.keep_alive_ack?void t.emit("message",n):void t.onHeartBeat(n)},e.onclose=function(e){t.signalConnected=!1,t.emit("signalTimeout",e)},e.onerror=function(e){t.signalConnected=!1,t.emit("signalError",e)}},u.send=function(t){var e=this;"keep_alive"!==t.type,this.ws&&this.signalConnected&&this.ws.readyState===this.ws.OPEN?(t.browser={},t.browser.name=window.platform.name,t.browser.version=window.platform.version,this.ws.send(t)):this.once("signalConnected",function(){e.send(t)})},u.heartbeat=function(){this.socketData=this.socketData||{uid:this.imInfo.uid,cid:this.imInfo.cid},this.heartBeatList=[],this.bindHearBeat(5)},u.onHeartBeat=function(t){this.heartBeatList.shift(),this.bindHearBeat(5)},u.heartBeatHandler=function(){var t=this.socketData,e=this.heartBeatList;if(e){var n=Date.now(),i=n;if(s.configMap.CURRENT.SDK_TYPE===s.configMap.SDK_TYPE.WHITEBOARD&&(i=+n.toString().slice(0,-3)),e.constructor===Array&&0===e.length){e.push(n);var o=this.getContentData({type:"keep_alive",uid:s.configMap.CURRENT.SDK_TYPE===s.configMap.SDK_TYPE.WHITEBOARD?+t.uid:t.uid+"",cid:s.configMap.CURRENT.SDK_TYPE===s.configMap.SDK_TYPE.WHITEBOARD?+t.cid:t.cid+""},i);return this.send(o),void this.bindHearBeat(5)}var r=Date.now()-e[0];if(r>3e4)this.logger.error("socket error: heartbeat timeout"),this.emit("signalTimeout");else if(r>2e3&&r<3e4){this.logger.warn("socket error: no response, keep heartbeat"),e.push(n);var a=this.getContentData({type:"keep_alive",uid:t.uid,cid:t.cid},i);this.send(a),this.bindHearBeat(2)}}},u.getContentData=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];return s.configMap.CURRENT.SDK_TYPE===s.configMap.SDK_TYPE.WHITEBOARD?(t.version=31,t.type=a.serializeWb.gateWay[t.type],t.content={params:{timestamp:+e}}):t.params={content:{timestamp:e+""}},t},u.bindHearBeat=function(t){this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.isHeartBeating=setTimeout(this.heartBeatHandler.bind(this),1e3*t)},u.stopHeartBeat=function(){this.isHeartBeating&&(this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.heartBeatTimer&&clearInterval(this.heartBeatTimer),this.isHeartBeating=null,this.heartBeatTimer=null,this.heartBeatList=null,this.heartBeatCount=0)},u.logout=function(){var t=this.socketData,e=Date.now().toString(),n=this.getContentData({type:"logout",uid:t.uid,cid:t.cid},e);this.send(n)},u.destroy=function(){this.logger.log("signal close -> signal.js"),this.stopHeartBeat(),this.isDestroy=!0,this.ws&&(this.ws.onopen=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.ws=null)},e["default"]=l,t.exports=e["default"]},43:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=n(7),r=n(3),s=r.info.nrtcVersion,a="https://statistic.live.126.net/statistic/realtime/sdkFunctioninfo",c=function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,u);var e=t.appkey,n=t.platform;this.apis={},this.isRtc=/WebRTC/.test(n),this.init(e,n),this.resetStatus()};e["default"]=c;var l=c.prototype;l.init=function(t,e){this.apis=Object.assign(this.apis,{ver:1,platform:e,sdk_ver:s||"v4.4.0",uid:null,appkey:t,time:null})},l.start=function(t){this.calling=!0,this.apis=Object.assign(this.apis,t)},l.resetStatus=function(){this.calling=!1,this.apis=Object.assign(this.apis,{p2p:{value:0},meeting:{value:0},bypass:{value:0},call_control_type:{value:0},self_mute:{value:-1},self_mic_mute:{value:-1},switch_p2p_type:{value:0},set_speaker:{value:-1},net_detect:{value:this.isRtc?-1:0},beautify:{value:-1},water_mark:{value:-1},audio_samples:{value:-1},video_samples:{value:-1},pre_view_mirror:{value:-1},code_mirror:{value:-1},custom_audio:{value:-1},custom_video:{value:-1},audio_mix:{value:-1},snap_shot:{value:-1},record:{value:0},audio_record:{value:0},display:{value:0},android_compatibility:{value:-1},hd_audio:{value:0},video_quality:{value:0},fps:{value:0},prefered_video_encoder:{value:-1},prefered_video_decoder:{value:-1},video_max_encode_bitrate:{value:this.isRtc?-1:0},audio_scene:{value:-1},video_adaptive_strategy:{value:this.isRtc?-1:0},ans:{value:this.isRtc?-1:0},agc:{value:-1},dtx:{value:-1},aec:{value:this.isRtc?-1:0},awc:{value:this.isRtc?-1:0}})},l.update=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1],n=t.key,i=t.ext;t.constructor===String&&(n=t),i=i||e,this.apis[n]&&(this.apis[n].value=1,void 0!==i&&(this.apis[n].ext=i),/(p2p|meeting)/.test(n)&&(this.calling=!0))},l.send=function(){var t=this;this.calling&&(this.calling=!1,this.apis.time=Date.now(),(0,o.ajax)({type:"post",url:a,data:this.apis}).then(function(e){t.resetStatus()})["catch"](function(e){console.log("err",e),t.resetStatus()}))},t.exports=e["default"]},44:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=n(7),r=n(3),s=r.info.nrtcVersion,a="https://statistic.live.126.net/statistic/realtime/sdkinfo",c=function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,h);var e=t.appkey;this.infos={},this.userlist=[],this.localVolumn=0,this.local={},this.remote={},this.init(e),this.resetStatus()};e["default"]=c;var l=c.prototype;l.init=function(t){this.infos=Object.assign(this.infos,{ver:1,device:-1,isp:-1,platform:u.convertPlatform(platform.os.family)+"-"+platform.os.version,browser:platform.name+"-"+platform.version,sdk_ver:s||"3.6.0",appkey:t,interval:60,samples:30,time:null,qos_algorithm:-1,fec_algorithm:-1,qos_scene:-1,qos_strategy:-1})},l.resetStatus=function(){this.infos=Object.assign(this.infos,{uid:null,cid:null,push_url:null,turn_ip:null,proxy_ip:null,meeting:!1,live:!1}),this.clearInfoData(),this.uidSsrcMap={},this.userlist=[]},l.initInfoData=function(t){var e={uid:t,cid:this.imInfo&&this.imInfo.channelId||-1,push_url:this.sessionConfig&&this.sessionConfig.rtmpUrl||-1,turn_ip:this.imInfo&&this.imInfo.turnMap||-1,proxy_ip:this.imInfo&&this.imInfo.turnMap||-1,meeting:/^meeting$/gi.test(this.imInfo.sessionMode),live:this.sessionConfig&&this.sessionConfig.liveEnable||!1,p2p:!1,isp:-1,net:-1,connect_state:this.imInfo&&this.imInfo.code||200,signalling_time:(this.sessionConfig&&this.sessionConfig.signalEndTime||0)-(this.sessionConfig&&this.sessionConfig.signalStartTime||0),connect_time:(this.sessionConfig&&this.sessionConfig.rtcEndTime||0)-(this.sessionConfig&&this.sessionConfig.rtcStartTime||0)};this.infos=Object.assign(this.infos,e)},l.clearInfoData=function(){this.localVolumn=0,this.infos=Object.assign(this.infos,{rx:{audio:[],video:[]},tx:{a_lost:[],v_lost:[],rtt:[],rtt_mdev:[],set_v_fps:[],qos_v_fps:[],v_fps:[],set_v_quality:[],real_v_res:[],real_v_kbps:[],real_v_kbps_n:[],real_a_kbps:[],real_a_kbps_n:[],set_v_kbps:[],qos_v_kbps:[],tx_bw_kbps:[],a_volume:[]}})},l.start=function(t){var e=this,n=t.info,i=t.imInfo,o=t.remoteUidMsidMap,r=t.sessionConfig,s=t.rtcConnection,a=t.uid;i&&o&&s&&(this.infos.appkey=n.appKey||n.appkey||this.infos.appkey,this.imInfo=i||{},this.remoteUidMsidMap=o||{},this.sessionConfig=r||{},this.rtcConnection=s,this.videoConfig=t.videoConfig||{},this.statsTimer||(this.getTurnMap(),this.initInfoData(a),this.format(),this.statsTimer=setInterval(function(){e.sendInfo()},1e3*this.infos.interval)))},l.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.resetStatus())},l.update=function(t){this.rtcStats=t,this.format(),this.updateRxMediaInfo(),this.updateTxMediaInfo()},l.updateOnce=function(t){var e=t.imInfo,n=t.remoteUidMsidMap,i=t.sessionConfig,o=t.rtcConnection;e&&(this.imInfo=e||{},this.remoteUidMsidMap=n||{},this.sessionConfig=i||{},this.rtcConnection=o||{},this.videoConfig=t.videoConfig||{},this.getTurnMap(),this.initInfoData(),this.sendInfo())},l.updateLocalVolumn=function(t){this.localVolumn=t},l.updateRxMediaInfo=function(){var t=this,e={u:[],g:[],c:[],bn:[],bc:[]},n={u:[],i:[],bn:[],bc:[],r:[],f:[]};this.userlist.map(function(i){var o=t.getMediaStats(i);e.u.push(o.audio.u),e.g.push(-1),e.c.push(-1),e.bn.push(o.audio.bn),e.bc.push(o.audio.bc),n.u.push(o.video.u),n.i.push(o.video.i),n.bn.push(o.video.bn),n.bc.push(o.video.bc),n.r.push(o.video.r),n.f.push(o.video.f)}),this.infos.rx.audio.push(e),this.infos.rx.video.push(n)},l.getMediaStats=function(t){var e=this.rtcStats,n={audio:{u:+t,g:-1,c:-1,bn:0,bc:0},video:{u:+t,i:-1,bn:0,bc:0,r:-1,f:0}},i={},o=this.uidSsrcMap[t];if(!o)return n;o=o.join("|");var r=new RegExp("("+o+")");return e.results.filter(function(t){return r.test(t.ssrc)&&(i[t.mediaType]=t),r.test(t)}),i.audio&&(n.audio.bn=(i.audio.availableBandwidth||0)-0,n.audio.bc=-1),i.video&&(n.video.bn=(i.video.availableBandwidth||0)-0,n.video.bc=i.video.googFrameWidthReceived+"x"+i.video.googFrameHeightReceived,n.video.f=(i.video.googFrameRateDecoded||0)-0),n},l.getLocalMediaStats=function(){var t=this.rtcStats,e={a_lost:-1,v_lost:-1,rtt:0,rtt_mdev:-1,set_v_fps:this.videoConfig.frameRate||0,qos_v_fps:0,v_fps:0,set_v_quality:this.sessionConfig.videoQuality,real_v_res:0,real_v_kbps:0,real_v_kbps_n:0,real_a_kbps:-1,real_a_kbps_n:0,set_v_kbps:-1,qos_v_kbps:0,tx_bw_kbps:0,a_volume:0},n={},i=this.imInfo.uid,o=this.uidSsrcMap[i];if(!o)return e;o=o.join("|");var r=new RegExp("("+o+")");return t.results.filter(function(t){return t.localCandidateId?void(n.rtt=t):(r.test(t.ssrc)&&(n[t.mediaType]=t),r.test(t))}),n.audio&&(e.real_a_kbps_n=(n.audio.availableBandwidth||t.audio.send.availableBandwidth)-0,e.a_volume=this.localVolumn-0),n.video&&(e.qos_v_fps=n.video.googFrameRateInput-0,e.v_fps=n.video.googFrameRateSent-0,e.real_v_res=n.video.googFrameWidthSent+"x"+n.video.googFrameHeightSent,e.real_v_kbps=n.video.googEncodeUsagePercent-0,e.real_v_kbps_n=n.video.availableBandwidth-0),e.rtt=n.rtt.googRtt-0,e.tx_bw_kbps=(t.connectionType.bitsSentPerSecond||0)-0,e},l.updateTxMediaInfo=function(){var t=this.getLocalMediaStats(),e=this.infos.tx;for(var n in t)e[n].push(t[n]);this.infos.net=u.convertNetwork(this.rtcStats.connectionType.local.networkType[0])},l.getTurnMap=function(){var t=this.imInfo;t.serverMap&&(t.turnMap=JSON.parse(t.serverMap||null),t.turnMap=t.turnMap&&t.turnMap.turnaddrs,t.turnMap=t.turnMap&&t.turnMap[0],t.turnMap=t.turnMap.constructor===Array?t.turnMap[0]:t.turnMap,t.turnMap=t.turnMap&&t.turnMap.match(/\d+\.\d+.\d+\.\d+/),t.turnMap=t.turnMap[0])},l.getSsrc=function(t,e){var n=[],i={audio:this.getTypeSsrc("audio",t,e),video:this.getTypeSsrc("video",t,e)};return i.audio&&n.push(i.audio),i.video&&n.push(i.video),n},l.getTypeSsrc=function(t,e,n){var i=void 0,o="";if(i=new RegExp(t+"[.\\r\\n\\s\\S]*ssrc:(\\d+)\\smsid:"+e),o=n.match(i),o=o&&o[0])return i=new RegExp("ssrc:\\d+\\smsid:"+e),o=o.match(i),o=o.map(function(t){return i=new RegExp("ssrc:(\\d+)\\s"),t=t.match(i),t[1]})},l.format=function(){this.formatLocal(),this.formatRemote()},l.formatLocal=function(){this.localSdp=this.rtcConnection.localDescription,this.localStream=this.rtcConnection.getLocalStreams()[0],this.localStream&&(this.uidSsrcMap[this.imInfo.uid]=this.getSsrc(this.localStream.id,this.localSdp.sdp),this.local.ssrc=this.uidSsrcMap[this.imInfo.uid])},l.formatRemote=function(){this.remoteSdp=this.rtcConnection.remoteDescription,this.userlist=[];var t=this.remoteUidMsidMap;for(var e in t)this.userlist.push(e),this.remote[e]={},this.uidSsrcMap[e]=this.getSsrc(t[e],this.remoteSdp.sdp),this.remote[e].ssrc=this.uidSsrcMap[e]},l.sendInfo=function(){var t=this;this.infos.uid&&this.infos.cid&&(this.infos.time=Date.now(),this.infos.samples=this.infos.rx.audio.length,(0,o.ajax)({type:"post",url:a,data:this.infos}).then(function(e){t.clearInfoData()})["catch"](function(e){t.clearInfoData()}))};var u={convertNetwork:function(t){var e={wlan:"wifi",lan:"ethernet"};return e[t]||"unknown"},convertPlatform:function(t){var e=/Windows/i,n=/OS X/i,i=void 0;return i=e.test(t)&&"Win"||t,i=n.test(i)&&"Mac"||i}};t.exports=e["default"]},45:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=n(7),r=n(3),s=r.info.nrtcVersion,a="//statistic.live.126.net/webrtc/stat",c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var n=e.appkey;this.infos={},this.init(n),this.resetStatus()}return t.prototype.resetStatus=function(){},t.prototype.init=function(t){this.infos=Object.assign(this.infos,{interval:60,ver:1,platform:l.convertPlatform(platform.os.family)+"-"+platform.os.version,browser:platform.name+"-"+platform.version,sdk_ver:s||"3.6.0",uid:null,appkey:t,time:null,data:{}})},t.prototype.clear=function(){this.infos.data={}},t.prototype.start=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.infos.appkey=e.appKey||e.appkey||this.infos.appkey,this.infos.cid=e.cid,this.infos.uid=e.uid,this.statsTimer||(this.statsTimer=setInterval(function(){t.send()},1e3*this.infos.interval))},t.prototype.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.clear())},t.prototype.update=function(t){this.infos.data["stat_"+Date.now()]=t},t.prototype.send=function(){var t=this;0!==Object.keys(this.infos.data).length&&(this.infos.time=Date.now(),(0,o.ajax)({type:"post",url:a,data:this.infos}).then(function(e){t.clear()})["catch"](function(t){console.log("err",t)}))},t}();e["default"]=c;var l={convertNetwork:function(t){var e={wlan:"wifi",lan:"ethernet"};return e[t]||"unknown"},convertPlatform:function(t){var e=/Windows/i,n=/OS X/i,i=void 0;return i=e.test(t)&&"Win"||t,i=n.test(i)&&"Mac"||i}};t.exports=e["default"]},46:function(t,e){"use strict";e.__esModule=!0,e["default"]=function(t){if(!t.url||!t.data)return Promise.reject("参数不完整，无法发起请求");t.dataType=t.dataType||"json";var e=new XMLHttpRequest;return e.open(t.type||"GET",t.url,!0),e.responseType=""+t.dataType,e.setRequestHeader("Content-type","application/json;charset=UTF-8"),new Promise(function(n,i){e.onload=function(){var t=e.response;n(t)},e.onerror=function(t){i(t)},e.send(JSON.stringify(t.data))})};t.exports=e["default"]},47:function(t,e){"use strict";e.__esModule=!0,e["default"]={html2node:function(t){var e=document.createElement("div");e.innerHTML=t;var n,i,o=[];if(e.children)for(n=0,i=e.children.length;n<i;n++)o.push(e.children[n]);else for(n=0,i=e.childNodes.length;n<i;n++){var r=e.childNodes[n];1===r.nodeType&&o.push(r)}return o.length>1?e:o[0]},n2node:function(t){return t?/HTML.+Element/gi.test(t)?t:t[0]&&/HTML.+Element/gi.test(t[0])?t[0]:null:null}},t.exports=e["default"]},48:function(t,e){"use strict";e.__esModule=!0,e["default"]={merge:function(){var t=arguments;return t[0]=Object.assign.apply(Object.assign,arguments),t[0]},verifyOptions:function(){var t=arguments;if(t[0]&&t[0].constructor===Object)for(var e=1;e<arguments.length;e++){var n=t[e];n=n.split(" "),n.map(function(e){if(!t[0][e])throw Error("参数缺失 "+e)})}},guid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return t()+t()+t()+t()+t()+t()+t()+t()}}()},t.exports=e["default"]},49:function(t,e){"use strict";e.__esModule=!0;var n={gateWay:{login:1,loginAck:2,join:3,keep_alive:4,keep_alive_ack:5,keep_alive_node:6,broadcast:7,toUser:8,logout:9}},i={gateWay:{1:"login",2:"loginAck",3:"join",4:"keep_alive",5:"keep_alive_ack",6:"keep_alive_node",7:"broadcast",8:"toUser",9:"logout"}};e.serializeWb=n,e.unserializeWb=i},58:function(t,e,n){"use strict";function i(t,e){for(var n in e)t[n]=e[n];return t}n(26),n(12),n(2).Promise,window.Object.assign||(window.Object.assign=function(){for(var t=arguments,e=1;e<t.length;e++)t[0]=i(t[0],t[e]);return t[0]})},63:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(7),a=n(4),c=function(t){function e(n){i(this,e);var r=o(this,t.call(this));return n.container=s.element.n2node(n.container),n.remoteContainer=s.element.n2node(n.remoteContainer),s.tool.merge(r,n),r.init(),r}return r(e,t),e}(a),l=c.prototype;l.init=function(){var t=this;this.resetStatus(),window.addEventListener("beforeunload",this.beforeunload.bind(this));var e=this.nim&&this.nim.logger||window.console;this.logger={log:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.debug&&e.log.apply(e,arguments)},error:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.debug&&e.error.apply(e,arguments)},warn:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.debug&&e.warn.apply(e,arguments)}},this.log=this.logger.log,this.error=this.logger.error,this.warn=this.logger.warn},l.resetStatus=function(){this.signalInited=!1,this.channelId=null,this.type=null,this.target={account:null,uid:null},this.sessionConfig={},this.sessionMode=null,this.imInfo={},this.calling=!1,this.isCaller=!1,this.callee=null,this.callAccepted=!1,this.callerInfo=null,this.beCalledInfo=null,this.nim&&(this.nim.protocol&&this.nim.protocol.setCurrentNetcall&&this.nim.protocol.setCurrentNetcall(),this.nim.protocol&&this.nim.protocol.setCurrentWhiteBoard&&this.nim.protocol.setCurrentWhiteBoard()),this.needQueryAccountMap={},this.accountUidMap={},this.uidAccountMap={},this.isOnHangup=!1},l.beforeunload=function(){this.signalInited&&(this.callerInfo||this.beCalledInfo?this.hangup():this.leaveChannel())},l.baseGetAccount=function(){return this.nim&&this.nim.account},l.baseGetUid=function(){return this.accountUidMap?this.accountUidMap[this.nim.account]||"-1":"-1"},l.parseAccountUidMap=function(t){var e=this;Object.keys(t).forEach(function(n){e.addAccountUidMap({account:n,uid:t[n]})})},l.addAccountUidMap=function(t){var e=t.account,n=t.uid;this.uidAccountMap||(this.uidAccountMap={}),this.uidAccountMap[n]=e,this.accountUidMap||(this.accountUidMap={}),this.accountUidMap[e]=n},l.getAccountWithUid=function(t){if(this.uidAccountMap)return this.uidAccountMap[t]},l.getUidWithAccount=function(t){if(this.accountUidMap)return this.accountUidMap[t]},l.baseIsCurrentChannelId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.channelId&&this.channelId===t.channelId},l.baseNotCurrentChannelId=function(t){return!this.baseIsCurrentChannelId(t)},l.baseResponse=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.fn||"calleeAck",i=e.beCalledInfo||this.beCalledInfo,o=i.accepted=e.accepted!==!1;return o?(this.sessionMode="p2p",this.type=i.type,this.channelId=i.channelId,this.target.account=i.account,this.calling=!0,this.imInfo=i,this.imInfo.sessionMode=this.sessionMode,this.setSessionConfig({signalStartTime:Date.now()})):(this.log("reject call",i),this.packNetcallRecord({type:i.type,channelId:i.channelId,isCaller:!1,target:i.account,recordType:"rejectNetcall"})),this.nim[n](i).then(function(){o&&(e.sessionConfig&&t.setSessionConfig(e.sessionConfig),t.beCalledInfo=i,t.initSession({beCalledInfo:i}))},function(e){throw t.log(e),e})},l.baseControl=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.channelId=e.channelId||this.channelId,e.command&&e.channelId){this.controller.uploadDataApi("update",{key:"call_control_type"});var n=e.fn||"netcallControl";return e.type=e.command,this.nim[n](e)["catch"](function(e){t.log(e)})}},l.baseHangup=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.uploadDataApi("send");var e=t.channelId,n=void 0===e?this.channelId:e,i=t.recordType;if(n){var o=t.fn||"hangup";this.nim[o]({channelId:n})}n===this.channelId&&(this.isCaller&&!this.callAccepted&&(this.log(i,{channelId:n}),this.packNetcallRecord({recordType:i})),this.resetWhenHangup())},l.baseStartSession=function(){this.imInfo.cid=this.imInfo.cid||this.imInfo.channelId;var t=this.sessionMode=this.sessionMode||"p2p";this.imInfo.sessionMode=t,this.imInfo.sessionConfig=this.sessionConfig},l.packNetcallRecord=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.recordType,n=t.type||this.type,i=t.channelId||this.channelId,o=t.duration||0,r=t.isCaller||this.isCaller,a=t.target||this.target.account,c=this.baseGetAccount(),l=r?c:a,u=r?a:c,h=+new Date;this.nim.protocol.onMsg({content:{msg:{attach:JSON.stringify({data:{calltype:n,channel:i,duration:o,ids:[c,a],time:h},id:e}),from:l,fromClientType:r?16:0,fromDeviceId:"",fromNick:"",idClient:s.tool.guid(),idServer:s.tool.guid(),scene:0,time:h,to:u,type:5}}})},l.setSessionConfig=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.tool.merge(this.sessionConfig,t)},l.initSignal=function(){return Promise.resolve()},l.initSession=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionMode="p2p";var n=this.isCaller?this.callerInfo:e.beCalledInfo;this.parseAccountUidMap(n.accountUidMap),!n.account&&n.uid&&(n.account=this.getAccountWithUid(n.uid)),this.callAccepted=!0,this.signalInited=!0,this.setSessionConfig({signalEndTime:Date.now()}),this.controller.uploadDataApi("start",{uid:n.uid}),this.target.uid=this.getUidWithAccount(this.target.account);var i={type:n.type,account:this.target&&this.target.account||n.account,channelId:n.channelId};n.netcallType&&(i.netcallType=n.netcallType),this.imInfo.target=this.target,setTimeout(function(){t.emit("callAccepted",i)},1)},l.onBeCalled=function(t){this.signalInited=!0,this.channelId=t.channelId,this.beCalledInfo=t,this.log("beCalling",t),this.emit("beCalling",t)},l.onUserJoin=function(t){if(this.log("client on userJoined",t),t.type=t.type||this.type,t.account=this.getAccountWithUid(t.uid),t.mode=this.sessionMode,t.account!==this.baseGetAccount()){if(t.account)return this.logger.log("有人加入 ----> 来自信令层的通知",t),void this.emit("joinChannel",t);this.needQueryAccountMap[t.uid]=t;var e=this.nim.queryAccountUidMap||this.nim.wbQueryAccountUidMap;e.call(this.nim,this.channelName,[t.uid])}},l.onUserLeft=function(t){var e=this;this.channelId&&(this.logger.log("leave channel from signal"),"p2p"===this.imInfo.sessionMode?(this.controller.uploadDataApi("send"),setTimeout(function(){e.logger.log("超时处理 onUserLeft"),e.resetWhenHangup()},1e3),this.emit("hangup",{channelId:t.channelId||t.cid,account:this.target.account,type:t.type||0})):this.emit("leaveChannel",{channelId:t.channelId||t.cid,account:this.getAccountWithUid(t.uid),type:t.type||0}))},l.onNotifyJoin=function(t){this.logger.log("join channel from IM");var e=t.accountUidMap,n=this.needQueryAccountMap;this.parseAccountUidMap(e);for(var i in e){var o=i,r=e[i];if(r in n){var s=n[r];s.account=o,delete n[r],this.logger.log("有人加入 ----> 来自IM的通知",t),this.emit("joinChannel",s)}}},l.onCalleeAck=function(t){if(this.logger.log("收到被叫的通知",t),!this.baseNotCurrentChannelId(t)){var e=t.account,n=this.beCalledInfo||this.callerInfo;this.target.account=e,this.setSessionConfig({signalEndTime:Date.now()}),t.accepted?(this.callAccepted=!0,this.initSession()):(this.log("call Rejected",t),this.packNetcallRecord({type:t.type,channelId:t.channelId,isCaller:!0,target:t.account,recordType:"netcallRejected"}),this.resetWhenHangup(),this.emit("callRejected",{type:n.type,account:e}))}},l.onHangup=function(t){var e=this;this.channelId&&(this.logger.log("on hangup from IM"),this.controller.uploadDataApi("send"),setTimeout(function(){e.logger.log("超时处理 onHangup"),e.resetWhenHangup()},1e3),this.emit("hangup",{channelId:t.channelId,account:t.account,type:0}))},l.onControl=function(t){this.emit("control",t)},l.onCalleeAckSync=function(t){this.emit("callerAckSync",t),this.baseIsCurrentChannelId(t)&&this.resetWhenHangup()},l.baseCreateChannel=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.tool.verifyOptions(n,"channelName"),n.custom=n.custom||"",this.setSessionConfig({signalStartTime:Date.now()}),this.nim[t](n).then(function(t){return Promise.resolve(t)})["catch"](function(t){return e.setSessionConfig({signalEndTime:Date.now()}),Promise.reject(t)})},l.baseJoinChannel=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.nim[t](n).then(function(t){return e.setSessionConfig({signalEndTime:Date.now()}),e.signalInited=!0,e.sessionMode=t.sessionMode="meeting",e.parseAccountUidMap(t.accountUidMap),t.uid=e.getUidWithAccount(e.nim.account),Promise.resolve(t)})["catch"](function(t){return e.setSessionConfig({signalEndTime:Date.now()}),Promise.reject(t)})},l.format=function(t){return t.rtcServerMap&&(t.rtcServerMap=JSON.parse(t.rtcServerMap),t.rtcServerMap=t.rtcServerMap.webrtcarray||[t.rtcServerMap.webrtc]||t.rtcServerMap),t.wbServerMap&&(t.wbServerMap=JSON.parse(t.wbServerMap),t.wbServerMap=t.wbServerMap.webrtcarray||[t.wbServerMap.webrtc]||t.wbServerMap),t},l.resetWhenHangup=function(){},t.exports=c},64:function(t,e){"use strict";e.__esModule=!0;var n,i,o={CURRENT:{SDK_TYPE:null},SDK_TYPE:{NETCALL:1,WEBRTC:2,WHITEBOARD:3,NRTC:4},SDK_NAME:{1:"Netcall",2:"WebRTC",3:"WhiteBoard",4:"NRTC"}};o.STATS_FUN=(n={},n[o.SDK_TYPE.NETCALL]=1,n[o.SDK_TYPE.WEBRTC]=1,n[o.SDK_TYPE.NRTC]=1,n[o.SDK_TYPE.WHITEBOARD]=0,n),o.STATS_RTC=(i={},i[o.SDK_TYPE.WEBRTC]=1,i[o.SDK_TYPE.NRTC]=1,i[o.SDK_TYPE.WHITEBOARD]=0,i),e["default"]=o,t.exports=e["default"]},65:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=n(11),a=n(20),c=n(24),l=n(4),u=n(34),h=function(t){function e(n){i(this,e);var r=o(this,t.call(this,n));return r.info={},r._init(n),r._reset(),r}return r(e,t),e.prototype._init=function(t){this.info=Object.assign(this.info,t),this.logger=t.logger||window.console,this.dataApi=(0,c.DataApi)({appkey:this.info.appKey,platform:a.configMap.SDK_NAME[a.configMap.CURRENT.SDK_TYPE]}),this.dataRtc=(0,c.DataRtc)({appkey:this.info.appKey}),this.dataStats=(0,c.DataStats)({appkey:this.info.appKey})},e.prototype._reset=function(){this.signal&&(this.signal.destroy(),this.signal=null),this.sessionConfig={},this.imInfo={},this.target={},this.userJoinTimeoutId=0,this.remoteNodeStatus={},this.dataRtc.stop(),this.dataStats.stop()},e.prototype.resetStatus=function(){this._reset()},e.prototype._startSession=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.imInfo||t;this.setSessionConfig(e.sessionConfig);var n=e.serverMap?JSON.parse(e.serverMap):{};e.urlArray=e.serverAddrs||n.webrtcarray||[n.webrtc];var i=void 0;return i=this.signal?Promise.resolve(this.signal):this._initSignal();
},e.prototype._initSignal=function(){var t=this;if(this.signal)return Promise.resolve();var e=new u({logger:this.logger}),n=this.imInfo.urlArray;if(n){var i=n.shift();return i?e.connect({url:i,imInfo:this.imInfo}).then(function(e){return t.signal=e,t._initSignalEvent(),Promise.resolve(e.url)})["catch"](function(e){return t._initSignal()}):Promise.reject("无可用的网关服务器地址, 如果当前应用是WebRTC音视频, 请确保对方打开了WebRTC兼容开关")}},e.prototype._initSignalEvent=function(){var t=this,e=this.signal;e.on("signalTimeout",this.onSignalTimeout.bind(this)),e.on("message",this.onSignalMessage.bind(this)),e.on("signalClosed",function(){t.emit("signalClosed"),t.resetStatus()}),this.signal.on("signalError",function(e){t.emit("signalClosed"),t._stopSignal()})},e.prototype._stopSignal=function(){this.signal&&(this.signal.destroy(),this.signal=null)},e.prototype._stopSession=function(){this._stopSignal(),this._reset()},e.prototype._logout=function(){this.signal&&this.signal.logout()},e.prototype.setAppKey=function(t){t&&(this.info.appKey=t)},e.prototype.getUidByMsid=function(t){var e=this.remoteUidMsidMap;for(var n in e)if(e[n]===t)return n;return null},e.prototype.getMsidByUid=function(t){return this.remoteUidMsidMap(t)},e.prototype.setSessionConfig=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionConfig=Object.assign(this.sessionConfig,t)},e.prototype.onSignalMessage=function(t){},e.prototype.onSignalTimeout=function(t){},e.prototype.uploadDataRtcStart=function(){this.info.appKey&&a.configMap.STATS_FUN[a.configMap.CURRENT.SDK_TYPE]&&this.dataRtc.start({info:this.info,rtcConnection:this.rtc.rtcConnection,imInfo:this.imInfo,remoteUidMsidMap:this.remoteUidMsidMap,sessionConfig:this.sessionConfig,videoConfig:this.imInfo.videoConfig,uid:this.imInfo.uid})},e.prototype.uploadDataRtcStop=function(){a.configMap.STATS_RTC[a.configMap.CURRENT.SDK_TYPE]&&this.dataRtc.stop()},e.prototype.uploadDataRtcOnce=function(t){if(a.configMap.STATS_RTC[a.configMap.CURRENT.SDK_TYPE]){var e=s.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});this.dataRtc.updateOnce({info:this.info,imInfo:t,sessionConfig:this.sessionConfig,videoConfig:e})}},e.prototype.uploadDataRtc=function(t,e){if(a.configMap.STATS_RTC[a.configMap.CURRENT.SDK_TYPE]&&this.info.appKey)return"volume"===t?void this.dataRtc.updateLocalVolumn(e):void this.dataRtc.update(t,e)},e.prototype.uploadDataApi=function(t,e){a.configMap.STATS_FUN[a.configMap.CURRENT.SDK_TYPE]&&this.info.appKey&&("start"===t&&(e.appkey=this.info.appKey),this.dataApi[t]&&this.dataApi[t](e))},e.prototype.uploadDataRtcNewStart=function(){a.configMap.STATS_RTC[a.configMap.CURRENT.SDK_TYPE]&&this.dataStats.start({info:this.info,rtcConnection:this.rtc.rtcConnection,imInfo:this.imInfo,cid:this.imInfo.cid,uid:this.imInfo.uid})},e.prototype.uploadDataRtcNewStop=function(){a.configMap.STATS_RTC[a.configMap.CURRENT.SDK_TYPE]&&this.dataStats.stop()},e.prototype.uploadDataRtcNew=function(t){a.configMap.STATS_RTC[a.configMap.CURRENT.SDK_TYPE]&&this.dataStats.update(t)},e}(l);e["default"]=h,t.exports=e["default"]},75:function(t,e){"use strict";function n(t){i(t.enable)&&(this.enable=t.enable?1:0),i(t.needBadge)&&(this.needBadge=t.needBadge?1:0),i(t.needPushNick)&&(this.needPushNick=t.needPushNick?1:0),i(t.pushContent)&&(this.pushContent=""+t.pushContent),i(t.custom)&&(this.custom=""+t.custom),i(t.pushPayload)&&(this.pushPayload=""+t.pushPayload),i(t.sound)&&(this.sound=""+t.sound),i(t.webrtcEnable)&&(this.webrtcEnable=t.webrtcEnable?1:0)}e.__esModule=!0,e["default"]=function(t){var e=t.util;return i=e.notundef,n};var i=void 0;t.exports=e["default"]},113:function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var i=function(){function t(e){n(this,t),this.all=e||Object.create(null)}return t.prototype.on=function(t,e){(this.all[t]||(this.all[t]=[])).push(e)},t.prototype.off=function(t,e){this.all[t]&&this.all[t].splice(this.all[t].indexOf(e)>>>0,1)},t.prototype.emit=function(t,e){(this.all[t]||[]).map(function(t){t(e)}),(this.all["*"]||[]).map(function(n){n(t,e)})},t}();e["default"]=i,t.exports=e["default"]},114:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e,n){var i=0;e.forEach(function(e){if(e.visible&&!(i>=n)){if(c(t,e),"fill"===e.mode)return b(t,e.corner[0]);t.drawImage(e.ctx.canvas,e.corner[0].x,e.corner[0].y),n++}})}function c(t,e){var n=e.UID,i=e.ctx,o=e.size,r=e.color,s=e.mode;void 0!==n&&(t.lineWidth=i.lineWidth=o,t.strokeStyle=i.strokeStyle=r),"erase"===s?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="source-over"}function l(t,e){var n=t.canvas,i=document.createElement("canvas").getContext("2d");i.canvas.width=n.width,i.canvas.height=n.height,i.drawImage(n,0,0,n.width,n.height),n.style.width=n.width*e+"px",n.style.height=n.height*e+"px",n.width=n.width*e,n.height=n.height*e,t.lineCap=t.lineJoin="round",t.drawImage(i.canvas,0,0,n.width,n.height)}function u(t,e,n,i){return e.x===i.x&&e.y===i.y?void p(t,e,1,1):(t.beginPath(),t.moveTo(e.x,e.y),t.quadraticCurveTo(n.x,n.y,i.x,i.y),void t.stroke())}function h(t,e,n){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.stroke()}function p(t,e,n,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];o?t.fillRect(e.x,e.y,n,i):t.strokeRect(e.x,e.y,n,i)}function d(t,e,n,i,o){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=e.x,a=e.y,c=n<0?-o:o,l=i<0?-o:o;t.beginPath(),t.moveTo(s+c,a),t.lineTo(s+n-c,a),t.quadraticCurveTo(s+n,a,s+n,a+l),t.lineTo(s+n,a+i-l),t.quadraticCurveTo(s+n,a+i,s+n-c,a+i),t.lineTo(s+c,a+i),t.quadraticCurveTo(s,a+i,s,a+i-l),t.lineTo(s,a+l),t.quadraticCurveTo(s,a,s+c,a),t.stroke(),r&&t.fill()}function f(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.beginPath(),t.arc(e.x,e.y,n,0,2*Math.PI,!0),t.stroke(),i&&t.fill()}function b(t,e){function n(t){return t===g||(4278190080&t)>>>0<4278190080}var i=e.x,o=e.y,r=t.getImageData(0,0,t.canvas.width,t.canvas.height),s=0,a=1,c=t.strokeStyle,l=parseInt(c.substr(1,2),16),u=parseInt(c.substr(3,2),16),h=parseInt(c.substr(5,2),16),p=(255<<24|h<<16|u<<8|l)>>>0,d=[i,o],f=new ArrayBuffer(r.data.length),b=new Uint8ClampedArray(f);b.set(r.data);var v=new Uint32Array(f),g=v[o*r.width+i];if(g!==p){for(var y=[d],m=void 0,_=r.width-1,w=r.height-1;m=y.pop();){for(var C=m[a]*r.width+m[s],T=m[s],S=m[a];S-- >=0&&n(v[C]);)C-=r.width;C+=r.width,S++;for(var O=!1,I=!1;S++<w&&n(v[C]);)v[C]=p,T>0&&(n(v[C-1])?O||(y.push([T-1,S]),O=!0):O&&(O=!1)),T<_&&(n(v[C+1])?I||(y.push([T+1,S]),I=!0):I&&(I=!1)),C+=r.width}r.data.set(b),t.putImageData(r,0,0)}}e.__esModule=!0;var v=n(113),g=i(v),y=function(t){function e(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e);var s=r(this,t.call(this));if(s.displayCtx&&s.destory(),s.users={},s.UID=i.UID||0,s.shapes=[],s.visible=0,!(n instanceof window.HTMLElement))throw new Error("画板容器不是HTMLElement实例");s.container=n;var a=document.createElement("canvas");if(s.displayCtx=a.getContext("2d"),n.style.position="relative",a.style.position="relative",a.style.boxSizing="content-box",a.style.zIndex=i.zIndex||0,a.style.cursor="crosshair",s.width=i.width||800,s.height=i.height||500,"number"!=typeof s.width)throw new Error("画板宽度不是数字");if("number"!=typeof s.height)throw new Error("画板高度不是数字");s.displayCtx.canvas.width=s.width,s.displayCtx.canvas.height=s.height,s.displayCtx.lineCap=s.displayCtx.lineJoin="round";var c=s.addUser(s.UID);return n.appendChild(a),n.appendChild(c.ctx.canvas),s.dispatcher=s.dispatcher.bind(s),s.switchEventListener(!0),s}return s(e,t),e.prototype.mode=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.UID,n=this.users[e];if(!t)return n.mode;if("string"!=typeof t)throw new Error("操作模式不是字符串");var i=t.split(":");n.mode=i[0],n.type=i[1]||"free",this.emit("action",{UID:e,op:"mode",value:t})},e.prototype.size=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.UID,n=this.users[e];if(!t)return n.size;if("number"!=typeof t)throw new Error("Type Error: size");n.size=t,this.emit("action",{UID:e,op:"size",value:t})},e.prototype.color=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.UID,n=this.users[e];return t?(n.color=t,void this.emit("action",{UID:e,op:"color",value:t})):n.color},e.prototype.switchEventListener=function(t){var e=t?"add":"remove",n=[this.users[this.UID].ctx.canvas,this.displayCtx.canvas],i=this.dispatcher;n.forEach(function(t){t[e+"EventListener"]("mousedown",i),t[e+"EventListener"]("mousemove",i),t[e+"EventListener"]("touchmove",i),t[e+"EventListener"]("touchstart",i)}),document[e+"EventListener"]("mouseup",i),document[e+"EventListener"]("touchend",i)},e.prototype.mousedown=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.UID,n=void 0,i=this.users[e],o=i.start,r=i.oldMid,s=i.end;i.isMouseDown=!0;var a=i.ctx;switch("free"===i.type?a.canvas.style.visibility="hidden":a.canvas.style.visibility="visible",c(this.displayCtx,i),i.mode){case"draw":case"erase":switch(n=new _(i.mode,i.type,i.size,i.color,new m(t.x,t.y)),i.activeShape=n,this.shapes.push(n),i.shapes.push(this.shapes.length-1),i.type){case"free":m.set(o,t.x,t.y),m.set(r,o.x,o.y),m.set(s,o.x,o.y);break;default:m.set(o,t.x,t.y)}break;case"fill":n=new _(i.mode,i.type,i.size,i.color,new m(t.x,t.y)),this.shapes.push(n),i.shapes.push(this.shapes.length-1),b(this.displayCtx,t);break;case"select":}"select"!==i.mode&&(i.available=++i.visible,this.visible++),this.emit("action",{UID:e,op:"mousedown",value:t})},e.prototype.mousemove=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.UID,n=this.users[e];if(n.isMouseDown){var i=n.start,o=n.oldMid,r=n.end,s=n.ctx,a=this.displayCtx;switch(n.mode){case"draw":case"erase":switch(c(a,n),n.type){case"free":var l=new m((r.x+t.x)/2,(r.y+t.y)/2);u(s,o,r,l),u(a,o,r,l),m.set(o,l.x,l.y),m.set(r,t.x,t.y);break;case"line":m.set(r,t.x,t.y),s.clearRect(0,0,s.canvas.width,s.canvas.height),h(s,i,r);break;case"rect":m.set(r,t.x,t.y),s.clearRect(0,0,s.canvas.width,s.canvas.height),p(s,i,r.x-i.x,r.y-i.y);break;case"roundRect":m.set(r,t.x,t.y),s.clearRect(0,0,s.canvas.width,s.canvas.height),d(s,i,r.x-i.x,r.y-i.y,30);break;case"circle":m.set(r,t.x,t.y),s.clearRect(0,0,s.canvas.width,s.canvas.height),f(s,i,Math.abs(t.x-i.x))}var b=n.activeShape.corner;if("circle"===n.type){var v=Math.abs(t.x-i.x);b[0].x=i.x-v,b[0].y=i.y-v,b[1].x=i.x+v,b[1].y=i.y+v}else b[0].x=Math.min(r.x,b[0].x),b[0].y=Math.min(r.y,b[0].y),b[1].x=Math.max(r.x,b[1].x),b[1].y=Math.max(r.y,b[1].y);break;case"fill":break;case"select":}this.emit("action",{UID:e,op:"mousemove",value:t})}},e.prototype.mouseup=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.UID,n=this.users[e];if(n.isMouseDown){n.isMouseDown=!1;var i=n.start,o=n.oldMid,r=n.end,s=n.ctx,a=this.displayCtx;switch(n.mode){case"draw":case"erase":switch(c(a,n),n.type){case"free":var l=new m((r.x+t.x)/2,(r.y+t.y)/2);u(s,o,r,l),u(a,o,r,l),m.set(o,l.x,l.y),m.set(r,t.x,t.y);break;case"line":m.set(r,t.x,t.y),h(s,i,r);break;case"rect":m.set(r,t.x,t.y),p(s,i,r.x-i.x,r.y-i.y);break;case"roundRect":m.set(r,t.x,t.y),d(s,i,r.x-i.x,r.y-i.y,30);break;case"circle":m.set(r,t.x,t.y),f(s,i,Math.abs(t.x-i.x))}var b=n.activeShape.corner,v=n.activeShape.ctx;b[0].x-=this.size(),b[0].y-=this.size(),b[1].x+=this.size(),b[1].y+=this.size(),v.canvas.width=Math.ceil(b[1].x-b[0].x),v.canvas.height=Math.ceil(b[1].y-b[0].y),v.lineCap=v.lineJoin=n.ctx.lineCap,v.lineWidth=n.ctx.lineWidth;var g=s.getImageData(b[0].x,b[0].y,v.canvas.width,v.canvas.height);v.putImageData(g,0,0),"free"!==n.type&&a.drawImage(v.canvas,b[0].x,b[0].y),s.clearRect(0,0,this.displayCtx.canvas.width,this.displayCtx.canvas.height);break;case"fill":break;case"select":}this.emit("action",{UID:e,op:"mouseup",value:t})}},e.prototype.undo=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.UID,e=this.users[t];if(0!==e.visible){var n=e.shapes.pop();this.shapes[n].visible=!1,e.recycle.push(n),--e.visible,this._clear(),a(this.displayCtx,this.shapes,--this.visible),this.emit("action",{UID:t,op:"undo",value:t})}},e.prototype.redo=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.UID,e=this.users[t];if(e.visible!==e.available){var n=e.recycle.pop();this.shapes[n].visible=!0,e.shapes.push(n),++e.visible,this._clear(),a(this.displayCtx,this.shapes,++this.visible),this.emit("action",{UID:t,op:"redo",value:t})}},e.prototype.clear=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.UID;if(this._clear(),t&&this.users[t]){var i=this.users[t];return i.isMouseDown=!1,i.shapes.forEach(function(t){e.shapes[t]&&(e.shapes[t].visible=!1,e.visible--)}),i.shapes=[],i.recycle=[],i.available=0,i.visible=0,this._clear(),void a(this.displayCtx,this.shapes,this.visible)}this.shapes=[],this.visible=0;for(var o in this.users){var r=this.users[o];r.shapes=[],r.recycle=[],r.available=0,r.visible=0,r.isMouseDown=!1}this.emit("action",{UID:n,op:"clear",value:null})},e.prototype._clear=function(){this.displayCtx.clearRect(0,0,this.width,this.height);for(var t in this.users){var e=this.users[t];e.ctx.clearRect(0,0,this.width,this.height)}},e.prototype.act=function(t){var e=t.UID,n=t.op,i=t.value,o=this.users[e];o||(this.users[e]=this.addUser(e)),this[n](i,e)},e.prototype.resize=function(t){if(t=parseInt(t),isNaN(t)||t<=0)throw new Error("白板宽度应是大于0的数字");var e=t/this.width,n=this.height*e;l(this.displayCtx,e);for(var i in this.users)l(this.users[i].ctx,e);this.shapes.forEach(function(t){l(t.ctx,e),t.corner[0].x*=e,t.corner[0].y*=e,t.corner[1].x*=e,t.corner[1].y*=e}),this.width=t,this.height=n},e.prototype.addUser=function(t){if(this.users[t])return this.users[t];var e=new w(t),n=e.ctx.canvas,i=this.displayCtx.canvas;return n.style.position="absolute",n.style.boxSizing="content-box",n.style.top=i.clientTop+"px",n.style.left=i.clientLeft+"px",n.style.zIndex=i.style.zIndex+1,n.style.cursor="crosshair",n.style.width=this.width+"px",n.style.height=this.height+"px",n.width=this.width,n.height=this.height,e.ctx.lineCap=e.ctx.lineJoin="round",this.users[t]=e,this.users[t]},e.prototype.destory=function(){this.users[this.UID]&&(this.switchEventListener(!1),this.container.removeChild(this.users[this.UID].ctx.canvas)),this.container.removeChild(this.displayCtx.canvas),this.displayCtx=null,this.shapes=[],this.visible=0},e.prototype.dispatcher=function(t){t.preventDefault(),t=t.originalEvent?t.originalEvent:t;var e=this.displayCtx.canvas.getBoundingClientRect(),n=void 0,i=void 0;t.touches&&1===t.touches.length?(n=t.touches[0].clientX,i=t.touches[0].clientY):t.changedTouches&&1===t.changedTouches.length?(n=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY):(n=t.clientX,i=t.clientY),n||0===n||(n=0),i||0===i||(i=0);var o=new m(n-e.left,i-e.top),r=t.type;"touchstart"===r&&(r="mousedown"),"touchmove"===r&&(r="mousemove"),"touchend"===r&&(r="mouseup"),this[r](o)},e}(g["default"]);e["default"]=y;var m=function(){function t(e,n){o(this,t),this.x=e||0,this.y=n||0}return t.prototype.copy=function(){return new t(this.x,this.y)},t.set=function(t,e,n){t.x=e,t.y=n},t}(),_=function C(t,e,n,i,r){o(this,C),this.visible=!0,this.ctx=document.createElement("canvas").getContext("2d"),this.type=e,this.mode=t,this.color=i,this.size=n,this.corner=[r.copy(),r.copy()],this.transform=[],this.path=[],this.zIndex=0},w=function T(t){o(this,T),this.UID=t,this.ctx=document.createElement("canvas").getContext("2d"),this.shapes=[],this.recycle=[],this.mode="draw",this.type="free",this.size=4,this.color="#000",this.isMouseDown=!1,this.start=new m(0,0),this.oldMid=new m(0,0),this.end=new m(0,0),this.visible=0,this.available=0,this.activeShape={}};t.exports=e["default"]},213:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=n(4),c=i(a),l=n(114),u=i(l),h="#f5455e",p="#238efa",d=function(t){function e(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e);var s=r(this,t.call(this));return s.debug=i.debug||!1,s.limit=i.limit||80,s.data="",s.count=0,s.draw=new u["default"](n,i),s.draw.size(4),s.draw.color(h),s.draw.on("action",s.transform.bind(s)),setInterval(function(){s.data.length>0&&(s.emit("action",s.data),s.data="",s.count++)},s.limit),s}return s(e,t),e.prototype.undo=function(){this.draw.undo()},e.prototype.clear=function(){this.draw.clear()},e.prototype.resize=function(t){this.draw.resize(t)},e.prototype.act=function(t){var e=this,n=t.UID,i=t.data;if(n!==this.draw.UID){this.draw.users[n]||(this.draw.addUser(n),this.draw.users[n].color=p);var o=i.split(";"),r=this.draw.width,s=this.draw.height;o.forEach(function(t){var i=t.split(":"),o=i[0],a=i.length>1?i[1].split(","):[],c={};switch(o){case"1":c.op="mousedown",c.value={x:Math.ceil(parseFloat(a[0])*r),y:Math.ceil(parseFloat(a[1])*s)};break;case"2":c.op="mousemove",c.value={x:Math.ceil(parseFloat(a[0])*r),y:Math.ceil(parseFloat(a[1])*s)};break;case"3":c.op="mouseup",c.value={x:Math.ceil(parseFloat(a[0])*r),y:Math.ceil(parseFloat(a[1])*s)};break;case"4":c.op="undo",c.value=n;break;case"5":return;case"6":c.op="clear",e.data+="7:0,0;";break;case"7":c.op="clear",c.value=n;break;case"8":break;case"9":break;case"10":break;case"11":break;case"12":break;case"13":break;case"14":break;default:return}c.UID=n,e.draw.act(c)})}},e.prototype.destory=function(){this.draw.destory()},e.prototype.transform=function(t){if(t.UID===this.draw.UID){var e="",n=[],i=this.draw.width,o=this.draw.height;switch(t.op){case"mousedown":e="1",n.push(t.value.x/i,t.value.y/o);break;case"mousemove":e="2",n.push(t.value.x/i,t.value.y/o);break;case"mouseup":e="3",n.push(t.value.x/i,t.value.y/o);break;case"undo":e="4",n.push(0,0);break;case"color":return void(this.color=parseInt(t.value.substring(1),16));case"clear":e="6",n.push(0,0);break;default:return}this.data+=e+":"+n.join(",")+";",this.debug&&(this.data+="5:"+this.count+",0;")}},e}(c["default"]);e["default"]=d,t.exports=e["default"]},214:function(t,e){"use strict";e.__esModule=!0,e["default"]={getAccount:function(){return this.baseGetAccount()},getUid:function(){return this.baseGetUid()},isCurrentChannelId:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.baseIsCurrentChannelId(t)},notCurrentChannelId:function(t){return!this.isCurrentChannelId(t)},startSession:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.sessionStarted?Promise.resolve():(this.sessionStarted=!0,t.wssArr&&(this.imInfo.serverAddrs=t.wssArr.constructor===Array?t.wssArr:[t.wssArr]),this.baseStartSession(),this.controller.startSession(this.imInfo))},stopSession:function(){return this.resetWhenHangup(),Promise.resolve()},leaveChannel:function(){this.stopSession()},undo:function(){this.controller.undo()},redo:function(){this.controller.redo()},clear:function(){this.controller.clear()},resize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.resize(t)},sendCustomData:function(t){this.controller.sendCustomData(t)},send:function(t){this.controller.send(t)}},t.exports=e["default"]},215:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=n(65),c=i(a),l=n(213),u=i(l),h=n(49),p=n(11),d=n(7),f=3,b=null,v=function(t){function e(n){o(this,e);var i=r(this,t.call(this,n));return i.logger=n.logger||{},i.resetStatus(),i}return s(e,t),e}(c["default"]);e["default"]=v;var g=v.prototype;g.resetStatus=function(){this.wbAdapter&&(this.wbAdapter.destory(),this.wbAdapter=null),this.nodeTimer&&(clearInterval(this.nodeTimer),this.nodeTimer=null),this.reConnectCount=0,this.recv_bytes=0,this.send_bytes=0},g.startSession=function(t){var e=this;return this.imInfo=t||this.imInfo,this.connect().then(function(){"meeting"===e.imInfo.sessionMode&&e.initWbAdapter()})},g.connect=function(){var t=this;return this._startSession().then(function(e){return b=e,t.reConnectCount=0,new Promise(function(e,n){t.wbLogin(),t.once("LoginSuccess",function(n){t.logger.log("once LoginSuccess-->",n),e(b)}),t.once("LoginFailed",function(e){t.logger.log("once LoginFailed-->",e),n(e)})})})},g.stopSession=function(){return this.wbLogout(),this._stopSession(),this.resetStatus(),Promise.resolve()},g.setSessionConfig=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d.tool.merge(this.sessionConfig,t)},g.initWbAdapter=function(){this.wbAdapter||(this.wbAdapter=new u["default"](this.info.container,{UID:this.imInfo.uid,width:parseInt(this.sessionConfig.width)||400,height:parseInt(this.sessionConfig.height)||400,limit:60,debug:this.info.debug}),this.wbAdapter.on("action",this.onWbAdapterData.bind(this)))},g.onWbAdapterData=function(t,e){e&&(t=JSON.stringify({isCustom:1,data:t}));var n={data:t};this.sendStats(t),"p2p"===this.imInfo.sessionMode&&(n.dst_client_id=this.target&&this.target.uid||0);var i="p2p"===this.imInfo.sessionMode?h.serializeWb.gateWay.toUser:h.serializeWb.gateWay.broadcast;this.sendMsg(i,n)},g.wbLogin=function(){var t={token:this.imInfo.cid,client_type:2,client_net:2,client_os:6,client_support_record:~~this.sessionConfig.record};this.sendMsg(h.serializeWb.gateWay.login,t)},g.wbLogout=function(){var t=Date.now(),e={timestamp:t,recv_bytes:this.recv_bytes,send_bytes:this.send_bytes};this.sendMsg(h.serializeWb.gateWay.logout,e)},g.sendMsg=function(t,e){var n={type:t,uid:+this.imInfo.uid,cid:+this.imInfo.cid,version:31,content:{params:e}};this.signal&&this.signal.send(n)},g.onSignalMessage=function(t){if(t&&t.cid&&t.uid&&(t.cid=+t.cid,t.uid=+t.uid),t.cid!==this.imInfo.cid)return console.error("websocket message not belong to this session");var e=h.unserializeWb.gateWay[t.type];this["on"+e]&&this["on"+e](t)},g.onloginAck=function(t){var e=this,n=t.content.params.auth_result-0;return 200!==n?(this.logger.error("服务器验证不通过, 断开连接"),void this.emit("LoginFailed",{code:n,error:"服务器验证不通过, 断开连接"})):(this.logger.log("白板服务器登录成功",t),this.emit("LoginSuccess"),void("p2p"===this.imInfo.sessionMode&&(this.userJoinTimeoutId=setTimeout(function(){e.userJoinTimeoutId&&0===Object.keys(e.remoteNodeStatus).length&&e.emit("error",{error:"点对点对方登录超时, 断开连接"})},45e3))))},g.onjoin=function(t){this.logger.log(t);var e=t.content&&t.content.params&&t.content.params.client_id;this.startNodeMonitor(e),"p2p"===this.imInfo.sessionMode&&(this.target={uid:e},this.initWbAdapter(),this.userJoinTimeoutId&&clearTimeout(this.userJoinTimeoutId),this.userJoinTimeoutId=0),this.emit("userJoined",{uid:e,cid:t.cid})},g.onkeep_alive_node=function(t){var e=t.uid,n=this.remoteNodeStatus;n[e]=n[e]||{now:Date.now(),total:45},n[e].now=Date.now(),n[e].total=45},g.onlogout=function(t){this.logger.log("onlogout",t),this.emit("leaveChannel",{uid:t.uid,channelId:t.cid})},g.ontoUser=function(t){this.onData(t)},g.onbroadcast=function(t){this.onData(t)},g.onData=function(t){var e=t.content&&t.content.params&&t.content.params.data,n=t.uid;this.receiveStats(e);var i=void 0;try{i=JSON.parse(e||null)}catch(o){i=e}return this.onkeep_alive_node({uid:n}),this.info.isCustom?void this.emit("data",{uid:n,data:i}):i.constructor===Object?void(i.isCustom&&this.emit("customData",{UID:t.uid,data:i.data})):(this.wbAdapter&&this.wbAdapter.act({UID:t.uid,data:i}),this.remoteNodeStatus[t.uid].now=Date.now(),void(this.remoteNodeStatus[t.uid].total=45))},g.startNodeMonitor=function(t){var e=this,n=this.remoteNodeStatus;n[t]=n[t]||{now:Date.now(),total:45},n[t].now=Date.now(),this.nodeTimer||(this.nodeTimer=setInterval(function(){var t=Date.now();Object.keys(n).map(function(i){return t-n[i].now>5e4||n[i].total<=0?(e.logger.warn("节点45s超时离开:",i),void e.emit("leaveChannel",{uid:i,type:p.constantBB.HANGUP_TYPE_TIMEOUT,channelId:e.imInfo.cid})):t-n[i].now>5e3?void(n[i].total-=5):void 0}),e.logger.log("节点巡查结束")},5e3))},g.onSignalTimeout=function(){var t=this;return this.emit("disconnected"),this.reConnectCount>=f?void this.emit("signalClosed"):(this.reConnectCount++,this.emit("willReconnect",this.reConnectCount),this.logger.log("3s后尝试第"+this.reConnectCount+"次重连服务器"),this._stopSignal(),void setTimeout(function(){t.logger.log("开始第"+t.reConnectCount+"次重连服务器"),b&&t.imInfo.serverAddrs.unshift(b),t.connect().then(function(){t.emit("connected",t.reConnectCount)})["catch"](function(e){t.logger.error("reconnect error",e),t.onSignalTimeout()})},3e3))},g.undo=function(){this.wbAdapter&&this.wbAdapter.undo()},g.redo=function(){this.wbAdapter&&this.wbAdapter.redo()},g.clear=function(){this.wbAdapter&&this.wbAdapter.clear()},g.resize=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.wbAdapter&&this.wbAdapter.resize(t.width)},g.sendCustomData=function(t){this.onWbAdapterData(t,!0)},g.sendStats=function(t){this.send_bytes+=t.length},g.receiveStats=function(t){this.recv_bytes+=t.length},t.exports=e["default"]},234:function(t,e,n){"use strict";var i=n(75),o={};o.install=function(t){var e=t.fn,n=t.util,o=i({util:n});e.initWhiteBoard=function(t){return n.verifyOptions(t,"type accounts"),t.pushContent="",t.custom="",t.pushConfig||(t.pushConfig={}),t.pushConfig.webrtcEnable=t.webrtcEnable,t.pushConfig=new o(t.pushConfig),this.cbAndSendCmd("initWhiteBoard",t)},e.wbKeepCalling=function(t){return n.verifyOptions(t,"type accounts channelId"),this.cbAndSendCmd("wbKeepCalling",t)},e.wbCalleeAck=function(t){return n.verifyOptions(t,"account channelId type accepted"),this.cbAndSendCmd("wbCalleeAck",t)},e.wbHangup=function(t){return n.verifyOptions(t,"channelId"),this.cbAndSendCmd("wbHangup",t)},e.wbControl=function(t){return n.verifyOptions(t,"channelId type"),this.cbAndSendCmd("wbControl",t)},e.wbCreateChannel=function(t){return this.cbAndSendCmd("wbCreateChannel",t)},e.wbJoinChannel=function(t){return n.verifyOptions(t,"channelName"),n.verifyBooleanWithDefault(t,"liveEnable",!1),n.verifyBooleanWithDefault(t,"webrtcEnable",!1),this.cbAndSendCmd("wbJoinChannel",{channelName:t.channelName,liveOption:{liveEnable:t.liveEnable?1:0,webrtcEnable:t.webrtcEnable?1:0}})},e.wbQueryAccountUidMap=function(t,e){return this.cbAndSendCmd("wbQueryAccountUidMap",{channelName:t,uids:e})}},t.exports=o},235:function(t,e){"use strict";var n={};n.install=function(t){var e=t.Protocol.fn;e.processDatatun=function(t){switch(t.cmd){case"initWhiteBoard":this.onWbInit(t);break;case"wbBeCalled":this.onWbBeCalled(t);break;case"wbKeepCalling":this.onWbKeepCalling(t);break;case"wbCalleeAck":break;case"wbNotifyCalleeAck":this.onWbNotifyCalleeAck(t);break;case"wbHangup":break;case"wbNotifyHangup":this.onWbNotifyHangup(t);break;case"wbNotifyControl":this.onWbControl(t);break;case"wbNotifyCalleeAckSync":this.onWbNotifyCalleeAckSync(t);break;case"wbNotifyRecord":break;case"wbCreateChannel":break;case"wbJoinChannel":this.wbJoinChannel(t);break;case"wbNotifyJoin":this.onWbNotifyJoin(t)}},e.onWbInit=function(t){if(!t.error){var e=t.obj.type;t.obj=t.content,t.obj.type=e,t.obj.accounts=t.obj.keepCallingAccounts,this.setCurrentWhiteBoard(t.obj.channelId),this.wbKeepCalling(t)}},e.setCurrentWhiteBoard=function(t){this.currentWhiteBoardChannelId=t},e.onWbKeepCalling=function(t){t.error||t.content.accounts.length&&this.wbKeepCalling(t)},e.wbKeepCalling=function(t){var e=this,n=t.obj,i=n.type,o=n.accounts,r=n.channelId;o&&o.length&&setTimeout(function(){e.currentWhiteBoardChannelId&&e.currentWhiteBoardChannelId===r&&e.api.wbKeepCalling({type:i,accounts:o,channelId:r})["catch"](function(){})},3e3)},e.onWbBeCalled=function(t){t.error||this.emitAPI({type:"wbBeCalled",obj:t.content})},e.onWbNotifyCalleeAck=function(t){t.error||this.emitAPI({type:"wbNotifyCalleeAck",obj:t.content})},e.onWbNotifyHangup=function(t){t.error||this.emitAPI({type:"wbNotifyHangup",obj:t.content})},e.onWbControl=function(t){t.error||this.emitAPI({type:"wbControl",obj:t.content})},e.onWbNotifyCalleeAckSync=function(t){t.error||this.emitAPI({type:"wbNotifyCalleeAckSync",obj:t.content})},e.onWbNotifyJoin=function(t){t.error||this.emitAPI({type:"wbNotifyJoin",obj:t.content})},e.wbJoinChannel=function(t){t.obj=t.content}},t.exports=n},236:function(t,e){"use strict";var n=11,i={wb:{id:n,initWhiteBoard:1,wbKeepCalling:2,wbCalleeAck:4,wbNotifyCalleeAck:5,wbHangup:8,wbNotifyHangup:9,wbControl:10,wbNotifyControl:11,wbNotifyRecord:12,wbCreateChannel:13,wbJoinChannel:14,wbNotifyJoin:15,wbQueryAccountUidMap:16}},o={initWhiteBoard:{sid:n,cid:i.wb.initWhiteBoard,params:[{type:"StrArray",name:"type"},{type:"StrArray",name:"accounts"},{type:"String",name:"pushContent"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"}]},wbKeepCalling:{sid:n,cid:i.wb.wbKeepCalling,params:[{type:"StrArray",name:"accounts"},{type:"long",name:"channelId"}]},wbCalleeAck:{sid:n,cid:i.wb.wbCalleeAck,params:[{type:"long",name:"channelId"},{type:"bool",name:"accepted"}]},wbHangup:{sid:n,cid:i.wb.wbHangup,params:[{type:"long",name:"channelId"}]},wbControl:{sid:n,cid:i.wb.wbControl,params:[{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"string",name:"info"}]},wbCreateChannel:{sid:n,cid:i.wb.wbCreateChannel,params:[{type:"String",name:"channelName"},{type:"String",name:"custom"},{type:"String",name:"webrtcEnable"}]},wbJoinChannel:{sid:n,cid:i.wb.wbJoinChannel,params:[{type:"String",name:"channelName"},{type:"Property",name:"liveOption"}]},wbQueryAccountUidMap:{sid:n,cid:i.wb.wbQueryAccountUidMap,params:[{type:"String",name:"channelName"},{type:"LongArray",name:"uids"}]}},r="datatun",s={"11_1":{service:r,cmd:"initWhiteBoard",response:[{type:"Number",name:"timetag"},{type:"Number",name:"uid"},{type:"Number",name:"channelId"},{type:"PropertyArray",name:"turnInfoTag"},{type:"StrArray",name:"keepCallingAccounts"},{type:"StrLongMap",name:"accountUidMap"},{type:"bool",name:"p2p"},{type:"String",name:"clientConfig"}]},"11_2":{service:r,cmd:"wbKeepCalling",response:[{type:"StrArr",name:"accounts"}]},"11_3":{service:r,cmd:"wbBeCalled",response:[{type:"Number",name:"timetag"},{type:"String",name:"account"},{type:"Number",name:"channelId"},{type:"PropertyArray",name:"turnInfoTag"},{type:"StrLongMap",name:"accountUidMap"},{type:"bool",name:"p2p"},{type:"String",name:"custom"},{type:"Number",name:"uid"},{type:"String",name:"clientConfig"},{type:"Property",
name:"pushConfig"}]},"11_4":{service:r,cmd:"wbCalleeAck",response:[]},"11_5":{service:r,cmd:"wbNotifyCalleeAck",response:[{type:"long",name:"channelId"},{type:"String",name:"account"},{type:"bool",name:"accepted"}]},"11_6":{service:r,cmd:"wbNotifyCalleeAckSync",response:[{type:"String",name:"timetag"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"},{type:"byte",name:"fromClientType"}]},"11_7":{service:r,cmd:"xxxx",response:[]},"11_8":{service:r,cmd:"wbHangup",response:[]},"11_9":{service:r,cmd:"wbNotifyHangup",response:[{type:"long",name:"timetag"},{type:"long",name:"channelId"},{type:"String",name:"account"}]},"11_10":{service:r,cmd:"wbControl",response:[]},"11_11":{service:r,cmd:"wbNotifyControl",response:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"string",name:"info"},{type:"long",name:"channelId"}]},"11_12":{service:r,cmd:"wbNotifyRecord",response:[{type:"Property",name:"msg"}]},"11_13":{service:r,cmd:"wbCreateChannel",response:[{type:"long",name:"timetag"}]},"11_14":{service:r,cmd:"wbJoinChannel",response:[{type:"long",name:"timetag"},{type:"long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"},{type:"Property",name:"turnInfoTag"},{type:"String",name:"custom"}]},"11_15":{service:r,cmd:"wbNotifyJoin",response:[{type:"Long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"}]},"11_16":{service:r,cmd:"wbQueryAccountUidMap",response:[]}};t.exports={idMap:i,cmdConfig:o,packetConfig:s}},237:function(t,e){"use strict";t.exports={pushConfig:{enable:1,needBadge:2,needPushNick:3,pushContent:4,custom:5,pushPayload:6,sound:7,webrtcEnable:10},liveOption:{liveEnable:1,webrtcEnable:2},turnInfoTag:{channelId:0,tunnelServer:1,proxyServer:2,stunServer:3,type:4,dispatchServer:5},gateWay:{login:1,loginAck:2,join:3,keep_alive:4,keep_alive_ack:5,keep_alive_node:6,broadcast:7,toUser:8,logout:9}}},238:function(t,e){"use strict";t.exports={pushConfig:{1:"enable",2:"needBadge",3:"needPushNick",4:"pushContent",5:"custom",6:"pushPayload",7:"sound",10:"webrtcEnable"},liveOption:{1:"liveEnable",2:"webrtcEnable"},turnInfoTag:{0:"channelId",1:"tunnelServer",2:"proxyServer",3:"stunServer",4:"type",5:"dispatchServer"}}},247:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=n(20),c=n(63),l=i(c),u=n(215),h=i(u),p=n(7),d=n(11),f=n(214),b=i(f);a.configMap.CURRENT.SDK_TYPE=a.configMap.SDK_TYPE.WHITEBOARD;var v=function(t){function e(n){o(this,e);var i=r(this,t.call(this,n));return i.initWB(),i}return s(e,t),e.prototype.initWB=function(){if(!this.nim)throw new Error({error:"请传入nim实例"});this.initProtocol(),this.initController()},e.prototype.initProtocol=function(){var t=this.nim;t.on("wbBeCalled",this.onBeCalled.bind(this)),t.on("wbNotifyCalleeAck",this.onCalleeAck.bind(this)),t.on("wbNotifyHangup",this.onHangup.bind(this)),t.on("wbControl",this.onControl.bind(this)),t.on("wbNotifyCalleeAckSync",this.onCalleeAckSync.bind(this)),t.on("wbNotifyJoin",this.onNotifyJoin.bind(this))},e.prototype.initController=function(){var t=this;window.myWbContrl=this.controller=new h["default"]({appKey:this.nim&&this.nim.options.appKey,debug:this.debug,container:this.container,logger:this.logger,client:this,isCustom:this.isCustom}),this.controller.on("userJoined",this.onUserJoin.bind(this)),this.controller.on("signalClosed",function(e){t.emit("signalClosed",e)}),this.controller.on("willReconnect",function(e){t.emit("willReconnect",e)}),this.controller.on("disconnected",function(e){t.emit("disconnected",e)}),this.controller.on("connected",function(e){t.emit("connected",e)}),this.controller.on("leaveChannel",this.onUserLeft.bind(this)),this.controller.on("error",function(e){t.emit("error",e)}),this.controller.on("customData",function(e){t.emit("customData",e)}),this.controller.on("data",function(e){t.emit("data",{account:t.getAccountWithUid(e.uid),data:e.data})}),window.addEventListener("beforeunload",this.beforeunload.bind(this))},e.prototype.serializeType=function(t,e){return e&&e!==d.constantBB.CALL_TYPE_NONE?e!==d.constantBB.CALL_TYPE_AUDIO?[t]:[e,t]:[t]},e.prototype.unserializeType=function(t){var e={},n=-1;return t.map(function(t,i){t===d.constantBB.CALL_TYPE_AUDIO&&(e.netcallType=d.constantBB.CALL_TYPE_AUDIO,n=i)}),n!==-1&&t.splice(e.i,1),e.type=t[0],e},e.prototype.call=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.account,n=t.type,i=t.netcallType,o=t.pushConfig,r=t.sessionConfig,s=t.webrtcEnable;return this.calling=!0,this.isCaller=!0,this.callee=e,this.target.account=e,r&&(r.signalStartTime=Date.now(),this.setSessionConfig(r)),this.initWhiteBoard({type:n,netcallType:i,pushConfig:o,webrtcEnable:s})},e.prototype.initWhiteBoard=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.type,i=e.netcallType,o=e.pushConfig,r=e.webrtcEnable;this.type=n,this.netcallType=i||d.constantBB.CALL_TYPE_NONE,this.setSessionConfig({signalStartTime:Date.now()});var s={type:this.serializeType(this.type,this.netcallType),accounts:[this.callee],pushConfig:o};return r&&(s.webrtcEnable=e.webrtcEnable),this.nim.initWhiteBoard(s).then(function(e){t.signalInited=!0,t.sessionMode="p2p",t.logger.log("initWhiteBoard:",e),t.callerInfo=t.wbFormat(e),t.imInfo=t.callerInfo,t.imInfo.sessionMode=t.sessionMode,t.channelId=e.channelId})["catch"](function(e){return t.setSessionConfig({signalEndTime:Date.now()}),t.resetWhenHangup(),Promise.reject(e)})},e.prototype.response=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.fn="wbCalleeAck",this.baseResponse(t)},e.prototype.control=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.info="",t.fn="wbControl",this.baseControl(t)},e.prototype.hangup=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.fn="wbHangup",t.recordType="cancelWhiteBoardBeforeAccept",this.baseHangup(t)},e.prototype.createChannel=function(t){return t.channelName?(t.custom=t.custom||"",this.baseCreateChannel("wbCreateChannel",t).then(function(t){return Promise.resolve(t)})["catch"](function(t){return Promise.reject(t)})):Promise.reject("缺少参数 channelName")},e.prototype.joinChannel=function(t){var e=this;if(this.signalInited)return Promise.reject("已经加入会议");if(!t.channelName)return Promise.reject("缺少参数 channelName");var n=t.sessionConfig;return n&&(p.tool.merge(this,{sessionConfig:n}),this.setSessionConfig(n),this.setSessionConfig({signalStartTime:Date.now()})),this.baseJoinChannel("wbJoinChannel",{channelName:t.channelName}).then(function(i){var o=void 0;return i.turnInfoTag&&(o=i.turnInfoTag.dispatchServer&&JSON.parse(i.turnInfoTag.dispatchServer)||i.turnInfoTag.tunnelServer),o&&o.constructor===String&&(o=o.split(";")),o&&o.constructor===Object&&(o=o.webrtcarray),i.serverAddrs=o||[],e.type=i.type=i.type,i.account=e.nim.account,i.sessionConfig=n,e.imInfo=i,setTimeout(function(){e.sessionStarted||e.startSession(t)},200),Promise.resolve({uid:i.uid,account:e.nim.account,type:i.type})})["catch"](function(t){return Promise.reject(t)})},e.prototype.onBeCalled=function(t){t=this.wbFormat(t),this.channelId||(this.signalInited=!0,this.channelId=t.channelId,this.beCalledInfo=t,this.logger.log("beCalling",t)),this.emit("beCalling",t)},e.prototype.wbFormat=function(t){var e=t,n=e.turnInfoTag;return n&&n.constructor===Array?(n.map(function(e){/[01]/.test(e.type)?(t.netcallType=e.type,t.rtcServerMap=e.dispatchServer,t.serverMap=JSON.parse(JSON.stringify(e.dispatchServer))):(t.type=e.type,t.wbServerMap=e.dispatchServer)}),t.netcallType=t.netcallType||d.constantBB.CALL_TYPE_NONE,t=this.format(t),t.serverAddrs=JSON.parse(JSON.stringify(t.wbServerMap))||[],t):t},e.prototype.resetWhenHangup=function(){this.controller.stopSession(),this.resetStatus(),this.sessionStarted=!1},e}(l["default"]),g=v.prototype;g=Object.assign(g,b["default"]),e["default"]=v,t.exports=e["default"]}})});